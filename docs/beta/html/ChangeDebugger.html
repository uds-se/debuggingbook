
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Isolating Failure-Inducing Changes &#8212; The Debugging Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=d5c2cecb" />
    <link rel="stylesheet" type="text/css" href="_static/mastodon-timeline.css?v=f82c2b23" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ChangeDebugger';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Statistical Debugging" href="StatisticalDebugger.html" />
    <link rel="prev" title="Reducing Failure-Inducing Inputs" href="DeltaDebugger.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p>This is a beta version of debuggingbook.org, currently in development. See the <a href="https://debuggingbook.org/classic/"  style="color:white!important;">classic site</a> for the 2024 version.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/debuggingbook.png" class="logo__image only-light" alt="The Debugging Book - Home"/>
    <script>document.write(`<img src="_static/debuggingbook.png" class="logo__image only-dark" alt="The Debugging Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    The Debugging Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tours.html">Sitemap</a></li>
<li class="toctree-l1"><a class="reference internal" href="Intro_Debugging.html">Introduction to Debugging</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Observing Executions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracer.html">Tracing Executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Debugger.html">How Debuggers Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="Assertions.html">Asserting Expectations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Flows and Dependencies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Slicer.html">Tracking Failure Origins</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reducing Failure Causes</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="DeltaDebugger.html">Reducing Failure-Inducing Inputs</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Isolating Failure-Inducing Changes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Abstracting Failures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="StatisticalDebugger.html">Statistical Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicInvariants.html">Mining Function Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="DDSetDebugger.html">Generalizing Failure Circumstances</a></li>
<li class="toctree-l1"><a class="reference internal" href="Alhazen.html">Learning from Failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="PerformanceDebugger.html">Debugging Performance Issues</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Automatic Repair</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Repairer.html">Repairing Code Automatically</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Debugging in the Large</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracking.html">Tracking Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeCounter.html">Where the Bugs are</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ExpectError.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timer.html">Timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timeout.html">Timeout</a></li>
<li class="toctree-l1"><a class="reference internal" href="ClassDiagram.html">Class Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="StackInspector.html">Inspecting Call Stacks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About This Book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ReleaseNotes.html">Release Notes for The Debugging Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importing.html">Downloads and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Guide_for_Authors.html">Guide for Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uds-se/debuggingbook/master?urlpath=tree/docs/notebooks/ChangeDebugger.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook/issues/new?title=Issue%20on%20page%20%2FChangeDebugger.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
    <li><a href="../code/ChangeDebugger.py" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="Download Python code"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">.py</span>
    </a>
    </li>
    
      
      
      
      <li><a href="_sources/ChangeDebugger.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download notebook"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  
    <li><a href="Importing.html" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="All downloads"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">All downloads</span>
    </a>
    </li>
    </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Isolating Failure-Inducing Changes</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#high-level-interface">High-Level Interface</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#programmatic-interface">Programmatic Interface</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supporting-functions">Supporting Functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#changes-and-bugs">Changes and Bugs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#leveraging-version-histories">Leveraging Version Histories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-version-history">An Example Version History</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-working-directory">Create a Working Directory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-git">Initialize Git</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#excursion-adding-more-revisions">Excursion: Adding More Revisions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-excursion">End of Excursion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-versions">Accessing Versions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-bisecting">Manual Bisecting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-bisecting">Automatic Bisecting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-and-applying-patches">Computing and Applying Patches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delta-debugging-on-patches">Delta Debugging on Patches</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-minimal-set-of-patches">A Minimal Set of Patches</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-minimal-difference">A Minimal Difference</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-changedebugger-class">A ChangeDebugger class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-fine-grained-changes">Exercise 1: Fine-Grained Changes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-failure-inducing-changes-in-the-large">Exercise 2: Failure-Inducing Changes in the Large</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-hierarchical-change-debugging">Exercise 3: Hierarchical Change Debugging</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="isolating-failure-inducing-changes">
<h1>Isolating Failure-Inducing Changes<a class="headerlink" href="#isolating-failure-inducing-changes" title="Link to this heading">#</a></h1>
<p>“Yesterday, my program worked. Today, it does not. Why?” In debugging, as elsewhere in software development, code keeps on changing. Thus, it can happen that a piece of code that yesterday was working perfectly, today no longer runs – because we (or others) have made some changes to it that cause it to fail. The good news is that for debugging, we can actually <em>exploit</em> this version history to narrow down <em>the changes that caused the failure</em> – be it by us or by others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;hX9ViNEXGL8&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="640"
            height="360"
            src="https://www.youtube-nocookie.com/embed/hX9ViNEXGL8"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p>You should have read the <a class="reference internal" href="DeltaDebugger.html"><span class="std std-doc">Chapter on Delta Debugging</span></a>.</p></li>
<li><p>Knowledge on version control systems (notably git) will be useful.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bookutils.setup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">quiz</span><span class="p">,</span> <span class="n">print_file</span><span class="p">,</span> <span class="n">print_content</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Link to this heading">#</a></h2>
<p>To <a class="reference internal" href="Importing.html"><span class="std std-doc">use the code provided in this chapter</span></a>, write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">debuggingbook.ChangeDebugger</span><span class="w"> </span><span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and then make use of the following features.</p>
<p><strong>Note</strong>: The examples in this section only work after the rest of the cells have been executed.</p>
<p>This chapter introduces a class <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> that automatically determines failure-inducing code changes.</p>
<section id="high-level-interface">
<h3>High-Level Interface<a class="headerlink" href="#high-level-interface" title="Link to this heading">#</a></h3>
<p>You are given two Python source codes <code class="docutils literal notranslate"><span class="pre">source_pass</span></code> and <code class="docutils literal notranslate"><span class="pre">source_fail</span></code>, and a function <code class="docutils literal notranslate"><span class="pre">test()</span></code> that works using the definitions in <code class="docutils literal notranslate"><span class="pre">source_pass</span></code>, but raises an exception using the definitions in <code class="docutils literal notranslate"><span class="pre">source_fail</span></code>. Then, you can use <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ChangeDebugger</span><span class="p">(</span><span class="n">source_pass</span><span class="p">,</span> <span class="n">source_fail</span><span class="p">)</span> <span class="k">as</span> <span class="n">cd</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
<span class="n">cd</span>
</pre></div>
</div>
<p>This will produce the failure-inducing change between <code class="docutils literal notranslate"><span class="pre">source_pass</span></code> and <code class="docutils literal notranslate"><span class="pre">source_fail</span></code>, using <a class="reference internal" href="DeltaDebugger.html"><span class="std std-doc">Delta Debugging</span></a> to determine minimal differences in patches applied.</p>
<div class="cell tag_remove-input docutils container">
</div>
<p>Here is an example. The function <code class="docutils literal notranslate"><span class="pre">test()</span></code> passes (raises no exception) if <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> is defined as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">source_pass</span><span class="p">,</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span><span class="p">(</span><span class="n">source_pass</span><span class="p">)</span>
<span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> is changed as follows, though, then
<code class="docutils literal notranslate"><span class="pre">test()</span></code> raises an exception and fails:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">source_fail</span><span class="p">,</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span><span class="p">(</span><span class="n">source_fail</span><span class="p">)</span>
<span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/4262003862.py&quot;, line 3, in &lt;module&gt;
    test()
    ~~~~^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/3045937450.py&quot;, line 2, in test
    assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> to automatically identify the failure-inducing difference:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ChangeDebugger</span><span class="p">(</span><span class="n">source_pass</span><span class="p">,</span> <span class="n">source_fail</span><span class="p">)</span> <span class="k">as</span> <span class="n">cd</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
<span class="n">cd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -215,24 +215,97 @@
 tag = False

+        elif c == &#39;&quot;&#39; or c == &quot;&#39;&quot; and tag:
            quote = not quote

         elif
</pre></div>
</div>
</div>
</div>
<p>The lines prefixed with <code class="docutils literal notranslate"><span class="pre">+</span></code> from are the ones in <code class="docutils literal notranslate"><span class="pre">source_fail</span></code> that cause the failure when added. (They also are the ones that should be fixed.)</p>
</section>
<section id="programmatic-interface">
<h3>Programmatic Interface<a class="headerlink" href="#programmatic-interface" title="Link to this heading">#</a></h3>
<p>For more details or more automation, use the programmatic interface. The method <code class="docutils literal notranslate"><span class="pre">min_patches()</span></code> returns a triple (<code class="docutils literal notranslate"><span class="pre">pass_patches</span></code>, <code class="docutils literal notranslate"><span class="pre">fail_patches</span></code>, <code class="docutils literal notranslate"><span class="pre">diffs</span></code>) where</p>
<ul class="simple">
<li><p>applying <code class="docutils literal notranslate"><span class="pre">pass_patches</span></code> still make the call pass</p></li>
<li><p>applying <code class="docutils literal notranslate"><span class="pre">fail_patches</span></code> causes the call to fail</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">diffs</span></code> is the (minimal) difference between the two.</p></li>
</ul>
<p>The patches come as list of <code class="docutils literal notranslate"><span class="pre">patch_obj</span></code> objects, as defined by Google’s <a class="reference external" href="https://github.com/google/diff-match-patch">diff-match-patch library</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pass_patches</span><span class="p">,</span> <span class="n">fail_patches</span><span class="p">,</span> <span class="n">diffs</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">min_patches</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>One can apply all patches in <code class="docutils literal notranslate"><span class="pre">pass_patches</span></code> and still not cause the test to fail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pass_patches</span><span class="p">:</span>
    <span class="n">print_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -<span class=" -Color -Color-Blue">48</span>,<span class=" -Color -Color-Blue">24</span> +<span class=" -Color -Color-Blue">48</span>,<span class=" -Color -Color-Blue">42</span> @@
 tag = <span class=" -Color -Color-Blue">False</span>

+    quote = <span class=" -Color -Color-Blue">False</span>

     out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>
@@ -<span class=" -Color -Color-Blue">104</span>,<span class=" -Color -Color-Blue">50</span> +<span class=" -Color -Color-Blue">104</span>,<span class=" -Color -Color-Blue">43</span> @@
  s:

-        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>

+        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
</pre></div>
</div>
</div>
</div>
<p>However, as soon as we also apply the patches in <code class="docutils literal notranslate"><span class="pre">diffs</span></code>, we get the failure. (This is also what is shown when we output a <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
    <span class="n">print_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">24</span> +<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">97</span> @@
 tag = <span class=" -Color -Color-Blue">False</span>

+        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote

         <span class=" -Color -Color-Blue">elif</span>
</pre></div>
</div>
</div>
</div>
<p>The full set of methods in <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> is shown below.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 14.0.2 (20251019.1705)
 -->
<!-- Pages: 1 -->
<svg width="296pt" height="400pt"
 viewBox="0.00 0.00 296.00 400.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 395.5)">
<g id="a_graph0"><a xlink:title="ChangeDebugger class hierarchy">
<polygon fill="white" stroke="none" points="-4,4 -4,-395.5 291.62,-395.5 291.62,4 -4,4"/>
</a>
</g>
<!-- ChangeDebugger -->
<g id="node1" class="node">
<title>ChangeDebugger</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class ChangeDebugger:&#10;Collect an exception&#45;raising function call f().&#10;Use as `with CallCollector(): f()`">
<polygon fill="none" stroke="black" points="15.38,-0.5 15.38,-148.5 150.62,-148.5 150.62,-0.5 15.38,-0.5"/>
<text xml:space="preserve" text-anchor="start" x="23.38" y="-132.2" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">ChangeDebugger</text>
<polyline fill="none" stroke="black" points="15.38,-123.25 150.62,-123.25"/>
<g id="a_node1_0"><a xlink:href="#" xlink:title="ChangeDebugger">
<g id="a_node1_1"><a xlink:href="#" xlink:title="__enter__(self) &#45;&gt; Any:&#10;Called at begin of a `with` block. Checks if current source fails.">
<text xml:space="preserve" text-anchor="start" x="29" y="-110.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__enter__()</text>
</a>
</g>
<g id="a_node1_2"><a xlink:href="#" xlink:title="__init__(self, pass_source: str, fail_source: str, **ddargs: Any) &#45;&gt; None:&#10;Constructor. Takes a passing source file (`pass_source`)&#10;and a failing source file (`fail_source`).&#10;Additional arguments are passed to `DeltaDebugger` constructor.">
<text xml:space="preserve" text-anchor="start" x="29" y="-98" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node1_3"><a xlink:href="#" xlink:title="__repr__(self) &#45;&gt; str:&#10;Return readable list of minimal patches">
<text xml:space="preserve" text-anchor="start" x="29" y="-85.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__repr__()</text>
</a>
</g>
<g id="a_node1_4"><a xlink:href="#" xlink:title="fail_source(self) &#45;&gt; str:&#10;Return the failing source file.">
<text xml:space="preserve" text-anchor="start" x="29" y="-72.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">fail_source()</text>
</a>
</g>
<g id="a_node1_5"><a xlink:href="#" xlink:title="min_patches(self) &#45;&gt; Tuple[List[diff_match_patch.diff_match_patch.patch_obj], List[diff_match_patch.diff_match_patch.patch_obj], List[diff_match_patch.diff_match_patch.patch_obj]]:&#10;Compute a minimal set of patches.&#10;Returns a triple (`pass_patches`, `fail_patches`, `diff_patches`)&#10;where `diff_patches` is the minimal difference between&#10;the set `pass_patches` (which, when applied, make the test pass) and&#10;the set `fail_patches` (which, when applied, make the test fail).">
<text xml:space="preserve" text-anchor="start" x="29" y="-59.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">min_patches()</text>
</a>
</g>
<g id="a_node1_6"><a xlink:href="#" xlink:title="pass_source(self) &#45;&gt; str:&#10;Return the passing source file.">
<text xml:space="preserve" text-anchor="start" x="29" y="-47" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">pass_source()</text>
</a>
</g>
<g id="a_node1_7"><a xlink:href="#" xlink:title="patches(self) &#45;&gt; List[diff_match_patch.diff_match_patch.patch_obj]:&#10;Return the diff between passing and failing source files.">
<text xml:space="preserve" text-anchor="start" x="29" y="-34.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">patches()</text>
</a>
</g>
<g id="a_node1_8"><a xlink:href="#" xlink:title="after_collection(self) &#45;&gt; None:&#10;Diagnostics.">
<text xml:space="preserve" text-anchor="start" x="29" y="-21.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">after_collection()</text>
</a>
</g>
<g id="a_node1_9"><a xlink:href="#" xlink:title="test_patches(self, patches: List[diff_match_patch.diff_match_patch.patch_obj]) &#45;&gt; None">
<text xml:space="preserve" text-anchor="start" x="29" y="-7.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">test_patches()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CallCollector -->
<g id="node2" class="node">
<title>CallCollector</title>
<g id="a_node2"><a xlink:href="DeltaDebugger.ipynb" xlink:title="class CallCollector:&#10;Collect an exception&#45;raising function call f().&#10;Use as `with CallCollector(): f()`">
<polygon fill="none" stroke="black" points="30.38,-185.5 30.38,-308 135.62,-308 135.62,-185.5 30.38,-185.5"/>
<text xml:space="preserve" text-anchor="start" x="38.38" y="-291.7" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">CallCollector</text>
<polyline fill="none" stroke="black" points="30.38,-282.75 135.62,-282.75"/>
<g id="a_node2_10"><a xlink:href="#" xlink:title="CallCollector">
<g id="a_node2_11"><a xlink:href="DeltaDebugger.ipynb" xlink:title="__enter__(self) &#45;&gt; Any:&#10;Called at begin of `with` block. Turn tracing on.">
<text xml:space="preserve" text-anchor="start" x="50" y="-270.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__enter__()</text>
</a>
</g>
<g id="a_node2_12"><a xlink:href="DeltaDebugger.ipynb" xlink:title="__exit__(self, exc_tp: Type, exc_value: BaseException, exc_traceback: traceback) &#45;&gt; Optional[bool]:&#10;Called at end of `with` block. Turn tracing off.">
<text xml:space="preserve" text-anchor="start" x="50" y="-257.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__exit__()</text>
</a>
</g>
<g id="a_node2_13"><a xlink:href="DeltaDebugger.ipynb" xlink:title="__init__(self) &#45;&gt; None:&#10;Initialize collector">
<text xml:space="preserve" text-anchor="start" x="50" y="-244.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node2_14"><a xlink:href="DeltaDebugger.ipynb" xlink:title="args(self) &#45;&gt; Dict[str, Any]:&#10;Return the dictionary of collected arguments.">
<text xml:space="preserve" text-anchor="start" x="50" y="-232" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">args()</text>
</a>
</g>
<g id="a_node2_15"><a xlink:href="DeltaDebugger.ipynb" xlink:title="call(self, new_args: Optional[Dict[str, Any]] = None) &#45;&gt; Any:&#10;Call collected function. If `new_args` is given,&#10;override arguments from its {var: value} entries.">
<text xml:space="preserve" text-anchor="start" x="50" y="-219.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">call()</text>
</a>
</g>
<g id="a_node2_16"><a xlink:href="DeltaDebugger.ipynb" xlink:title="exception(self) &#45;&gt; Optional[BaseException]:&#10;Return the exception produced, or `None` if none.">
<text xml:space="preserve" text-anchor="start" x="50" y="-206.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">exception()</text>
</a>
</g>
<g id="a_node2_17"><a xlink:href="DeltaDebugger.ipynb" xlink:title="function(self) &#45;&gt; Callable:&#10;Return the function called.">
<text xml:space="preserve" text-anchor="start" x="50" y="-193.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">function()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- ChangeDebugger&#45;&gt;CallCollector -->
<g id="edge1" class="edge">
<title>ChangeDebugger&#45;&gt;CallCollector</title>
<path fill="none" stroke="black" d="M83,-148.69C83,-157.05 83,-165.58 83,-173.92"/>
<polygon fill="none" stroke="black" points="79.5,-173.65 83,-183.65 86.5,-173.65 79.5,-173.65"/>
</g>
<!-- StackInspector -->
<g id="node3" class="node">
<title>StackInspector</title>
<g id="a_node3"><a xlink:href="StackInspector.ipynb" xlink:title="class StackInspector:&#10;Provide functions to inspect the stack">
<polygon fill="none" stroke="black" points="0,-345 0,-391 166,-391 166,-345 0,-345"/>
<text xml:space="preserve" text-anchor="start" x="32.75" y="-374.7" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">StackInspector</text>
<polyline fill="none" stroke="black" points="0,-365.75 166,-365.75"/>
<g id="a_node3_18"><a xlink:href="#" xlink:title="StackInspector">
<g id="a_node3_19"><a xlink:href="StackInspector.ipynb" xlink:title="_generated_function_cache = {(&#39;test_patches&#39;, 2): &lt;function ChangeDebugger.test_patches at 0x10e032e80&gt;}">
<text xml:space="preserve" text-anchor="start" x="8" y="-352.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">_generated_function_cache</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CallCollector&#45;&gt;StackInspector -->
<g id="edge2" class="edge">
<title>CallCollector&#45;&gt;StackInspector</title>
<path fill="none" stroke="black" d="M83,-308.42C83,-317.06 83,-325.66 83,-333.52"/>
<polygon fill="none" stroke="black" points="79.5,-333.25 83,-343.25 86.5,-333.25 79.5,-333.25"/>
</g>
<!-- Legend -->
<g id="node4" class="node">
<title>Legend</title>
<text xml:space="preserve" text-anchor="start" x="168.38" y="-90.5" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="10.00" fill="#6a0dad">Legend</text>
<text xml:space="preserve" text-anchor="start" x="168.38" y="-80.5" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="174.38" y="-80.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00">public_method()</text>
<text xml:space="preserve" text-anchor="start" x="168.38" y="-70.5" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="174.38" y="-70.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00">private_method()</text>
<text xml:space="preserve" text-anchor="start" x="168.38" y="-60.5" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="174.38" y="-60.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00">overloaded_method()</text>
<text xml:space="preserve" text-anchor="start" x="168.38" y="-51.45" font-family="Helvetica,sans-Serif" font-size="9.00">Hover over names to see doc</text>
</g>
</g>
</svg>
</div></div>
</div>
</section>
<section id="supporting-functions">
<h3>Supporting Functions<a class="headerlink" href="#supporting-functions" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> relies on lower level <code class="docutils literal notranslate"><span class="pre">patch()</span></code> and <code class="docutils literal notranslate"><span class="pre">diff()</span></code> functions.</p>
<p>To apply patch objects on source code, use the <code class="docutils literal notranslate"><span class="pre">patch()</span></code> function. It takes a source code and a list of patches to be applied.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">patch</span><span class="p">(</span><span class="n">source_pass</span><span class="p">,</span> <span class="n">diffs</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>Conversely, the <code class="docutils literal notranslate"><span class="pre">diff()</span></code> function computes patches between two texts. It returns a list of patch objects that can be applied on text.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">(</span><span class="n">source_pass</span><span class="p">,</span> <span class="n">source_fail</span><span class="p">):</span>
    <span class="n">print_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -<span class=" -Color -Color-Blue">48</span>,<span class=" -Color -Color-Blue">24</span> +<span class=" -Color -Color-Blue">48</span>,<span class=" -Color -Color-Blue">42</span> @@
 tag = <span class=" -Color -Color-Blue">False</span>

+    quote = <span class=" -Color -Color-Blue">False</span>

     out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>
@@ -<span class=" -Color -Color-Blue">104</span>,<span class=" -Color -Color-Blue">50</span> +<span class=" -Color -Color-Blue">104</span>,<span class=" -Color -Color-Blue">43</span> @@
  s:

-        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>

+        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
@@ -<span class=" -Color -Color-Blue">162</span>,<span class=" -Color -Color-Blue">48</span> +<span class=" -Color -Color-Blue">162</span>,<span class=" -Color -Color-Blue">45</span> @@
 rue

-        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>

+        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
@@ -<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">24</span> +<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">97</span> @@
 tag = <span class=" -Color -Color-Blue">False</span>

+        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote

         <span class=" -Color -Color-Blue">elif</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="changes-and-bugs">
<h2>Changes and Bugs<a class="headerlink" href="#changes-and-bugs" title="Link to this heading">#</a></h2>
<p>When you develop software, it is unlikely that you will be able to produce a fully working piece of software right from the beginning – hence the need for debugging. It is just as unlikely, though, that your software will stay <em>unchanged</em> forever. Evolving requirements, the introduction of new technology, changes in the environment all induce software changes – and every such change brings the risk of introducing new bugs.</p>
<p>To detect such bugs introduced by changes, systematic (and best automatic) <em>testing</em>, notably <em>regression testing</em>, can be a big help; in fact, the more comprehensive and the more automated your testing strategy is, the more it actually <em>enables</em> evolving your software, because every new test lowers the risk of a change introducing a bug. Extensive testing is what enables agile development – and we’re happy to point to our <a class="reference external" href="https://www.fuzzingbook.org">sibling book on test generation</a> to give you some inspiration on how to do this.</p>
<p>However, a test can only <em>detect</em> failures, not <em>fix</em> them. The more you change, the more you may need to fix, too. The good news is that there are a number of debugging techniques, manual and automated, that can actually <em>exploit</em> the presence of older, working software versions to effectively narrow down the causes of failure in a new, failing software.</p>
</section>
<section id="leveraging-version-histories">
<h2>Leveraging Version Histories<a class="headerlink" href="#leveraging-version-histories" title="Link to this heading">#</a></h2>
<p>The fundamental prerequisite for exploiting older, working software versions is to have such older, working versions in the first place. If your software <em>always</em> failed, then you will have to resort to conventional debugging. But if there is an older <em>working</em> version, you can make use of it.</p>
<p>We assume that you do have a <em>version repository</em> such as git or SVN, which you use to organize software development and keep older software versions.  (If you do <em>not</em> use version control for your project, you are in <a class="reference internal" href="Intro_Debugging.html"><span class="std std-doc">debugging hell</span></a>. Go and set it up now, and come back once you’re done.)</p>
<p>If you have a version history, an older working version, and a new failing version, your situation is roughly as depicted in this diagram:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">graphviz</span><span class="w"> </span><span class="kn">import</span> <span class="n">Digraph</span><span class="p">,</span> <span class="n">nohtml</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/856bc9c4783952d21d1034476a19e941b6953095d4c1ae1dc49ac4fd75e63ea6.svg" src="_images/856bc9c4783952d21d1034476a19e941b6953095d4c1ae1dc49ac4fd75e63ea6.svg" />
</div>
</div>
<p>Somewhere between the old version “v1” (“yesterday”) and the current version “v8” (“today”), the software stopped working. But when exactly? And which change was it that caused the failure?</p>
<p>You may think that this is an easy task: We simply manually test one version after another, thus determining the exact version that first failed. However,</p>
<ul class="simple">
<li><p>this can take a long time (notably in the presence of dozens or even hundreds of versions);</p></li>
<li><p>this may still leave you with <em>dozens of changes</em> applied from one version to another; and</p></li>
<li><p>this is actually a task that can be <em>fully automated</em>.</p></li>
</ul>
<p>And these “automated” debugging techniques are what we explore in this chapter.</p>
</section>
<section id="an-example-version-history">
<h2>An Example Version History<a class="headerlink" href="#an-example-version-history" title="Link to this heading">#</a></h2>
<p>As our ongoing example, we start with creating a little version history, using the git version management system. We follow the evolution of the <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> versions from <a class="reference internal" href="Intro_Debugging.html"><span class="std std-doc">the introduction to debugging</span></a> and <a class="reference internal" href="Assertions.html"><span class="std std-doc">the chapter on assertions</span></a>.</p>
<section id="create-a-working-directory">
<h3>Create a Working Directory<a class="headerlink" href="#create-a-working-directory" title="Link to this heading">#</a></h3>
<p>We start with creating a working folder (aptly named <code class="docutils literal notranslate"><span class="pre">my_project</span></code>) in which we will do our work. (Note: should you have a folder of that name, it will be deleted and re-initialized).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PROJECT</span> <span class="o">=</span> <span class="s1">&#39;my_project&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We choose the project folder as our working directory. Any file we create will be created in that folder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="initialize-git">
<h3>Initialize Git<a class="headerlink" href="#initialize-git" title="Link to this heading">#</a></h3>
<p>We set up a local Git repository in our local project folder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>init
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">hint: Using &#39;master&#39; as the name for the initial branch. This default branch name</span>
<span class=" -Color -Color-Yellow">hint: is subject to change. To configure the initial branch name to use in all</span>
<span class=" -Color -Color-Yellow">hint: of your new repositories, which will suppress this warning, call:</span>
<span class=" -Color -Color-Yellow">hint:</span>
<span class=" -Color -Color-Yellow">hint: 	git config --global init.defaultBranch &lt;name&gt;</span>
<span class=" -Color -Color-Yellow">hint:</span>
<span class=" -Color -Color-Yellow">hint: Names commonly chosen instead of &#39;master&#39; are &#39;main&#39;, &#39;trunk&#39; and</span>
<span class=" -Color -Color-Yellow">hint: &#39;development&#39;. The just-created branch can be renamed via this command:</span>
<span class=" -Color -Color-Yellow">hint:</span>
<span class=" -Color -Color-Yellow">hint: 	git branch -m &lt;name&gt;</span>
Initialized empty Git repository in /Users/zeller/Projects/debuggingbook/notebooks/my_project/.git/
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>config<span class="w"> </span>user.name<span class="w"> </span><span class="s2">&quot;Demo User&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>config<span class="w"> </span>user.email<span class="w"> </span><span class="s2">&quot;demo-user@example.com&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>config<span class="w"> </span>advice.detachedHead<span class="w"> </span>False
</pre></div>
</div>
</div>
</div>
<p>We are now ready to commit our first version. Here’s the initial definition of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> from <a class="reference internal" href="Intro_Debugging.html"><span class="std std-doc">the introduction to debugging</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>    <span class="c1"># start of markup</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>  <span class="c1"># end of markup</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">write_source()</span></code> takes a function <code class="docutils literal notranslate"><span class="pre">fun</span></code> and writes its source code into a file of the same name – in our case, <code class="docutils literal notranslate"><span class="pre">remove_html_markup.py</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">write_source</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fun</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Here is <code class="docutils literal notranslate"><span class="pre">write_source()</span></code> in action:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_source</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_file</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code>, we add the file to our version repository. The <code class="docutils literal notranslate"><span class="pre">-m</span></code> option defines a <em>message</em> for the commit; this is how we (and potential co-workers) can later retrieve information on what has changed, and why. (The messages we use here are deliberately kept short.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>add<span class="w"> </span>remove_html_markup.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;First version&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[master (root-commit) 033b881] First version
 1 file changed, 13 insertions(+)
 create mode 100644 remove_html_markup.py
</pre></div>
</div>
</div>
</div>
<p>Let us now take the second (buggy) version of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> and again write this into our file, thus simulating changing the source code from the first version to the new version:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_source</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can inspect the differences between the previously committed version and the current one. Lines prefixed with <code class="docutils literal notranslate"><span class="pre">+</span></code> are added; lines prefixed with <code class="docutils literal notranslate"><span class="pre">-</span></code> are deleted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>diff<span class="w"> </span>remove_html_markup.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">diff --git a/remove_html_markup.py b/remove_html_markup.py</span>
<span class=" -Color -Color-Bold">index 4999dc0..768bae9 100644</span>
<span class=" -Color -Color-Bold">--- a/remove_html_markup.py</span>
<span class=" -Color -Color-Bold">+++ b/remove_html_markup.py</span>
<span class=" -Color -Color-Cyan">@@ -1,12 +1,15 @@</span>
 def remove_html_markup(s):  # type: ignore
     tag = False
<span class=" -Color -Color-Green">+    quote = False</span>
     out = &quot;&quot;
 
     for c in s:
<span class=" -Color -Color-Red">-        if c == &#39;&lt;&#39;:    # start of markup</span>
<span class=" -Color -Color-Green">+        if c == &#39;&lt;&#39; and not quote:</span>
             tag = True
<span class=" -Color -Color-Red">-        elif c == &#39;&gt;&#39;:  # end of markup</span>
<span class=" -Color -Color-Green">+        elif c == &#39;&gt;&#39; and not quote:</span>
             tag = False
<span class=" -Color -Color-Green">+        elif c == &#39;&quot;&#39; or c == &quot;&#39;&quot; and tag:</span>
<span class=" -Color -Color-Green">+            quote = not quote</span>
         elif not tag:
             out = out + c
 
</pre></div>
</div>
</div>
</div>
<p>We can now commit this second version, adding it to our repository.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Second version&quot;</span><span class="w"> </span>remove_html_markup.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[master 1387f38] Second version
 1 file changed, 5 insertions(+), 2 deletions(-)
</pre></div>
</div>
</div>
</div>
<p>We create a few more revisions.</p>
</section>
<section id="excursion-adding-more-revisions">
<h3>Excursion: Adding More Revisions<a class="headerlink" href="#excursion-adding-more-revisions" title="Link to this heading">#</a></h3>
<p>We use the additional definitions for <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> from <a class="reference internal" href="Intro_Debugging.html"><span class="std std-doc">the introduction to debugging</span></a> as additional versions.</p>
<p>These also include “debugging” versions with enabled logging statements, as well as “tentative” versions that may or may not fix the discussed issues. In a real version history, such transient versions would typically not show up – or at least not be made available to co-workers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c =&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="s2">&quot;tag =&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;quote =&quot;</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_source</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Third version (with debugging output)&quot;</span><span class="w"> </span>remove_html_markup.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[master 817a3b5] Third version (with debugging output)
 1 file changed, 2 insertions(+)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>  <span class="c1"># and not quote:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>  <span class="c1"># and not quote:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_source</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Fourth version (clueless)&quot;</span><span class="w"> </span>remove_html_markup.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[master e85967e] Fourth version (clueless)
 1 file changed, 2 insertions(+), 4 deletions(-)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">tag</span>  <span class="c1"># &lt;=== Just added</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_source</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Fifth version (with assert)&quot;</span><span class="w"> </span>remove_html_markup.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[master 8682efe] Fifth version (with assert)
 1 file changed, 4 insertions(+), 2 deletions(-)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>  <span class="c1"># &lt;=== Just added</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_source</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Sixth version (with another assert)&quot;</span><span class="w"> </span>remove_html_markup.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[master 5a6d50c] Sixth version (with another assert)
 1 file changed, 1 insertion(+), 2 deletions(-)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>  <span class="c1"># &lt;-- FIX</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_source</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Seventh version (fixed)&quot;</span><span class="w"> </span>remove_html_markup.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[master dea04a4] Seventh version (fixed)
 1 file changed, 1 insertion(+), 2 deletions(-)
</pre></div>
</div>
</div>
</div>
</section>
<section id="end-of-excursion">
<h3>End of Excursion<a class="headerlink" href="#end-of-excursion" title="Link to this heading">#</a></h3>
<p>Here comes the last version of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, this one from <a class="reference internal" href="Assertions.html"><span class="std std-doc">the chapter on assertions</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="c1"># postcondition</span>
    <span class="k">assert</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span> <span class="ow">and</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_source</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Eighth version (with proper assertion)&quot;</span><span class="w"> </span>remove_html_markup.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[master e5b94d5] Eighth version (with proper assertion)
 1 file changed, 4 insertions(+), 1 deletion(-)
</pre></div>
</div>
</div>
</div>
<p>We finally reached the “today” state with the latest version – and find that the latest version has an error. This should come to you as no surprise if you have read the earlier chapters. But if you haven’t, you will find that when the argument <code class="docutils literal notranslate"><span class="pre">s</span></code> contains double quotes, these are stripped from the output:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;foo&#39;
</pre></div>
</div>
</div>
</div>
<p>Consequently, this test assertion fails:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ExpectError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExpectError</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/1036061906.py&quot;, line 2, in &lt;module&gt;
    assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>Note that the failure does <em>not</em> occur in the very first version, as introduced above. So the simple question is:</p>
<ul class="simple">
<li><p>What is the change that caused the failure?</p></li>
</ul>
</section>
</section>
<section id="accessing-versions">
<h2>Accessing Versions<a class="headerlink" href="#accessing-versions" title="Link to this heading">#</a></h2>
<p>To find out the failure-inducing change, we first need to be able to access older versions. The command</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>log
</pre></div>
</div>
<p>gives us a listing of all commits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>log
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">commit e5b94d59c858f6cf1f25e77a5790332ffe45aabb (</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">HEAD</span><span class=" -Color -Color-Yellow"> -&gt; </span><span class=" -Color -Color-Bold -Color-Bold-Green">master</span><span class=" -Color -Color-Yellow">)</span>
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:52 2025 +0100

    Eighth version (with proper assertion)

<span class=" -Color -Color-Yellow">commit dea04a436a9cdcaee5fd513d17946849dd852c09</span>
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:52 2025 +0100

    Seventh version (fixed)

<span class=" -Color -Color-Yellow">commit 5a6d50c9315c354c47130dd15a8ca564cd4d7e77</span>
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:52 2025 +0100

    Sixth version (with another assert)

<span class=" -Color -Color-Yellow">commit 8682efe02bc4ef0bb2571f3547f157fd5fcfdcdf</span>
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:52 2025 +0100

    Fifth version (with assert)

<span class=" -Color -Color-Yellow">commit e85967ef371579969f628e8cdea95af56f49e779</span>
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:51 2025 +0100

    Fourth version (clueless)

<span class=" -Color -Color-Yellow">commit 817a3b5392ab8f1179eda142feb8a32e9b585148</span>
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:51 2025 +0100

    Third version (with debugging output)

<span class=" -Color -Color-Yellow">commit 1387f381eee63c725f2224744213773b84d9dce6</span>
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:51 2025 +0100

    Second version

<span class=" -Color -Color-Yellow">commit 033b8816067e25eccd9a891f328641f5d3cd7545</span>
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:51 2025 +0100

    First version
</pre></div>
</div>
</div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> module, we can run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code> and access its output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_output</span><span class="p">(</span><span class="n">command</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> 
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
</pre></div>
</div>
</div>
</div>
<p>The output of <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code> contains the ID of the version (the so-called <em>commit hash</em>) as well as the message provided during the commit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="o">=</span> <span class="n">get_output</span><span class="p">([</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;--pretty=oneline&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>e5b94d59c858f6cf1f25e77a5790332ffe45aabb Eighth version (with proper assertion)
dea04a436a9cdcaee5fd513d17946849dd852c09 Seventh version (fixed)
5a6d50c9315c354c47130dd15a8ca564cd4d7e77 Sixth version (with another assert)
8682efe02bc4ef0bb2571f3547f157fd5fcfdcdf Fifth version (with assert)
e85967ef371579969f628e8cdea95af56f49e779 Fourth version (clueless)
817a3b5392ab8f1179eda142feb8a32e9b585148 Third version (with debugging output)
1387f381eee63c725f2224744213773b84d9dce6 Second version
033b8816067e25eccd9a891f328641f5d3cd7545 First version
</pre></div>
</div>
</div>
</div>
<p>Each hash uniquely identifies a version, and is required to access it. Let us create a list <code class="docutils literal notranslate"><span class="pre">versions</span></code>, where <code class="docutils literal notranslate"><span class="pre">versions[0]</span></code> contains the hash (the id) of the first version, <code class="docutils literal notranslate"><span class="pre">versions[1]</span></code> the second version, and so on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span><span class="p">]</span>
<span class="n">versions</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="n">versions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;033b8816067e25eccd9a891f328641f5d3cd7545&#39;
</pre></div>
</div>
</div>
</div>
<p>We can now check out the first version:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>checkout<span class="w"> </span><span class="o">{</span>versions<span class="o">[</span><span class="m">0</span><span class="o">]}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HEAD is now at 033b881 First version
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_file</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>If we read in this definition of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> from the first version, we will find that the failure was not yet present:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&quot;foo&quot;&#39;
</pre></div>
</div>
</div>
</div>
<p>However, if we check out the <em>last</em> version of that file …</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>checkout<span class="w"> </span><span class="o">{</span>versions<span class="o">[</span><span class="m">7</span><span class="o">]}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Previous HEAD position was 033b881 First version
HEAD is now at e5b94d5 Eighth version (with proper assertion)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_file</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-White"># postcondition</span>
    <span class=" -Color -Color-Blue">assert</span> <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">not</span> <span class=" -Color -Color-Magenta">in</span> out <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">not</span> <span class=" -Color -Color-Magenta">in</span> out

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>… we find that this is the version that no longer works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;foo&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="manual-bisecting">
<h2>Manual Bisecting<a class="headerlink" href="#manual-bisecting" title="Link to this heading">#</a></h2>
<p>As stated above, we could now go and try out one version after another to see with which version the bug was introduced. But again, proceeding in such a <em>linear</em> fashion would be very inefficient. It is much better to proceed by <em>binary search</em>: If you know that version <span class="math notranslate nohighlight">\(v_n\)</span> passed, and version <span class="math notranslate nohighlight">\(v_m\)</span> failed (with <span class="math notranslate nohighlight">\(m &gt;n\)</span>), then test a version <span class="math notranslate nohighlight">\(v' = v_{n + (m - n)/2}\)</span> that is right in the <em>middle</em> between the two.</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(v'\)</span> passes, then repeat the process with <span class="math notranslate nohighlight">\(v'\)</span> and <span class="math notranslate nohighlight">\(v_m\)</span>.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(v'\)</span> fails, then repeat the process with <span class="math notranslate nohighlight">\(v_n\)</span> and <span class="math notranslate nohighlight">\(v'\)</span>.</p></li>
</ul>
<p>Such <em>bisecting</em> quickly progresses towards the failure-inducing version, as it requires you to take only a logarithmic number of tests. In contrast, progressing linearly through the version history requires a test for each version, which is far more effort.</p>
<p>If you use the git version control system, such bisecting is actually a <em>built-in feature</em>, coming to you through the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> command. Let us illustrate how <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> quickly identifies the version that introduced the error.</p>
<p>A bisecting section with <code class="docutils literal notranslate"><span class="pre">git</span></code> starts with the command <code class="docutils literal notranslate"><span class="pre">bisect</span> <span class="pre">start</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>start
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>status: waiting for both good and bad commits
</pre></div>
</div>
</div>
</div>
<p>Then, you use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">good</span></code> to identify the version that worked, and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">bad</span></code> to identify the version that was bad – in our case, the hashes of the first and last version.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>good<span class="w"> </span><span class="o">{</span>versions<span class="o">[</span><span class="m">0</span><span class="o">]}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>status: waiting for bad commit, 1 good commit known
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>bad<span class="w"> </span><span class="o">{</span>versions<span class="o">[</span><span class="m">7</span><span class="o">]}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bisecting: 3 revisions left to test after this (roughly 2 steps)
[e85967ef371579969f628e8cdea95af56f49e779] Fourth version (clueless)
</pre></div>
</div>
</div>
</div>
<p>We find that <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> automatically has checked out the <em>middle</em> version between the passing and the failing one – in our case, version 4 – and now asks us to assess this version.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/16717168c17c6c333379b54413f1f51594fad89ba82773d14b932931fd8a0a2f.svg" src="_images/16717168c17c6c333379b54413f1f51594fad89ba82773d14b932931fd8a0a2f.svg" />
</div>
</div>
<p>The version is already in our working folder:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_file</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:  <span class=" -Color -Color-White"># and not quote:</span>
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># and not quote:</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>We now need to test this version, and let <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> know the outcome – with</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>bisect<span class="w"> </span>good
</pre></div>
</div>
<p>if the test passes, and with</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>bisect<span class="w"> </span>bad
</pre></div>
</div>
<p>if the test fails.</p>
<p>It turns out that this version fails:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;foo&#39;
</pre></div>
</div>
</div>
</div>
<p>So we enter <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">bad</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>bad
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bisecting: 0 revisions left to test after this (roughly 1 step)
[817a3b5392ab8f1179eda142feb8a32e9b585148] Third version (with debugging output)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> has chosen version 3 to assess – again in the middle between a passing and a failing version:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/931973f0e60912d0b47b00af3ed9abca7c9263cac8c305b7a5546abab6e7d64e.svg" src="_images/931973f0e60912d0b47b00af3ed9abca7c9263cac8c305b7a5546abab6e7d64e.svg" />
</div>
</div>
<p>So let us test this version and find that it fails, too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_file</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Cyan">print</span>(<span class=" -Color -Color-Yellow">&quot;c =&quot;</span>, <span class=" -Color -Color-Cyan">repr</span>(c), <span class=" -Color -Color-Yellow">&quot;tag =&quot;</span>, tag, <span class=" -Color -Color-Yellow">&quot;quote =&quot;</span>, quote)

        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c = &#39;&quot;&#39; tag = False quote = False
c = &#39;f&#39; tag = False quote = True
c = &#39;o&#39; tag = False quote = True
c = &#39;o&#39; tag = False quote = True
c = &#39;&quot;&#39; tag = False quote = True
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;foo&#39;
</pre></div>
</div>
</div>
</div>
<p>We mark the version as <code class="docutils literal notranslate"><span class="pre">bad</span></code>. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> then checks out version 2 as the last version to assess.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>bad
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bisecting: 0 revisions left to test after this (roughly 0 steps)
[1387f381eee63c725f2224744213773b84d9dce6] Second version
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/7cde9ae91a7f0344b7f40cc6070c722701bd7cacd147db4577b18d55a0e92f8a.svg" src="_images/7cde9ae91a7f0344b7f40cc6070c722701bd7cacd147db4577b18d55a0e92f8a.svg" />
</div>
</div>
<p>When we test version 2, we find that it fails as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_file</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;remove_html_markup.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;foo&#39;
</pre></div>
</div>
</div>
</div>
<p>Hence, version 2 is <em>the version that introduced the error</em>.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/2570fb4dbd2117925e7adc6c3bd9eeb1fe6b3b329cc3018089f398b8435aefc7.svg" src="_images/2570fb4dbd2117925e7adc6c3bd9eeb1fe6b3b329cc3018089f398b8435aefc7.svg" />
</div>
</div>
<p>When we let <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> know that this version fails, it tells us that this version is indeed the “first bad commit”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>bad
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1387f381eee63c725f2224744213773b84d9dce6 is the first bad commit
<span class=" -Color -Color-Yellow">commit 1387f381eee63c725f2224744213773b84d9dce6 (</span><span class=" -Color -Color-Bold -Color-Bold-Cyan">HEAD</span><span class=" -Color -Color-Yellow">)</span>
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:51 2025 +0100

    Second version

 remove_html_markup.py | 7 <span class=" -Color -Color-Green">+++++</span><span class=" -Color -Color-Red">--</span>
 1 file changed, 5 insertions(+), 2 deletions(-)
</pre></div>
</div>
</div>
</div>
<p>By comparing this version against the older one, we can see the lines it introduced – namely (buggy) handling of double quotes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>diff<span class="w"> </span>HEAD^
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">diff --git a/remove_html_markup.py b/remove_html_markup.py</span>
<span class=" -Color -Color-Bold">index 4999dc0..768bae9 100644</span>
<span class=" -Color -Color-Bold">--- a/remove_html_markup.py</span>
<span class=" -Color -Color-Bold">+++ b/remove_html_markup.py</span>
<span class=" -Color -Color-Cyan">@@ -1,12 +1,15 @@</span>
 def remove_html_markup(s):  # type: ignore
     tag = False
<span class=" -Color -Color-Green">+    quote = False</span>
     out = &quot;&quot;
 
     for c in s:
<span class=" -Color -Color-Red">-        if c == &#39;&lt;&#39;:    # start of markup</span>
<span class=" -Color -Color-Green">+        if c == &#39;&lt;&#39; and not quote:</span>
             tag = True
<span class=" -Color -Color-Red">-        elif c == &#39;&gt;&#39;:  # end of markup</span>
<span class=" -Color -Color-Green">+        elif c == &#39;&gt;&#39; and not quote:</span>
             tag = False
<span class=" -Color -Color-Green">+        elif c == &#39;&quot;&#39; or c == &quot;&#39;&quot; and tag:</span>
<span class=" -Color -Color-Green">+            quote = not quote</span>
         elif not tag:
             out = out + c
 
</pre></div>
</div>
</div>
</div>
<p>Now that we have identified the failure-inducing change (“something is wrong in <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, and it has to do with quote handling”), we can end our <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> session. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">reset</span></code> gets us back to the start, such that we can fix the most recent version.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>reset
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Previous HEAD position was 1387f38 Second version
HEAD is now at e5b94d5 Eighth version (with proper assertion)
</pre></div>
</div>
</div>
</div>
</section>
<section id="automatic-bisecting">
<h2>Automatic Bisecting<a class="headerlink" href="#automatic-bisecting" title="Link to this heading">#</a></h2>
<p>Even though manual bisecting can be quick, we can speed things up by writing a <em>script</em> that does the testing for us. With such a script, we can have <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> run fully automatically.</p>
<p>A test script to automate bisecting does the following:</p>
<ul class="simple">
<li><p>It (re)builds the program under test for the given version</p></li>
<li><p>It tests whether the failure is present.</p></li>
</ul>
<p>Its exit code indicates the test outcome:</p>
<ul class="simple">
<li><p>0 means “good” (the failure did not occur)</p></li>
<li><p>1 means “bad” (the failure did occur)</p></li>
<li><p>125 means “undetermined” (we cannot decide if the failure is present or not)</p></li>
</ul>
<p>The latter (“undetermined”) case may occur if the program fails to build, or shows some other behavior.</p>
<p>We use a Python script <code class="docutils literal notranslate"><span class="pre">test.py</span></code> that reads in <code class="docutils literal notranslate"><span class="pre">remove_html_markup.py</span></code> and then tests for the presence or absence of the failure. (Since this is Python, we don’t have to rebuild things.)</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_file</span><span class="p">(</span><span class="s1">&#39;test.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-White">#!/usr/bin/env python</span>

<span class=" -Color -Color-Blue">from</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Cyan">remove_html_markup</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Blue">import</span> remove_html_markup
<span class=" -Color -Color-Blue">import</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Cyan">sys</span>

result = remove_html_markup(<span class=" -Color -Color-Yellow">&#39;&quot;foo&quot;&#39;</span>)
<span class=" -Color -Color-Blue">if</span> result == <span class=" -Color -Color-Yellow">&#39;&quot;foo&quot;&#39;</span>:
    sys.exit(<span class=" -Color -Color-Blue">0</span>)  <span class=" -Color -Color-White"># good/pass</span>
<span class=" -Color -Color-Blue">elif</span> result == <span class=" -Color -Color-Yellow">&#39;foo&#39;</span>:
    sys.exit(<span class=" -Color -Color-Blue">1</span>)  <span class=" -Color -Color-White"># bad/fail</span>
<span class=" -Color -Color-Blue">else</span>:
    sys.exit(<span class=" -Color -Color-Blue">125</span>)  <span class=" -Color -Color-White"># unresolved</span>
</pre></div>
</div>
</div>
</div>
<p>Right now, we are with version 8 and thus in the “failing” state – our script exits with a code of 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>./test.py<span class="p">;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<p>Let us use our test script to bisect automatically. As with manual bisecting, we first have to tell <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> which the good (passing) and bad (failing) versions are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>start
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>status: waiting for both good and bad commits
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>good<span class="w"> </span><span class="o">{</span>versions<span class="o">[</span><span class="m">0</span><span class="o">]}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>status: waiting for bad commit, 1 good commit known
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>bad<span class="w"> </span><span class="o">{</span>versions<span class="o">[</span><span class="m">7</span><span class="o">]}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bisecting: 3 revisions left to test after this (roughly 2 steps)
[e85967ef371579969f628e8cdea95af56f49e779] Fourth version (clueless)
</pre></div>
</div>
</div>
</div>
<p>Now, we can make use of our script. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">run</span> <span class="pre">&lt;script&gt;</span></code> automatically determines the failing version. In our case, <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">test.py</span></code>, and it produces the failing version in less than a second:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>test.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>running &#39;python&#39; &#39;test.py&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bisecting: 0 revisions left to test after this (roughly 1 step)
[817a3b5392ab8f1179eda142feb8a32e9b585148] Third version (with debugging output)
running &#39;python&#39; &#39;test.py&#39;
c = &#39;&quot;&#39; tag = False quote = False
c = &#39;f&#39; tag = False quote = True
c = &#39;o&#39; tag = False quote = True
c = &#39;o&#39; tag = False quote = True
c = &#39;&quot;&#39; tag = False quote = True
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bisecting: 0 revisions left to test after this (roughly 0 steps)
[1387f381eee63c725f2224744213773b84d9dce6] Second version
running &#39;python&#39; &#39;test.py&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1387f381eee63c725f2224744213773b84d9dce6 is the first bad commit
commit 1387f381eee63c725f2224744213773b84d9dce6
Author: Demo User &lt;demo-user@example.com&gt;
Date:   Sun Oct 26 18:47:51 2025 +0100

    Second version

 remove_html_markup.py | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)
bisect found first bad commit
</pre></div>
</div>
</div>
</div>
<p>Again, we are at version 2, and can investigate the failure-inducing change:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>diff<span class="w"> </span>HEAD^
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">diff --git a/remove_html_markup.py b/remove_html_markup.py</span>
<span class=" -Color -Color-Bold">index 4999dc0..768bae9 100644</span>
<span class=" -Color -Color-Bold">--- a/remove_html_markup.py</span>
<span class=" -Color -Color-Bold">+++ b/remove_html_markup.py</span>
<span class=" -Color -Color-Cyan">@@ -1,12 +1,15 @@</span>
 def remove_html_markup(s):  # type: ignore
     tag = False
<span class=" -Color -Color-Green">+    quote = False</span>
     out = &quot;&quot;
 
     for c in s:
<span class=" -Color -Color-Red">-        if c == &#39;&lt;&#39;:    # start of markup</span>
<span class=" -Color -Color-Green">+        if c == &#39;&lt;&#39; and not quote:</span>
             tag = True
<span class=" -Color -Color-Red">-        elif c == &#39;&gt;&#39;:  # end of markup</span>
<span class=" -Color -Color-Green">+        elif c == &#39;&gt;&#39; and not quote:</span>
             tag = False
<span class=" -Color -Color-Green">+        elif c == &#39;&quot;&#39; or c == &quot;&#39;&quot; and tag:</span>
<span class=" -Color -Color-Green">+            quote = not quote</span>
         elif not tag:
             out = out + c
 
</pre></div>
</div>
</div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">run</span></code> as well, we have to end our bisecting session:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>bisect<span class="w"> </span>reset
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Previous HEAD position was 1387f38 Second version
HEAD is now at e5b94d5 Eighth version (with proper assertion)
</pre></div>
</div>
</div>
</div>
</section>
<section id="computing-and-applying-patches">
<h2>Computing and Applying Patches<a class="headerlink" href="#computing-and-applying-patches" title="Link to this heading">#</a></h2>
<p>Even if a version control system allows us to identify the change that introduced the failure, a single change between versions can still affect multiple locations. The change between version 1 and version 2 of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, above, for instance, affects four separate locations in a single function. In the real world, changes between versions may affect dozens or even hundreds of locations. The question is:</p>
<ul class="simple">
<li><p>Can we break down changes further down to individual locations?</p></li>
</ul>
<p>The answer is yes! But for this, we first need a means to break down changes into smaller parts. These parts are called <em>patches</em> – differences in individual code locations that can be determined and applied individually.</p>
<p>To illustrate how to compute and apply patches, let us have an example. We access the source code of the first and second version of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, respectively:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">version_1</span> <span class="o">=</span> <span class="n">get_output</span><span class="p">([</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">versions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">:remove_html_markup.py&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">version_2</span> <span class="o">=</span> <span class="n">get_output</span><span class="p">([</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">versions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">:remove_html_markup.py&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">version_2</span><span class="p">,</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>Patches are what a tool like <code class="docutils literal notranslate"><span class="pre">diff</span></code> produces when comparing two files (or <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> when comparing two versions). Here, we see that the difference between the two files consists of four patches, each one affecting a different line in the program.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>git<span class="w"> </span>diff<span class="w"> </span><span class="o">{</span>versions<span class="o">[</span><span class="m">0</span><span class="o">]}</span><span class="w"> </span><span class="o">{</span>versions<span class="o">[</span><span class="m">1</span><span class="o">]}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">diff --git a/remove_html_markup.py b/remove_html_markup.py</span>
<span class=" -Color -Color-Bold">index 4999dc0..768bae9 100644</span>
<span class=" -Color -Color-Bold">--- a/remove_html_markup.py</span>
<span class=" -Color -Color-Bold">+++ b/remove_html_markup.py</span>
<span class=" -Color -Color-Cyan">@@ -1,12 +1,15 @@</span>
 def remove_html_markup(s):  # type: ignore
     tag = False
<span class=" -Color -Color-Green">+    quote = False</span>
     out = &quot;&quot;
 
     for c in s:
<span class=" -Color -Color-Red">-        if c == &#39;&lt;&#39;:    # start of markup</span>
<span class=" -Color -Color-Green">+        if c == &#39;&lt;&#39; and not quote:</span>
             tag = True
<span class=" -Color -Color-Red">-        elif c == &#39;&gt;&#39;:  # end of markup</span>
<span class=" -Color -Color-Green">+        elif c == &#39;&gt;&#39; and not quote:</span>
             tag = False
<span class=" -Color -Color-Green">+        elif c == &#39;&quot;&#39; or c == &quot;&#39;&quot; and tag:</span>
<span class=" -Color -Color-Green">+            quote = not quote</span>
         elif not tag:
             out = out + c
 
</pre></div>
</div>
</div>
</div>
<p>We’d like to compute and apply such patches without the help of an external program. To this end, we use Google’s <a class="reference external" href="https://github.com/google/diff-match-patch">diff-match-patch library</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">diff_match_patch</span><span class="w"> </span><span class="kn">import</span> <span class="n">diff_match_patch</span><span class="p">,</span> <span class="n">patch_obj</span>
</pre></div>
</div>
</div>
</div>
<p>By default, the diff-match-patch library is set up for comparing character strings, not lines; so we have to use a special workaround. Our <code class="docutils literal notranslate"><span class="pre">diff()</span></code> function computes a set of line patches between the two texts <code class="docutils literal notranslate"><span class="pre">s1</span></code> and <code class="docutils literal notranslate"><span class="pre">s2</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">diff</span><span class="p">(</span><span class="n">s1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">patch_obj</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare s1 and s2 like `diff`; return a list of patches&quot;&quot;&quot;</span>

    <span class="c1"># Sometimes, we may get bytes instead of strings</span>
    <span class="c1"># Let&#39;s convert these in a conservative way</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="s1">&#39;latin1&#39;</span><span class="p">)</span>

    <span class="n">dmp</span> <span class="o">=</span> <span class="n">diff_match_patch</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;lines&#39;</span><span class="p">:</span>
        <span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">,</span> <span class="n">linearray</span><span class="p">)</span> <span class="o">=</span> <span class="n">dmp</span><span class="o">.</span><span class="n">diff_linesToChars</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>

        <span class="n">diffs</span> <span class="o">=</span> <span class="n">dmp</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span>
        <span class="n">dmp</span><span class="o">.</span><span class="n">diff_charsToLines</span><span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">linearray</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dmp</span><span class="o">.</span><span class="n">patch_make</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;chars&#39;</span><span class="p">:</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="n">dmp</span><span class="o">.</span><span class="n">diff_main</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dmp</span><span class="o">.</span><span class="n">patch_make</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">diffs</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mode must be &#39;lines&#39; or &#39;chars&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can use our <code class="docutils literal notranslate"><span class="pre">diff()</span></code> function to compare the two versions of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>. We obtain four <code class="docutils literal notranslate"><span class="pre">patch_obj</span></code> patch objects:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">patches</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">version_2</span><span class="p">)</span>
<span class="n">patches</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;diff_match_patch.diff_match_patch.patch_obj at 0x10de106e0&gt;,
 &lt;diff_match_patch.diff_match_patch.patch_obj at 0x10db44b90&gt;,
 &lt;diff_match_patch.diff_match_patch.patch_obj at 0x10db46350&gt;,
 &lt;diff_match_patch.diff_match_patch.patch_obj at 0x10db32d70&gt;]
</pre></div>
</div>
</div>
</div>
<p>To inspect these patches, one can simply <code class="docutils literal notranslate"><span class="pre">print()</span></code> them; however, their string representation uses URL encoding for special characters. We introduce a <code class="docutils literal notranslate"><span class="pre">patch_string()</span></code> function that decodes them again, and then print out the four patches:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">urllib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">patch_string</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">patch_obj</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>  <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">print_patch</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">patch_obj</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">print_content</span><span class="p">(</span><span class="n">patch_string</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
    <span class="n">print_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -<span class=" -Color -Color-Blue">48</span>,<span class=" -Color -Color-Blue">24</span> +<span class=" -Color -Color-Blue">48</span>,<span class=" -Color -Color-Blue">42</span> @@
 tag = <span class=" -Color -Color-Blue">False</span>

+    quote = <span class=" -Color -Color-Blue">False</span>

     out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>
@@ -<span class=" -Color -Color-Blue">104</span>,<span class=" -Color -Color-Blue">50</span> +<span class=" -Color -Color-Blue">104</span>,<span class=" -Color -Color-Blue">43</span> @@
  s:

-        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>

+        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
@@ -<span class=" -Color -Color-Blue">162</span>,<span class=" -Color -Color-Blue">48</span> +<span class=" -Color -Color-Blue">162</span>,<span class=" -Color -Color-Blue">45</span> @@
 rue

-        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>

+        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">24</span> +<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">97</span> @@
 tag = <span class=" -Color -Color-Blue">False</span>

+        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote

         <span class=" -Color -Color-Blue">elif</span>
</pre></div>
</div>
</div>
</div>
<p>Each patch comes with a <em>location</em> (the part between <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> characters as a character offset into the string) and a <em>change</em> (prefixed by <code class="docutils literal notranslate"><span class="pre">+</span></code> for added lines or <code class="docutils literal notranslate"><span class="pre">-</span></code> for deleted lines) in a particular <em>context</em> (notably, the preceding and following line).</p>
<p>This <em>context</em> allows us to <em>apply</em> patches even if the location no longer exactly matches – the last patch, for instance, introducing <code class="docutils literal notranslate"><span class="pre">elif</span> <span class="pre">c</span> <span class="pre">==</span> <span class="pre">'&quot;'...</span></code>, for instance, is applied between the lines <code class="docutils literal notranslate"><span class="pre">tag</span> <span class="pre">=</span> <span class="pre">False</span></code> and the next <code class="docutils literal notranslate"><span class="pre">elif</span></code>.</p>
<p>We define a <code class="docutils literal notranslate"><span class="pre">patch()</span></code> function that applies a list of patches to a string, again wrapping around the function provided by the diff-match-patch library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">patch</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">patches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">patch_obj</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply given patches on given text; return patched text.&quot;&quot;&quot;</span>
    <span class="n">dmp</span> <span class="o">=</span> <span class="n">diff_match_patch</span><span class="p">()</span>
    <span class="n">patched_text</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">dmp</span><span class="o">.</span><span class="n">patch_apply</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">success</span><span class="p">),</span> <span class="s2">&quot;Could not apply some patch(es)&quot;</span>
    <span class="k">return</span> <span class="n">patched_text</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s how to use <code class="docutils literal notranslate"><span class="pre">patch()</span></code>. First, if we apply <em>all</em> patches between version 1 and version 2 on version 1, we get version 2:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">patch</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">patches</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">patch</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">patches</span><span class="p">)</span> <span class="o">==</span> <span class="n">version_2</span>
</pre></div>
</div>
</div>
</div>
<p>Applying <em>no</em> patch leaves the content unchanged.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">patch</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="p">[])</span> <span class="o">==</span> <span class="n">version_1</span>
</pre></div>
</div>
</div>
</div>
<p>However, one can also apply <em>partial</em> sets of patches. For instance, if we only apply the first patch…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">patch_string</span><span class="p">(</span><span class="n">patches</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -48,24 +48,42 @@
 tag = False

+    quote = False

     out = &quot;&quot;
</pre></div>
</div>
</div>
</div>
<p>… we find that the result includes the added line <code class="docutils literal notranslate"><span class="pre">quote</span> <span class="pre">=</span> <span class="pre">False</span></code>, but nothing else:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">patch</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="p">[</span><span class="n">patches</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>Likewise, we can also apply the second patch individually:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">patch</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="p">[</span><span class="n">patches</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">What has changed in version 1 after applying the second patch?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="e896e7b0-b293-11f0-9d39-6298cf1a5790" id="e896e7b0-b293-11f0-9d39-6298cf1a5790-1" onclick="clear_selection('e896e7b0-b293-11f0-9d39-6298cf1a5790')">
        <label id="e896e7b0-b293-11f0-9d39-6298cf1a5790-1-label" for="e896e7b0-b293-11f0-9d39-6298cf1a5790-1">The initialization of quote is deleted</label><br>
    
        <input type="radio" name="e896e7b0-b293-11f0-9d39-6298cf1a5790" id="e896e7b0-b293-11f0-9d39-6298cf1a5790-2" onclick="clear_selection('e896e7b0-b293-11f0-9d39-6298cf1a5790')">
        <label id="e896e7b0-b293-11f0-9d39-6298cf1a5790-2-label" for="e896e7b0-b293-11f0-9d39-6298cf1a5790-2">The condition after <code>if c == '&lt;'</code> is expanded</label><br>
    
        <input type="radio" name="e896e7b0-b293-11f0-9d39-6298cf1a5790" id="e896e7b0-b293-11f0-9d39-6298cf1a5790-3" onclick="clear_selection('e896e7b0-b293-11f0-9d39-6298cf1a5790')">
        <label id="e896e7b0-b293-11f0-9d39-6298cf1a5790-3-label" for="e896e7b0-b293-11f0-9d39-6298cf1a5790-3">The tag variable gets a different value</label><br>
    
        <input type="radio" name="e896e7b0-b293-11f0-9d39-6298cf1a5790" id="e896e7b0-b293-11f0-9d39-6298cf1a5790-4" onclick="clear_selection('e896e7b0-b293-11f0-9d39-6298cf1a5790')">
        <label id="e896e7b0-b293-11f0-9d39-6298cf1a5790-4-label" for="e896e7b0-b293-11f0-9d39-6298cf1a5790-4">None of the above</label><br>
    
    </div>
    </p>
    <input id="e896e7b0-b293-11f0-9d39-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('e896e7b0-b293-11f0-9d39-6298cf1a5790', 4, 0, '1 / 1 + 1 ** 1 - 1 % 1 * 1')">
    <span class="quiz_hint" id="e896e7b0-b293-11f0-9d39-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
</section>
<section id="delta-debugging-on-patches">
<h2>Delta Debugging on Patches<a class="headerlink" href="#delta-debugging-on-patches" title="Link to this heading">#</a></h2>
<p>With the ability to apply arbitrary sets of patches, we can now go and apply <a class="reference internal" href="DeltaDebugger.html"><span class="std std-doc">Delta Debugging</span></a> to identify failure-inducing patches. The idea is simple: If applying <em>no</em> patch makes the test pass, and applying <em>all</em> patches makes the test fail, then we can use Delta Debugging to identify a minimal set of failure-inducing patches.</p>
<p>Let us write a testing function that checks for the presence of the failure. <code class="docutils literal notranslate"><span class="pre">test_remove_html_markup_patches()</span></code></p>
<ul class="simple">
<li><p>takes a list of patches,</p></li>
<li><p>applies them on version 1,</p></li>
<li><p>reads in the definition of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code></p></li>
<li><p>and then invokes it to check if the error is present.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_remove_html_markup_patches</span><span class="p">(</span><span class="n">patches</span><span class="p">:</span> <span class="n">patch_obj</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">new_version</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">patches</span><span class="p">)</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">new_version</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
    <span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>If no patches are applied, we are at version 1, and the error is not present.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_remove_html_markup_patches</span><span class="p">([])</span>
</pre></div>
</div>
</div>
</div>
<p>If <em>all</em> patches are applied, we are at version 2, and the error <em>is</em> present.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">test_remove_html_markup_patches</span><span class="p">(</span><span class="n">patches</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/382405065.py&quot;, line 2, in &lt;module&gt;
    test_remove_html_markup_patches(patches)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/1244207729.py&quot;, line 4, in test_remove_html_markup_patches
    assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<section id="a-minimal-set-of-patches">
<h3>A Minimal Set of Patches<a class="headerlink" href="#a-minimal-set-of-patches" title="Link to this heading">#</a></h3>
<p>We can now apply delta debugging on the list of patches, simply by invoking a <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">DeltaDebugger</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeltaDebugger</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">test_remove_html_markup_patches</span><span class="p">(</span><span class="n">patches</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is the minimal set of failure-inducing patches:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_patches</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()[</span><span class="s1">&#39;patches&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">reduced_patches</span><span class="p">:</span>
    <span class="n">print_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -<span class=" -Color -Color-Blue">48</span>,<span class=" -Color -Color-Blue">24</span> +<span class=" -Color -Color-Blue">48</span>,<span class=" -Color -Color-Blue">42</span> @@
 tag = <span class=" -Color -Color-Blue">False</span>

+    quote = <span class=" -Color -Color-Blue">False</span>

     out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">24</span> +<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">97</span> @@
 tag = <span class=" -Color -Color-Blue">False</span>

+        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote

         <span class=" -Color -Color-Blue">elif</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>This is the resulting code. We see that the changes to the conditions (<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">c</span> <span class="pre">==</span> <span class="pre">'&lt;'</span></code> and <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">c</span> <span class="pre">==</span> <span class="pre">'&gt;'</span></code>) are not necessary to produce the failure – our test string has no HTML tags.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">patch</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">reduced_patches</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>Hence, we have now narrowed down our failure-inducing changes from four patches down to two.</p>
</section>
<section id="a-minimal-difference">
<h3>A Minimal Difference<a class="headerlink" href="#a-minimal-difference" title="Link to this heading">#</a></h3>
<p>Can we narrow this down even further? Yes, we can! The idea is to not only search for the minimal set of patches to be applied on the passing version, but to actually seek a minimal <em>difference</em> between two patch sets. That is, we obtain</p>
<ul class="simple">
<li><p>one set of <em>passing</em> patches that, when applied, still passes;</p></li>
<li><p>one set of <em>failing</em> patches that, when applied, fails;</p></li>
</ul>
<p>with a <em>minimal difference</em> between the two. This minimal difference is what causes the failure.</p>
<p>We obtain such two sets (as well as their difference) by using the <code class="docutils literal notranslate"><span class="pre">min_arg_diff()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pass_patches</span><span class="p">,</span> <span class="n">fail_patches</span><span class="p">,</span> <span class="n">diffs</span> <span class="o">=</span> \
    <span class="nb">tuple</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="s1">&#39;patches&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_arg_diff</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>This is <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> with the passing set applied. We see that the variable <code class="docutils literal notranslate"><span class="pre">quote</span></code> is defined at the beginning. This definition is actually a precondition for other patches to result in an executable program; otherwise, the program will fail when the variable <code class="docutils literal notranslate"><span class="pre">quote</span></code> does not exist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">patch</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">pass_patches</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>Here’s <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> with the failing set applied. We see that now we also have the check for double quotes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">patch</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">fail_patches</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>The difference is just this one patch:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">:</span>
    <span class="n">print_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">24</span> +<span class=" -Color -Color-Blue">215</span>,<span class=" -Color -Color-Blue">97</span> @@
 tag = <span class=" -Color -Color-Blue">False</span>

+        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote

         <span class=" -Color -Color-Blue">elif</span>
</pre></div>
</div>
</div>
</div>
<p>And one more time, we are pointed to the buggy line that introduced the error.</p>
</section>
</section>
<section id="a-changedebugger-class">
<h2>A ChangeDebugger class<a class="headerlink" href="#a-changedebugger-class" title="Link to this heading">#</a></h2>
<p>Let us put all these steps together in a single class. The <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> is a derivative of <code class="docutils literal notranslate"><span class="pre">CallCollector</span></code> which takes two source files (one passing, one failing).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">DeltaDebugger</span><span class="w"> </span><span class="kn">import</span> <span class="n">CallCollector</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeDebugger</span><span class="p">(</span><span class="n">CallCollector</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pass_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fail_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">ddargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor. Takes a passing source file (`pass_source`)</span>
<span class="sd">        and a failing source file (`fail_source`).</span>
<span class="sd">        Additional arguments are passed to `DeltaDebugger` constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pass_source</span> <span class="o">=</span> <span class="n">pass_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fail_source</span> <span class="o">=</span> <span class="n">fail_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">pass_source</span><span class="p">,</span> <span class="n">fail_source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ddargs</span> <span class="o">=</span> <span class="n">ddargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">ddargs</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;log&#39;</span> <span class="ow">in</span> <span class="n">ddargs</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pass_source</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the passing source file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pass_source</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fail_source</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the failing source file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fail_source</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">patches</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">patch_obj</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the diff between passing and failing source files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span>
</pre></div>
</div>
</div>
</div>
<p>From <code class="docutils literal notranslate"><span class="pre">CallCollector</span></code>, it inherits the ability to inspect a single function call…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_remove_html_markup</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ChangeDebugger</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">version_2</span><span class="p">)</span> <span class="k">as</span> <span class="n">cd</span><span class="p">:</span>
    <span class="n">test_remove_html_markup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>… and to repeat it at will.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">cd</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/3359775007.py&quot;, line 2, in &lt;module&gt;
    cd.call()
    ~~~~~~~^^
  File &quot;/Users/zeller/Projects/debuggingbook/notebooks/DeltaDebugger.ipynb&quot;, line 214, in call
    return self.function()(**args)
           ~~~~~~~~~~~~~~~^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/3114633459.py&quot;, line 2, in test_remove_html_markup
    assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>We can access the passing source, the failing source, and the list of patches:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">cd</span><span class="o">.</span><span class="n">pass_source</span><span class="p">(),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:    <span class=" -Color -Color-White"># start of markup</span>
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:  <span class=" -Color -Color-White"># end of markup</span>
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">cd</span><span class="o">.</span><span class="n">fail_source</span><span class="p">(),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span><span class="o">.</span><span class="n">patches</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;diff_match_patch.diff_match_patch.patch_obj at 0x10e03f7e0&gt;,
 &lt;diff_match_patch.diff_match_patch.patch_obj at 0x10e03fa80&gt;,
 &lt;diff_match_patch.diff_match_patch.patch_obj at 0x10e03fb60&gt;,
 &lt;diff_match_patch.diff_match_patch.patch_obj at 0x10e03f9a0&gt;]
</pre></div>
</div>
</div>
</div>
<p>For testing, we do not apply Delta Debugging on the function under test – that would reduce the function’s arguments. (It would still be neat, but that’s not what we’re aiming for here.)</p>
<p>Instead, we introduce a method <code class="docutils literal notranslate"><span class="pre">test_patches()</span></code> that gets a set of patches, applies them, reads in the resulting source, and (re-)calls the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeDebugger</span><span class="p">(</span><span class="n">ChangeDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_patches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">patch_obj</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_version</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pass_source</span><span class="p">(),</span> <span class="n">patches</span><span class="p">)</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">new_version</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>For completeness, we ensure that at the beginning of the <code class="docutils literal notranslate"><span class="pre">with</span></code> block, we assume the failing source:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeDebugger</span><span class="p">(</span><span class="n">ChangeDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called at begin of a `with` block. Checks if current source fails.&quot;&quot;&quot;</span>
        <span class="n">exec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fail_source</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s <code class="docutils literal notranslate"><span class="pre">test_patches()</span></code> in action. As before, if we apply no patches, the test passes; if we apply all patches, it fails.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ChangeDebugger</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">version_2</span><span class="p">)</span> <span class="k">as</span> <span class="n">cd</span><span class="p">:</span>
    <span class="n">test_remove_html_markup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span><span class="o">.</span><span class="n">test_patches</span><span class="p">([])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">cd</span><span class="o">.</span><span class="n">test_patches</span><span class="p">(</span><span class="n">cd</span><span class="o">.</span><span class="n">patches</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/3279782181.py&quot;, line 2, in &lt;module&gt;
    cd.test_patches(cd.patches())
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/1738176692.py&quot;, line 5, in test_patches
    self.call()
    ~~~~~~~~~^^
  File &quot;/Users/zeller/Projects/debuggingbook/notebooks/DeltaDebugger.ipynb&quot;, line 214, in call
    return self.function()(**args)
           ~~~~~~~~~~~~~~~^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51678/3114633459.py&quot;, line 2, in test_remove_html_markup
    assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>Now for the actual debugging. We introduce a method <code class="docutils literal notranslate"><span class="pre">min_patches()</span></code> in which we invoke a <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> on the <code class="docutils literal notranslate"><span class="pre">test_patches()</span></code> method we just defined. Using <code class="docutils literal notranslate"><span class="pre">min_arg.diff()</span></code>, it then computes a minimal failure-inducing difference between the patches.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeDebugger</span><span class="p">(</span><span class="n">ChangeDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">min_patches</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">patch_obj</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">patch_obj</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">patch_obj</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute a minimal set of patches.</span>
<span class="sd">        Returns a triple (`pass_patches`, `fail_patches`, `diff_patches`) </span>
<span class="sd">        where `diff_patches` is the minimal difference between </span>
<span class="sd">        the set `pass_patches` (which, when applied, make the test pass) and </span>
<span class="sd">        the set `fail_patches` (which, when applied, make the test fail).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_ddargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_patches</span><span class="p">(</span><span class="n">patches</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_arg_diff</span><span class="p">()</span>
        <span class="n">pass_patches</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;patches&#39;</span><span class="p">]</span>
        <span class="n">fail_patches</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;patches&#39;</span><span class="p">]</span>
        <span class="n">diff_patches</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;patches&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">pass_patches</span><span class="p">,</span> <span class="n">fail_patches</span><span class="p">,</span> <span class="n">diff_patches</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">__repr__()</span></code> method, turning a <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> into a readable string, computes <code class="docutils literal notranslate"><span class="pre">min_patches()</span></code> and returns a user-readable representation of the patches:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeDebugger</span><span class="p">(</span><span class="n">ChangeDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return readable list of minimal patches&quot;&quot;&quot;</span>
        <span class="n">pass_patches</span><span class="p">,</span> <span class="n">fail_patches</span><span class="p">,</span> <span class="n">diff_patches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_patches</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">patch_string</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">diff_patches</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s how to use these methods. First, we invoke <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> with the given old and new source code versions on our test function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ChangeDebugger</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">version_2</span><span class="p">)</span> <span class="k">as</span> <span class="n">cd</span><span class="p">:</span>
    <span class="n">test_remove_html_markup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>These are the patches we determined:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span><span class="o">.</span><span class="n">patches</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;diff_match_patch.diff_match_patch.patch_obj at 0x10df3d160&gt;,
 &lt;diff_match_patch.diff_match_patch.patch_obj at 0x10df3d780&gt;,
 &lt;diff_match_patch.diff_match_patch.patch_obj at 0x10deab2a0&gt;,
 &lt;diff_match_patch.diff_match_patch.patch_obj at 0x10deab4d0&gt;]
</pre></div>
</div>
</div>
</div>
<p>We invoke <code class="docutils literal notranslate"><span class="pre">min_patches</span></code> to obtain a minimal set of patches:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pass_patches</span><span class="p">,</span> <span class="n">fail_patches</span><span class="p">,</span> <span class="n">diffs</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">min_patches</span><span class="p">()</span>
<span class="n">diffs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;diff_match_patch.diff_match_patch.patch_obj at 0x10deab4d0&gt;]
</pre></div>
</div>
</div>
</div>
<p>We can inspect the failure-inducing patches right away:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">patch_string</span><span class="p">(</span><span class="n">diffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -215,24 +215,97 @@
 tag = False

+        elif c == &#39;&quot;&#39; or c == &quot;&#39;&quot; and tag:
            quote = not quote

         elif
</pre></div>
</div>
</div>
</div>
<p>Or – even simpler – we can simply print out the <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> to obtain a readable representation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -215,24 +215,97 @@
 tag = False

+        elif c == &#39;&quot;&#39; or c == &quot;&#39;&quot; and tag:
            quote = not quote

         elif
</pre></div>
</div>
</div>
</div>
<p>Success!</p>
<p>Does this also work for longer change histories? Let’s take the very first and the very last version.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">version_8</span> <span class="o">=</span> <span class="n">get_output</span><span class="p">([</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> 
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">versions</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="si">}</span><span class="s1">:remove_html_markup.py&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ChangeDebugger</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">version_8</span><span class="p">)</span> <span class="k">as</span> <span class="n">cd</span><span class="p">:</span>
    <span class="n">test_remove_html_markup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We start with 5 patches:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">cd</span><span class="o">.</span><span class="n">patches</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<p>Printing out the debugger again reveals a single failure-inducing change – it’s actually still the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -215,24 +215,97 @@
 tag = False

+        elif c == &#39;&quot;&#39; or c == &quot;&#39;&quot; and tag:
            quote = not quote

         elif
</pre></div>
</div>
</div>
</div>
<p>We close with a bit of housekeeping, ensuring that the preconditions are properly met.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">DeltaDebugger</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoCallError</span><span class="p">,</span> <span class="n">NotFailingError</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NotPassingError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeDebugger</span><span class="p">(</span><span class="n">ChangeDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">after_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Diagnostics.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoCallError</span><span class="p">(</span><span class="s2">&quot;No function call observed&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFailingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">()</span><span class="si">}</span><span class="s2"> did not raise an exception&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_patches</span><span class="p">([])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotPassingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">()</span><span class="si">}</span><span class="s2"> raised an exception in its passing version&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_patches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">())</span>
            <span class="k">raise</span> <span class="n">NotFailingError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">()</span><span class="si">}</span><span class="s2"> did not raise an exception in failing version&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Observed </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s2">&quot; raising </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="n">NotPassingError</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">ChangeDebugger</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">version_2</span><span class="p">)</span> <span class="k">as</span> <span class="n">cd</span><span class="p">:</span>
        <span class="n">test_remove_html_markup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>With this, we’re done. Enjoy debugging changes!</p>
</section>
<section id="lessons-learned">
<h2>Lessons Learned<a class="headerlink" href="#lessons-learned" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>If one has a version history available, one can use it to determine failure-inducing changes.</p></li>
<li><p>Bisecting with git effectively isolates failure-inducing commits, both manually and automatically.</p></li>
<li><p>Delta debugging on changes allows further isolating minimal sets of failure-inducing changes.</p></li>
</ul>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>This concludes our applications of Delta Debugging. In the next chapters, we will analyze how to abstract failure-inducing inputs into failure-inducing <em>input sets</em>.</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>The concept of “bisecting” as traversing a version history to identify failure-inducing changes was first described by Brian Ness and Viet Ngo from Cray Research as “Source change isolation” \cite{Ness1997}. The abstract of their paper summarizes the goals and benefits:</p>
<blockquote>
<div><p>Effective regression containment is an important factor in the design of development and testing processes for large software projects, especially when many developers are doing concurrent work on a common set of sources. Source change isolation provides an inexpensive, mechanical alternative to analytical methods for identifying the cause of software regressions. It also provides the advantage of enabling regressions to be eliminated by reversing the effect of source changes that introduced errant behavior, without the need to write new code, and without halting other development work on the same software. Deliverability is also improved.</p>
</div></blockquote>
<p>Delta Debugging on changes (and also Delta Debugging) was introduced in “Yesterday, my program worked. Today, it does not. Why?” \cite{Zeller1999}, a paper which would win an ACM SIGSOFT Impact Paper Award ten years later.
This paper generalized over \cite{Ness1997} by identifying failure-inducing differences in arbitrary sets of changes. \cite{Zeller2002} generalized the algorithm to work on inputs and other collections (including changes); the <a class="reference internal" href="DeltaDebugger.html"><span class="doc std std-doc">chapter on delta debugging</span></a>, which we use in this chapter, uses the \cite{Zeller2002} formulation of the <code class="docutils literal notranslate"><span class="pre">dd</span></code> algorithm.</p>
<p>We’re done, so we clean up a bit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">PROJECT</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<section id="exercise-1-fine-grained-changes">
<h3>Exercise 1: Fine-Grained Changes<a class="headerlink" href="#exercise-1-fine-grained-changes" title="Link to this heading">#</a></h3>
<p>Instead of computing patches on lines (as we and most <code class="docutils literal notranslate"><span class="pre">diff</span></code> programs do), one can also compute fine-grained diffs, using our <code class="docutils literal notranslate"><span class="pre">diff()</span></code> function with <code class="docutils literal notranslate"><span class="pre">mode='chars'</span></code>. Would this make sense?</p>
<p><strong>Solution.</strong> Let us see what happens if we compute a character <code class="docutils literal notranslate"><span class="pre">diff</span></code> on our two versions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">patches</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">version_1</span><span class="p">,</span> <span class="n">version_2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;chars&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">patch_string</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -52,24 +52,42 @@
 = False
    
+quote = False
    
 out = &quot;&quot;


@@ -123,30 +123,23 @@
  &#39;&lt;&#39;
-:
  
-   # st
 a
-rt
+nd
  
+n
 o
-f
+t
  
-mark
+q
 u
-p
+ote:
 

@@ -183,26 +183,23 @@
  &#39;&gt;&#39;
-:  #
  
-e
+a
 nd 
+n
 o
-f
+t
  
-mark
+q
 u
-p
+ote:
 

@@ -213,24 +213,97 @@
   tag = Fals
+e
        elif c == &#39;&quot;&#39; or c == &quot;&#39;&quot; and tag:
            quote = not quot
 e
        el
</pre></div>
</div>
</div>
</div>
<p>We see that the patches now replace words like <code class="docutils literal notranslate"><span class="pre">start</span></code> to <code class="docutils literal notranslate"><span class="pre">and</span></code>, keeping the <code class="docutils literal notranslate"><span class="pre">a</span></code> common to both words. Such tiny differences may be useful for merging changes in text documents (which is what the Google library was built for), but not necessarily code.</p>
</section>
<section id="exercise-2-failure-inducing-changes-in-the-large">
<h3>Exercise 2: Failure-Inducing Changes in the Large<a class="headerlink" href="#exercise-2-failure-inducing-changes-in-the-large" title="Link to this heading">#</a></h3>
<p>Our <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> class works on two versions of one class, function, or module, but not on versions of an entire project. Extend <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> to a class <code class="docutils literal notranslate"><span class="pre">DiffDebugger</span></code> that can actually take two <em>directories</em> (including differences in subdirectories with added and deleted files) and determine failure-inducing differences between them. This would allow checking out two versions of a project and determine failure-inducing differences.</p>
<p>Note that applying delte debugging on large sets of differences is a time-consuming task, since</p>
<ul class="simple">
<li><p>Every test requires a rebuild and rerun of the code; and</p></li>
<li><p>There are many ways to cause inconsistencies by applying random changes.</p></li>
</ul>
<p>Refer to \cite{Zeller1999} for some hints on how to make this efficient.</p>
</section>
<section id="exercise-3-hierarchical-change-debugging">
<h3>Exercise 3: Hierarchical Change Debugging<a class="headerlink" href="#exercise-3-hierarchical-change-debugging" title="Link to this heading">#</a></h3>
<p>Rather than running Delta Debugging on <em>all</em> changes between two projects (as with <code class="docutils literal notranslate"><span class="pre">DiffDebugger</span></code>, above), it can be wise to first progress along the change history (as with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code>) and only then run Delta Debugging on the remaining changes.</p>
<p>Building on <code class="docutils literal notranslate"><span class="pre">DiffDebugger</span></code>, implement a class <code class="docutils literal notranslate"><span class="pre">GitDebugger</span></code> that takes two version identifiers (= the “good” and “bad” hashes in <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code>) and a test (like <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code>) and then</p>
<ol class="arabic simple">
<li><p>runs <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> to narrow down the failure-inducing commit</p></li>
<li><p>runs <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> to further narrow down the failure-inducing change within the failure-inducing commit.</p></li>
</ol>
<p>This gives you the best of two worlds: The failure-inducing commit is quickly identified; and the additional <code class="docutils literal notranslate"><span class="pre">ChangeDebugger</span></code> run provides even more fine-grained details, albeit at the expense of (potentially several) additional tests.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="DeltaDebugger.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Reducing Failure-Inducing Inputs</p>
      </div>
    </a>
    <a class="right-next"
       href="StatisticalDebugger.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Statistical Debugging</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#high-level-interface">High-Level Interface</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#programmatic-interface">Programmatic Interface</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supporting-functions">Supporting Functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#changes-and-bugs">Changes and Bugs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#leveraging-version-histories">Leveraging Version Histories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-version-history">An Example Version History</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-working-directory">Create a Working Directory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-git">Initialize Git</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#excursion-adding-more-revisions">Excursion: Adding More Revisions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-excursion">End of Excursion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-versions">Accessing Versions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-bisecting">Manual Bisecting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-bisecting">Automatic Bisecting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-and-applying-patches">Computing and Applying Patches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delta-debugging-on-patches">Delta Debugging on Patches</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-minimal-set-of-patches">A Minimal Set of Patches</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-minimal-difference">A Minimal Difference</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-changedebugger-class">A ChangeDebugger class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-fine-grained-changes">Exercise 1: Fine-Grained Changes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-failure-inducing-changes-in-the-large">Exercise 2: Failure-Inducing Changes in the Large</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-hierarchical-change-debugging">Exercise 3: Hierarchical Change Debugging</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andreas Zeller
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
  Copyright &copy; 2021–2025 <a href="https://www.cispa.de/">CISPA Helmholtz Center for Information Security</a>.
  The <strong>content</strong> of this project is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  The <strong>source code</strong> that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/debuggingbook/blob/master/LICENSE.md#mit-license">MIT License</a>. <a href="https://cispa.de/en/impressum">Imprint</a>.
  <br>
  <a href="https://cispa.de/en/impressum">Imprint</a> &middot; <a href="/html/index.html#how-do-i-cite-your-work">Cite</a>
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>