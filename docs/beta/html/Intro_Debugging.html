
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction to Debugging &#8212; The Debugging Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=d5c2cecb" />
    <link rel="stylesheet" type="text/css" href="_static/mastodon-timeline.css?v=f82c2b23" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Intro_Debugging';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tracing Executions" href="Tracer.html" />
    <link rel="prev" title="Sitemap" href="Tours.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p>This is a beta version of debuggingbook.org, currently in development. See the <a href="https://debuggingbook.org/classic/"  style="color:white!important;">classic site</a> for the 2024 version.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/debuggingbook.png" class="logo__image only-light" alt="The Debugging Book - Home"/>
    <script>document.write(`<img src="_static/debuggingbook.png" class="logo__image only-dark" alt="The Debugging Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    The Debugging Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tours.html">Sitemap</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Introduction to Debugging</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Observing Executions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracer.html">Tracing Executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Debugger.html">How Debuggers Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="Assertions.html">Asserting Expectations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Flows and Dependencies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Slicer.html">Tracking Failure Origins</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reducing Failure Causes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="DeltaDebugger.html">Reducing Failure-Inducing Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeDebugger.html">Isolating Failure-Inducing Changes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Abstracting Failures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="StatisticalDebugger.html">Statistical Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicInvariants.html">Mining Function Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="DDSetDebugger.html">Generalizing Failure Circumstances</a></li>
<li class="toctree-l1"><a class="reference internal" href="Alhazen.html">Learning from Failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="PerformanceDebugger.html">Debugging Performance Issues</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Automatic Repair</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Repairer.html">Repairing Code Automatically</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Debugging in the Large</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracking.html">Tracking Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeCounter.html">Where the Bugs are</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ExpectError.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timer.html">Timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timeout.html">Timeout</a></li>
<li class="toctree-l1"><a class="reference internal" href="ClassDiagram.html">Class Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="StackInspector.html">Inspecting Call Stacks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About This Book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ReleaseNotes.html">Release Notes for The Debugging Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importing.html">Downloads and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Guide_for_Authors.html">Guide for Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uds-se/debuggingbook/master?urlpath=tree/docs/notebooks/Intro_Debugging.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook/issues/new?title=Issue%20on%20page%20%2FIntro_Debugging.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
    <li><a href="../code/Intro_Debugging.py" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="Download Python code"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">.py</span>
    </a>
    </li>
    
      
      
      
      <li><a href="_sources/Intro_Debugging.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download notebook"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  
    <li><a href="Importing.html" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="All downloads"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">All downloads</span>
    </a>
    </li>
    </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Introduction to Debugging</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-function">A Simple Function</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#your-task-remove-html-markup">Your Task: Remove HTML Markup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-python-programs">Understanding Python Programs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-a-function">Running a Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interacting-with-notebooks">Interacting with Notebooks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-a-function">Testing a Function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#oops-a-bug">Oops! A Bug!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-code">Visualizing Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-fix">A First Fix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-devils-guide-to-debugging">The Devil’s Guide to Debugging</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#printf-debugging">Printf Debugging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-into-existence">Debugging into Existence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-the-most-obvious-fix">Use the Most Obvious Fix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#things-to-do-instead">Things to do Instead</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-defect-to-failure">From Defect to Failure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-failure-to-defect">From Failure to Defect</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-scientific-method">The Scientific Method</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-a-hypothesis">Finding a Hypothesis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-a-hypothesis">Testing a Hypothesis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#refining-a-hypothesis">Refining a Hypothesis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#refuting-a-hypothesis">Refuting a Hypothesis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fixing-the-bug">Fixing the Bug</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-diagnoses">Checking Diagnoses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fixing-the-code">Fixing the Code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternate-paths">Alternate Paths</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework-after-the-fix">Homework after the Fix</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-for-further-defect-occurrences">Check for further Defect Occurrences</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-your-tests">Check your Tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-assertions">Add Assertions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#commit-the-fix">Commit the Fix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#close-the-bug-report">Close the Bug Report</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#become-a-better-debugger">Become a Better Debugger</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#follow-the-process">Follow the Process</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#keep-a-log">Keep a Log</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rubberducking">Rubberducking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-cost-of-debugging">The Cost of Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-aftermath">Debugging Aftermath</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#history-of-debugging">History of Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-get-acquainted-with-notebooks-and-python">Exercise 1: Get Acquainted with Notebooks and Python</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#beginner-level-run-notebooks-in-your-browser">Beginner Level: Run Notebooks in Your Browser</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-level-run-python-code-on-your-machine">Advanced Level: Run Python Code on Your Machine</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pro-level-run-notebooks-on-your-machine">Pro Level: Run Notebooks on Your Machine</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boss-level-contribute">Boss Level: Contribute!</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-more-bugs">Exercise 2: More Bugs!</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-find-the-problem">Part 1: Find the Problem</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-identify-extent-and-cause">Part 2: Identify Extent and Cause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3-fix-the-problem">Part 3: Fix the Problem</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="introduction-to-debugging">
<h1>Introduction to Debugging<a class="headerlink" href="#introduction-to-debugging" title="Link to this heading">#</a></h1>
<p>In this book, we want to explore <em>debugging</em> - the art and science of fixing bugs in computer software. In particular, we want to explore techniques that <em>automatically</em> answer questions like: Where is the bug? When does it occur? And how can we repair it? But before we start automating the debugging process, we first need to understand what this process is.</p>
<p>In this chapter, we introduce basic concepts of systematic software debugging and the debugging process, and at the same time get acquainted with Python and interactive notebooks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">YouTubeVideo</span><span class="p">,</span> <span class="n">quiz</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;bCHRCehDOq0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="640"
            height="360"
            src="https://www.youtube-nocookie.com/embed/bCHRCehDOq0"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p>The book is meant to be a standalone reference; however, a number of <em>great books on debugging</em> are listed at the end,</p></li>
<li><p>Knowing a bit of <em>Python</em> is helpful for understanding the code examples in the book.</p></li>
</ul>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Link to this heading">#</a></h2>
<p>To <a class="reference internal" href="Importing.html"><span class="std std-doc">use the code provided in this chapter</span></a>, write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">debuggingbook.Intro_Debugging</span><span class="w"> </span><span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and then make use of the following features.</p>
<p><strong>Note</strong>: The examples in this section only work after the rest of the cells have been executed.</p>
<p>In this chapter, we introduce some basics of how failures come to be as well as a general process for debugging.</p>
</section>
<section id="a-simple-function">
<h2>A Simple Function<a class="headerlink" href="#a-simple-function" title="Link to this heading">#</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
<section id="your-task-remove-html-markup">
<h3>Your Task: Remove HTML Markup<a class="headerlink" href="#your-task-remove-html-markup" title="Link to this heading">#</a></h3>
<p>Let us start with a simple example. You may have heard of how documents on the Web are made out of text and HTML markup. HTML markup consists of <em>tags</em> in angle brackets that surround the text, providing additional information on how the text should be interpreted. For instance, in the HTML text</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>This is <span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span>emphasized<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>.
</pre></div>
</div>
<p>the word “emphasized” is enclosed in the HTML tags <code class="docutils literal notranslate"><span class="pre">&lt;em&gt;</span></code> (start) and <code class="docutils literal notranslate"><span class="pre">&lt;/em&gt;</span></code> (end), meaning that it should be interpreted (and rendered) in an emphasized way – typically in italics. In your environment, the HTML text gets rendered as</p>
<blockquote>
<div><p>This is <em>emphasized</em>.</p>
</div></blockquote>
<p>There’s HTML tags for pretty much everything – text markup (<strong>bold</strong> text, <s>strikethrough</s> text), text structure (titles, lists), references (links) to other documents, and many more. These HTML tags shape the Web as we know it.</p>
<p>However, with all the HTML markup, it may become difficult to actually access the <em>text</em> that lies within. We’d like to implement a simple function that removes <em>HTML markup</em> and converts it into text. If our input is</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Here&#39;s some <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>strong argument<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>.
</pre></div>
</div>
<p>the output should be</p>
<blockquote>
<div><p>Here’s some strong argument.</p>
</div></blockquote>
<p>Here’s a Python function which does exactly this. It takes a (HTML) string and returns the text without markup.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>    <span class="c1"># start of markup</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>  <span class="c1"># end of markup</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>This function works, but not always. Before we start debugging things, let us first explore its code and how it works.</p>
</section>
<section id="understanding-python-programs">
<h3>Understanding Python Programs<a class="headerlink" href="#understanding-python-programs" title="Link to this heading">#</a></h3>
<p>If you’re new to Python, you might first have to understand what the above code does.  We very much recommend the <a class="reference external" href="https://docs.python.org/3/tutorial/">Python tutorial</a> to get an idea on how Python works.  The most important things for you to understand the above code are these three:</p>
<ol class="arabic simple">
<li><p>Python structures programs through <em>indentation</em>, so the function and <code class="docutils literal notranslate"><span class="pre">for</span></code> bodies are defined by being indented.</p></li>
<li><p>Python is <em>dynamically typed</em>, meaning that the type of variables like <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">tag</span></code>, or <code class="docutils literal notranslate"><span class="pre">out</span></code> is determined at run-time.</p></li>
<li><p>Most of Python’s syntactic features are inspired by other common languages, such as control structures (<code class="docutils literal notranslate"><span class="pre">while</span></code>, <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">for</span></code>), assignments (<code class="docutils literal notranslate"><span class="pre">=</span></code>), or comparisons (<code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>).</p></li>
</ol>
<p>With that, you can already understand what the above code does: <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> takes a (HTML) string <code class="docutils literal notranslate"><span class="pre">s</span></code> and then iterates over the individual characters (<code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">c</span> <span class="pre">in</span> <span class="pre">s</span></code>). By default, these characters are added to the return string <code class="docutils literal notranslate"><span class="pre">out</span></code>. However, if <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> finds a <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> character, it sets the <code class="docutils literal notranslate"><span class="pre">tag</span></code> flag, meaning that all further characters are ignored until a <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> character is found.</p>
<p>In contrast to other languages, Python makes no difference between strings and characters – there are only strings. As in HTML, strings can be enclosed in single quotes (<code class="docutils literal notranslate"><span class="pre">'a'</span></code>) and in double quotes (<code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code>). This is useful if you want to specify a string that contains quotes, as in <code class="docutils literal notranslate"><span class="pre">'She</span> <span class="pre">said</span> <span class="pre">&quot;hello&quot;,</span> <span class="pre">and</span> <span class="pre">then</span> <span class="pre">left'</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;The</span> <span class="pre">first</span> <span class="pre">character</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">'c'&quot;</span></code></p>
</section>
<section id="running-a-function">
<h3>Running a Function<a class="headerlink" href="#running-a-function" title="Link to this heading">#</a></h3>
<p>To find out whether <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> works correctly, we can <em>test</em> it with a few values.  For the string</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Here&#39;s some <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>strong argument<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>.
</pre></div>
</div>
<p>for instance, it produces the correct value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;Here&#39;s some &lt;strong&gt;strong argument&lt;/strong&gt;.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;Here&#39;s some strong argument.&quot;
</pre></div>
</div>
</div>
</div>
</section>
<section id="interacting-with-notebooks">
<h3>Interacting with Notebooks<a class="headerlink" href="#interacting-with-notebooks" title="Link to this heading">#</a></h3>
<p>If you are reading this in the interactive notebook, you can try out <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> with other values as well.  Click on the above cells with the invocation of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> and change the value – say, to <code class="docutils literal notranslate"><span class="pre">remove_html_markup(&quot;&lt;em&gt;foo&lt;/em&gt;&quot;)</span></code>.  Press <kbd>Shift</kbd>+<kbd>Enter</kbd> (or click on the play symbol) to execute it and see the result.  If you get an error message, go to the above cell with the definition of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> and execute this first.  You can also run <em>all</em> cells at once; see the Notebook menu for details.  (You can actually also change the text by clicking on it, and corect mistaks such as in this sentence.)</p>
<p>Executing a single cell does not execute other cells, so if your cell builds on a definition in another cell that you have not executed yet, you will get an error.  You can select <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">all</span> <span class="pre">cells</span> <span class="pre">above</span></code> from the menu to ensure all definitions are set.</p>
<p>Also keep in mind that, unless overwritten, all definitions are kept across executions.  Occasionally, it thus helps to <em>restart the kernel</em> (i.e. start the Python interpreter from scratch) to get rid of older, superfluous definitions.</p>
</section>
<section id="testing-a-function">
<h3>Testing a Function<a class="headerlink" href="#testing-a-function" title="Link to this heading">#</a></h3>
<p>Since one can change not only invocations, but also definitions, we want to ensure that our function works properly now and in the future. To this end, we introduce tests through <em>assertions</em> – a statement that fails if the given <em>check</em> is false. The following assertion, for instance, checks that the above call to <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> returns the correct value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;Here&#39;s some &lt;strong&gt;strong argument&lt;/strong&gt;.&quot;</span><span class="p">)</span> <span class="o">==</span> \
    <span class="s2">&quot;Here&#39;s some strong argument.&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>If you change the code of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> such that the above assertion fails, you will have introduced a bug.</p>
</section>
</section>
<section id="oops-a-bug">
<h2>Oops! A Bug!<a class="headerlink" href="#oops-a-bug" title="Link to this heading">#</a></h2>
<p>As nice and simple as <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> is, it is buggy. Some HTML markup is not properly stripped away. Consider this HTML tag:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&lt;your name&gt;&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>This would render as an input field in a form:</p>
<blockquote>
<div><input type="text" value="<your name>">
</div></blockquote>
<p>If we feed this string into <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, we would expect an empty string as the result. Instead, this is what we get:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;text&quot; value=&quot;&lt;your name&gt;&quot;&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&quot;&#39;
</pre></div>
</div>
</div>
</div>
<p>Every time we encounter a bug, this means that our earlier tests have failed. We thus need to introduce another test that documents not only how the bug came to be, but also the result we actually expected.</p>
<p>The assertion we write now fails with an error message. (The <code class="docutils literal notranslate"><span class="pre">ExpectError</span></code> magic ensures we see the error message, but the rest of the notebook is still executed.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ExpectError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExpectError</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;text&quot; value=&quot;&lt;your name&gt;&quot;&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_50153/145241764.py&quot;, line 2, in &lt;module&gt;
    assert remove_html_markup(&#39;&lt;input type=&quot;text&quot; value=&quot;&lt;your name&gt;&quot;&gt;&#39;) == &quot;&quot;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>With this, we now have our task: <em>Fix the failure as above.</em></p>
</section>
<section id="visualizing-code">
<h2>Visualizing Code<a class="headerlink" href="#visualizing-code" title="Link to this heading">#</a></h2>
<p>To properly understand what is going on here, it helps drawing a diagram on how <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> works. Technically, <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> implements a <em>state machine</em> with two states <code class="docutils literal notranslate"><span class="pre">tag</span></code> and <code class="docutils literal notranslate"><span class="pre">¬</span> <span class="pre">tag</span></code>. We change between these states depending on the characters we process. This is visualized in the following diagram:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">graphviz</span><span class="w"> </span><span class="kn">import</span> <span class="n">Digraph</span><span class="p">,</span> <span class="n">nohtml</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/7d0d2f1134d3d1d3d6a4ff7441c4cf78e8d3b832426056400ff9544b8e019949.svg" src="_images/7d0d2f1134d3d1d3d6a4ff7441c4cf78e8d3b832426056400ff9544b8e019949.svg" />
</div>
</div>
<p>You see that we start in the <em>non-tag</em> state (<code class="docutils literal notranslate"><span class="pre">¬</span> <span class="pre">tag</span></code>). Here, for every character that is not <code class="docutils literal notranslate"><span class="pre">'&lt;'</span></code>, we add the character and stay in the non-tag state. <code class="docutils literal notranslate"><span class="pre">'&gt;'</span></code> characters are skipped, though.</p>
<p>When we read a <code class="docutils literal notranslate"><span class="pre">'&lt;'</span></code>, though, we transition to the <em>tag</em> state (<code class="docutils literal notranslate"><span class="pre">tag</span></code>) and stay in the tag state, skipping characters up to a closing <code class="docutils literal notranslate"><span class="pre">'&gt;'</span></code> character, which makes us transition to the <em>non-tag</em> state again.</p>
</section>
<section id="a-first-fix">
<h2>A First Fix<a class="headerlink" href="#a-first-fix" title="Link to this heading">#</a></h2>
<p>We will now iteratively try to find a correct solution to our bug. On the way we will come up with different <em>interim solutions</em> that bring us closer and closer to the perfect code. Of course, we could come up with a near-perfect solution right away, but each of these interim solutions illustrate some techniques we can use during debugging.</p>
<p>Let us look at the above state machine, and process through our input:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&lt;your name&gt;&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>So what you can see is: We are interpreting the <code class="docutils literal notranslate"><span class="pre">'&gt;'</span></code> of <code class="docutils literal notranslate"><span class="pre">&quot;&lt;your</span> <span class="pre">name&gt;&quot;</span></code> as the closing of the tag. However, this is a quoted string, so the <code class="docutils literal notranslate"><span class="pre">'&gt;'</span></code> should be interpreted as a regular character, not as markup. This is an example of <em>missing functionality:</em> We do not handle quoted characters correctly. We haven’t claimed yet to take care of all functionality, so we still need to extend our code.</p>
<p>So we extend the whole thing.  We set up a special “quote” state which processes quoted inputs in tags until the end of the quoted string is reached. This is how the state machine looks like:</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/30aada5950bdb16cc0ac81472ccc53be713600939847012764509048af2255d1.svg" src="_images/30aada5950bdb16cc0ac81472ccc53be713600939847012764509048af2255d1.svg" />
</div>
</div>
<p>This is a bit more complex already. Proceeding from left to right, we first have the state <code class="docutils literal notranslate"><span class="pre">¬</span> <span class="pre">quote</span> <span class="pre">∧</span> <span class="pre">¬</span> <span class="pre">tag</span></code>, which is our “standard” state for text. If we encounter a <code class="docutils literal notranslate"><span class="pre">'&lt;'</span></code>, we again switch to the “tagged” state <code class="docutils literal notranslate"><span class="pre">¬</span> <span class="pre">quote</span> <span class="pre">∧</span> <span class="pre">tag</span></code>. In this state, however (and only in this state), if we encounter a quotation mark, we switch to the “quotation” state <code class="docutils literal notranslate"><span class="pre">quote</span> <span class="pre">∧</span> <span class="pre">tag</span></code>, in which we remain until we see another quotation mark indicating the end of the string – and then continue in the “tagged” state <code class="docutils literal notranslate"><span class="pre">¬</span> <span class="pre">quote</span> <span class="pre">∧</span> <span class="pre">tag</span></code> until we see the end of the string.</p>
<p>Things get even more complicated as HTML allows both single and double quotation characters. Here’s a revised implementation of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> that takes the above states into account:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>Now, our previous input works well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;text&quot; value=&quot;&lt;your name&gt;&quot;&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&#39;
</pre></div>
</div>
</div>
</div>
<p>and our earlier tests also pass:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;Here&#39;s some &lt;strong&gt;strong argument&lt;/strong&gt;.&quot;</span><span class="p">)</span> <span class="o">==</span> \
    <span class="s2">&quot;Here&#39;s some strong argument.&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;text&quot; value=&quot;&lt;your name&gt;&quot;&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>However, the above code still has a bug.  In two of these inputs, HTML markup is still not properly stripped:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>&quot;foo&quot;<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
&quot;<span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>&quot;
<span class="err">&lt;</span>&quot;b&quot;&gt;foo<span class="err">&lt;</span>/&quot;b&quot;&gt;
</pre></div>
</div>
<p>Can you guess which ones these are?</p>
<p>Again, a simple assertion will reveal the culprits:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;foo&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;&quot;foo&quot;&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_50153/4031927246.py&quot;, line 2, in &lt;module&gt;
    assert remove_html_markup(&#39;&lt;b&gt;&quot;foo&quot;&lt;/b&gt;&#39;) == &#39;&quot;foo&quot;&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;&lt;b&gt;foo&lt;/b&gt;&quot;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_50153/242211734.py&quot;, line 2, in &lt;module&gt;
    assert remove_html_markup(&#39;&quot;&lt;b&gt;foo&lt;/b&gt;&quot;&#39;) == &#39;&quot;foo&quot;&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;&quot;b&quot;&gt;foo&lt;/&quot;b&quot;&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>So, unfortunately, we’re not done yet – our function still has errors.</p>
</section>
<section id="the-devils-guide-to-debugging">
<h2>The Devil’s Guide to Debugging<a class="headerlink" href="#the-devils-guide-to-debugging" title="Link to this heading">#</a></h2>
<p>Let us now discuss a couple of methods that do <em>not</em> work well for debugging. (These “devil’s suggestions” are adapted from the 1993 book “Code Complete” from Steve McConnell.)</p>
<section id="printf-debugging">
<h3>Printf Debugging<a class="headerlink" href="#printf-debugging" title="Link to this heading">#</a></h3>
<p>When I was a student, I never got any formal training in debugging, so I had to figure this out for myself. What I learned was how to use <em>debugging output</em>; in Python, this would be the <code class="docutils literal notranslate"><span class="pre">print()</span></code> function. For instance, I would go and scatter <code class="docutils literal notranslate"><span class="pre">print()</span></code> calls everywhere:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup_with_print</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c =&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="s2">&quot;tag =&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="s2">&quot;quote =&quot;</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>This way of inspecting executions is commonly called “Printf debugging”, after the C <code class="docutils literal notranslate"><span class="pre">printf()</span></code> function. Then, running this would allow me to see what’s going on in my code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup_with_print</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;&quot;foo&quot;&lt;/b&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c = &#39;&lt;&#39; tag = False quote = False
c = &#39;b&#39; tag = True quote = False
c = &#39;&gt;&#39; tag = True quote = False
c = &#39;&quot;&#39; tag = False quote = False
c = &#39;f&#39; tag = False quote = True
c = &#39;o&#39; tag = False quote = True
c = &#39;o&#39; tag = False quote = True
c = &#39;&quot;&#39; tag = False quote = True
c = &#39;&lt;&#39; tag = False quote = False
c = &#39;/&#39; tag = True quote = False
c = &#39;b&#39; tag = True quote = False
c = &#39;&gt;&#39; tag = True quote = False
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;foo&#39;
</pre></div>
</div>
</div>
</div>
<p>Yes, one sees what is going on – but this is horribly inefficient!  Think of a 1,000-character input – you’d have to go through 1,000 lines of logs.  It may help you, but it’s a total time waster.  Plus, you have to enter these statements, remove them again… it’s a maintenance nightmare.</p>
<p>(You may even forget printf’s in your code, creating a security problem: Mac OS X versions 10.7 to 10.7.3 would log the password in clear because someone had forgotten to turn off debugging output.)</p>
</section>
<section id="debugging-into-existence">
<h3>Debugging into Existence<a class="headerlink" href="#debugging-into-existence" title="Link to this heading">#</a></h3>
<p>I would also try to <em>debug the program into existence.</em>  Just change things until they work.  Let me see: If I remove the conditions “and not quote” from the program, it would actually work again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup_without_quotes</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>  <span class="c1"># and not quote:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>  <span class="c1"># and not quote:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">remove_html_markup_without_quotes</span><span class="p">(</span><span class="s1">&#39;&lt;b id=&quot;bar&quot;&gt;foo&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Cool! Unfortunately, the function still fails on the other input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">remove_html_markup_without_quotes</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;&quot;foo&quot;&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_50153/3864559921.py&quot;, line 2, in &lt;module&gt;
    assert remove_html_markup_without_quotes(&#39;&lt;b&gt;&quot;foo&quot;&lt;/b&gt;&#39;) == &#39;&quot;foo&quot;&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>So, maybe we can change things again, such that both work? And maybe the other tests we had earlier won’t fail? Let’s just continue to change things randomly again and again and again.</p>
<p>Oh, and of course, I would never back up earlier versions such that I would be able to keep track of what has changed and when.
Especially keep in mind that our tests will never cover all corner cases. Randomly patching code will just lead to harder to find bugs.</p>
</section>
<section id="use-the-most-obvious-fix">
<h3>Use the Most Obvious Fix<a class="headerlink" href="#use-the-most-obvious-fix" title="Link to this heading">#</a></h3>
<p>My favorite: Use the most obvious fix.  This means that you’re fixing the symptom, not the problem. In our case, this would be something like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup_fixed</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;&lt;b&gt;&quot;foo&quot;&lt;/b&gt;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<p>Miracle! Our earlier failing assertion now works! Now we can do the same for the other failing test, too, and we’re done.
(Rumor has it that some programmers use this technique to get their tests to pass…)</p>
</section>
<section id="things-to-do-instead">
<h3>Things to do Instead<a class="headerlink" href="#things-to-do-instead" title="Link to this heading">#</a></h3>
<p>As with any devil’s guide, you get an idea of how to do things by doing the <em>opposite.</em>  What this means is:</p>
<ol class="arabic simple">
<li><p>Understand the code</p></li>
<li><p>Fix the problem, not the symptom</p></li>
<li><p>Proceed systematically</p></li>
</ol>
<p>which is what we will apply for the rest of this chapter.</p>
</section>
</section>
<section id="from-defect-to-failure">
<h2>From Defect to Failure<a class="headerlink" href="#from-defect-to-failure" title="Link to this heading">#</a></h2>
<p>To understand how to systematically debug a program, we first have to understand <em>how failures come to be.</em> The typical debugging situation looks like this:</p>
<ul class="simple">
<li><p>We have a program (execution), taking some input and producing some output.</p></li>
<li><p>The output is in <em>error</em> (✘), meaning an unwanted and unintended deviation from what is correct, right, or true.</p></li>
<li><p>The input, in contrast, is assumed to be correct (✔) – that is, it should be properly processed by the program in question.</p></li>
</ul>
<p>If the input is incorrect, we wouldn’t normally be searching for the bug in our program, but in whatever produced its input. If the input is under control of a third party, though (which typically is the case for <em>system inputs</em>), your program must check its correctness and reject it if it is incorrect. Once your program accepts a system input as valid, it must be properly processed by the program in question.</p>
<p>Hence, the (very simple) situation we’re having can be shown as:</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/f58fff94a4da7e3a145edf6d9b4aae376896a20e5d193b85cfe9962694f43628.svg" src="_images/f58fff94a4da7e3a145edf6d9b4aae376896a20e5d193b85cfe9962694f43628.svg" />
</div>
</div>
<p>This situation we see above is what we call a <em>failure</em>: An externally visible <em>error</em> in the program behavior, with the error again being an unwanted and unintended deviation from what is correct, right, or true.</p>
<p>How does this failure come to be? The execution we see above breaks down into several program <em>states</em>, one after the other.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/a1bd2ca81319220d4f1aa1aa49157516d2664a66c0bb5da8bba938776a2ea2e4.svg" src="_images/a1bd2ca81319220d4f1aa1aa49157516d2664a66c0bb5da8bba938776a2ea2e4.svg" />
<img alt="_images/ac4517a5d2a23568459f93931ddef7f0d1222f60f1af9117d7535ee945db9e4d.svg" src="_images/ac4517a5d2a23568459f93931ddef7f0d1222f60f1af9117d7535ee945db9e4d.svg" />
<img alt="_images/a55f672ce7f22da10f70c44ce63691c051596d8f542e0a5491087653255b6ee5.svg" src="_images/a55f672ce7f22da10f70c44ce63691c051596d8f542e0a5491087653255b6ee5.svg" />
<img alt="_images/4dc9a694328aaaa72e1ea46ad5905bf2498cb313a40cba8035a9ec0081b8099a.svg" src="_images/4dc9a694328aaaa72e1ea46ad5905bf2498cb313a40cba8035a9ec0081b8099a.svg" />
<img alt="_images/05369b61a8a65d064b1ed5deb0ffe0142628fba0e14762400143108b8607512c.svg" src="_images/05369b61a8a65d064b1ed5deb0ffe0142628fba0e14762400143108b8607512c.svg" />
</div>
</div>
<p>Initially, the program state is still correct (✔). However, at some point in the execution, the state gets an <em>error</em>, also known as a <em>fault</em>. This fault – again an unwanted and unintended deviation from what is correct, right, or true – then propagates along the execution, until it becomes externally visible as a <em>failure</em>.
(In reality, there are many, many more states than just this, but these would not fit in a diagram.)</p>
<p>How does a fault come to be? Each of these program states is produced by a <em>step</em> in the program code. These steps take a state as input and produce another state as output. Technically speaking, the program inputs and outputs are also parts of the program state, so the input flows into the first step, and the output is the state produced by the last step.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/a1bd2ca81319220d4f1aa1aa49157516d2664a66c0bb5da8bba938776a2ea2e4.svg" src="_images/a1bd2ca81319220d4f1aa1aa49157516d2664a66c0bb5da8bba938776a2ea2e4.svg" />
<img alt="_images/e2e26e257ee6cf35fd54c3ebad6e41af20f3e5c2db4f828d30e49fd6a54425f8.svg" src="_images/e2e26e257ee6cf35fd54c3ebad6e41af20f3e5c2db4f828d30e49fd6a54425f8.svg" />
<img alt="_images/5e8b46f83b2c20befed8c69e99fe5d2b1315507518fa43af4133d34b1d0b2d9e.svg" src="_images/5e8b46f83b2c20befed8c69e99fe5d2b1315507518fa43af4133d34b1d0b2d9e.svg" />
<img alt="_images/27178f18be5cf0bcb3a9e713bcfd23e33c916d6e8fa12c9376efbe80d1887c70.svg" src="_images/27178f18be5cf0bcb3a9e713bcfd23e33c916d6e8fa12c9376efbe80d1887c70.svg" />
<img alt="_images/58cd833d686393b967b8d0302c552844ced429dad7a71d6d4a73ebcd711cde94.svg" src="_images/58cd833d686393b967b8d0302c552844ced429dad7a71d6d4a73ebcd711cde94.svg" />
</div>
</div>
<p>Now, in the diagram above, Step 2 gets a <em>correct</em> state as input and produces a <em>faulty</em> state as output. The produced fault then propagates across more steps to finally become visible as a <em>failure</em>.</p>
<p>The goal of debugging thus is to <em>search</em> for the step in which the state first becomes faulty. The <em>code</em> associated with this step is again an error – an unwanted and unintended deviation from what is correct, right, or true – and is called a <em>defect</em>. This is what we have to find – and to fix.</p>
<p>Sounds easy, right? Unfortunately, things are not that easy, and that has something to do with the program state. Let us assume our state consists of three variables, <code class="docutils literal notranslate"><span class="pre">var1</span></code> to <code class="docutils literal notranslate"><span class="pre">var3</span></code>, and that Step 2 produces a fault in <code class="docutils literal notranslate"><span class="pre">var2</span></code>. This fault then propagates to the output:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/a1bd2ca81319220d4f1aa1aa49157516d2664a66c0bb5da8bba938776a2ea2e4.svg" src="_images/a1bd2ca81319220d4f1aa1aa49157516d2664a66c0bb5da8bba938776a2ea2e4.svg" />
<img alt="_images/acd2e0ca9e1ce9eccfd92e4cf256b374085c5d05c47420cdb06b15baafa4106d.svg" src="_images/acd2e0ca9e1ce9eccfd92e4cf256b374085c5d05c47420cdb06b15baafa4106d.svg" />
<img alt="_images/4136a0a5c9190c13961f2f768dcdb700ff89aba5fa594c16b13c728b71695746.svg" src="_images/4136a0a5c9190c13961f2f768dcdb700ff89aba5fa594c16b13c728b71695746.svg" />
<img alt="_images/c6c8b075b36e2f7c3852e30fd5bc7eb2837778b240d7ba4bc96799e7f36cf905.svg" src="_images/c6c8b075b36e2f7c3852e30fd5bc7eb2837778b240d7ba4bc96799e7f36cf905.svg" />
<img alt="_images/50f1b153ef123b27f47e000e099f45f69670d3fb5a58b1617e8fd8b33df999bf.svg" src="_images/50f1b153ef123b27f47e000e099f45f69670d3fb5a58b1617e8fd8b33df999bf.svg" />
</div>
</div>
<p>The way these faults propagate is called a <em>cause-effect chain</em>:</p>
<ul class="simple">
<li><p>The <em>defect</em> in the code <em>causes</em> a fault in the state when executed.</p></li>
<li><p>This <em>fault</em> in the state then <em>propagates</em> through further execution steps…</p></li>
<li><p>… until it becomes visible as a <em>failure</em>.</p></li>
</ul>
<p>Even worse: in most cases the fault often expresses itself first in the control flow rather than the variable contents.
Such a deviation from a normal execution is in general even harder to find.</p>
<p>Since the code was originally written by a human, any defect can be related to some original <em>mistake</em> the programmer made. This gives us a number of terms that all are more precise than the general “error” or the colloquial “bug”:</p>
<ul class="simple">
<li><p>A <em>mistake</em> is a human act or decision resulting in an error.</p></li>
<li><p>A <em>defect</em> is an error in the program code. Also called <em>bug</em>.</p></li>
<li><p>A <em>fault</em> is an error in the program state. Also called <em>infection</em>.</p></li>
<li><p>A <em>failure</em> is an externally visible error in the program behavior. Also called <em>malfunction</em>.</p></li>
</ul>
<p>The cause-effect chain of events is thus</p>
<ul class="simple">
<li><p>Mistake → Defect → Fault → … → Fault → Failure</p></li>
</ul>
<p>Note that not every defect also causes a failure, which is despite all testing, there can still be defects in the code looming around until the right conditions are met to trigger them. On the other hand, though, <em>every failure can be traced back to the defect that causes it</em>. Our job is to break the cause-effect chain.</p>
</section>
<section id="from-failure-to-defect">
<h2>From Failure to Defect<a class="headerlink" href="#from-failure-to-defect" title="Link to this heading">#</a></h2>
<p>To find a defect from a failure, we <em>trace back</em> the faults along their <em>propagation</em> – that is, we find out which faults in the earlier state have caused the later faults. We start from the very end of the execution and then gradually progress backwards in time, examining fault after fault until we find a <em>transition</em> from a correct state to a faulty state – that is, a
step in which a correct state comes in and a faulty state comes out. At this point, we have found the origin of the failure – and the defect that causes it.</p>
<p>What sounds like a straight-forward strategy, unfortunately, doesn’t always work this way in practice. That is because of the following problems of debugging:</p>
<ul class="simple">
<li><p>First, program states are actually <em>large</em>, encompassing dozens to thousands of variables, possibly even more. If you have to search all of these manually and check them for faults, you will spend a lot of time for a single state.</p></li>
<li><p>Second, you do not always know <em>whether a state is correct or not.</em> While most programs have some form of specification for their inputs and outputs, these do not necessarily exist for intermediate results. If one had a specification that could check each state for correctness (possibly even automatically), debugging would be trivial. Unfortunately, it is not, and that’s partly due to the lack of specifications.</p></li>
<li><p>Third, executions typically do not come in a handful of steps, as in the diagrams above; instead, they can easily encompass <em>thousands to millions of steps.</em> This means that you will have to examine not just one state, but several, making the problem much worse.</p></li>
</ul>
<p>To make your search efficient, you thus have to <em>focus</em> your search – starting with most likely causes and gradually progressing to the less probable causes. This is what we call a <em>debugging strategy</em>. Intermediate assertions of the program state also come in handy, as they make the cause-effect chain smaller.</p>
</section>
<section id="the-scientific-method">
<h2>The Scientific Method<a class="headerlink" href="#the-scientific-method" title="Link to this heading">#</a></h2>
<p>Now that we know how failures come to be, let’s look into how to systematically find their causes. What we need is a <em>strategy</em> that helps us search for how and when the failure comes to be. For this, we use a process called the <em>scientific method</em>.</p>
<p>When we are debugging a program, we are trying to find the causes of a given effect – very much like natural scientists try to understand why things in nature are as they are and how they come to be. Over thousands of years, scientists have conducted <em>observations</em> and <em>experiments</em> to come to an understanding of how our world works. The process by which experimental scientists operate has been coined “The scientific method”. This is how it works:</p>
<ol class="arabic simple">
<li><p>Formulate a <em>question</em>, as in “Why does this apple fall down?”.</p></li>
<li><p>Invent a <em>hypothesis</em> based on knowledge obtained while formulating the question, that may explain the observed behavior.</p></li>
<li><p>Determining the logical consequences of the hypothesis, formulate a <em>prediction</em> that can <em>support</em> or <em>refute</em> the hypothesis. Ideally, the prediction would distinguish the hypothesis from likely alternatives.</p></li>
<li><p><em>Test</em> the prediction (and thus the hypothesis) in an <em>experiment</em>. If the prediction holds, confidence in the hypothesis increases; otherwise, it decreases.</p></li>
<li><p>Repeat Steps 2–4 until there are no discrepancies between hypothesis and predictions and/or observations.</p></li>
</ol>
<p>At this point, your hypothesis may be named a <em>theory</em> – that is, a predictive and comprehensive description of some aspect of the natural world. The gravitational theory, for instance, predicts very well how the moon revolves around the earth, and how the earth revolves around the sun.  Our debugging problems are of a slightly lesser scale – we’d like a theory of how our failure came to be – but the process is pretty much the same.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/dd42b61354b7609e90383018e3ff4e6267fd95ba20a1238f81fed6a744b74400.svg" src="_images/dd42b61354b7609e90383018e3ff4e6267fd95ba20a1238f81fed6a744b74400.svg" />
</div>
</div>
<p>In debugging, we proceed the very same way – indeed, we are treating bugs as if they were natural phenomena.   This analogy may sound far-fetched, as programs are anything but natural.  Nature, by definition, is not under our control.  But bugs are <em>out of our control just as well.</em>  Hence, the analogy is not that far-fetched – and we can apply the same techniques for debugging.</p>
<section id="finding-a-hypothesis">
<h3>Finding a Hypothesis<a class="headerlink" href="#finding-a-hypothesis" title="Link to this heading">#</a></h3>
<p>Let us apply the scientific method to our Python program which removes HTML tags.  First of all, let us recall the problem – <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> works for some inputs, but fails on others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">html</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;&lt;b&gt;foo&lt;/b&gt;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;&lt;b&gt;&quot;foo&quot;&lt;/b&gt;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;&quot;&lt;b&gt;foo&lt;/b&gt;&quot;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;&lt;b id=&quot;bar&quot;&gt;foo&lt;/b&gt;&#39;</span><span class="p">]):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%-2d</span><span class="s2"> </span><span class="si">%-15s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1  &lt;b&gt;foo&lt;/b&gt;      foo
2  &lt;b&gt;&quot;foo&quot;&lt;/b&gt;    foo
3  &quot;&lt;b&gt;foo&lt;/b&gt;&quot;    &lt;b&gt;foo&lt;/b&gt;
4  &lt;b id=&quot;bar&quot;&gt;foo&lt;/b&gt; foo
</pre></div>
</div>
</div>
</div>
<p>Input #1 and #4 work as expected, the others do not. We can write these down in a table, such that we can always look back at our previous results:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Input</p></th>
<th class="head"><p>Expectation</p></th>
<th class="head"><p>Output</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;&quot;foo&quot;&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✘</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;&lt;b&gt;foo&lt;/b&gt;&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p>✘</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b</span> <span class="pre">id=&quot;bar&quot;&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✔</p></td>
</tr>
</tbody>
</table>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">From the difference between success and failure, we can already devise some observations about  what is wrong with the output. Which of these can we turn into general hypotheses?</div>
    </p>
    <p>
    <div class="quiz_options" title="Check all that apply.">
    
        <input type="checkbox" name="b601b014-b293-11f0-ab86-6298cf1a5790" id="b601b014-b293-11f0-ab86-6298cf1a5790-1" onclick="clear_selection('b601b014-b293-11f0-ab86-6298cf1a5790')">
        <label id="b601b014-b293-11f0-ab86-6298cf1a5790-1-label" for="b601b014-b293-11f0-ab86-6298cf1a5790-1">Double quotes (<code>"</code>) are stripped from the tagged input.</label><br>
    
        <input type="checkbox" name="b601b014-b293-11f0-ab86-6298cf1a5790" id="b601b014-b293-11f0-ab86-6298cf1a5790-2" onclick="clear_selection('b601b014-b293-11f0-ab86-6298cf1a5790')">
        <label id="b601b014-b293-11f0-ab86-6298cf1a5790-2-label" for="b601b014-b293-11f0-ab86-6298cf1a5790-2">Tags in double quotes are not stripped.</label><br>
    
        <input type="checkbox" name="b601b014-b293-11f0-ab86-6298cf1a5790" id="b601b014-b293-11f0-ab86-6298cf1a5790-3" onclick="clear_selection('b601b014-b293-11f0-ab86-6298cf1a5790')">
        <label id="b601b014-b293-11f0-ab86-6298cf1a5790-3-label" for="b601b014-b293-11f0-ab86-6298cf1a5790-3">The tag <code>&lt;&gt;</code> is always stripped from the input.</label><br>
    
        <input type="checkbox" name="b601b014-b293-11f0-ab86-6298cf1a5790" id="b601b014-b293-11f0-ab86-6298cf1a5790-4" onclick="clear_selection('b601b014-b293-11f0-ab86-6298cf1a5790')">
        <label id="b601b014-b293-11f0-ab86-6298cf1a5790-4-label" for="b601b014-b293-11f0-ab86-6298cf1a5790-4">Four-letter words are stripped.</label><br>
    
    </div>
    </p>
    <input id="b601b014-b293-11f0-ab86-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('b601b014-b293-11f0-ab86-6298cf1a5790', 6, 1, '[298 % 33, 1234 % 616]')">
    <span class="quiz_hint" id="b601b014-b293-11f0-ab86-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
</section>
<section id="testing-a-hypothesis">
<h3>Testing a Hypothesis<a class="headerlink" href="#testing-a-hypothesis" title="Link to this heading">#</a></h3>
<p>The hypotheses that remain are:</p>
<ol class="arabic simple">
<li><p>Double quotes are stripped from the tagged input.</p></li>
<li><p>Tags in double quotes are not stripped.</p></li>
</ol>
<p>These may be two separate issues, but chances are they are tied to each other.  Let’s focus on 1., because it is simpler.  Does it hold for all inputs, even untagged ones?  Our hypothesis becomes</p>
<ol class="arabic simple">
<li><p>Double quotes are stripped from the <s>tagged</s> input.</p></li>
</ol>
<p>Let’s devise an experiment to validate this.  If we feed the string</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>&quot;foo&quot;
</pre></div>
</div>
<p>(including the double quotes) into <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, we should obtain</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>&quot;foo&quot;
</pre></div>
</div>
<p>as result – that is, the output should be the unchanged input. However, if our hypothesis 1. is correct, we should obtain</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>foo
</pre></div>
</div>
<p>as result – that is, “Double quotes are stripped from the input” as predicted by the hypothesis.</p>
<p>We can very easily test this hypothesis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;foo&#39;
</pre></div>
</div>
</div>
</div>
<p>Our hypothesis is confirmed! We can add this to our list of observations.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Input</p></th>
<th class="head"><p>Expectation</p></th>
<th class="head"><p>Output</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;&quot;foo&quot;&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✘</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;&lt;b&gt;foo&lt;/b&gt;&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p>✘</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b</span> <span class="pre">id=&quot;bar&quot;&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✘</p></td>
</tr>
</tbody>
</table>
</div>
<p>You can try out the hypothesis with more inputs – and it remains valid. Any non-markup input that contains double quotes will have these stripped.</p>
<p>Where does that quote-stripping come from?  This is where we need to explore the cause-effect chain.  The only place in <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> where quotes are handled is this line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
</pre></div>
</div>
<p>So, quotes should be removed only if <code class="docutils literal notranslate"><span class="pre">tag</span></code> is set. However, <code class="docutils literal notranslate"><span class="pre">tag</span></code> can be set only if the input contains a markup tag, which is not the case for a simple input like <code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code>. Hence, what we observe is actually <em>impossible.</em> Yet, it happens.</p>
</section>
<section id="refining-a-hypothesis">
<h3>Refining a Hypothesis<a class="headerlink" href="#refining-a-hypothesis" title="Link to this heading">#</a></h3>
<p>Debugging is a game of falsifying assumptions. You assume the code works – it doesn’t. You assume the <code class="docutils literal notranslate"><span class="pre">tag</span></code> flag cannot be set – yet it may be. What do we do? Again, we create a hypothesis:</p>
<ol class="arabic simple">
<li><p>The error is due to <code class="docutils literal notranslate"><span class="pre">tag</span></code> being set.</p></li>
</ol>
<p>How do we know whether tag is being set?  Let me introduce one of the most powerful debugging tools ever invented, the <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement.  The statement</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">cond</span>
</pre></div>
</div>
<p>evaluates the given condition <code class="docutils literal notranslate"><span class="pre">cond</span></code> and</p>
<ul class="simple">
<li><p>if it holds: proceed as usual</p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">cond</span></code> does not hold: throw an exception</p></li>
</ul>
<p>An <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement <em>encodes our assumptions</em> and as such, should never fail. If it does, well, then something is wrong.
Furthermore, <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements break the cause-effect chain into smaller pieces. The observable failure occurs earlier in
the program execution and thus closer to the initial fault.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">assert</span></code>, we can check the value of <code class="docutils literal notranslate"><span class="pre">tag</span></code> all through the loop:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup_with_tag_assert</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">tag</span>  <span class="c1"># &lt;=== Just added</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>Our expectation is that this assertion would fail. So, do we actually get an exception? Try it out for yourself by uncommenting the following line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove_html_markup_with_tag_assert(&#39;&quot;foo&quot;&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">What happens after inserting the above assertion?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="b6044fa4-b293-11f0-ab86-6298cf1a5790" id="b6044fa4-b293-11f0-ab86-6298cf1a5790-1" onclick="clear_selection('b6044fa4-b293-11f0-ab86-6298cf1a5790')">
        <label id="b6044fa4-b293-11f0-ab86-6298cf1a5790-1-label" for="b6044fa4-b293-11f0-ab86-6298cf1a5790-1">The program raises an exception. (i.e., <code>tag</code> is set)</label><br>
    
        <input type="radio" name="b6044fa4-b293-11f0-ab86-6298cf1a5790" id="b6044fa4-b293-11f0-ab86-6298cf1a5790-2" onclick="clear_selection('b6044fa4-b293-11f0-ab86-6298cf1a5790')">
        <label id="b6044fa4-b293-11f0-ab86-6298cf1a5790-2-label" for="b6044fa4-b293-11f0-ab86-6298cf1a5790-2">The output is as before, i.e., <code>foo</code> without quotes. (which means that <code>tag</code> is not set)</label><br>
    
    </div>
    </p>
    <input id="b6044fa4-b293-11f0-ab86-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('b6044fa4-b293-11f0-ab86-6298cf1a5790', 4, 0, '')">
    <span class="quiz_hint" id="b6044fa4-b293-11f0-ab86-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Here’s the solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">remove_html_markup_with_tag_assert</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;foo&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="refuting-a-hypothesis">
<h3>Refuting a Hypothesis<a class="headerlink" href="#refuting-a-hypothesis" title="Link to this heading">#</a></h3>
<p>We did not get an exception, hence we reject our hypothesis:</p>
<ol class="arabic simple">
<li><p><s>The error is due to <code class="docutils literal notranslate"><span class="pre">tag</span></code> being set.</s></p></li>
</ol>
<p>Again, let’s go back to the only place in our code where quotes are handled:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
</pre></div>
</div>
<p>Because of the assertion, we already know that <code class="docutils literal notranslate"><span class="pre">tag</span></code> is always False.  Hence, this condition should never hold either.</p>
<p>But maybe there’s something wrong with the condition such that it holds? Here’s our hypothesis:</p>
<ol class="arabic simple">
<li><p>The error is due to the quote condition evaluating to true</p></li>
</ol>
<p>If the condition evaluates to true, then <code class="docutils literal notranslate"><span class="pre">quote</span></code> should be set.  We could now go and assert that <code class="docutils literal notranslate"><span class="pre">quote</span></code> is false; but we only care about the condition.  So we insert an assertion that assumes that setting the code setting the <code class="docutils literal notranslate"><span class="pre">quote</span></code> flag is never reached:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup_with_quote_assert</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>  <span class="c1"># &lt;=== Just added</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>Our expectation this time again is that the assertion fails. So, do we get an exception this time? Try it out for yourself by uncommenting the following line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove_html_markup_with_quote_assert(&#39;&quot;foo&quot;&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">What happens after inserting the 'assert' tag?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="b6068602-b293-11f0-ab86-6298cf1a5790" id="b6068602-b293-11f0-ab86-6298cf1a5790-1" onclick="clear_selection('b6068602-b293-11f0-ab86-6298cf1a5790')">
        <label id="b6068602-b293-11f0-ab86-6298cf1a5790-1-label" for="b6068602-b293-11f0-ab86-6298cf1a5790-1">The program raises an exception (i.e., the quote condition holds)</label><br>
    
        <input type="radio" name="b6068602-b293-11f0-ab86-6298cf1a5790" id="b6068602-b293-11f0-ab86-6298cf1a5790-2" onclick="clear_selection('b6068602-b293-11f0-ab86-6298cf1a5790')">
        <label id="b6068602-b293-11f0-ab86-6298cf1a5790-2-label" for="b6068602-b293-11f0-ab86-6298cf1a5790-2">The output is still foo (i.e., the quote condition does not hold)</label><br>
    
    </div>
    </p>
    <input id="b6068602-b293-11f0-ab86-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('b6068602-b293-11f0-ab86-6298cf1a5790', 2, 0, '')">
    <span class="quiz_hint" id="b6068602-b293-11f0-ab86-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Here’s what happens now that we have the <code class="docutils literal notranslate"><span class="pre">assert</span></code> tag:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">remove_html_markup_with_quote_assert</span><span class="p">(</span><span class="s1">&#39;&quot;foo&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_50153/904218512.py&quot;, line 2, in &lt;module&gt;
    result = remove_html_markup_with_quote_assert(&#39;&quot;foo&quot;&#39;)
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_50153/2877654332.py&quot;, line 12, in remove_html_markup_with_quote_assert
    assert False  # &lt;=== Just added
           ^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>From this observation, we can deduce that our hypothesis is <em>confirmed</em>:</p>
<ol class="arabic simple">
<li><p>The error is due to the quote condition evaluating to true (CONFIRMED)</p></li>
</ol>
<p>and the <em>condition is actually faulty.</em> It evaluates to True although <code class="docutils literal notranslate"><span class="pre">tag</span></code> is always False:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
</pre></div>
</div>
<p>But this condition holds for single and double quotes.  Is there a difference?</p>
<p>Let us see whether our observations generalize towards general quotes:</p>
<ol class="arabic simple">
<li><p><s>Double</s> quotes are stripped from the input.</p></li>
</ol>
<p>We can verify these hypotheses with an additional experiment.  We go back to our original implementation (without any asserts), and then check it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;&#39;foo&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;&#39;foo&#39;&quot;
</pre></div>
</div>
</div>
</div>
<p>Surprise: Our hypothesis is rejected and we can add another observation to our table:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Input</p></th>
<th class="head"><p>Expectation</p></th>
<th class="head"><p>Output</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">'foo'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'foo'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'foo'</span></code></p></td>
<td><p>✔</p></td>
</tr>
</tbody>
</table>
</div>
<p>So, the condition</p>
<ul class="simple">
<li><p>becomes True when a double quote is seen</p></li>
<li><p>becomes False (as it should) with single quotes</p></li>
</ul>
<p>At this point, you should have enough material to solve the problem.  How do we have to fix the condition? Here are four alternatives:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">tag</span>        <span class="c1"># Choice 1</span>
<span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tag</span>  <span class="c1"># Choice 2</span>
<span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span>    <span class="c1"># Choice 3</span>
<span class="o">...</span>                               <span class="c1"># Something else</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">How should the condition read?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="b6083a56-b293-11f0-ab86-6298cf1a5790" id="b6083a56-b293-11f0-ab86-6298cf1a5790-1" onclick="clear_selection('b6083a56-b293-11f0-ab86-6298cf1a5790')">
        <label id="b6083a56-b293-11f0-ab86-6298cf1a5790-1-label" for="b6083a56-b293-11f0-ab86-6298cf1a5790-1"><code>c == "" or c == '' and tag</code> (Choice 1)</label><br>
    
        <input type="radio" name="b6083a56-b293-11f0-ab86-6298cf1a5790" id="b6083a56-b293-11f0-ab86-6298cf1a5790-2" onclick="clear_selection('b6083a56-b293-11f0-ab86-6298cf1a5790')">
        <label id="b6083a56-b293-11f0-ab86-6298cf1a5790-2-label" for="b6083a56-b293-11f0-ab86-6298cf1a5790-2"><code>c == '"' or c == "'" and not tag</code> (Choice 2)</label><br>
    
        <input type="radio" name="b6083a56-b293-11f0-ab86-6298cf1a5790" id="b6083a56-b293-11f0-ab86-6298cf1a5790-3" onclick="clear_selection('b6083a56-b293-11f0-ab86-6298cf1a5790')">
        <label id="b6083a56-b293-11f0-ab86-6298cf1a5790-3-label" for="b6083a56-b293-11f0-ab86-6298cf1a5790-3"><code>(c == '"' or c == "'") and tag</code> (Choice 3)</label><br>
    
        <input type="radio" name="b6083a56-b293-11f0-ab86-6298cf1a5790" id="b6083a56-b293-11f0-ab86-6298cf1a5790-4" onclick="clear_selection('b6083a56-b293-11f0-ab86-6298cf1a5790')">
        <label id="b6083a56-b293-11f0-ab86-6298cf1a5790-4-label" for="b6083a56-b293-11f0-ab86-6298cf1a5790-4">Something else</label><br>
    
    </div>
    </p>
    <input id="b6083a56-b293-11f0-ab86-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('b6083a56-b293-11f0-ab86-6298cf1a5790', 8, 0, '399 % 4')">
    <span class="quiz_hint" id="b6083a56-b293-11f0-ab86-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
</section>
</section>
<section id="fixing-the-bug">
<h2>Fixing the Bug<a class="headerlink" href="#fixing-the-bug" title="Link to this heading">#</a></h2>
<p>So, you have spotted the defect: In Python (and most other languages), <code class="docutils literal notranslate"><span class="pre">and</span></code> takes precedence over <code class="docutils literal notranslate"><span class="pre">or</span></code>, which is why the condition is wrong.  It should read:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span>
</pre></div>
</div>
<p>(Actually, good programmers rarely depend on precedence; it is considered good style to use parentheses lavishly.)</p>
<p>So, our hypothesis now has become</p>
<ol class="arabic simple">
<li><p>The error is due to the <code class="docutils literal notranslate"><span class="pre">quote</span></code> condition evaluating to True</p></li>
</ol>
<p>Is this our final hypothesis?  We can check our earlier examples whether they should now work well:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Input</p></th>
<th class="head"><p>Expectation</p></th>
<th class="head"><p>Output</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;&quot;foo&quot;&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✘</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;&lt;b&gt;foo&lt;/b&gt;&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p>✘</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b</span> <span class="pre">id=&quot;bar&quot;&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✔</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'foo'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✘</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">'foo'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'foo'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'foo'</span></code></p></td>
<td><p>✔</p></td>
</tr>
</tbody>
</table>
</div>
<p>In all of these examples, the <code class="docutils literal notranslate"><span class="pre">quote</span></code> flag should now be set outside of tags; hence, everything should work as expected.</p>
<p>In terms of the scientific process, we now have a <em>theory</em> – a hypothesis that</p>
<ul class="simple">
<li><p>is consistent with all earlier observations</p></li>
<li><p>predicts future observations (in our case: correct behavior)</p></li>
</ul>
<p>For debugging, our problems are usually too small for a big word like theory, so we use the word <em>diagnosis</em> instead. So is our diagnosis sufficient to fix the bug? Let us check.</p>
<section id="checking-diagnoses">
<h3>Checking Diagnoses<a class="headerlink" href="#checking-diagnoses" title="Link to this heading">#</a></h3>
<p>In debugging, you should start to fix your code if and only if you have a diagnosis that shows two things:</p>
<ol class="arabic simple">
<li><p><strong>Causality.</strong> Your diagnosis should explain why and how the failure came to be. Hence, it induces a <em>fix</em> that, when applied, should make the failure disappear.</p></li>
<li><p><strong>Incorrectness.</strong> Your diagnosis should explain why and how the code is <em>incorrect</em> (which in turn suggests how to <em>correct</em> the code). Hence, the fix it induces not only applies to the given failure, but also to all related failures.</p></li>
</ol>
<p>Showing both these aspects requirements – <em>causality</em> and <em>incorrectness</em> – are crucial for a debugging diagnosis:</p>
<ul class="simple">
<li><p>If you find that you can change some location to make the failure go away, but are not sure why this location is wrong, then your “fix” may apply only to the symptom rather than the source. Your diagnosis explains <em>causality</em>, but not <em>incorrectness</em>.</p></li>
<li><p>If you find that there is a defect in some code location, but do not verify whether this defect is related to the failure in question, then your “fix” may not address the failure. Your diagnosis addresses <em>incorrectness</em>, but not <em>causality</em>.</p></li>
</ul>
<p>When you do have a diagnosis that explains both causality (how the failure came to be), and incorrectness (how to correct the code accordingly), then (and only then!) is it time to actually <em>fix</em> the code accordingly. After applying the fix, the failure should be gone, and no other failure should occur. If the failure persists, this should come as a surprise. Obviously, there is some other aspect that you haven’t considered yet, so you have to go back to the drawing board and add another failing test case to the set of observations.</p>
</section>
<section id="fixing-the-code">
<h3>Fixing the Code<a class="headerlink" href="#fixing-the-code" title="Link to this heading">#</a></h3>
<p>All these things considered, let us go and fix <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>. We know how the defect <em>causes</em> the failure (by erroneously setting <code class="docutils literal notranslate"><span class="pre">quote</span></code> outside of tags). We know that the line in question is <em>incorrect</em> (as single and double of quotes should be treated similarly). So, our diagnosis shows both causality and incorrectness, and we can go and fix the code accordingly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>  <span class="c1"># &lt;-- FIX</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>We verify that the fix was successful by running our earlier tests. Not only should the previously failing tests now pass, the previously passing tests also should not be affected. Fortunately, all tests now pass:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;Here&#39;s some &lt;strong&gt;strong argument&lt;/strong&gt;.&quot;</span><span class="p">)</span> <span class="o">==</span> \
    <span class="s2">&quot;Here&#39;s some strong argument.&quot;</span>
<span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span>
    <span class="s1">&#39;&lt;input type=&quot;text&quot; value=&quot;&lt;your name&gt;&quot;&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
<span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;foo&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
<span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;&quot;foo&quot;&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
<span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;&lt;b&gt;foo&lt;/b&gt;&quot;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
<span class="k">assert</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b id=&quot;bar&quot;&gt;foo&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>So, our hypothesis <em>was</em> a theory, and our diagnosis was correct. Success!</p>
</section>
<section id="alternate-paths">
<h3>Alternate Paths<a class="headerlink" href="#alternate-paths" title="Link to this heading">#</a></h3>
<p>A defect may have more than one hypothesis, and each diagnosis can be obtained by many ways.  We could also have started with our other hypothesis</p>
<ol class="arabic simple" start="2">
<li><p>Tags in double quotes are not stripped</p></li>
</ol>
<p>and by reasoning and experiments, we would have reached the same conclusion that the condition is faulty:</p>
<ul class="simple">
<li><p>To strip tags, the <code class="docutils literal notranslate"><span class="pre">tag</span></code> flag must be set (but it is not).</p></li>
<li><p>To set the <code class="docutils literal notranslate"><span class="pre">tag</span></code> flag, the <code class="docutils literal notranslate"><span class="pre">quote</span></code> variable must not be set (but it is).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">quote</span></code> flag is set under the given condition (which thus must be faulty).</p></li>
</ul>
<p>This gets us to the same diagnosis as above – and, of course, the same fix.</p>
</section>
</section>
<section id="homework-after-the-fix">
<h2>Homework after the Fix<a class="headerlink" href="#homework-after-the-fix" title="Link to this heading">#</a></h2>
<p>After having successfully validated the fix, we still have some homework to make.</p>
<section id="check-for-further-defect-occurrences">
<h3>Check for further Defect Occurrences<a class="headerlink" href="#check-for-further-defect-occurrences" title="Link to this heading">#</a></h3>
<p>First, we may want to check that the underlying mistake was not made elsewhere, too.</p>
<p>For an error as with <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, it may be wise to check other parts of the code (possibly written by the same programmer) whether Boolean formulas show proper precedence. Consider setting up a static program checker or style checker to catch similar mistakes.
Usually if you code in an IDE specifically designed for language you are coding in, you will get hints on so called <em>code smells</em>,
parts of your code that are typically erroneous because of bad style or other typical mistakes.</p>
</section>
<section id="check-your-tests">
<h3>Check your Tests<a class="headerlink" href="#check-your-tests" title="Link to this heading">#</a></h3>
<p>If the defect was not found through testing, now is a good time to make sure it will be found the next time. If you use automated tests, add a test that catches the bug (as well as similar ones), such that you can prevent regressions.</p>
</section>
<section id="add-assertions">
<h3>Add Assertions<a class="headerlink" href="#add-assertions" title="Link to this heading">#</a></h3>
<p>To be 100% sure, we could add an assertion to <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> that checks the final result for correctness. Unfortunately, writing such an assertion is just as complex as writing the function itself.</p>
<p>There is one assertion, though, which could be placed in the loop body to catch this kind of errors, and which could remain in the code. Which is it?</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">Which assertion would have caught the problem?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="b60a3a68-b293-11f0-ab86-6298cf1a5790" id="b60a3a68-b293-11f0-ab86-6298cf1a5790-1" onclick="clear_selection('b60a3a68-b293-11f0-ab86-6298cf1a5790')">
        <label id="b60a3a68-b293-11f0-ab86-6298cf1a5790-1-label" for="b60a3a68-b293-11f0-ab86-6298cf1a5790-1"><code>assert quote and not tag</code></label><br>
    
        <input type="radio" name="b60a3a68-b293-11f0-ab86-6298cf1a5790" id="b60a3a68-b293-11f0-ab86-6298cf1a5790-2" onclick="clear_selection('b60a3a68-b293-11f0-ab86-6298cf1a5790')">
        <label id="b60a3a68-b293-11f0-ab86-6298cf1a5790-2-label" for="b60a3a68-b293-11f0-ab86-6298cf1a5790-2"><code>assert quote or not tag</code></label><br>
    
        <input type="radio" name="b60a3a68-b293-11f0-ab86-6298cf1a5790" id="b60a3a68-b293-11f0-ab86-6298cf1a5790-3" onclick="clear_selection('b60a3a68-b293-11f0-ab86-6298cf1a5790')">
        <label id="b60a3a68-b293-11f0-ab86-6298cf1a5790-3-label" for="b60a3a68-b293-11f0-ab86-6298cf1a5790-3"><code>assert tag or not quote</code></label><br>
    
        <input type="radio" name="b60a3a68-b293-11f0-ab86-6298cf1a5790" id="b60a3a68-b293-11f0-ab86-6298cf1a5790-4" onclick="clear_selection('b60a3a68-b293-11f0-ab86-6298cf1a5790')">
        <label id="b60a3a68-b293-11f0-ab86-6298cf1a5790-4-label" for="b60a3a68-b293-11f0-ab86-6298cf1a5790-4"><code>assert tag and not quote</code></label><br>
    
    </div>
    </p>
    <input id="b60a3a68-b293-11f0-ab86-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('b60a3a68-b293-11f0-ab86-6298cf1a5790', 8, 0, '3270 - 3267')">
    <span class="quiz_hint" id="b60a3a68-b293-11f0-ab86-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Indeed, the statement</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tag</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">quote</span>
</pre></div>
</div>
<p>is correct. This excludes the situation of ¬<code class="docutils literal notranslate"><span class="pre">tag</span></code> ∧ <code class="docutils literal notranslate"><span class="pre">quote</span></code> – that is, the <code class="docutils literal notranslate"><span class="pre">tag</span></code> flag is not set, but the <code class="docutils literal notranslate"><span class="pre">quote</span></code> flag is. If you remember our state machine from above, this is actually a state that should never exist:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/30aada5950bdb16cc0ac81472ccc53be713600939847012764509048af2255d1.svg" src="_images/30aada5950bdb16cc0ac81472ccc53be713600939847012764509048af2255d1.svg" />
</div>
</div>
<p>Here’s our function in its “final” state. As software goes, software is never final – and this may also hold for our function, as there is still room for improvement. For this chapter though, we leave it be.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">tag</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">quote</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="commit-the-fix">
<h3>Commit the Fix<a class="headerlink" href="#commit-the-fix" title="Link to this heading">#</a></h3>
<p>It may sound obvious, but your fix is worth nothing if it doesn’t go into production. Be sure to commit your change to the code repository, together with your diagnosis. If your fix has to be approved by a third party, a good diagnosis on why and what happened is immensely helpful.</p>
</section>
<section id="close-the-bug-report">
<h3>Close the Bug Report<a class="headerlink" href="#close-the-bug-report" title="Link to this heading">#</a></h3>
<p>If you <a class="reference internal" href="Tracking.html"><span class="std std-doc">systematically track bugs</span></a>, and your bug is properly tracked, now is the time to mark the issue as “resolved”. Check for duplicates of the issue and check whether they are resolved, too. And now, you are finally done:</p>
<p><img alt="" src="https://media.giphy.com/media/nbJUuYFI6s0w0/giphy.gif" /></p>
<p>Time to relax – and look for the next bug!</p>
</section>
</section>
<section id="become-a-better-debugger">
<h2>Become a Better Debugger<a class="headerlink" href="#become-a-better-debugger" title="Link to this heading">#</a></h2>
<p>We have now systematically fixed a bug. In this book, we will explore a number of techniques to make debugging easier – coming up with automated diagnoses, explanations, even automatic repairs, including for our example above. But there are also a number of things <em>you</em> can do to become a better debugger.</p>
<section id="follow-the-process">
<h3>Follow the Process<a class="headerlink" href="#follow-the-process" title="Link to this heading">#</a></h3>
<p>If you’re an experienced programmer, you may have spotted the problem in <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> immediately, and start fixing the code right away. But this is dangerous and risky.</p>
<p>Why is this so?  Well, because you should first</p>
<ul class="simple">
<li><p>try to understand the problem, and</p></li>
<li><p>have a full diagnosis before starting to fix away.</p></li>
</ul>
<p>You <em>can</em> skip these steps, and jump right to your interactive debugger the very moment you see a failure, happily stepping through their program. This may even work well for simple problems, including this one. The risk, however, is that this narrows your view to just this one execution, which limits your ability to understand <em>all</em> the circumstances of the problem. Even worse: If you start “fixing” the bug without exactly understanding the problem, you may end up with an incomplete solution – as illustrated in “The Devil’s Guide to Debugging”, above.</p>
</section>
<section id="keep-a-log">
<h3>Keep a Log<a class="headerlink" href="#keep-a-log" title="Link to this heading">#</a></h3>
<p>A second risk of starting debugging too soon is that it lets you easily deviate from a systematic process. Remember how we wrote down every experiment in a table? How we numbered every hypothesis? This is not just for teaching. Writing these things down explicitly allow you to keep track of all your observations and hypotheses over time.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Input</p></th>
<th class="head"><p>Expectation</p></th>
<th class="head"><p>Output</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;b&gt;foo&lt;/b&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">foo</span></code></p></td>
<td><p>✔</p></td>
</tr>
</tbody>
</table>
</div>
<p>Every time you come up with a new hypothesis, you can immediately check it against your earlier observations, which will help you to eliminate unlikely ones from the start. This is a bit like in the classic “Mastermind” board game, in which you have to guess some secret combination of pins, and in which your opponent gives you hints on whether and how your guesses are correct. At any time, you can see your previous guesses (experiments) and the results (observations) you got; any new guess (hypothesis) has to be consistent with the previous observations and experiments.</p>
<p><img alt="Master Mind Board Grame" src="https://upload.wikimedia.org/wikipedia/commons/2/2d/Mastermind.jpg" /></p>
<p>Keeping such a log also allows you to interrupt your debugging session at any time. You can be home in time, sleep over the problem, and resume the next morning with a refreshed mind. You can even hand over the log to someone else, stating your findings so far.</p>
<p>The alternative to having a log is to <em>keep all in memory</em>. This only works for short amounts of time, as it puts a higher and higher cognitive load on your memory as you debug along. After some time, you will forget earlier observations, which leads to mistakes. Worst of all, any interruption will break your concentration and make you forget things, so you can’t stop debugging until you’re done.</p>
<p>Sure, if you are a real master, you can stay glued to the screen all night. But I’d rather be home in time, thank you.</p>
</section>
<section id="rubberducking">
<h3>Rubberducking<a class="headerlink" href="#rubberducking" title="Link to this heading">#</a></h3>
<p>A great technique to revisit your observations and to come up with new hypotheses is to <em>explain the problem to someone else</em>. In this process, the “someone else” is important, but even more important is that <em>you are explaining the problem to yourself</em>! As Kernighan and Pike \cite{Kernighan1999} put it:</p>
<blockquote>
<div><p>Sometimes it takes no more than a few sentences, followed by an embarrassed “Never mind. I see what’s wrong. Sorry to bother you.”</p>
</div></blockquote>
<p>The reason why this works is that teaching someone else forces you to take different perspectives, and these help you to resolve the inconsistency between what you assume and what you actually observe.</p>
<p>Since that “someone else” can be totally passive, you can even replace her with an inanimate object to talk to – even a rubber duck. This technique is called <em>rubber duck debugging</em> or <em>rubberducking</em> – the idea is that you explain your problem to a rubber duck first before interrupting one of your co-workers with the problem. Some programmers, when asked for advice, explicitly request that you “explain your problem to the duck first”, knowing that this resolves a good fraction of problems.</p>
<p><img alt="Rubber duck debugging" src="https://upload.wikimedia.org/wikipedia/commons/d/d5/Rubber_duck_assisting_with_debugging.jpg" /></p>
</section>
</section>
<section id="the-cost-of-debugging">
<h2>The Cost of Debugging<a class="headerlink" href="#the-cost-of-debugging" title="Link to this heading">#</a></h2>
<p>And it’s not only that debugging takes time – the worst thing is that it is a search process, which can take anything between a few minutes and several hours, sometimes even days and weeks.  But even if you never know how much time a bug will take, it’s a bit of blessing to use a process which gradually gets you towards its cause.</p>
</section>
<section id="debugging-aftermath">
<h2>Debugging Aftermath<a class="headerlink" href="#debugging-aftermath" title="Link to this heading">#</a></h2>
<p>The fix of a bug may lead to a code construct, a more complex condition or another solution which may look strange on first sight.
Often the initial code was easier to understand but did not catch all cases. After fixing a bug it may be beneficial to
write down why the code now looks like this and what caused the more complex construct. A comment right at the fixed location
will help future programmers to not be confused or even re-introduce the bug while refactoring for better readability.
And of course, helpful comments at complex code locations should even exist before something went wrong with the code – but
thats a chapter in another book.</p>
</section>
<section id="history-of-debugging">
<h2>History of Debugging<a class="headerlink" href="#history-of-debugging" title="Link to this heading">#</a></h2>
<p>Engineers and programmers have long used the term “bug” for faults in their systems – as if it were something that crept into an otherwise flawless program to cause the effects that none could explain. And from a psychological standpoint, it is far easier to blame some “bug” rather than taking responsibility ourselves. In the end, though, we have to face the fact: We made the bugs, and they are ours to fix.</p>
<p>Having said that, there has been one recorded instance where a real bug has crept into a system. That was on September 9, 1947, when a moth got stuck in the relay of a Harvard Mark II machine.  This event was logged, and the log book is now on display at the Smithsonian Natural Museum of American History, as “First actual case of bug being found.”</p>
<p><img alt="First actual case of bug being found" src="https://upload.wikimedia.org/wikipedia/commons/f/ff/First_Computer_Bug%2C_1945.jpg" /></p>
<p>The actual term “bug”, however, is much older. What do you think is its origin?</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">Where has the name "bug" been used to denote disruptive events?</div>
    </p>
    <p>
    <div class="quiz_options" title="Check all that apply.">
    
        <input type="checkbox" name="b64ab4b2-b293-11f0-ab86-6298cf1a5790" id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-1" onclick="clear_selection('b64ab4b2-b293-11f0-ab86-6298cf1a5790')">
        <label id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-1-label" for="b64ab4b2-b293-11f0-ab86-6298cf1a5790-1">In the early days of Morse telegraphy, referring to a special key that would send a string of dots</label><br>
    
        <input type="checkbox" name="b64ab4b2-b293-11f0-ab86-6298cf1a5790" id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-2" onclick="clear_selection('b64ab4b2-b293-11f0-ab86-6298cf1a5790')">
        <label id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-2-label" for="b64ab4b2-b293-11f0-ab86-6298cf1a5790-2">Among radio technicians to describe a device that converts electromagnetic field variations into acoustic signals</label><br>
    
        <input type="checkbox" name="b64ab4b2-b293-11f0-ab86-6298cf1a5790" id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-3" onclick="clear_selection('b64ab4b2-b293-11f0-ab86-6298cf1a5790')">
        <label id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-3-label" for="b64ab4b2-b293-11f0-ab86-6298cf1a5790-3">In Shakespeare's "Henry VI", referring to a walking spectre</label><br>
    
        <input type="checkbox" name="b64ab4b2-b293-11f0-ab86-6298cf1a5790" id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-4" onclick="clear_selection('b64ab4b2-b293-11f0-ab86-6298cf1a5790')">
        <label id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-4-label" for="b64ab4b2-b293-11f0-ab86-6298cf1a5790-4">In Middle English, where the word "bugge" is the basis for terms like "bugbear" and "bugaboo"</label><br>
    
    </div>
    </p>
    <input id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('b64ab4b2-b293-11f0-ab86-6298cf1a5790', 30, 1, '')">
    <span class="quiz_hint" id="b64ab4b2-b293-11f0-ab86-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Need help on this quiz? To learn more about the term “bug” and its origin, have a look at <a class="reference external" href="http://www.catb.org/~esr/jargon/html/B/bug.html">the etymology of the word “bug”</a> in <a class="reference external" href="http://www.catb.org/~esr/jargon/">The Jargon File</a>. Also check out the <a class="reference external" href="https://en.wikipedia.org/wiki/Debugging">Wikipedia entry on debugging</a>!</p>
</section>
<section id="lessons-learned">
<h2>Lessons Learned<a class="headerlink" href="#lessons-learned" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>An <em>error</em> is a deviation from what is correct, right, or true. Specifically,</p>
<ul class="simple">
<li><p>A <em>mistake</em> is a human act or decision resulting in an error.</p></li>
<li><p>A <em>defect</em> is an error in the program code. Also called <em>bug</em>.</p></li>
<li><p>A <em>fault</em> is an error in the program state. Also called <em>infection</em>.</p></li>
<li><p>A <em>failure</em> is an externally visible error in the program behavior. Also called <em>malfunction</em>.</p></li>
</ul>
</li>
<li><p>In a failing program execution, a mistake by the programmer results in a defect in the code, which creates a fault in the state, which propagates until it results in a failure. Tracing back fault propagation allows identifying the defect that causes the failure.</p></li>
<li><p>In debugging, the <em>scientific method</em> allows systematically identifying failure causes by gradually refining and refuting hypotheses based on experiments and observations.</p></li>
<li><p>Before fixing the defect, have a complete <em>diagnosis</em> that</p>
<ul class="simple">
<li><p>shows <em>causality</em> (how the defect causes the failure)</p></li>
<li><p>shows <em>incorrectness</em> (how the defect is wrong)</p></li>
</ul>
</li>
<li><p>You can become a better debugger by</p>
<ul class="simple">
<li><p>Following a systematic process like the scientific method</p></li>
<li><p>Keeping a log of your observations and hypotheses</p></li>
<li><p>Making your observations and conclusions explicit by telling them somebody (or something).</p></li>
</ul>
</li>
</ol>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>In the next chapters, we will learn how to</p>
<ul class="simple">
<li><p><a class="reference internal" href="Tracer.html"><span class="std std-doc">trace and observe executions</span></a></p></li>
<li><p><a class="reference internal" href="Debugger.html"><span class="std std-doc">build your own interactive debugger</span></a></p></li>
<li><p><a class="reference internal" href="StatisticalDebugger.html"><span class="std std-doc">locate defects automatically by correlating failures and code coverage</span></a></p></li>
<li><p><a class="reference internal" href="DeltaDebugger.html"><span class="std std-doc">identify and simplify failure-inducing inputs</span></a></p></li>
</ul>
<p>Enjoy!</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>There are several good books on debugging, but these three are especially recommended:</p>
<ul class="simple">
<li><p><em>Debugging</em> by Agans \cite{agans2006-debugging} takes a pragmatic approach to debugging, highlighting systematic approaches that help for all kinds of application-specific problems;</p></li>
<li><p><em>Why Programs Fail</em> by Zeller \cite{zeller2009-why-programs-fail} takes a more academic approach, creating theories of how failures come to be and systematic debugging processes;</p></li>
<li><p><em>Effective Debugging</em> by Spinellis \cite{spinellis2016-effective-debugging} aims for a middle ground between the two, creating general recipes and recommendations that easily instantiate towards specific problems.</p></li>
</ul>
<p>All these books focus on <em>manual</em> debugging and the debugging process, just like this chapter; for <em>automated</em> debugging, simply read on :-)</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<section id="exercise-1-get-acquainted-with-notebooks-and-python">
<h3>Exercise 1: Get Acquainted with Notebooks and Python<a class="headerlink" href="#exercise-1-get-acquainted-with-notebooks-and-python" title="Link to this heading">#</a></h3>
<p>Your first exercise in this book is to get acquainted with notebooks and Python, such that you can run the code examples in the book – and try out your own. Here are a few tasks to get you started.</p>
<section id="beginner-level-run-notebooks-in-your-browser">
<h4>Beginner Level: Run Notebooks in Your Browser<a class="headerlink" href="#beginner-level-run-notebooks-in-your-browser" title="Link to this heading">#</a></h4>
<p>The easiest way to get access to the code is to run them in your browser.</p>
<ol class="arabic simple">
<li><p>From the <a class="reference internal" href="#__CHAPTER_HTML__"><span class="xref myst">Web Page</span></a>, check out the menu at the top. Select <code class="docutils literal notranslate"><span class="pre">Resources</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">as</span> <span class="pre">Notebook</span></code>.</p></li>
<li><p>After a short waiting time, this will open a Jupyter Notebook right within your browser, containing the current chapter as a notebook.</p></li>
<li><p>You can again scroll through the material, but you click on any code example to edit and run its code (by entering <kbd>Shift</kbd> + <kbd>Return</kbd>). You can edit the examples as you please.</p></li>
<li><p>Note that code examples typically depend on earlier code, so be sure to run the preceding code first.</p></li>
<li><p>Any changes you make will not be saved (unless you save your notebook to disk).</p></li>
</ol>
<p>For help on Jupyter Notebooks, from the <a class="reference internal" href="#__CHAPTER_HTML__"><span class="xref myst">Web Page</span></a>, check out the <code class="docutils literal notranslate"><span class="pre">Help</span></code> menu.</p>
</section>
<section id="advanced-level-run-python-code-on-your-machine">
<h4>Advanced Level: Run Python Code on Your Machine<a class="headerlink" href="#advanced-level-run-python-code-on-your-machine" title="Link to this heading">#</a></h4>
<p>This is useful if you want to make greater changes, but do not want to work with Jupyter.</p>
<ol class="arabic simple">
<li><p>From the <a class="reference internal" href="#__CHAPTER_HTML__"><span class="xref myst">Web Page</span></a>, check out the menu at the top. Select <code class="docutils literal notranslate"><span class="pre">Resources</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Code</span></code>.</p></li>
<li><p>This will download the Python code of the chapter as a single Python .py file, which you can save to your computer.</p></li>
<li><p>You can then open the file, edit it, and run it in your favorite Python environment to re-run the examples.</p></li>
<li><p>Most importantly, you can <a class="reference internal" href="Importing.html"><span class="std std-doc">import it</span></a> into your own code and reuse functions, classes, and other resources.</p></li>
</ol>
<p>For help on Python, from the <a class="reference internal" href="#__CHAPTER_HTML__"><span class="xref myst">Web Page</span></a>, check out the <code class="docutils literal notranslate"><span class="pre">Help</span></code> menu.</p>
</section>
<section id="pro-level-run-notebooks-on-your-machine">
<h4>Pro Level: Run Notebooks on Your Machine<a class="headerlink" href="#pro-level-run-notebooks-on-your-machine" title="Link to this heading">#</a></h4>
<p>This is useful if you want to work with Jupyter on your machine. This will allow you to also run more complex examples, such as those with graphical output.</p>
<ol class="arabic simple">
<li><p>From the <a class="reference internal" href="#__CHAPTER_HTML__"><span class="xref myst">Web Page</span></a>, check out the menu at the top. Select <code class="docutils literal notranslate"><span class="pre">Resources</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">Notebooks</span></code>.</p></li>
<li><p>This will download all Jupyter Notebooks as a collection of .ipynb files, which you can save to your computer.</p></li>
<li><p>You can then open the notebooks in Jupyter Notebook or Jupyter Lab, edit them, and run them. To navigate across notebooks, open the notebook <a class="reference internal" href="#00_Table_of_Contents.ipynb"><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">00_Table_of_Contents.ipynb</span></code></span></a>.</p></li>
<li><p>You can also download individual notebooks using Select <code class="docutils literal notranslate"><span class="pre">Resources</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Notebook</span></code>. Running these, however, will require that you have the other notebooks downloaded already.</p></li>
</ol>
<p>For help on Jupyter Notebooks, from the <a class="reference internal" href="#__CHAPTER_HTML__"><span class="xref myst">Web Page</span></a>, check out the <code class="docutils literal notranslate"><span class="pre">Help</span></code> menu.</p>
</section>
<section id="boss-level-contribute">
<h4>Boss Level: Contribute!<a class="headerlink" href="#boss-level-contribute" title="Link to this heading">#</a></h4>
<p>This is useful if you want to contribute to the book with patches or other material. It also gives you access to the very latest version of the book.</p>
<ol class="arabic simple">
<li><p>From the <a class="reference internal" href="#__CHAPTER_HTML__"><span class="xref myst">Web Page</span></a>, check out the menu at the top. Select <code class="docutils literal notranslate"><span class="pre">Resources</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">GitHub</span> <span class="pre">Repo</span></code>.</p></li>
<li><p>This will get you to the GitHub repository which contains all sources of the book, including the latest notebooks.</p></li>
<li><p>You can then <em>clone</em> this repository to your disk, such that you get the latest and greatest.</p></li>
<li><p>You can report issues and suggest pull requests on the GitHub page.</p></li>
<li><p>Updating the repository with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span></code> will get you updated.</p></li>
</ol>
<p>If you want to contribute code or text, check out the <a class="reference internal" href="Guide_for_Authors.html"><span class="std std-doc">Guide for Authors</span></a>.</p>
</section>
</section>
<section id="exercise-2-more-bugs">
<h3>Exercise 2: More Bugs!<a class="headerlink" href="#exercise-2-more-bugs" title="Link to this heading">#</a></h3>
<p>You may have noticed that our <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> function is still not working perfectly under all circumstances.  The error has something to do with different quotes occurring in the input.</p>
<section id="part-1-find-the-problem">
<h4>Part 1: Find the Problem<a class="headerlink" href="#part-1-find-the-problem" title="Link to this heading">#</a></h4>
<p>What does the problem look like? Set up a test case that demonstrates the problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Set up additional test cases as useful.</p>
<p><strong>Solution.</strong> The remaining problem stems from the fact that in <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, we do not differentiate between single and double quotes. Hence, if we have a <em>quote within a quoted text</em>, the function may get confused. Notably, a string that begins with a double quote may be interpreted as ending when a single quote is seen, and vice versa. Here’s an example of such a string:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">b</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;&lt;Shakespeare&#39;s play&gt;&quot;</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>When we remove the HTML markup, the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> in the string is interpreted as <em>unquoted</em>. Hence, it is interpreted as ending the tag, such that the rest of the tag is not removed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&lt;b title=&quot;&lt;Shakespeare&#39;</span> <span class="o">+</span> <span class="s2">&quot;&#39;s play&gt;&quot;</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;foo&lt;/b&gt;&#39;</span>
<span class="n">s</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;b title=&quot;&lt;Shakespeare\&#39;s play&gt;&quot;&gt;foo&lt;/b&gt;&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&quot;foo&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_50153/2099129847.py&quot;, line 2, in &lt;module&gt;
    assert(remove_html_markup(s) == &quot;foo&quot;)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
</section>
<section id="part-2-identify-extent-and-cause">
<h4>Part 2: Identify Extent and Cause<a class="headerlink" href="#part-2-identify-extent-and-cause" title="Link to this heading">#</a></h4>
<p>Using the scientific method, identify the extent and cause of the problem. Write down your hypotheses and log your observations, as in</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Input</p></th>
<th class="head"><p>Expectation</p></th>
<th class="head"><p>Output</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>(input)</p></td>
<td><p>(expectation)</p></td>
<td><p>(output)</p></td>
<td><p>(outcome)</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Solution.</strong> The first step is obviously</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Input</p></th>
<th class="head"><p>Expectation</p></th>
<th class="head"><p>Output</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><b title="<Shakespeare's play>">foo</b></p></td>
<td><p>foo</p></td>
<td><p>“foo</p></td>
<td><p>✘</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="part-3-fix-the-problem">
<h4>Part 3: Fix the Problem<a class="headerlink" href="#part-3-fix-the-problem" title="Link to this heading">#</a></h4>
<p>Design a fix for the problem. Show that it satisfies the earlier tests and does not violate any existing test.</p>
<p><strong>Solution</strong>. Here’s an improved implementation that actually tracks the opening and closing quote by storing the quoting character in the <code class="docutils literal notranslate"><span class="pre">quote</span></code> variable. (If <code class="docutils literal notranslate"><span class="pre">quote</span></code> is <code class="docutils literal notranslate"><span class="pre">''</span></code>, we are not in a string.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup_with_proper_quotes</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">tag</span> <span class="ow">or</span> <span class="n">quote</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="n">quote</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="n">quote</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span> <span class="ow">and</span> <span class="n">quote</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># beginning of string</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="n">c</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">quote</span><span class="p">:</span>
            <span class="c1"># end of string</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>Python enthusiasts may note that we could also write <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">quote</span></code> instead of <code class="docutils literal notranslate"><span class="pre">quote</span> <span class="pre">==</span> <span class="pre">''</span></code>, leaving most of the original code untouched. We stick to classic Boolean comparisons here.</p>
<p>The function now satisfies the earlier failing test:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span><span class="p">(</span><span class="n">remove_html_markup_with_proper_quotes</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>as well as all our earlier tests:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">remove_html_markup_with_proper_quotes</span><span class="p">(</span>
    <span class="s2">&quot;Here&#39;s some &lt;strong&gt;strong argument&lt;/strong&gt;.&quot;</span><span class="p">)</span> <span class="o">==</span> \
    <span class="s2">&quot;Here&#39;s some strong argument.&quot;</span>
<span class="k">assert</span> <span class="n">remove_html_markup_with_proper_quotes</span><span class="p">(</span>
    <span class="s1">&#39;&lt;input type=&quot;text&quot; value=&quot;&lt;your name&gt;&quot;&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
<span class="k">assert</span> <span class="n">remove_html_markup_with_proper_quotes</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;foo&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
<span class="k">assert</span> <span class="n">remove_html_markup_with_proper_quotes</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;&quot;foo&quot;&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
<span class="k">assert</span> <span class="n">remove_html_markup_with_proper_quotes</span><span class="p">(</span><span class="s1">&#39;&quot;&lt;b&gt;foo&lt;/b&gt;&quot;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&quot;foo&quot;&#39;</span>
<span class="k">assert</span> <span class="n">remove_html_markup_with_proper_quotes</span><span class="p">(</span><span class="s1">&#39;&lt;b id=&quot;bar&quot;&gt;foo&lt;/b&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Tours.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Sitemap</p>
      </div>
    </a>
    <a class="right-next"
       href="Tracer.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tracing Executions</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-function">A Simple Function</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#your-task-remove-html-markup">Your Task: Remove HTML Markup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-python-programs">Understanding Python Programs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-a-function">Running a Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interacting-with-notebooks">Interacting with Notebooks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-a-function">Testing a Function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#oops-a-bug">Oops! A Bug!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-code">Visualizing Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-fix">A First Fix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-devils-guide-to-debugging">The Devil’s Guide to Debugging</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#printf-debugging">Printf Debugging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-into-existence">Debugging into Existence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-the-most-obvious-fix">Use the Most Obvious Fix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#things-to-do-instead">Things to do Instead</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-defect-to-failure">From Defect to Failure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-failure-to-defect">From Failure to Defect</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-scientific-method">The Scientific Method</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-a-hypothesis">Finding a Hypothesis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-a-hypothesis">Testing a Hypothesis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#refining-a-hypothesis">Refining a Hypothesis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#refuting-a-hypothesis">Refuting a Hypothesis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fixing-the-bug">Fixing the Bug</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-diagnoses">Checking Diagnoses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fixing-the-code">Fixing the Code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alternate-paths">Alternate Paths</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework-after-the-fix">Homework after the Fix</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-for-further-defect-occurrences">Check for further Defect Occurrences</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-your-tests">Check your Tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-assertions">Add Assertions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#commit-the-fix">Commit the Fix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#close-the-bug-report">Close the Bug Report</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#become-a-better-debugger">Become a Better Debugger</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#follow-the-process">Follow the Process</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#keep-a-log">Keep a Log</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rubberducking">Rubberducking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-cost-of-debugging">The Cost of Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-aftermath">Debugging Aftermath</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#history-of-debugging">History of Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-get-acquainted-with-notebooks-and-python">Exercise 1: Get Acquainted with Notebooks and Python</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#beginner-level-run-notebooks-in-your-browser">Beginner Level: Run Notebooks in Your Browser</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-level-run-python-code-on-your-machine">Advanced Level: Run Python Code on Your Machine</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pro-level-run-notebooks-on-your-machine">Pro Level: Run Notebooks on Your Machine</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boss-level-contribute">Boss Level: Contribute!</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-more-bugs">Exercise 2: More Bugs!</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-find-the-problem">Part 1: Find the Problem</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-identify-extent-and-cause">Part 2: Identify Extent and Cause</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3-fix-the-problem">Part 3: Fix the Problem</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andreas Zeller
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
  Copyright &copy; 2021–2025 <a href="https://www.cispa.de/">CISPA Helmholtz Center for Information Security</a>.
  The <strong>content</strong> of this project is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  The <strong>source code</strong> that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/debuggingbook/blob/master/LICENSE.md#mit-license">MIT License</a>. <a href="https://cispa.de/en/impressum">Imprint</a>.
  <br>
  <a href="https://cispa.de/en/impressum">Imprint</a> &middot; <a href="/html/index.html#how-do-i-cite-your-work">Cite</a>
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>