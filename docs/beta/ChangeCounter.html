
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Where the Bugs are &#8212; The Debugging Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=d5c2cecb" />
    <link rel="stylesheet" type="text/css" href="_static/mastodon-timeline.css?v=f82c2b23" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ChangeCounter';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Error Handling" href="ExpectError.html" />
    <link rel="prev" title="Tracking Bugs" href="Tracking.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p>This is a beta version of debuggingbook.org, currently in development. See the <a href="https://debuggingbook.org/classic/"  style="color:white!important;">classic site</a> for the 2024 version.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/debuggingbook.png" class="logo__image only-light" alt="The Debugging Book - Home"/>
    <script>document.write(`<img src="_static/debuggingbook.png" class="logo__image only-dark" alt="The Debugging Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    The Debugging Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tours.html">Sitemap</a></li>
<li class="toctree-l1"><a class="reference internal" href="Intro_Debugging.html">Introduction to Debugging</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Observing Executions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracer.html">Tracing Executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Debugger.html">How Debuggers Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="Assertions.html">Asserting Expectations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Flows and Dependencies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Slicer.html">Tracking Failure Origins</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reducing Failure Causes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="DeltaDebugger.html">Reducing Failure-Inducing Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeDebugger.html">Isolating Failure-Inducing Changes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Abstracting Failures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="StatisticalDebugger.html">Statistical Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicInvariants.html">Mining Function Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="DDSetDebugger.html">Generalizing Failure Circumstances</a></li>
<li class="toctree-l1"><a class="reference internal" href="Alhazen.html">Learning from Failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="PerformanceDebugger.html">Debugging Performance Issues</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Automatic Repair</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Repairer.html">Repairing Code Automatically</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Debugging in the Large</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracking.html">Tracking Bugs</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Where the Bugs are</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ExpectError.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timer.html">Timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timeout.html">Timeout</a></li>
<li class="toctree-l1"><a class="reference internal" href="ClassDiagram.html">Class Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="StackInspector.html">Inspecting Call Stacks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About This Book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ReleaseNotes.html">Release Notes for The Debugging Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importing.html">Downloads and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Guide_for_Authors.html">Guide for Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uds-se/debuggingbook/master?urlpath=tree/docs/notebooks/ChangeCounter.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook/issues/new?title=Issue%20on%20page%20%2FChangeCounter.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
    <li><a href="../code/ChangeCounter.py" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="Download Python code"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">.py</span>
    </a>
    </li>
    
      
      
      
      <li><a href="_sources/ChangeCounter.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download notebook"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  
    <li><a href="Importing.html" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="All downloads"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">All downloads</span>
    </a>
    </li>
    </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Where the Bugs are</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mining-change-histories">Mining Change Histories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mining-with-pydriller">Mining with PyDriller</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-changes">Counting Changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-past-changes">Visualizing Past Changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-past-fixes">Counting Past Fixes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-fine-grained-changes">Counting Fine-Grained Changes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapping-elements-to-locations">Mapping Elements to Locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-changed-elements">Determining Changed Elements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-it-all-together">Putting it all Together</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-fine-grained-fixes">Exercise 1: Fine-Grained Fixes</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="where-the-bugs-are">
<h1>Where the Bugs are<a class="headerlink" href="#where-the-bugs-are" title="Link to this heading">#</a></h1>
<p>Every time a bug is fixed, developers leave a trace – in the <em>version database</em> when they commit the fix, or in the <em>bug database</em> when they close the bug. In this chapter, we learn how to <em>mine these repositories</em> for past changes and bugs, and how to <em>map</em> them to individual modules and functions, highlighting those project components that have seen most changes and fixes over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;Aifq0JOc1Jc&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="640"
            height="360"
            src="https://www.youtube-nocookie.com/embed/Aifq0JOc1Jc"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p>You should have read <a class="reference internal" href="Tracking.html"><span class="std std-doc">the chapter on tracking bugs</span></a>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bookutils.setup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">Tracking</span>
</pre></div>
</div>
</div>
</div>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Link to this heading">#</a></h2>
<p>To <a class="reference internal" href="Importing.html"><span class="std std-doc">use the code provided in this chapter</span></a>, write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">debuggingbook.ChangeCounter</span><span class="w"> </span><span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and then make use of the following features.</p>
<p><strong>Note</strong>: The examples in this section only work after the rest of the cells have been executed.</p>
<p>This chapter provides two classes <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code> and <code class="docutils literal notranslate"><span class="pre">FineChangeCounter</span></code> that allow mining and visualizing the distribution of changes in a given <code class="docutils literal notranslate"><span class="pre">git</span></code> repository.</p>
<p><code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code> is initialized as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">change_counter</span> <span class="o">=</span> <span class="n">ChangeCounter</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">repository</span></code> is either</p>
<ul class="simple">
<li><p>a <em>directory</em> containing a <code class="docutils literal notranslate"><span class="pre">git</span></code> clone (i.e., it contains a <code class="docutils literal notranslate"><span class="pre">.git</span></code> directory)</p></li>
<li><p>the URL of a <code class="docutils literal notranslate"><span class="pre">git</span></code> repository.</p></li>
</ul>
<p>Additional arguments are being passed to the underlying <code class="docutils literal notranslate"><span class="pre">Repository</span></code> class from the <a class="reference external" href="https://pydriller.readthedocs.io/">PyDriller</a> Python package. A <code class="docutils literal notranslate"><span class="pre">filter</span></code> keyword argument, if given, is a predicate that takes a modification (from PyDriller) and returns True if it should be included.</p>
<p>In a change counter, all elements in the repository are represented as <em>nodes</em> – tuples <span class="math notranslate nohighlight">\((f_1, f_2, ..., f_n)\)</span> that denote a <em>hierarchy</em>: Each <span class="math notranslate nohighlight">\(f_i\)</span> is a directory holding <span class="math notranslate nohighlight">\(f_{i+1}\)</span>, with <span class="math notranslate nohighlight">\(f_n\)</span> being the actual file.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">change_counter</span></code> provides a number of attributes. <code class="docutils literal notranslate"><span class="pre">changes</span></code> is a mapping of nodes to the number of changes in that node:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">change_counter</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;README.md&#39;</span><span class="p">,),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">messages</span></code> attribute holds all commit messages related to that node:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">change_counter</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;README.md&#39;</span><span class="p">,),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Doc update&#39;,
 &#39;Doc update&#39;,
 &#39;Doc update&#39;,
 &#39;Doc update&#39;,
 &#39;Fix: corrected rule for rendered notebooks (#24)\nNew: strip out any &lt;iframe&gt; tags\nNew: when rendering .md files, replace videos by proper image&#39;,
 &#39;Doc update&#39;,
 &#39;Doc update&#39;,
 &#39;New: show badges at top of GitHub project page&#39;,
 &#39;More badges&#39;,
 &#39;Fix: bad links in CI badges&#39;,
 &#39;New: prefer Unicode arrows over LaTeX ones&#39;,
 &#39;Updated README.md&#39;,
 &#39;Update&#39;,
 &#39;Doc update&#39;,
 &#39;Doc update&#39;,
 &#39;Doc update&#39;,
 &#39;Doc update&#39;,
 &#39;Updated README&#39;,
 &#39;Doc update&#39;,
 &#39;Doc update&#39;]
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sizes</span></code> attribute holds the (last) size of the respective element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">change_counter</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;README.md&#39;</span><span class="p">,),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4728
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">FineChangeCounter</span></code> acts like <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code>, but also retrieves statistics for elements <em>within</em> the respective files; it has been tested for C, Python, and Jupyter Notebooks and should provide sufficient results for programming languages with similar syntax.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">map()</span></code> method of <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code> and <code class="docutils literal notranslate"><span class="pre">FineChangeCounter</span></code> produces an interactive tree map that allows exploring the elements of a repository. The redder (darker) a rectangle, the more changes it has seen; the larger a rectangle, the larger its size in bytes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fine_change_counter</span><span class="o">.</span><span class="n">map</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>The included classes offer several methods that can be overridden in subclasses to customize what to mine and how to visualize it. See the chapter for details.</p>
<p>Here are all the classes defined in this chapter:</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 14.0.2 (20251019.1705)
 -->
<!-- Pages: 1 -->
<svg width="420pt" height="329pt"
 viewBox="0.00 0.00 420.00 329.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 325.25)">
<g id="a_graph0"><a xlink:title="FineChangeCounter class hierarchy">
<polygon fill="white" stroke="none" points="-4,4 -4,-325.25 415.75,-325.25 415.75,4 -4,4"/>
</a>
</g>
<!-- FineChangeCounter -->
<g id="node1" class="node">
<title>FineChangeCounter</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class FineChangeCounter:&#10;Count the changes for files in the repository and their elements">
<polygon fill="none" stroke="black" points="0,-13.25 0,-59.25 150.25,-59.25 150.25,-13.25 0,-13.25"/>
<text xml:space="preserve" text-anchor="start" x="8" y="-42.95" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">FineChangeCounter</text>
<polyline fill="none" stroke="black" points="0,-34 150.25,-34"/>
<g id="a_node1_0"><a xlink:href="#" xlink:title="FineChangeCounter">
<g id="a_node1_1"><a xlink:href="#" xlink:title="update_elems(self, node: Tuple, m: pydriller.domain.commit.ModifiedFile) &#45;&gt; None:&#10;Update counters for subelements of `node` with modification `m`.&#10;To be defined in subclasses.">
<text xml:space="preserve" text-anchor="start" x="33.12" y="-21.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">update_elems()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- ChangeCounter -->
<g id="node2" class="node">
<title>ChangeCounter</title>
<g id="a_node2"><a xlink:href="#" xlink:title="class ChangeCounter:&#10;Count the number of changes for a repository.">
<polygon fill="none" stroke="black" points="87.25,-109 87.25,-320.75 209,-320.75 209,-109 87.25,-109"/>
<text xml:space="preserve" text-anchor="start" x="95.25" y="-304.45" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">ChangeCounter</text>
<polyline fill="none" stroke="black" points="87.25,-295.5 209,-295.5"/>
<g id="a_node2_2"><a xlink:href="#" xlink:title="ChangeCounter">
<g id="a_node2_3"><a xlink:href="#" xlink:title="__init__(self, repo: str, *, filter: Optional[Callable[[pydriller.domain.commit.Commit], bool]] = None, log: bool = False, **kwargs: Any) &#45;&gt; None:&#10;Constructor.&#10;`repo` is a git repository (as URL or directory).&#10;`filter` is a predicate that takes a modification and returns True&#10;if it should be considered (default: consider all).&#10;`log` turns on logging if set.&#10;`kwargs` are passed to the `Repository()` constructor.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-283" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node2_4"><a xlink:href="#" xlink:title="map(self) &#45;&gt; plotly.graph_objs._figure.Figure:&#10;Produce an interactive tree map of the repository.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-270.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">map()</text>
</a>
</g>
<g id="a_node2_5"><a xlink:href="#" xlink:title="include(self, m: pydriller.domain.commit.ModifiedFile) &#45;&gt; bool:&#10;Return True if the modification `m` should be included&#10;(default: the `filter` predicate given to the constructor).&#10;To be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-257.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">include()</text>
</a>
</g>
<g id="a_node2_6"><a xlink:href="#" xlink:title="map_colorscale(self) &#45;&gt; str:&#10;Return the colorscale for the map. To be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-244.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">map_colorscale()</text>
</a>
</g>
<g id="a_node2_7"><a xlink:href="#" xlink:title="map_hoverinfo(self) &#45;&gt; str:&#10;Return the text to be shown when hovering over a node.&#10;To be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-232" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">map_hoverinfo()</text>
</a>
</g>
<g id="a_node2_8"><a xlink:href="#" xlink:title="map_node_color(self, node: Tuple) &#45;&gt; Optional[int]:&#10;Return a color of the node, as a number.&#10;Can be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-219.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">map_node_color()</text>
</a>
</g>
<g id="a_node2_9"><a xlink:href="#" xlink:title="map_node_sizes(self, scale: str = &#39;log&#39;) &#45;&gt; Dict[Tuple, Union[int, float]]:&#10;Return a mapping of nodes to sizes.&#10;Can be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-206.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">map_node_sizes()</text>
</a>
</g>
<g id="a_node2_10"><a xlink:href="#" xlink:title="map_node_text(self, node: Tuple) &#45;&gt; Optional[str]:&#10;Return the text to be shown for the node (default: #changes).&#10;Can be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-193.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">map_node_text()</text>
</a>
</g>
<g id="a_node2_11"><a xlink:href="#" xlink:title="mine(self, **kwargs: Any) &#45;&gt; None:&#10;Gather data from repository. To be extended in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-181" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">mine()</text>
</a>
</g>
<g id="a_node2_12"><a xlink:href="#" xlink:title="mine_commit(self, commit: pydriller.domain.commit.Commit) &#45;&gt; None">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-167.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">mine_commit()</text>
</a>
</g>
<g id="a_node2_13"><a xlink:href="#" xlink:title="update_changes(self, node: Tuple, commit_msg: str) &#45;&gt; None:&#10;Update stats for `node` changed with `commit_msg`.&#10;Can be extended in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-155.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">update_changes()</text>
</a>
</g>
<g id="a_node2_14"><a xlink:href="#" xlink:title="update_elems(self, node: Tuple, m: pydriller.domain.commit.ModifiedFile) &#45;&gt; None:&#10;Update counters for subelements of `node` with modification `m`.&#10;To be defined in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-142.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">update_elems()</text>
</a>
</g>
<g id="a_node2_15"><a xlink:href="#" xlink:title="update_size(self, node: Tuple, size: int) &#45;&gt; None:&#10;Update counters for `node` with `size`.&#10;Can be extended in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-130" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">update_size()</text>
</a>
</g>
<g id="a_node2_16"><a xlink:href="#" xlink:title="update_stats(self, m: pydriller.domain.commit.ModifiedFile) &#45;&gt; None:&#10;Update counters with modification `m`.&#10;Can be extended in subclasses.">
<text xml:space="preserve" text-anchor="start" x="100.12" y="-117.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">update_stats()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- FineChangeCounter&#45;&gt;ChangeCounter -->
<g id="edge1" class="edge">
<title>FineChangeCounter&#45;&gt;ChangeCounter</title>
<path fill="none" stroke="black" d="M84.37,-59.62C88.77,-70.25 94.39,-83.85 100.46,-98.56"/>
<polygon fill="none" stroke="black" points="97.1,-99.59 104.16,-107.49 103.57,-96.91 97.1,-99.59"/>
</g>
<!-- FixCounter -->
<g id="node3" class="node">
<title>FixCounter</title>
<g id="a_node3"><a xlink:href="#" xlink:title="class FixCounter:&#10;Count the fixes for files in the repository.&#10;Fixes are all commits whose message starts with the word &#39;Fix: &#39;">
<polygon fill="none" stroke="black" points="168.12,-0.5 168.12,-72 274.12,-72 274.12,-0.5 168.12,-0.5"/>
<text xml:space="preserve" text-anchor="start" x="184.38" y="-55.7" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">FixCounter</text>
<polyline fill="none" stroke="black" points="168.12,-46.75 274.12,-46.75"/>
<g id="a_node3_17"><a xlink:href="#" xlink:title="FixCounter">
<g id="a_node3_18"><a xlink:href="#" xlink:title="include(self, m: pydriller.domain.commit.ModifiedFile) &#45;&gt; bool:&#10;Include all modifications whose commit messages start with &#39;Fix:&#39;">
<text xml:space="preserve" text-anchor="start" x="176.12" y="-34.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">include()</text>
</a>
</g>
<g id="a_node3_19"><a xlink:href="#" xlink:title="map_hoverinfo(self) &#45;&gt; str:&#10;Return the text to be shown when hovering over a node.&#10;To be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="176.12" y="-21.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">map_hoverinfo()</text>
</a>
</g>
<g id="a_node3_20"><a xlink:href="#" xlink:title="map_node_text(self, node: Tuple) &#45;&gt; str:&#10;Return the text to be shown for the node (default: #changes).&#10;Can be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="176.12" y="-8.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">map_node_text()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- FixCounter&#45;&gt;ChangeCounter -->
<g id="edge2" class="edge">
<title>FixCounter&#45;&gt;ChangeCounter</title>
<path fill="none" stroke="black" d="M206.7,-72.15C203.44,-80.03 199.81,-88.83 195.98,-98.08"/>
<polygon fill="none" stroke="black" points="192.76,-96.71 192.18,-107.29 199.23,-99.38 192.76,-96.71"/>
</g>
<!-- Legend -->
<g id="node4" class="node">
<title>Legend</title>
<text xml:space="preserve" text-anchor="start" x="292.5" y="-52.25" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="10.00" fill="#6a0dad">Legend</text>
<text xml:space="preserve" text-anchor="start" x="292.5" y="-42.25" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="298.5" y="-42.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00">public_method()</text>
<text xml:space="preserve" text-anchor="start" x="292.5" y="-32.25" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="298.5" y="-32.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00">private_method()</text>
<text xml:space="preserve" text-anchor="start" x="292.5" y="-22.25" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="298.5" y="-22.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00">overloaded_method()</text>
<text xml:space="preserve" text-anchor="start" x="292.5" y="-13.2" font-family="Helvetica,sans-Serif" font-size="9.00">Hover over names to see doc</text>
</g>
</g>
</svg>
</div></div>
</div>
</section>
<section id="mining-change-histories">
<h2>Mining Change Histories<a class="headerlink" href="#mining-change-histories" title="Link to this heading">#</a></h2>
<p>The history of any software project is a history of change. Any nontrivial project thus comes with a <em>version database</em> to organize and track changes; and possibly also with an <a class="reference internal" href="Tracking.html"><span class="std std-doc">issue database</span></a> to organize and track issues.</p>
<p>Over time, these databases hold plenty of information about the project: <em>Who changed what, when, and why?</em> This information can be <em>mined</em> from existing databases and <em>analyzed</em> to answer questions such as</p>
<ul class="simple">
<li><p>Which parts in my project were most frequently or recently changed?</p></li>
<li><p>How many files does the average change touch?</p></li>
<li><p>Where in my project were the most bugs fixed?</p></li>
</ul>
<p>To answer such questions, we can <em>mine</em> change and bug histories for past changes and fixes. This involves digging through version databases such as <code class="docutils literal notranslate"><span class="pre">git</span></code> and <a class="reference internal" href="Tracking.html"><span class="std std-doc">issue trackers such as RedMine or Bugzilla</span></a> and extracting all their information. Fortunately for us, there is ready-made infrastructure for some of this.</p>
</section>
<section id="mining-with-pydriller">
<h2>Mining with PyDriller<a class="headerlink" href="#mining-with-pydriller" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://pydriller.readthedocs.io/">PyDriller</a> is a Python package for mining change histories. Its <code class="docutils literal notranslate"><span class="pre">Repository</span></code> class takes a <code class="docutils literal notranslate"><span class="pre">git</span></code> version repository and allows accessing all the individual changes (“modifications”), together with committers, affected files, commit messages, and more.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pydriller</span><span class="w"> </span><span class="kn">import</span> <span class="n">Repository</span>  <span class="c1"># https://pydriller.readthedocs.io/</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pydriller.domain.commit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Commit</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pydriller.domain.commit</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModifiedFile</span>
</pre></div>
</div>
</div>
</div>
<p>To use <code class="docutils literal notranslate"><span class="pre">Repository</span></code>, we need to pass it</p>
<ul class="simple">
<li><p>the URL of a <code class="docutils literal notranslate"><span class="pre">git</span></code> repository; or</p></li>
<li><p>the directory name where a cloned <code class="docutils literal notranslate"><span class="pre">git</span></code> repository can be found.</p></li>
</ul>
<p>In general, cloning a <code class="docutils literal notranslate"><span class="pre">git</span></code> repository locally (with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">URL</span></code>) and then analyzing it locally will be faster and require less network resources.</p>
<p>Let us apply <code class="docutils literal notranslate"><span class="pre">Repository</span></code> on the repository of this book. The function <code class="docutils literal notranslate"><span class="pre">current_repo()</span></code> returns the directory in which a <code class="docutils literal notranslate"><span class="pre">.git</span></code> subdirectory is stored – that is, the root of a cloned <code class="docutils literal notranslate"><span class="pre">git</span></code> repository.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">current_repo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;.git&#39;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># Go one level up</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">new_path</span> <span class="o">!=</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">new_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">current_repo</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/Users/zeller/Projects/debuggingbook&#39;
</pre></div>
</div>
</div>
</div>
<p>This gives us a repository miner for the book:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">book_miner</span> <span class="o">=</span> <span class="n">Repository</span><span class="p">(</span><span class="n">current_repo</span><span class="p">(),</span> <span class="n">to</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">to</span></code> argument limits the range of time we want to look at.</p>
<p>You can also specify a URL instead, but this will access the repository via the network and generally be much slower.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DEBUGGINGBOOK_REMOTE_REPO</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/uds-se/debuggingbook.git&#39;</span>
<span class="c1"># book_miner = Repository(DEBUGGINGBOOK_REMOTE_REPO)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p><code class="docutils literal notranslate"><span class="pre">traverse_commits()</span></code> is a generator that returns one commit after another. Let us fetch the very first commit made to the book:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">book_commits</span> <span class="o">=</span> <span class="n">book_miner</span><span class="o">.</span><span class="n">traverse_commits</span><span class="p">()</span>
<span class="n">book_first_commit</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">book_commits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Each commit has a number of attributes telling us more about the commit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">book_first_commit</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;author&#39;,
 &#39;author_date&#39;,
 &#39;author_timezone&#39;,
 &#39;branches&#39;,
 &#39;co_authors&#39;,
 &#39;committer&#39;,
 &#39;committer_date&#39;,
 &#39;committer_timezone&#39;,
 &#39;deletions&#39;,
 &#39;dmm_unit_complexity&#39;,
 &#39;dmm_unit_interfacing&#39;,
 &#39;dmm_unit_size&#39;,
 &#39;files&#39;,
 &#39;hash&#39;,
 &#39;in_main_branch&#39;,
 &#39;insertions&#39;,
 &#39;lines&#39;,
 &#39;merge&#39;,
 &#39;modified_files&#39;,
 &#39;msg&#39;,
 &#39;parents&#39;,
 &#39;project_name&#39;,
 &#39;project_path&#39;]
</pre></div>
</div>
</div>
</div>
<p>For instance, the <code class="docutils literal notranslate"><span class="pre">msg</span></code> attribute lets us know about the commit message:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">book_first_commit</span><span class="o">.</span><span class="n">msg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;first commit&#39;
</pre></div>
</div>
</div>
</div>
<p>whereas the <code class="docutils literal notranslate"><span class="pre">author</span></code> attribute gets us the name and email of the person who made the commit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">book_first_commit</span><span class="o">.</span><span class="n">author</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;email&#39;, &#39;name&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">book_first_commit</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">book_first_commit</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">email</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Andreas Zeller&#39;, &#39;zeller@cispa.saarland&#39;)
</pre></div>
</div>
</div>
</div>
<p>A commit consists of multiple <em>modifications</em> to possibly multiple files. The commit <code class="docutils literal notranslate"><span class="pre">modified_files</span></code> attribute returns a list of modifications.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">book_first_commit</span><span class="o">.</span><span class="n">modified_files</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;pydriller.domain.commit.ModifiedFile at 0x109ae9e80&gt;]
</pre></div>
</div>
</div>
</div>
<p>For each modification, we can retrieve the files involved as well as several statistics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">book_first_commit</span><span class="o">.</span><span class="n">modified_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;added_lines&#39;,
 &#39;change_type&#39;,
 &#39;changed_methods&#39;,
 &#39;complexity&#39;,
 &#39;content&#39;,
 &#39;content_before&#39;,
 &#39;deleted_lines&#39;,
 &#39;diff&#39;,
 &#39;diff_parsed&#39;,
 &#39;filename&#39;,
 &#39;language_supported&#39;,
 &#39;methods&#39;,
 &#39;methods_before&#39;,
 &#39;new_path&#39;,
 &#39;nloc&#39;,
 &#39;old_path&#39;,
 &#39;source_code&#39;,
 &#39;source_code_before&#39;,
 &#39;token_count&#39;]
</pre></div>
</div>
</div>
</div>
<p>Let us see which file was created with this modification:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">book_first_commit</span><span class="o">.</span><span class="n">modified_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">new_path</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;README.md&#39;
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">content</span></code> attribute holds the entire file contents after the modification.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">book_first_commit</span><span class="o">.</span><span class="n">modified_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b&#39;# debuggingbook\n&#39;
</pre></div>
</div>
</div>
</div>
<p>We see that the <code class="docutils literal notranslate"><span class="pre">debuggingbook</span></code> project started with a very simple commit, namely the addition of an (almost empty) <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file.</p>
<p>The attribute <code class="docutils literal notranslate"><span class="pre">content_before</span></code> holds the previous source code. We see that it is <code class="docutils literal notranslate"><span class="pre">None</span></code> – the file was just created.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">book_first_commit</span><span class="o">.</span><span class="n">modified_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content_before</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
</div>
</div>
<p>Let us have a look at the <em>second</em> commit. We see that it is much more substantial already.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">book_second_commit</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">book_commits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">new_path</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">book_second_commit</span><span class="o">.</span><span class="n">modified_files</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Chapters.makefile&#39;,
 &#39;LICENSE.md&#39;,
 &#39;Makefile&#39;,
 &#39;README.md&#39;,
 &#39;debuggingbook.bib&#39;,
 &#39;ipypublish&#39;,
 &#39;ipypublish_plugins&#39;,
 &#39;notebooks/.ipynb_checkpoints/index-checkpoint.ipynb&#39;,
 &#39;notebooks/index.ipynb&#39;,
 &#39;utils&#39;]
</pre></div>
</div>
</div>
</div>
<p>We fetch the modification for the <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">readme_modification</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">book_second_commit</span><span class="o">.</span><span class="n">modified_files</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">new_path</span> <span class="o">==</span> <span class="s1">&#39;README.md&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">content_before</span></code> attribute holds the previous version (which we already have seen):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">readme_modification</span><span class="o">.</span><span class="n">content_before</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># debuggingbook
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">content</span></code> attribute holds the new version – now a complete “README” file. (Compare this first version to the <a class="reference internal" href="index.html"><span class="std std-doc">current README text</span></a>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">readme_modification</span><span class="o">.</span><span class="n">content</span><span class="p">[:</span><span class="mi">400</span><span class="p">],</span> <span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># About this Book

__Welcome to &quot;The Debugging Book&quot;!__ 

Software has bugs, and finding bugs can involve lots of effort.  This book addresses this problem by _automating_ software debugging, specifically by _locating errors and their causes automatically_.  Recent years have seen the development of novel techniques that lead to dramatic improvements in test generation and software testing.  They
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">diff</span></code> attribute holds the differences between the old and the new version.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">readme_modification</span><span class="o">.</span><span class="n">diff</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@@ -1 +1,157 @@
-# debuggingbook
+
+# About this Book
+
+__Welcome to &quot;The Debugging Book&quot;!__ 
+
+So
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">diff_parsed</span></code> attribute even lists added and deleted lines:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">readme_modification</span><span class="o">.</span><span class="n">diff_parsed</span><span class="p">[</span><span class="s1">&#39;added&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(1, &#39;&#39;),
 (2, &#39;# About this Book&#39;),
 (3, &#39;&#39;),
 (4, &#39;__Welcome to &quot;The Debugging Book&quot;!__&#39;),
 (5, &#39;&#39;),
 (6,
  &#39;Software has bugs, and finding bugs can involve lots of effort.  This book addresses this problem by _automating_ software debugging, specifically by _locating errors and their causes automatically_.  Recent years have seen the development of novel techniques that lead to dramatic improvements in test generation and software testing.  They now are mature enough to be assembled in a book – even with executable code.&#39;),
 (7, &#39;&#39;),
 (8, &#39;&#39;),
 (9, &#39;&#39;),
 (10, &#39;## A Textbook for Paper, Screen, and Keyboard&#39;)]
</pre></div>
</div>
</div>
</div>
<p>With all this information, we can track all commits and modifications and establish statistics over which files were changed (and possibly even fixed) most. This is what we will do in the next section.</p>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="counting-changes">
<h2>Counting Changes<a class="headerlink" href="#counting-changes" title="Link to this heading">#</a></h2>
<p>We start with a simple <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code> class that, given a repository, counts for each file how frequently it was changed.</p>
<p>We represent file names as <em>nodes</em> – a tuple <span class="math notranslate nohighlight">\((f_1, f_2, ..., f_n)\)</span> that denotes a <em>hierarchy</em>: Each <span class="math notranslate nohighlight">\(f_i\)</span> is a directory holding <span class="math notranslate nohighlight">\(f_{i+1}\)</span>, with <span class="math notranslate nohighlight">\(f_n\)</span> being the actual file. Here is what this notebook looks as a node:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;debuggingbook/notebooks/ChangeCounter.ipynb&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;debuggingbook&#39;, &#39;notebooks&#39;, &#39;ChangeCounter.ipynb&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Node</span> <span class="o">=</span> <span class="n">Tuple</span>
</pre></div>
</div>
</div>
</div>
<p>The constructor takes the repository to be analyzed and sets the internal counters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">git.exc</span><span class="w"> </span><span class="kn">import</span> <span class="n">GitCommandError</span>  <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count the number of changes for a repository.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repo</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> 
                 <span class="nb">filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Commit</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                 <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>
<span class="sd">        `repo` is a git repository (as URL or directory).</span>
<span class="sd">        `filter` is a predicate that takes a modification and returns True </span>
<span class="sd">        if it should be considered (default: consider all).</span>
<span class="sd">        `log` turns on logging if set.</span>
<span class="sd">        `kwargs` are passed to the `Repository()` constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repo</span> <span class="o">=</span> <span class="n">repo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>

        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="n">ModifiedFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="nb">filter</span>

        <span class="c1"># A node is an tuple (f_1, f_2, f_3, ..., f_n) denoting</span>
        <span class="c1"># a folder f_1 holding a folder f_2 ... holding a file f_n.</span>

        <span class="c1"># Mapping node -&gt; #of changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># Mapping node -&gt; list of commit messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="c1"># Mapping node -&gt; last size seen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mine</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">mine()</span></code> does all the heavy lifting of mining. It retrieves all commits and all modifications from the repository, passing the modifications through the <code class="docutils literal notranslate"><span class="pre">update_stats()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gather data from repository. To be extended in subclasses.&quot;&quot;&quot;</span>
        <span class="n">miner</span> <span class="o">=</span> <span class="n">Repository</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">commit</span> <span class="ow">in</span> <span class="n">miner</span><span class="o">.</span><span class="n">traverse_commits</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mine_commit</span><span class="p">(</span><span class="n">commit</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">GitCommandError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="c1"># Warn about failing git commands, but continue</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cannot mine commit &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">commit</span><span class="o">.</span><span class="n">hash</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cannot mine commit &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">commit</span><span class="o">.</span><span class="n">hash</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">err</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mine_commit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="p">:</span> <span class="n">Commit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">commit</span><span class="o">.</span><span class="n">modified_files</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">committer</span> <span class="o">=</span> <span class="n">commit</span><span class="o">.</span><span class="n">committer</span>
            <span class="n">m</span><span class="o">.</span><span class="n">committer_date</span> <span class="o">=</span> <span class="n">commit</span><span class="o">.</span><span class="n">committer_date</span>
            <span class="n">m</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">commit</span><span class="o">.</span><span class="n">msg</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_stats</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">include()</span></code> method allows filtering modifications. For simplicity, we copy the most relevant attributes of the commit over to the modification, such that the filter can access them, too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">ModifiedFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the modification `m` should be included</span>
<span class="sd">        (default: the `filter` predicate given to the constructor).</span>
<span class="sd">        To be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For each such node, <code class="docutils literal notranslate"><span class="pre">update_stats()</span></code> then invokes <code class="docutils literal notranslate"><span class="pre">update_size()</span></code>, <code class="docutils literal notranslate"><span class="pre">update_changes()</span></code>, and <code class="docutils literal notranslate"><span class="pre">update_elems()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">ModifiedFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update counters with modification `m`.</span>
<span class="sd">        Can be extended in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">new_path</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">node</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">new_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_size</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">content</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_changes</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_elems</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">update_size()</span></code> simply saves the last size of the item being modified. Since we progress from first to last commit, this reflects the size of the newest version.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update counters for `node` with `size`.</span>
<span class="sd">        Can be extended in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">update_changes()</span></code> increases the counter <code class="docutils literal notranslate"><span class="pre">changes</span></code> for the given node <code class="docutils literal notranslate"><span class="pre">node</span></code>, and adds the current commit message <code class="docutils literal notranslate"><span class="pre">commit_msg</span></code> to its list. This makes</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code> a mapping of nodes to their size</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">changes</span></code> a mapping of nodes to the number of changes they have seen</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">commit_msg</span></code> a mapping of nodes to the list of commit messages that have affected them.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">commit_msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update stats for `node` changed with `commit_msg`.</span>
<span class="sd">        Can be extended in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commit_msg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">update_elems()</span></code> method is reserved for later use, when we go and count fine-grained changes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_elems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">ModifiedFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update counters for subelements of `node` with modification `m`.</span>
<span class="sd">        To be defined in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>Let us put <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code> to action – on the current (debuggingbook) repository.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DEBUGGINGBOOK_REPO</span> <span class="o">=</span> <span class="n">current_repo</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DEBUGGINGBOOK_REPO</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/Users/zeller/Projects/debuggingbook&#39;
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">debuggingbook_change_counter</span></code> instantiates a <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code> class (or any subclass) with the <code class="docutils literal notranslate"><span class="pre">debuggingbook</span></code> repository, mining all the counters as listed above. Since mining <em>all</em> history takes quite some time, its parameter <code class="docutils literal notranslate"><span class="pre">start_date</span></code> allows setting a starting date (default: March 1, 2021); changes before that date will be ignored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DEBUGGINGBOOK_START_DATE</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NUM_WORKERS</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Number of threads to be run in parallel</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">debuggingbook_change_counter</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">DEBUGGINGBOOK_START_DATE</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiate a ChangeCounter (sub)class `cls` with the debuggingbook repo.</span>
<span class="sd">    Only mines changes after `start_date` (default: DEBUGGINGBOOK_START_DATE)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="n">ModifiedFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do not include</span>
<span class="sd">        * the `docs/` directory; it only holds generated Web pages</span>
<span class="sd">        * the `notebooks/shared/` package; this is infrastructure</span>
<span class="sd">        * the `synopsis` pictures; these are all generated</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">new_path</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">new_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;docs/&#39;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">new_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;notebooks/shared/&#39;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="s1">&#39;-synopsis-&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">new_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">DEBUGGINGBOOK_REPO</span><span class="p">,</span>
               <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
               <span class="n">since</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
               <span class="n">num_workers</span><span class="o">=</span><span class="n">NUM_WORKERS</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us set <code class="docutils literal notranslate"><span class="pre">change_counter</span></code> to this <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code> instance. This can take a few minutes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Timer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">change_counter</span> <span class="o">=</span> <span class="n">debuggingbook_change_counter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">)</span>

<span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>94.75101675000042
</pre></div>
</div>
</div>
</div>
<p>The attribute <code class="docutils literal notranslate"><span class="pre">changes</span></code> of our <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code> now is a mapping of nodes to the respective number of changes. Here are the first 10 entries:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">change_counter</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;notebooks&#39;, &#39;Intro_Debugging.ipynb&#39;),
 (&#39;html&#39;, &#39;custom.css&#39;),
 (&#39;Chapters.makefile&#39;,),
 (&#39;notebooks&#39;, &#39;02_Observing.ipynb&#39;),
 (&#39;notebooks&#39;, &#39;04_Reducing.ipynb&#39;),
 (&#39;notebooks&#39;, &#39;PerformanceDebugger.ipynb&#39;),
 (&#39;notebooks&#39;, &#39;ThreadDebugger.ipynb&#39;),
 (&#39;notebooks&#39;, &#39;Debugger.ipynb&#39;),
 (&#39;notebooks&#39;, &#39;Tracer.ipynb&#39;),
 (&#39;binder&#39;, &#39;postBuild&#39;)]
</pre></div>
</div>
</div>
</div>
<p>This is the number of changes to the <code class="docutils literal notranslate"><span class="pre">Chapters.makefile</span></code> file which lists the book chapters:</p>
<div class="cell tag_outputPrepend docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">change_counter</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;Chapters.makefile&#39;</span><span class="p">,),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>33
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">messages</span></code> attribute holds all the messages:</p>
<div class="cell tag_outputPrepend docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">change_counter</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;Chapters.makefile&#39;</span><span class="p">,),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;New: (Incomplete) chapters on performance and concurrency debugging&#39;,
 &#39;New: moved StackInspector in its own module&#39;,
 &quot;New: mark (pretty much) all chapters as &#39;ready&#39;&quot;,
 &#39;Doc fix&#39;,
 &#39;New: release first chapters&#39;,
 &quot;New: have a &#39;shared&#39; directory for material shared between fuzzingbook and debuggingbook; avoid cross-project links&quot;,
 &quot;New: &#39;make shared&#39; syncs the &#39;shared&#39; folder&quot;,
 &#39;New: can now run notebooks and check HTML as part of CI&#39;,
 &#39;New: Assertions is ready&#39;,
 &quot;Fix: Mark &#39;Assertions&#39; as new, too&quot;,
 &#39;New: publish Slicer&#39;,
 &#39;Fix: DEPENDENCIES_PART was missing in PUBLIC_CHAPTERS&#39;,
 &#39;New: publish DeltaDebugger&#39;,
 &#39;New release: ChangeDebugger&#39;,
 &#39;New: publish StatisticalDebugger&#39;,
 &#39;Made StatisticalDebugger visible&#39;,
 &#39;New: public chapter on dynamic invariants&#39;,
 &#39;New: publish DDSetDebugger&#39;,
 &#39;New: PerformanceDebugger goes live&#39;,
 &#39;New: Publish repair chapter&#39;,
 &#39;New chapter: Tracking&#39;,
 &#39;New: ChangeCounter is public&#39;,
 &#39;New: do not check types in fuzzingbook (yet)&#39;,
 &#39;New: checking types is now the default&#39;,
 &#39;New: illustrated code&#39;,
 &#39;New: Illustrated Code&#39;,
 &#39;New: efficient timeout handling&#39;,
 &#39;Fix: added default target&#39;,
 &#39;Fix: bad default target&#39;,
 &#39;No new chapters&#39;,
 &#39;Moved announcements from Twitter to Mastodon&#39;,
 &#39;New: first sketch of Alhazen chapter&#39;,
 &#39;Moved Alhazen out of beta&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">change_counter</span><span class="o">.</span><span class="n">changes</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">change_counter</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="n">node</span><span class="p">])</span> <span class="o">==</span> <span class="n">change_counter</span><span class="o">.</span><span class="n">changes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sizes</span></code> attribute holds the final size:</p>
<div class="cell tag_outputPrepend docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">change_counter</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;Chapters.makefile&#39;</span><span class="p">,),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3801
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-past-changes">
<h2>Visualizing Past Changes<a class="headerlink" href="#visualizing-past-changes" title="Link to this heading">#</a></h2>
<p>To explore the number of changes across all project files, we visualize them as a <em>tree map</em>. A tree map visualizes hierarchical data using nested rectangles. In our visualization, each directory is shown as a rectangle containing smaller rectangles. The <em>size</em> of a rectangle is relative to its size (in bytes); and the <em>color</em> of a rectangle is relative to the number of changes it has seen.</p>
<p>We use the <a class="reference external" href="https://github.com/mwouts/easyplotly">easyplotly</a> package to easily create a treemap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">easyplotly</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ep</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</pre></div>
</div>
</div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">map_node_sizes()</span></code> returns a size for the node – any number will do. By default, we use a logarithmic scale, such that smaller files are not totally visually eclipsed by larger files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">map_node_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> \
        <span class="n">Dict</span><span class="p">[</span><span class="n">Node</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a mapping of nodes to sizes.</span>
<span class="sd">        Can be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="c1"># Default: use log scale</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> 
                    <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">:</span>
            <span class="c1"># Alternative: use sqrt size</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;abs&#39;</span><span class="p">:</span>
            <span class="c1"># Alternative: use absolute size</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown scale: </span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">; &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;use one of [log, sqrt, abs]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">map_node_color()</span></code> returns a color for the node – again, as a number. The smallest and largest numbers returned indicate beginning and end in the given color scale, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">map_node_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a color of the node, as a number.</span>
<span class="sd">        Can be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">map_node_text()</span></code> shows a text to be displayed in the rectangle; we set this to the number of changes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">map_node_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the text to be shown for the node (default: #changes).</span>
<span class="sd">        Can be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="k">if</span> <span class="n">change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<p>The methods <code class="docutils literal notranslate"><span class="pre">map_hoverinfo()</span></code> and <code class="docutils literal notranslate"><span class="pre">map_colorscale()</span></code> set additional map parameters. For details, see the <a class="reference external" href="https://github.com/mwouts/easyplotly">easyplotly</a> documentation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">map_hoverinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the text to be shown when hovering over a node.</span>
<span class="sd">        To be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;label+text&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">map_colorscale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the colorscale for the map. To be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;YlOrRd&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>With all this, the <code class="docutils literal notranslate"><span class="pre">map()</span></code> function creates a tree map of the repository, using the  <a class="reference external" href="https://github.com/mwouts/easyplotly">easyplotly</a> <code class="docutils literal notranslate"><span class="pre">Treemap</span></code> constructor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce an interactive tree map of the repository.&quot;&quot;&quot;</span>
        <span class="n">treemap</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">Treemap</span><span class="p">(</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">map_node_sizes</span><span class="p">(),</span>
                     <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map_node_text</span><span class="p">,</span>
                     <span class="n">hoverinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map_hoverinfo</span><span class="p">(),</span>
                     <span class="n">marker_colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map_node_color</span><span class="p">,</span>
                     <span class="n">marker_colorscale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map_colorscale</span><span class="p">(),</span>
                     <span class="n">root_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repo</span><span class="p">,</span>
                     <span class="n">branchvalues</span><span class="o">=</span><span class="s1">&#39;total&#39;</span>
                    <span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">treemap</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<p>This is what the tree map for <code class="docutils literal notranslate"><span class="pre">debuggingbook</span></code> looks like.</p>
<ul class="simple">
<li><p>Click on any rectangle to enlarge it.</p></li>
<li><p>Click outside the rectangle to return to a wider view.</p></li>
<li><p>Hover over a rectangle to get further information.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">change_counter</span> <span class="o">=</span> <span class="n">debuggingbook_change_counter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">change_counter</span><span class="o">.</span><span class="n">map</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>We can easily identify the most frequently changed files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sorted</span><span class="p">(</span><span class="n">change_counter</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[((&#39;notebooks&#39;, &#39;Slicer.ipynb&#39;), 53),
 ((&#39;notebooks&#39;, &#39;ChangeCounter.ipynb&#39;), 47),
 ((&#39;requirements.txt&#39;,), 40),
 ((&#39;notebooks&#39;, &#39;Repairer.ipynb&#39;), 34)]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">quiz</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">Which two notebooks have seen the most changes over time?</div>
    </p>
    <p>
    <div class="quiz_options" title="Check all that apply.">
    
        <input type="checkbox" name="fc5527d8-b295-11f0-8845-6298cf1a5790" id="fc5527d8-b295-11f0-8845-6298cf1a5790-1" onclick="clear_selection('fc5527d8-b295-11f0-8845-6298cf1a5790')">
        <label id="fc5527d8-b295-11f0-8845-6298cf1a5790-1-label" for="fc5527d8-b295-11f0-8845-6298cf1a5790-1"><code>Slicer</code></label><br>
    
        <input type="checkbox" name="fc5527d8-b295-11f0-8845-6298cf1a5790" id="fc5527d8-b295-11f0-8845-6298cf1a5790-2" onclick="clear_selection('fc5527d8-b295-11f0-8845-6298cf1a5790')">
        <label id="fc5527d8-b295-11f0-8845-6298cf1a5790-2-label" for="fc5527d8-b295-11f0-8845-6298cf1a5790-2"><code>Tracer</code></label><br>
    
        <input type="checkbox" name="fc5527d8-b295-11f0-8845-6298cf1a5790" id="fc5527d8-b295-11f0-8845-6298cf1a5790-3" onclick="clear_selection('fc5527d8-b295-11f0-8845-6298cf1a5790')">
        <label id="fc5527d8-b295-11f0-8845-6298cf1a5790-3-label" for="fc5527d8-b295-11f0-8845-6298cf1a5790-3"><code>ChangeCounter</code></label><br>
    
        <input type="checkbox" name="fc5527d8-b295-11f0-8845-6298cf1a5790" id="fc5527d8-b295-11f0-8845-6298cf1a5790-4" onclick="clear_selection('fc5527d8-b295-11f0-8845-6298cf1a5790')">
        <label id="fc5527d8-b295-11f0-8845-6298cf1a5790-4-label" for="fc5527d8-b295-11f0-8845-6298cf1a5790-4"><code>Repairer</code></label><br>
    
    </div>
    </p>
    <input id="fc5527d8-b295-11f0-8845-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('fc5527d8-b295-11f0-8845-6298cf1a5790', 10, 1, '[1234 % 3, 3702 / 1234]')">
    <span class="quiz_hint" id="fc5527d8-b295-11f0-8845-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Indeed, these two are the two most frequently recently changed notebooks:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">notebook</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">notebook</span> <span class="ow">in</span> <span class="n">all_notebooks</span><span class="p">[:</span><span class="mi">2</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Slicer&#39;, &#39;ChangeCounter&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="counting-past-fixes">
<h2>Counting Past Fixes<a class="headerlink" href="#counting-past-fixes" title="Link to this heading">#</a></h2>
<p>Knowing which files have been changed most is useful in debugging, because any change increases the chance to introduce a new bug. Even more important, however, is the question of how frequently a file was <em>fixed</em> in the past, as this is an important indicator for its bug-proneness.</p>
<p>(One may think that fixing several bugs <em>reduces</em> the number of bugs, but unfortunately, a file which has seen several fixes in the past is likely to see fixes in the future, too. This is because the bug-proneness of a software component very much depends on the requirements it has to fulfill, and if these requirements are unclear, complex, or frequently change, this translates into many fixes.)</p>
<p>How can we tell <em>changes</em> from <em>fixes</em>?</p>
<ul class="simple">
<li><p>One indicator is <em>commit messages</em>:
If they refer to “bugs” or “fixes”, then the change is a fix.</p></li>
<li><p>Another indicator is <em>bug numbers</em>:
If a commit message contains an issue number from an associated issue database, then we can make use of the issue referred to.</p>
<ul>
<li><p>The issue database may provide us with additional information about the bug, such as its severity, how many people it was assigned to, how long it took to fix it, and more.</p></li>
</ul>
</li>
<li><p>A final indicator is <em>time</em>:
If a developer first committed a change and in the same time frame marked an issue as “resolved”, then it is likely that the two refer to each other.</p></li>
</ul>
<p>The way these two are linked very much depends on the project – and the discipline of developers as it comes to change messages. <em>Branches</em> and <em>merges</em> bring additional challenges.</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">debuggingbook</span></code> project, identifying fixes is easy. The discipline is that if a change fixes a bug, it is prefixed with <code class="docutils literal notranslate"><span class="pre">Fix:</span></code>. We can use this to introduce a <code class="docutils literal notranslate"><span class="pre">FixCounter</span></code> class specific to our <code class="docutils literal notranslate"><span class="pre">debuggingbook</span></code> project.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FixCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Count the fixes for files in the repository.</span>
<span class="sd">    Fixes are all commits whose message starts with the word &#39;Fix: &#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">ModifiedFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Include all modifications whose commit messages start with &#39;Fix:&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Fix:&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As a twist to our default <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code> class, we include the “fix” messages in the tree map rectangles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FixCounter</span><span class="p">(</span><span class="n">FixCounter</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">map_node_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[]))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">map_hoverinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;label&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>This is the tree map showing fixes. We see that</p>
<ul class="simple">
<li><p>only those components that actually have seen a fix are shown; and</p></li>
<li><p>the fix distribution differs from the change distribution.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fix_counter</span> <span class="o">=</span> <span class="n">debuggingbook_change_counter</span><span class="p">(</span><span class="n">FixCounter</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fix_counter</span><span class="o">.</span><span class="n">map</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>If you want to take a look at the <em>entire</em> fix history, pass an early <code class="docutils literal notranslate"><span class="pre">start_date</span></code> argument to <code class="docutils literal notranslate"><span class="pre">debugging_change_counter()</span></code>. This takes a few extra minutes, so we make it optional:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fix_counter = debuggingbook_change_counter(</span>
<span class="c1">#     FixCounter,</span>
<span class="c1">#     start_date=datetime(1999, 1, 1)</span>
<span class="c1"># )</span>
<span class="c1"># fix_counter.map()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="counting-fine-grained-changes">
<h2>Counting Fine-Grained Changes<a class="headerlink" href="#counting-fine-grained-changes" title="Link to this heading">#</a></h2>
<p>In programming projects, individual files typically consist of <em>smaller units</em> such as functions, classes, and methods. We want to determine which of these <em>units</em> are frequently changed (and fixed). For this, we need to <em>break down</em> individual files into smaller parts, and then determine which of these parts would be affected by a change.</p>
<section id="mapping-elements-to-locations">
<h3>Mapping Elements to Locations<a class="headerlink" href="#mapping-elements-to-locations" title="Link to this heading">#</a></h3>
<p>Our first task is a simple means to split a (programming) file into smaller parts, each with their own locations. First, we need to know what kind of content a file contains. To this end, we use the Python <a class="reference external" href="https://github.com/ahupp/python-magic">magic</a> package. (The “magic” in the name does not refer to some “magic” functionality, but to the practice of having files start with “magic” bytes that indicate their type.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">magic</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">magic</span></code> package easily guesses that a file contains C code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">magic</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#include &lt;stdio.h&gt;</span>

<span class="s1">int main(int argc, char *argv[]) {</span>
<span class="s1">    printf(&quot;Hello, world!</span><span class="se">\n</span><span class="s1">&quot;)</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;C source, ASCII text&#39;
</pre></div>
</div>
</div>
</div>
<p>It also works well for Python code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">magic</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">def foo():</span>
<span class="s1">    print(&quot;Hello, world!&quot;)</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Python script, ASCII text executable&#39;
</pre></div>
</div>
</div>
</div>
<p>Jupyter Notebooks, however, are identified as <code class="docutils literal notranslate"><span class="pre">JSON</span></code> data or <code class="docutils literal notranslate"><span class="pre">SGML</span></code> documents:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">magic</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_repo</span><span class="p">(),</span>   <span class="c1"># type: ignore</span>
                                    <span class="s1">&#39;notebooks&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Assertions.ipynb&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;JSON text data&#39;
</pre></div>
</div>
</div>
</div>
<p>We define a set of <em>delimiters</em> for these languages which use <em>regular expressions</em> to identify</p>
<ul class="simple">
<li><p>the <em>language</em> (matching the <code class="docutils literal notranslate"><span class="pre">magic</span></code> output)</p></li>
<li><p>the <em>beginning of a unit</em>, and</p></li>
<li><p>the <em>end</em> of a unit,</p></li>
</ul>
<p>For Python, for instance, any line starting with <code class="docutils literal notranslate"><span class="pre">def</span></code> or <code class="docutils literal notranslate"><span class="pre">class</span></code> denotes the start of some unit; any line starting with something else denotes the end of a unit. For Jupyter, the delimiters do the same, yet encoded into JSON. The definitions for C are likely to work for a wide range of languages that all use <code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code> to delimit units.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DELIMITERS</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Pattern</span><span class="p">,</span> <span class="n">Pattern</span><span class="p">,</span> <span class="n">Pattern</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span>
        <span class="c1"># Python</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^python.*&#39;</span><span class="p">),</span>

        <span class="c1"># Beginning of element</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(async\s+)?(def|class)\s+(?P&lt;name&gt;\w+)\W.*&#39;</span><span class="p">),</span>

        <span class="c1"># End of element</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[^#\s]&#39;</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="p">(</span>
        <span class="c1"># Jupyter Notebooks</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(json|exported sgml|jupyter).*&#39;</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s+&quot;(async\s+)?(def|class)\s+(?P&lt;name&gt;\w+)\W&#39;</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\s+&quot;[^#\s</span><span class="se">\\</span><span class="s1">]|\s+\])&#39;</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="p">(</span>
        <span class="c1"># C source code (actually, any { }-delimited language)</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(c |c\+\+|c#|java|perl|php).*&#39;</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[^\s].*\s+(?P&lt;name&gt;\w+)\s*[({].*&#39;</span><span class="p">),</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[}]&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">rxdelim()</span></code> returns suitable delimiters for a given content, using <code class="docutils literal notranslate"><span class="pre">DELIMITERS</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">rxdelim</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Pattern</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Pattern</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return suitable begin and end delimiters for the content `content`.</span>
<span class="sd">    If no matching delimiters are found, return `None, None`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="n">magic</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">rxtp</span><span class="p">,</span> <span class="n">rxbegin</span><span class="p">,</span> <span class="n">rxend</span> <span class="ow">in</span> <span class="n">DELIMITERS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rxtp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">tp</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">rxbegin</span><span class="p">,</span> <span class="n">rxend</span>

    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">elem_mapping()</span></code> returns a list of the individual elements as found in the file, indexed by line numbers (starting with 1).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Mapping</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">elem_mapping</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of the elements in `content`, indexed by line number.&quot;&quot;&quot;</span>
    <span class="n">rxbegin</span><span class="p">,</span> <span class="n">rxend</span> <span class="o">=</span> <span class="n">rxdelim</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rxbegin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">rxend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">mapping</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
    <span class="n">current_elem</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">rxbegin</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">current_elem</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rxend</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="n">current_elem</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_elem</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lineno</span><span class="si">:</span><span class="s2">3</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">current_elem</span><span class="p">)</span><span class="si">:</span><span class="s2">15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mapping</span>
</pre></div>
</div>
</div>
</div>
<p>Here is an example of how <code class="docutils literal notranslate"><span class="pre">elem_mapping()</span></code> works. During execution (with <code class="docutils literal notranslate"><span class="pre">log</span></code> set to <code class="docutils literal notranslate"><span class="pre">True</span></code>), we already see the elements associated with individual line numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">some_c_source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#include &lt;stdio.h&gt;</span>

<span class="s2">int foo(int x) {</span>
<span class="s2">    return x;</span>
<span class="s2">}</span>

<span class="s2">struct bar {</span>
<span class="s2">    int x, y;</span>
<span class="s2">}</span>

<span class="s2">int main(int argc, char *argv[]) {</span>
<span class="s2">    return foo(argc);</span>
<span class="s2">}</span>

<span class="s2">&quot;&quot;&quot;</span>
<span class="n">some_c_mapping</span> <span class="o">=</span> <span class="n">elem_mapping</span><span class="p">(</span><span class="n">some_c_source</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1 None            
  2 None            #include &lt;stdio.h&gt;
  3 None            
  4 foo             int foo(int x) {
  5 foo                 return x;
  6 None            }
  7 None            
  8 bar             struct bar {
  9 bar                 int x, y;
 10 None            }
 11 None            
 12 main            int main(int argc, char *argv[]) {
 13 main                return foo(argc);
 14 None            }
 15 None            
 16 None            
</pre></div>
</div>
</div>
</div>
<p>In the actual mapping, we can access the individual units for any line number:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">some_c_mapping</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">some_c_mapping</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(None, &#39;bar&#39;)
</pre></div>
</div>
</div>
</div>
<p>Here’s how this works for Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">some_python_source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">def foo(x):</span>
<span class="s2">    return x</span>

<span class="s2">class bar(blue):</span>
<span class="s2">    x = 25</span>
<span class="s2">    def f(x):</span>
<span class="s2">        return 26</span>

<span class="s2">def main(argc):</span>
<span class="s2">    return foo(argc)</span>

<span class="s2">&quot;&quot;&quot;</span>
<span class="n">some_python_mapping</span> <span class="o">=</span> <span class="n">elem_mapping</span><span class="p">(</span><span class="n">some_python_source</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1 None            
  2 foo             def foo(x):
  3 foo                 return x
  4 foo             
  5 bar             class bar(blue):
  6 bar                 x = 25
  7 bar                 def f(x):
  8 bar                     return 26
  9 bar             
 10 main            def main(argc):
 11 main                return foo(argc)
 12 main            
 13 main            
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># some_jupyter_source = open(&quot;Debugger.ipynb&quot;).read()</span>
<span class="c1"># some_jupyter_mapping = elem_mapping(some_jupyter_source, log=True)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="determining-changed-elements">
<h3>Determining Changed Elements<a class="headerlink" href="#determining-changed-elements" title="Link to this heading">#</a></h3>
<p>Using a mapping from <code class="docutils literal notranslate"><span class="pre">elem_mapping()</span></code>, we can determine which elements are affected by a change. The <code class="docutils literal notranslate"><span class="pre">changed_elems_by_mapping()</span></code> function returns the set of affected elements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">changed_elems_by_mapping</span><span class="p">(</span><span class="n">mapping</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Within `mapping`, return the set of elements affected by a change</span>
<span class="sd">    starting in line `start` and extending over `length` additional lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">elems</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="n">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mapping</span><span class="p">[</span><span class="n">line</span><span class="p">]:</span>
            <span class="n">elem</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">elems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">elems</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s an example of <code class="docutils literal notranslate"><span class="pre">changed_elems_by_mapping()</span></code>, applied to the Python content, above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">changed_elems_by_mapping</span><span class="p">(</span><span class="n">some_python_mapping</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;bar&#39;, &#39;foo&#39;}
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">elem_size()</span></code> returns the size of an element (say, a function).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">elem_size</span><span class="p">(</span><span class="n">elem</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Within `source`, return the size of `elem`&quot;&quot;&quot;</span>
    <span class="n">source_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="n">elem_mapping</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">line_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">mapping</span><span class="p">[</span><span class="n">line_no</span><span class="p">]</span> <span class="o">==</span> <span class="n">elem</span> <span class="ow">or</span> <span class="n">mapping</span><span class="p">[</span><span class="n">line_no</span><span class="p">]</span> <span class="ow">is</span> <span class="n">elem</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_lines</span><span class="p">[</span><span class="n">line_no</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">size</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">elem_size</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">some_python_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>26
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elem_size</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">some_python_source</span><span class="p">)</span> 
           <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">some_python_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Given an old version and a new version of a (text) file, we can use the <code class="docutils literal notranslate"><span class="pre">diff_match_patch</span></code> module to determine differences, and from these the affected lines:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ChangeDebugger</span><span class="w"> </span><span class="kn">import</span> <span class="n">diff</span>  <span class="c1"># minor dependency</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">diff_match_patch</span><span class="w"> </span><span class="kn">import</span> <span class="n">diff_match_patch</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">changed_elems</span><span class="p">(</span><span class="n">old_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the elements affected by the change from `old_source` to `new_source`&quot;&quot;&quot;</span>
    <span class="n">patches</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">old_source</span><span class="p">,</span> <span class="n">new_source</span><span class="p">)</span>

    <span class="n">old_mapping</span> <span class="o">=</span> <span class="n">elem_mapping</span><span class="p">(</span><span class="n">old_source</span><span class="p">)</span>
    <span class="n">new_mapping</span> <span class="o">=</span> <span class="n">elem_mapping</span><span class="p">(</span><span class="n">new_source</span><span class="p">)</span>

    <span class="n">elems</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
        <span class="n">old_start_line</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">start1</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">new_start_line</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">start2</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="n">patch</span><span class="o">.</span><span class="n">diffs</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="n">diff_match_patch</span><span class="o">.</span><span class="n">DIFF_INSERT</span><span class="p">:</span>
                <span class="n">elems</span> <span class="o">|=</span> <span class="n">changed_elems_by_mapping</span><span class="p">(</span><span class="n">old_mapping</span><span class="p">,</span> <span class="n">old_start_line</span><span class="p">)</span>
                <span class="n">elems</span> <span class="o">|=</span> <span class="n">changed_elems_by_mapping</span><span class="p">(</span><span class="n">new_mapping</span><span class="p">,</span> <span class="n">new_start_line</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="n">diff_match_patch</span><span class="o">.</span><span class="n">DIFF_DELETE</span><span class="p">:</span>
                <span class="n">elems</span> <span class="o">|=</span> <span class="n">changed_elems_by_mapping</span><span class="p">(</span><span class="n">old_mapping</span><span class="p">,</span> <span class="n">old_start_line</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
                <span class="n">elems</span> <span class="o">|=</span> <span class="n">changed_elems_by_mapping</span><span class="p">(</span><span class="n">new_mapping</span><span class="p">,</span> <span class="n">new_start_line</span><span class="p">)</span>

            <span class="n">old_start_line</span> <span class="o">+=</span> <span class="n">length</span>
            <span class="n">new_start_line</span> <span class="o">+=</span> <span class="n">length</span>

    <span class="k">return</span> <span class="n">elems</span>
</pre></div>
</div>
</div>
</div>
<p>Here is how <code class="docutils literal notranslate"><span class="pre">changed_elems()</span></code> works. We define a “new” version of <code class="docutils literal notranslate"><span class="pre">some_python_source</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">some_new_python_source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">def foo(y):</span>
<span class="s2">    return y</span>

<span class="s2">class qux(blue):</span>
<span class="s2">    x = 25</span>
<span class="s2">    def f(x):</span>
<span class="s2">        return 26</span>

<span class="s2">def main(argc):</span>
<span class="s2">    return foo(argc)</span>

<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">changed_elems</span><span class="p">(</span><span class="n">some_python_source</span><span class="p">,</span> <span class="n">some_new_python_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;bar&#39;, &#39;foo&#39;, &#39;qux&#39;}
</pre></div>
</div>
</div>
</div>
<p>Note that the list of changed elements includes added as well as deleted elements.</p>
</section>
<section id="putting-it-all-together">
<h3>Putting it all Together<a class="headerlink" href="#putting-it-all-together" title="Link to this heading">#</a></h3>
<p>We introduce a class <code class="docutils literal notranslate"><span class="pre">FineChangeCounter</span></code> that, like <code class="docutils literal notranslate"><span class="pre">ChangeCounter</span></code>, counts changes for individual files; however, <code class="docutils literal notranslate"><span class="pre">FineChangeCounter</span></code> adds additional nodes for all elements affected by the change. For a file consisting of multiple elements, this has the same effect as if the file were a directory, and the elements were all contained as individual files in this directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FineChangeCounter</span><span class="p">(</span><span class="n">ChangeCounter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count the changes for files in the repository and their elements&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_elems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">ModifiedFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">old_source</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">content_before</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">content_before</span> <span class="k">else</span> <span class="nb">bytes</span><span class="p">()</span>
        <span class="n">new_source</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">content</span> <span class="k">else</span> <span class="nb">bytes</span><span class="p">()</span>

        <span class="c1"># Content comes as bytes instead of strings</span>
        <span class="c1"># Let&#39;s convert this in a conservative way</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">old_source</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">old_source</span><span class="p">,</span> <span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">new_source</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_source</span><span class="p">,</span> <span class="s1">&#39;latin1&#39;</span><span class="p">)</span>

        <span class="n">changed</span> <span class="o">=</span> <span class="n">changed_elems</span><span class="p">(</span><span class="n">old_source</span><span class="p">,</span> <span class="n">new_source</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">changed</span><span class="p">:</span>
            <span class="n">elem_node</span> <span class="o">=</span> <span class="n">node</span> <span class="o">+</span> <span class="p">(</span><span class="n">elem</span><span class="p">,)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_size</span><span class="p">(</span><span class="n">elem_node</span><span class="p">,</span> <span class="n">elem_size</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">new_source</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_changes</span><span class="p">(</span><span class="n">elem_node</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Retrieving fine-grained changes takes a bit more time, since all files have to be parsed…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">fine_change_counter</span> <span class="o">=</span> <span class="n">debuggingbook_change_counter</span><span class="p">(</span><span class="n">FineChangeCounter</span><span class="p">)</span>

<span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>114.56250616698526
</pre></div>
</div>
</div>
</div>
<p>… but the result is very much worth it. We can now zoom into individual files and compare the change counts for the individual functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fine_change_counter</span><span class="o">.</span><span class="n">map</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Like before, we can access the most frequently changed elements, This is the most frequently changed item in the book:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">elem_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">fine_change_counter</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
              <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.ipynb&#39;</span><span class="p">)]</span>
<span class="n">elem_nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">fine_change_counter</span><span class="o">.</span><span class="n">changes</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">[(</span><span class="n">node</span><span class="p">,</span> <span class="n">fine_change_counter</span><span class="o">.</span><span class="n">changes</span><span class="p">[</span><span class="n">node</span><span class="p">])</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">elem_nodes</span><span class="p">[:</span><span class="mi">1</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[((&#39;notebooks&#39;, &#39;Slicer.ipynb&#39;, &#39;Slicer&#39;), 3)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">quiz</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">Which is the <em>second</em> most changed element?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="b5ea1f3c-b296-11f0-8845-6298cf1a5790" id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-1" onclick="clear_selection('b5ea1f3c-b296-11f0-8845-6298cf1a5790')">
        <label id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-1-label" for="b5ea1f3c-b296-11f0-8845-6298cf1a5790-1"><code>ManagedMemory</code> in <code>Assertions</code></label><br>
    
        <input type="radio" name="b5ea1f3c-b296-11f0-8845-6298cf1a5790" id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-2" onclick="clear_selection('b5ea1f3c-b296-11f0-8845-6298cf1a5790')">
        <label id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-2-label" for="b5ea1f3c-b296-11f0-8845-6298cf1a5790-2"><code>ExistenceFeature</code> in <code>Alhazen</code></label><br>
    
        <input type="radio" name="b5ea1f3c-b296-11f0-8845-6298cf1a5790" id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-3" onclick="clear_selection('b5ea1f3c-b296-11f0-8845-6298cf1a5790')">
        <label id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-3-label" for="b5ea1f3c-b296-11f0-8845-6298cf1a5790-3"><code>StackInspector</code> in <code>StackInspector</code></label><br>
    
        <input type="radio" name="b5ea1f3c-b296-11f0-8845-6298cf1a5790" id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-4" onclick="clear_selection('b5ea1f3c-b296-11f0-8845-6298cf1a5790')">
        <label id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-4-label" for="b5ea1f3c-b296-11f0-8845-6298cf1a5790-4"><code>Slicer</code> in <code>Slicer</code></label><br>
    
    </div>
    </p>
    <input id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('b5ea1f3c-b296-11f0-8845-6298cf1a5790', 4, 0, '1975308642 // 987654321')">
    <span class="quiz_hint" id="b5ea1f3c-b296-11f0-8845-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Indeed, here come the top five most frequently changed elements:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="n">node</span><span class="p">,</span> <span class="n">fine_change_counter</span><span class="o">.</span><span class="n">changes</span><span class="p">[</span><span class="n">node</span><span class="p">])</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">elem_nodes</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[((&#39;notebooks&#39;, &#39;Slicer.ipynb&#39;, &#39;Slicer&#39;), 3),
 ((&#39;notebooks&#39;, &#39;Alhazen.ipynb&#39;, &#39;ExistenceFeature&#39;), 3),
 ((&#39;notebooks&#39;, &#39;StackInspector.ipynb&#39;, &#39;StackInspector&#39;), 2),
 ((&#39;notebooks&#39;, &#39;Assertions.ipynb&#39;, &#39;ManagedMemory&#39;), 2),
 ((&#39;notebooks&#39;, &#39;ChangeCounter.ipynb&#39;, &#39;ChangeCounter&#39;), 2)]
</pre></div>
</div>
</div>
</div>
<p>Now it is time to apply these tools on your own projects. Which are the most frequently changed (and fixed) elements? Why is that so? What can you do to improve things? All these are consequences of debugging – to help have fewer bugs in the future!</p>
</section>
</section>
<section id="lessons-learned">
<h2>Lessons Learned<a class="headerlink" href="#lessons-learned" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>We can easily <em>mine</em> past changes and map these to individual files and elements</p></li>
<li><p>This information can be helpful in guiding the debugging and development process</p></li>
<li><p>Counting <em>fixes</em> needs to be customized to the conventions used in the project at hand</p></li>
</ul>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>Before you venture out building your own development analytics, you may want to check out what’s already there and available. This <a class="reference external" href="https://livablesoftware.com/tools-mine-analyze-github-git-software-data/">overview at Livable Software</a> gives a great overview of platforms and tools for mining development data. One of the most ambitious ones is <a class="reference external" href="https://chaoss.github.io/grimoirelab/">GrimoireLab</a>, set to mine data from pretty much <em>any</em> open source repository.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<section id="exercise-1-fine-grained-fixes">
<h3>Exercise 1: Fine-Grained Fixes<a class="headerlink" href="#exercise-1-fine-grained-fixes" title="Link to this heading">#</a></h3>
<p>Construct a class <code class="docutils literal notranslate"><span class="pre">FineFixCounter</span></code> that combines fine-grained counting from <code class="docutils literal notranslate"><span class="pre">FineChangeCounter</span></code> with the fix-counting abilities from <code class="docutils literal notranslate"><span class="pre">FixCounter</span></code>. Visualize the treemap.</p>
<p><strong>Solution.</strong> We can use multiple inheritance to combine both. We inherit from <code class="docutils literal notranslate"><span class="pre">FixCounter</span></code> first such that we can see the fix messages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FineFixCounter</span><span class="p">(</span><span class="n">FixCounter</span><span class="p">,</span> <span class="n">FineChangeCounter</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>Try things out for yourself:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fine_fix_counter = debuggingbook_change_counter(FineFixCounter, start_date=datetime(1999, 1, 1))</span>
<span class="c1"># fine_fix_counter.map()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Tracking.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tracking Bugs</p>
      </div>
    </a>
    <a class="right-next"
       href="ExpectError.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Error Handling</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mining-change-histories">Mining Change Histories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mining-with-pydriller">Mining with PyDriller</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-changes">Counting Changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-past-changes">Visualizing Past Changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-past-fixes">Counting Past Fixes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-fine-grained-changes">Counting Fine-Grained Changes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapping-elements-to-locations">Mapping Elements to Locations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-changed-elements">Determining Changed Elements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-it-all-together">Putting it all Together</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-fine-grained-fixes">Exercise 1: Fine-Grained Fixes</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andreas Zeller
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
  Copyright &copy; 2021–2025 <a href="https://www.cispa.de/">CISPA Helmholtz Center for Information Security</a>.
  The <strong>content</strong> of this project is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  The <strong>source code</strong> that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/debuggingbook/blob/master/LICENSE.md#mit-license">MIT License</a>.
  <br>
  <a href="https://cispa.de/en/impressum">Imprint</a> &middot; <a href="/html/index.html#how-do-i-cite-your-work">Cite</a>
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>