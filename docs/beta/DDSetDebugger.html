
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Generalizing Failure Circumstances &#8212; The Debugging Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=d5c2cecb" />
    <link rel="stylesheet" type="text/css" href="_static/mastodon-timeline.css?v=f82c2b23" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'DDSetDebugger';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Learning from Failures" href="Alhazen.html" />
    <link rel="prev" title="Mining Function Specifications" href="DynamicInvariants.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p>This is a beta version of debuggingbook.org, currently in development. See the <a href="https://debuggingbook.org/classic/"  style="color:white!important;">classic site</a> for the 2024 version.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/debuggingbook.png" class="logo__image only-light" alt="The Debugging Book - Home"/>
    <script>document.write(`<img src="_static/debuggingbook.png" class="logo__image only-dark" alt="The Debugging Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    The Debugging Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tours.html">Sitemap</a></li>
<li class="toctree-l1"><a class="reference internal" href="Intro_Debugging.html">Introduction to Debugging</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Observing Executions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracer.html">Tracing Executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Debugger.html">How Debuggers Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="Assertions.html">Asserting Expectations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Flows and Dependencies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Slicer.html">Tracking Failure Origins</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reducing Failure Causes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="DeltaDebugger.html">Reducing Failure-Inducing Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeDebugger.html">Isolating Failure-Inducing Changes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Abstracting Failures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="StatisticalDebugger.html">Statistical Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicInvariants.html">Mining Function Specifications</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Generalizing Failure Circumstances</a></li>
<li class="toctree-l1"><a class="reference internal" href="Alhazen.html">Learning from Failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="PerformanceDebugger.html">Debugging Performance Issues</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Automatic Repair</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Repairer.html">Repairing Code Automatically</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Debugging in the Large</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracking.html">Tracking Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeCounter.html">Where the Bugs are</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ExpectError.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timer.html">Timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timeout.html">Timeout</a></li>
<li class="toctree-l1"><a class="reference internal" href="ClassDiagram.html">Class Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="StackInspector.html">Inspecting Call Stacks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About This Book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ReleaseNotes.html">Release Notes for The Debugging Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importing.html">Downloads and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Guide_for_Authors.html">Guide for Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uds-se/debuggingbook/master?urlpath=tree/docs/notebooks/DDSetDebugger.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook/issues/new?title=Issue%20on%20page%20%2FDDSetDebugger.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
    <li><a href="../code/DDSetDebugger.py" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="Download Python code"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">.py</span>
    </a>
    </li>
    
      
      
      
      <li><a href="_sources/DDSetDebugger.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download notebook"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  
    <li><a href="Importing.html" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="All downloads"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">All downloads</span>
    </a>
    </li>
    </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Generalizing Failure Circumstances</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-failing-program">A Failing Program</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grammars">Grammars</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#derivation-trees">Derivation Trees</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parsing">Parsing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutating-the-tree">Mutating the Tree</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#referencing-subtrees">Referencing Subtrees</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-subtrees">Creating new Subtrees</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Mutating the Tree</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generalizing-trees">Generalizing Trees</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-generalization">Testing for Generalization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generalizable-paths">Generalizable Paths</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fuzzing-with-patterns">Fuzzing with Patterns</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-it-all-together">Putting it all Together</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructor">Constructor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generalizing-arguments">Generalizing Arguments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fuzzing">Fuzzing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-examples">More Examples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#square-root">Square Root</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#middle">Middle</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-generalization-and-specialization">Exercise 1: Generalization and Specialization</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="generalizing-failure-circumstances">
<h1>Generalizing Failure Circumstances<a class="headerlink" href="#generalizing-failure-circumstances" title="Link to this heading">#</a></h1>
<p>One central question in debugging is: <em>Does this bug occur in other situations, too?</em> In this chapter, we present a technique that is set to <em>generalize</em> the circumstances under which a failure occurs. The DDSET algorithm takes a failure-inducing input, breaks it into individual elements. For each element, it tries to find whether it can be replaced by others in the same category, and if so, it <em>generalizes</em> the concrete element to the very category. The result is a <em>pattern</em> that characterizes the failure condition: “The failure occurs for all inputs of the form <code class="docutils literal notranslate"><span class="pre">(&lt;expr&gt;</span> <span class="pre">*</span> <span class="pre">&lt;expr&gt;)</span></code>”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;PV22XtIQU1s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="640"
            height="360"
            src="https://www.youtube-nocookie.com/embed/PV22XtIQU1s"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p>You should have read the <a class="reference internal" href="DeltaDebugger.html"><span class="std std-doc">chapter on <em>delta debugging</em></span></a>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bookutils.setup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">DeltaDebugger</span>
</pre></div>
</div>
</div>
</div>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Link to this heading">#</a></h2>
<p>To <a class="reference internal" href="Importing.html"><span class="std std-doc">use the code provided in this chapter</span></a>, write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">debuggingbook.DDSetDebugger</span><span class="w"> </span><span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and then make use of the following features.</p>
<p><strong>Note</strong>: The examples in this section only work after the rest of the cells have been executed.</p>
<p>This chapter provides a class <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code>, implementing the DDSET algorithm for generalizing failure-inducing inputs. The <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code> is used as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DDSetDebugger</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">function</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">function(args...)</span></code> is a failing function call (= raises an execption) that takes at least one string argument; <code class="docutils literal notranslate"><span class="pre">grammar</span></code> is an <a class="reference external" href="https://www.fuzzingbook.org/html/Grammars.html">input grammar in fuzzingbook format</a> that matches the format of this argument.</p>
<p>The result is a call of <code class="docutils literal notranslate"><span class="pre">function()</span></code> with an <em>abstract failure-inducing input</em> – a variant of the conrete input in which parts are replaced by placeholders in the form <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> is a nonterminal in the grammar. The failure has been verified to occur for a number of instantiations of <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code>.</p>
<p>Here is an example of how <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code> works. The concrete failing input <code class="docutils literal notranslate"><span class="pre">&lt;foo&gt;&quot;bar&lt;/foo&gt;</span></code> is generalized to an <em>abstract failure-inducing input</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DDSetDebugger</span><span class="p">(</span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;foo&gt;&quot;bar&lt;/foo&gt;&#39;</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>remove_html_markup(s=&#39;&lt;lt&gt;&lt;id&gt;&lt;gt&gt;&quot;&lt;plain-text&gt;&lt;closing-tag&gt;&#39;)
</pre></div>
</div>
</div>
</div>
<p>The abstract input tells us that the failure occurs for whatever opening and closing HTML tags as long as there is a double quote between them.</p>
<p>A programmatic interface is available as well. <code class="docutils literal notranslate"><span class="pre">generalize()</span></code> returns a mapping of argument names to (generalized) values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">generalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;s&#39;: &#39;&lt;lt&gt;&lt;id&gt;&lt;gt&gt;&quot;&lt;plain-text&gt;&lt;closing-tag&gt;&#39;}
</pre></div>
</div>
</div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">fuzz()</span></code>, the abstract input can be instantiated to further concrete inputs, all set to produce the failure again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>remove_html_markup(s=&#39;&lt;s1d&gt;&quot;1&lt;/hF&gt;&#39;)
remove_html_markup(s=&#39;&lt;H&gt;&quot;c*C&lt;/l&gt;&#39;)
remove_html_markup(s=&#39;&lt;Ah2&gt;&quot;&lt;/v&gt;&#39;)
remove_html_markup(s=&#39;&lt;a7&gt;&quot;)&lt;/NP&gt;&#39;)
remove_html_markup(s=&#39;&lt;boyIIt640TF&gt;&quot;&lt;/b08&gt;&#39;)
remove_html_markup(s=&#39;&lt;dF&gt;&quot;&lt;/fay&gt;&#39;)
remove_html_markup(s=&#39;&lt;l2&gt;&quot;\t7&lt;/z&gt;&#39;)
remove_html_markup(s=&#39;&lt;ci&gt;&quot;&lt;/t&gt;&#39;)
remove_html_markup(s=&#39;&lt;J&gt;&quot;2&lt;/t&gt;&#39;)
remove_html_markup(s=&#39;&lt;Fo9g&gt;&quot;\r~\t\r&lt;/D&gt;&#39;)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code> can be customized by passing a subclass of <code class="docutils literal notranslate"><span class="pre">TreeGeneralizer</span></code>, which does the gist of the work; for details, see its constructor.
The full class hierarchy is shown below.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 14.0.2 (20251019.1705)
 -->
<!-- Pages: 1 -->
<svg width="451pt" height="387pt"
 viewBox="0.00 0.00 451.00 387.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 382.75)">
<g id="a_graph0"><a xlink:title="DDSetDebugger class hierarchy">
<polygon fill="white" stroke="none" points="-4,4 -4,-382.75 446.62,-382.75 446.62,4 -4,4"/>
</a>
</g>
<!-- DDSetDebugger -->
<g id="node1" class="node">
<title>DDSetDebugger</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class DDSetDebugger:&#10;Debugger implementing the DDSET algorithm for abstracting failure&#45;inducing inputs.">
<polygon fill="none" stroke="black" points="20.62,-19.62 20.62,-116.62 145.38,-116.62 145.38,-19.62 20.62,-19.62"/>
<text xml:space="preserve" text-anchor="start" x="28.62" y="-100.33" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">DDSetDebugger</text>
<polyline fill="none" stroke="black" points="20.62,-91.38 145.38,-91.38"/>
<g id="a_node1_0"><a xlink:href="#" xlink:title="DDSetDebugger">
<g id="a_node1_1"><a xlink:href="#" xlink:title="__init__(self, grammar: Dict[str, List[Union[str, Tuple[str, Dict[str, Any]]]]], generalizer_class: Type = &lt;class &#39;TreeGeneralizer&#39;&gt;, parser: Optional[fuzzingbook.Parser.Parser] = None, **kwargs: Any) &#45;&gt; None:&#10;Constructor.&#10;`grammar` is an input grammar in fuzzingbook format.&#10;`generalizer_class` is the tree generalizer class to use&#10;(default: `TreeGeneralizer`)&#10;`parser` is the parser to use (default: `EarleyParser(grammar)`).&#10;All other keyword args are passed to the tree generalizer, notably:&#10;`fuzzer` &#45; the fuzzer to use (default: `GrammarFuzzer`), and&#10;`log` &#45; enables debugging output if True.">
<text xml:space="preserve" text-anchor="start" x="47" y="-78.88" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node1_2"><a xlink:href="#" xlink:title="__repr__(self) &#45;&gt; str:&#10;Return a string representation of the generalized call.">
<text xml:space="preserve" text-anchor="start" x="47" y="-66.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__repr__()</text>
</a>
</g>
<g id="a_node1_3"><a xlink:href="#" xlink:title="fuzz(self) &#45;&gt; str:&#10;Return a call with arguments randomly instantiated&#10;from the abstract failure&#45;inducing pattern.">
<text xml:space="preserve" text-anchor="start" x="47" y="-53.38" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">fuzz()</text>
</a>
</g>
<g id="a_node1_4"><a xlink:href="#" xlink:title="fuzz_args(self) &#45;&gt; Dict[str, Any]:&#10;Return arguments randomly instantiated&#10;from the abstract failure&#45;inducing pattern.">
<text xml:space="preserve" text-anchor="start" x="47" y="-40.62" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">fuzz_args()</text>
</a>
</g>
<g id="a_node1_5"><a xlink:href="#" xlink:title="generalize(self) &#45;&gt; Dict[str, Any]:&#10;Generalize arguments seen. For each function argument,&#10;produce an abstract failure&#45;inducing input that characterizes&#10;the set of inputs for which the function fails.">
<text xml:space="preserve" text-anchor="start" x="47" y="-27.88" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">generalize()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CallCollector -->
<g id="node2" class="node">
<title>CallCollector</title>
<g id="a_node2"><a xlink:href="DeltaDebugger.ipynb" xlink:title="class CallCollector:&#10;Collect an exception&#45;raising function call f().&#10;Use as `with CallCollector(): f()`">
<polygon fill="none" stroke="black" points="30.38,-172.75 30.38,-295.25 135.62,-295.25 135.62,-172.75 30.38,-172.75"/>
<text xml:space="preserve" text-anchor="start" x="38.38" y="-278.95" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">CallCollector</text>
<polyline fill="none" stroke="black" points="30.38,-270 135.62,-270"/>
<g id="a_node2_6"><a xlink:href="#" xlink:title="CallCollector">
<g id="a_node2_7"><a xlink:href="DeltaDebugger.ipynb" xlink:title="__enter__(self) &#45;&gt; Any:&#10;Called at begin of `with` block. Turn tracing on.">
<text xml:space="preserve" text-anchor="start" x="50" y="-257.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__enter__()</text>
</a>
</g>
<g id="a_node2_8"><a xlink:href="DeltaDebugger.ipynb" xlink:title="__exit__(self, exc_tp: Type, exc_value: BaseException, exc_traceback: traceback) &#45;&gt; Optional[bool]:&#10;Called at end of `with` block. Turn tracing off.">
<text xml:space="preserve" text-anchor="start" x="50" y="-244.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__exit__()</text>
</a>
</g>
<g id="a_node2_9"><a xlink:href="DeltaDebugger.ipynb" xlink:title="__init__(self) &#45;&gt; None:&#10;Initialize collector">
<text xml:space="preserve" text-anchor="start" x="50" y="-232" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node2_10"><a xlink:href="DeltaDebugger.ipynb" xlink:title="args(self) &#45;&gt; Dict[str, Any]:&#10;Return the dictionary of collected arguments.">
<text xml:space="preserve" text-anchor="start" x="50" y="-219.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">args()</text>
</a>
</g>
<g id="a_node2_11"><a xlink:href="DeltaDebugger.ipynb" xlink:title="call(self, new_args: Optional[Dict[str, Any]] = None) &#45;&gt; Any:&#10;Call collected function. If `new_args` is given,&#10;override arguments from its {var: value} entries.">
<text xml:space="preserve" text-anchor="start" x="50" y="-206.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">call()</text>
</a>
</g>
<g id="a_node2_12"><a xlink:href="DeltaDebugger.ipynb" xlink:title="exception(self) &#45;&gt; Optional[BaseException]:&#10;Return the exception produced, or `None` if none.">
<text xml:space="preserve" text-anchor="start" x="50" y="-193.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">exception()</text>
</a>
</g>
<g id="a_node2_13"><a xlink:href="DeltaDebugger.ipynb" xlink:title="function(self) &#45;&gt; Callable:&#10;Return the function called.">
<text xml:space="preserve" text-anchor="start" x="50" y="-181" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">function()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- DDSetDebugger&#45;&gt;CallCollector -->
<g id="edge1" class="edge">
<title>DDSetDebugger&#45;&gt;CallCollector</title>
<path fill="none" stroke="black" d="M83,-116.96C83,-130.74 83,-146.08 83,-160.98"/>
<polygon fill="none" stroke="black" points="79.5,-160.74 83,-170.74 86.5,-160.74 79.5,-160.74"/>
</g>
<!-- StackInspector -->
<g id="node3" class="node">
<title>StackInspector</title>
<g id="a_node3"><a xlink:href="StackInspector.ipynb" xlink:title="class StackInspector:&#10;Provide functions to inspect the stack">
<polygon fill="none" stroke="black" points="0,-332.25 0,-378.25 166,-378.25 166,-332.25 0,-332.25"/>
<text xml:space="preserve" text-anchor="start" x="32.75" y="-361.95" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">StackInspector</text>
<polyline fill="none" stroke="black" points="0,-353 166,-353"/>
<g id="a_node3_14"><a xlink:href="#" xlink:title="StackInspector">
<g id="a_node3_15"><a xlink:href="StackInspector.ipynb" xlink:title="_generated_function_cache = {}">
<text xml:space="preserve" text-anchor="start" x="8" y="-339.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">_generated_function_cache</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CallCollector&#45;&gt;StackInspector -->
<g id="edge2" class="edge">
<title>CallCollector&#45;&gt;StackInspector</title>
<path fill="none" stroke="black" d="M83,-295.67C83,-304.31 83,-312.91 83,-320.77"/>
<polygon fill="none" stroke="black" points="79.5,-320.5 83,-330.5 86.5,-320.5 79.5,-320.5"/>
</g>
<!-- TreeGeneralizer -->
<g id="node4" class="node">
<title>TreeGeneralizer</title>
<g id="a_node4"><a xlink:href="#" xlink:title="class TreeGeneralizer:&#10;Determine which parts of a derivation tree can be generalized.">
<polygon fill="none" stroke="black" points="163,-0.5 163,-135.75 305,-135.75 305,-0.5 163,-0.5"/>
<text xml:space="preserve" text-anchor="start" x="180.38" y="-119.45" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">TreeGeneralizer</text>
<polyline fill="none" stroke="black" points="163,-110.5 305,-110.5"/>
<g id="a_node4_16"><a xlink:href="#" xlink:title="TreeGeneralizer">
<g id="a_node4_17"><a xlink:href="#" xlink:title="__init__(self, grammar: Dict[str, List[Union[str, Tuple[str, Dict[str, Any]]]]], tree: Tuple[str, Optional[List[Any]]], test: Callable, max_tries_for_generalization: int = 10, **kwargs: Any) &#45;&gt; None:&#10;Constructor. `grammar` and `tree` are as in `TreeMutator`.&#10;`test` is a function taking a string that either&#10;* raises an exception, indicating test failure;&#10;* or not, indicating test success.&#10;`max_tries_for_generalization` is the number of times&#10;an instantiation has to fail before it is generalized.">
<text xml:space="preserve" text-anchor="start" x="171" y="-98" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node4_18"><a xlink:href="#" xlink:title="can_generalize(self, path: List[int], tree: Optional[Tuple[str, Optional[List[Any]]]] = None) &#45;&gt; bool:&#10;Return True if the subtree at `path` can be generalized.">
<text xml:space="preserve" text-anchor="start" x="171" y="-84.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">can_generalize()</text>
</a>
</g>
<g id="a_node4_19"><a xlink:href="#" xlink:title="find_paths(self, predicate: Callable[[List[int], Tuple[str, Optional[List[Any]]]], bool], path: Optional[List[int]] = None, tree: Optional[Tuple[str, Optional[List[Any]]]] = None) &#45;&gt; List[List[int]]:&#10;Return a list of all paths for which `predicate` holds.&#10;`predicate` is a function `predicate`(`path`, `tree`), where&#10;`path` denotes a subtree in `tree`. If `predicate()` returns&#10;True, `path` is included in the returned list.">
<text xml:space="preserve" text-anchor="start" x="171" y="-71.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">find_paths()</text>
</a>
</g>
<g id="a_node4_20"><a xlink:href="#" xlink:title="fuzz_tree(self, tree: Tuple[str, Optional[List[Any]]]) &#45;&gt; Tuple[str, Optional[List[Any]]]:&#10;Return an instantiated copy of `tree`.">
<text xml:space="preserve" text-anchor="start" x="171" y="-58.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">fuzz_tree()</text>
</a>
</g>
<g id="a_node4_21"><a xlink:href="#" xlink:title="generalizable_paths(self) &#45;&gt; List[List[int]]:&#10;Return a list of all paths whose subtrees can be generalized.">
<text xml:space="preserve" text-anchor="start" x="171" y="-46" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">generalizable_paths()</text>
</a>
</g>
<g id="a_node4_22"><a xlink:href="#" xlink:title="generalize(self) &#45;&gt; Tuple[str, Optional[List[Any]]]:&#10;Returns a copy of the tree in which all generalizable subtrees&#10;are generalized (= replaced by nonterminals without children)">
<text xml:space="preserve" text-anchor="start" x="171" y="-33.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">generalize()</text>
</a>
</g>
<g id="a_node4_23"><a xlink:href="#" xlink:title="generalize_path(self, path: List[int], tree: Optional[Tuple[str, Optional[List[Any]]]] = None) &#45;&gt; Tuple[str, Optional[List[Any]]]:&#10;Return a copy of the tree in which the subtree at `path`&#10;is generalized (= replaced by a nonterminal without children)">
<text xml:space="preserve" text-anchor="start" x="171" y="-20.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">generalize_path()</text>
</a>
</g>
<g id="a_node4_24"><a xlink:href="#" xlink:title="test_tree(self, tree: Tuple[str, Optional[List[Any]]]) &#45;&gt; bool:&#10;Return True if testing `tree` passes, else False">
<text xml:space="preserve" text-anchor="start" x="171" y="-7.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">test_tree()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- TreeMutator -->
<g id="node5" class="node">
<title>TreeMutator</title>
<g id="a_node5"><a xlink:href="#" xlink:title="class TreeMutator:&#10;Grammar&#45;based mutations of derivation trees.">
<polygon fill="none" stroke="black" points="184.38,-191.88 184.38,-276.12 283.62,-276.12 283.62,-191.88 184.38,-191.88"/>
<text xml:space="preserve" text-anchor="start" x="192.38" y="-259.82" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">TreeMutator</text>
<polyline fill="none" stroke="black" points="184.38,-250.88 283.62,-250.88"/>
<g id="a_node5_25"><a xlink:href="#" xlink:title="TreeMutator">
<g id="a_node5_26"><a xlink:href="#" xlink:title="__init__(self, grammar: Dict[str, List[Union[str, Tuple[str, Dict[str, Any]]]]], tree: Tuple[str, Optional[List[Any]]], fuzzer: Optional[fuzzingbook.GrammarFuzzer.GrammarFuzzer] = None, log: Union[bool, int] = False):&#10;Constructor.&#10;`grammar` is the underlying grammar;&#10;`tree` is the tree to work on.&#10;`fuzzer` is the grammar fuzzer to use (default: `GrammarFuzzer`)">
<text xml:space="preserve" text-anchor="start" x="195" y="-238.38" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node5_27"><a xlink:href="#" xlink:title="get_subtree(self, path: List[int], tree: Optional[Tuple[str, Optional[List[Any]]]] = None) &#45;&gt; Tuple[str, Optional[List[Any]]]:&#10;Access a subtree based on `path` (a list of children numbers)">
<text xml:space="preserve" text-anchor="start" x="195" y="-224.62" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">get_subtree()</text>
</a>
</g>
<g id="a_node5_28"><a xlink:href="#" xlink:title="mutate(self, path: List[int], tree: Optional[Tuple[str, Optional[List[Any]]]] = None) &#45;&gt; Tuple[str, Optional[List[Any]]]:&#10;Return a new tree mutated at `path`">
<text xml:space="preserve" text-anchor="start" x="195" y="-211.88" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">mutate()</text>
</a>
</g>
<g id="a_node5_29"><a xlink:href="#" xlink:title="new_tree(self, start_symbol: str) &#45;&gt; Tuple[str, Optional[List[Any]]]:&#10;Create a new subtree for &lt;start_symbol&gt;.">
<text xml:space="preserve" text-anchor="start" x="195" y="-199.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">new_tree()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- TreeGeneralizer&#45;&gt;TreeMutator -->
<g id="edge3" class="edge">
<title>TreeGeneralizer&#45;&gt;TreeMutator</title>
<path fill="none" stroke="black" d="M234,-135.78C234,-150.74 234,-166.41 234,-180.69"/>
<polygon fill="none" stroke="black" points="230.5,-180.29 234,-190.29 237.5,-180.29 230.5,-180.29"/>
</g>
<!-- Legend -->
<g id="node6" class="node">
<title>Legend</title>
<text xml:space="preserve" text-anchor="start" x="323.38" y="-84.12" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="10.00" fill="#6a0dad">Legend</text>
<text xml:space="preserve" text-anchor="start" x="323.38" y="-74.12" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="329.38" y="-74.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00">public_method()</text>
<text xml:space="preserve" text-anchor="start" x="323.38" y="-64.12" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="329.38" y="-64.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00">private_method()</text>
<text xml:space="preserve" text-anchor="start" x="323.38" y="-54.12" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="329.38" y="-54.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00">overloaded_method()</text>
<text xml:space="preserve" text-anchor="start" x="323.38" y="-45.08" font-family="Helvetica,sans-Serif" font-size="9.00">Hover over names to see doc</text>
</g>
</g>
</svg>
</div></div>
</div>
</section>
<section id="a-failing-program">
<h2>A Failing Program<a class="headerlink" href="#a-failing-program" title="Link to this heading">#</a></h2>
<p>As with previous chapters, we use <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> as our ongoing example. This function is set to remove HTML markup tags (like <code class="docutils literal notranslate"><span class="pre">&lt;em&gt;</span></code>) from a given string <code class="docutils literal notranslate"><span class="pre">s</span></code>, returning the plain text only. We use the version from <a class="reference internal" href="Assertions.html"><span class="std std-doc">the chapter on asssertions</span></a>, using an assertion as postcondition checker.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="c1"># postcondition</span>
    <span class="k">assert</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span> <span class="ow">and</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>For the most inputs, <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> works just as expected:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;Be &lt;em&gt;quiet&lt;/em&gt;, he said&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Be quiet, he said&#39;
</pre></div>
</div>
</div>
</div>
<p>There are inputs, however, for which it fails:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BAD_INPUT</span> <span class="o">=</span> <span class="s1">&#39;&lt;foo&gt;&quot;bar&lt;/foo&gt;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ExpectError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExpectError</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="n">BAD_INPUT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_52206/3787550988.py&quot;, line 2, in &lt;module&gt;
    remove_html_markup(BAD_INPUT)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_52206/2717035104.py&quot;, line 17, in remove_html_markup
    assert &#39;&lt;&#39; not in out and &#39;&gt;&#39; not in out
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">quiz</span>
</pre></div>
</div>
</div>
</div>
<p>In contrast to the other chapters, our aim now is not to immediately go and debug <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>. Instead, we focus on another important question:</p>
<blockquote>
<div><p>Under which conditions precisely does <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> fail?</p>
</div></blockquote>
<p>This question can be generalized to</p>
<blockquote>
<div><p>What is the set of inputs for which <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> fails?</p>
</div></blockquote>
<p>Our plan for this is to <em>generalize</em> concrete inputs (such as <code class="docutils literal notranslate"><span class="pre">BAD_INPUTS</span></code>) into an <em>abstract failure-inducing inputs</em>. These are patterns formed from a concrete input, but in which specific <em>placeholders</em> indicate sets of inputs that are permitted. In the abstract failure-inducing input</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">opening-tag</span><span class="p">&gt;</span>&quot;bar<span class="p">&lt;</span><span class="nt">closing-tag</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>for instance, <code class="docutils literal notranslate"><span class="pre">&lt;opening-tag&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;closing-tag&gt;</span></code> are placeholders for opening and closing HTML tags, respectively. The pattern indicates that any opening HTML tag and closing HTML tag can be present in the input, as long as the enclosed text reads <code class="docutils literal notranslate"><span class="pre">&quot;bar</span></code>.</p>
<p>Given a concrete failure-inducing input, our aim is to <em>generalize</em> it as much as possible to such an abstract failure-inducing input. The resulting pattern should then</p>
<ul class="simple">
<li><p>capture the <em>circumstances</em> under which the program fails;</p></li>
<li><p>allow for <em>test generation</em> by instantiating the placeholders;</p></li>
<li><p>help ensuring our fix is as <em>general as possible</em>.</p></li>
</ul>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">If <code>s = '&lt;foo&gt;"bar&lt;/foo&gt;'</code> (i.e., <code>BAD_INPUT</code>), what is the value of <code>out</code> such that the assertion fails?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="0121fd4c-b294-11f0-8772-6298cf1a5790" id="0121fd4c-b294-11f0-8772-6298cf1a5790-1" onclick="clear_selection('0121fd4c-b294-11f0-8772-6298cf1a5790')">
        <label id="0121fd4c-b294-11f0-8772-6298cf1a5790-1-label" for="0121fd4c-b294-11f0-8772-6298cf1a5790-1"><code>bar</code></label><br>
    
        <input type="radio" name="0121fd4c-b294-11f0-8772-6298cf1a5790" id="0121fd4c-b294-11f0-8772-6298cf1a5790-2" onclick="clear_selection('0121fd4c-b294-11f0-8772-6298cf1a5790')">
        <label id="0121fd4c-b294-11f0-8772-6298cf1a5790-2-label" for="0121fd4c-b294-11f0-8772-6298cf1a5790-2"><code>bar&lt;/foo&gt;</code></label><br>
    
        <input type="radio" name="0121fd4c-b294-11f0-8772-6298cf1a5790" id="0121fd4c-b294-11f0-8772-6298cf1a5790-3" onclick="clear_selection('0121fd4c-b294-11f0-8772-6298cf1a5790')">
        <label id="0121fd4c-b294-11f0-8772-6298cf1a5790-3-label" for="0121fd4c-b294-11f0-8772-6298cf1a5790-3"><code>"bar&lt;/foo&gt;</code></label><br>
    
        <input type="radio" name="0121fd4c-b294-11f0-8772-6298cf1a5790" id="0121fd4c-b294-11f0-8772-6298cf1a5790-4" onclick="clear_selection('0121fd4c-b294-11f0-8772-6298cf1a5790')">
        <label id="0121fd4c-b294-11f0-8772-6298cf1a5790-4-label" for="0121fd4c-b294-11f0-8772-6298cf1a5790-4"><code>&lt;foo&gt;"bar&lt;/foo&gt;</code></label><br>
    
    </div>
    </p>
    <input id="0121fd4c-b294-11f0-8772-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('0121fd4c-b294-11f0-8772-6298cf1a5790', 4, 0, '9999999 // 4999999')">
    <span class="quiz_hint" id="0121fd4c-b294-11f0-8772-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
</section>
<section id="grammars">
<h2>Grammars<a class="headerlink" href="#grammars" title="Link to this heading">#</a></h2>
<p>To determine abstract failure-inducing inputs, we need means to determine and characterize <em>sets of inputs</em> – known in computer science as <em>languages</em>. To formally describe languages, the field of <em>formal languages</em> has devised a number of <em>language specifications</em> that describe a language.  <em>Regular expressions</em> represent the simplest class of these languages to denote sets of strings: The regular expression <code class="docutils literal notranslate"><span class="pre">[a-z]*</span></code>, for instance, denotes a (possibly empty) sequence of lowercase letters.  <em>Automata theory</em> connects these languages to automata that accept these inputs; <em>finite state machines</em>, for instance, can be used to specify the language of regular expressions.</p>
<p>Regular expressions are great for not-too-complex input formats, and the associated finite state machines have many properties that make them great for reasoning.  To specify more complex inputs, though, they quickly encounter limitations.  At the other end of the language spectrum, we have <em>universal grammars</em> that denote the language accepted by <em>Turing machines</em>.  A Turing machine can compute anything that can be computed; and with Python being Turing-complete, this means that we can also use a Python program <span class="math notranslate nohighlight">\(p\)</span> to specify or even enumerate legal inputs. But then, computer science theory also tells us that each such program has to be written specifically for the input to be considered, which is not the level of automation we want.</p>
<p>The middle ground between regular expressions and Turing machines is covered by <em>grammars</em>.  Grammars are among the most popular (and best understood) formalisms to formally specify input languages.  Using a grammar, one can express a wide range of the properties of an input language.  Grammars are particularly great for expressing the <em>syntactical structure</em> of an input, and are the formalism of choice to express nested or recursive inputs.  The grammars we use are so-called <em>context-free grammars</em>, one of the easiest and most popular grammar formalisms.</p>
<p>A grammar is defined as a mapping of <em>nonterminal</em> symbols (denoted in <code class="docutils literal notranslate"><span class="pre">&lt;angle</span> <span class="pre">brackets&gt;</span></code>) to lists of alternative <em>expansions</em>, which are strings containing <em>terminal</em> symbols and possibly more <em>nonterminal</em> symbols. To make the writing of grammars as simple as possible, we adopt the <a class="reference external" href="https://www.fuzzingbook.org/">fuzzingbook</a> format that is based on strings and lists.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">fuzzingbook</span>
</pre></div>
</div>
</div>
</div>
<p>Fuzzingbook grammars take the format of a <em>mapping</em> between symbol names and expansions, where expansions are <em>lists</em> of alternatives.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Grammar</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span>  <span class="c1"># A grammar maps strings...</span>
               <span class="n">List</span><span class="p">[</span>
                   <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span>  <span class="c1"># to list of strings...</span>
                         <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>  <span class="c1"># or to pairs of strings and attributes.</span>
                        <span class="p">]</span>
               <span class="p">]</span>
              <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>A one-rule grammar for digits thus takes the form</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DIGIT_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>which means that the <code class="docutils literal notranslate"><span class="pre">&lt;start&gt;</span></code> symbol can be expanded into any of the digits listed.</p>
<p>A full grammar for arithmetic expressions looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EXPR_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;term&gt; + &lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt; - &lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;factor&gt; * &lt;term&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;factor&gt; / &lt;term&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;factor&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;factor&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;+&lt;factor&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;-&lt;factor&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;(&lt;expr&gt;)&quot;</span><span class="p">,</span>
         <span class="s2">&quot;&lt;integer&gt;.&lt;integer&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&lt;integer&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>From such a grammar, one can easily generate inputs that conform to the grammar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">fuzzingbook.GrammarFuzzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">GrammarFuzzer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_expr_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">fuzz_expr</span> <span class="o">=</span> <span class="n">simple_expr_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fuzz_expr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.8 + --62.912 - ++4 - +5 * 3.0 * 4
7 * (75.5 - -6 + 5 - 4) + -(8 - 1) / 5 * 2
(-(9) * +6 + 9 / 3 * 8 - 9 * 8 / 7) / -+-65
(9 + 8) * 2 * (6 + 6 + 9) * 0 * 1.9 * 0
(1 * 7 - 9 + 5) * 5 / 0 * 5 + 7 * 5 * 7
-(6 / 9 - 5 - 3 - 1) - -1 / +1 + (9) / (8) * 6
(+-(0 - (1) * 7 / 3)) / ((1 * 3 + 8) + 9 - +1 / --0) - 5 * (-+939.491)
+2.9 * 0 / 501.19814 / --+--(6.05002)
+-8.8 / (1) * -+1 + -8 + 9 - 3 / 8 * 6 + 4 * 3 * 5
(+(8 / 9 - 1 - 7)) + ---06.30 / +4.39
</pre></div>
</div>
</div>
</div>
<p>Nonterminals as found in the grammar make natural <em>placeholders</em> in abstract failure-inducing inputs. If we know, for instance, that it is not just the concrete failure-inducing input</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>but the abstract failure-inducing input</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>(<span class="p">&lt;</span><span class="nt">expr</span><span class="p">&gt;</span> * <span class="p">&lt;</span><span class="nt">expr</span><span class="p">&gt;</span>)
</pre></div>
</div>
<p>that causes the failure, we immediately see that the error is due to the multiplication operator rather than its operands.</p>
<p>Coming back to our <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> example, let us create a simple grammar for HTML expressions. A <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code> element is either plain text or tagged text.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;plain-text&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;tagged-text&gt;&quot;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Plain text is a simple (possibly empty) sequence of letter, digits, punctuation, and whitespace. (Note how <code class="docutils literal notranslate"><span class="pre">&lt;plain-text&gt;</span></code> is either empty or some character followed by more plain text.) The characters <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> are not allowed, though.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s2">&quot;&lt;plain-text&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;plain-char&gt;&lt;plain-text&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;plain-char&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;letter&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;other&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;whitespace&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;letter&gt;&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">),</span>
    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">),</span>
    <span class="s2">&quot;&lt;other&gt;&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
    <span class="s2">&quot;&lt;whitespace&gt;&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">whitespace</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Tagged text is a bit more complicated. We have opening tags <code class="docutils literal notranslate"><span class="pre">&lt;foo&gt;</span></code>, followed by some more HTML material, and then closed by a closing tag <code class="docutils literal notranslate"><span class="pre">&lt;/foo&gt;</span></code>. (We do not insist that the two tags match.) A self-closing tag has the form <code class="docutils literal notranslate"><span class="pre">&lt;br/&gt;</span></code>. For compatibility reasons, we also allow just opening tags without closing tags, as in <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s2">&quot;&lt;tagged-text&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;opening-tag&gt;&lt;html&gt;&lt;closing-tag&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;&lt;self-closing-tag&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;&lt;opening-tag&gt;&quot;</span><span class="p">],</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Since the characters <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> are already reserved for denoting nonterminal symbols, we use the special nonterminal symbols <code class="docutils literal notranslate"><span class="pre">&lt;lt&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;gt&gt;</span></code> that expand into <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, respectively,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s2">&quot;&lt;opening-tag&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;lt&gt;&lt;id&gt;&lt;gt&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;&lt;lt&gt;&lt;id&gt;&lt;attrs&gt;&lt;gt&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;lt&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;gt&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;id&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;letter&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;id&gt;&lt;letter&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;id&gt;&lt;digit&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;closing-tag&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;lt&gt;/&lt;id&gt;&lt;gt&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;self-closing-tag&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;lt&gt;&lt;id&gt;&lt;attrs&gt;/&lt;gt&gt;&quot;</span><span class="p">],</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, HTML tags can have attributes, which are enclosed in quotes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s2">&quot;&lt;attrs&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;attr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;attr&gt;&lt;attrs&gt;&quot;</span> <span class="p">],</span>

    <span class="s2">&quot;&lt;attr&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot; &lt;id&gt;=&#39;&lt;plain-text&gt;&#39;&quot;</span><span class="p">,</span>
         <span class="s1">&#39; &lt;id&gt;=&quot;&lt;plain-text&gt;&quot;&#39;</span><span class="p">],</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Again, we can generate inputs from the grammar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_html_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">fuzz_html</span> <span class="o">=</span> <span class="n">simple_html_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">fuzz_html</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;T3 xG=&quot;&quot;&gt;&#39;
&#39;&lt;N9cd U=\&#39;\&#39; y=\&#39;l1\&#39; v0=&quot;&quot; tb4ya=&quot;&quot; UbD=\&#39;\&#39;&gt;9&lt;/R&gt;&#39;
&#39;\x0b&#39;
&#39; ea\\\\&#39;
&#39;&amp;7&#39;
&quot;&lt;c1 o2=&#39;&#39; x9661lQo64T=&#39;&#39;/&gt;&quot;
&#39;&lt;S4&gt;&#39;
&#39;&lt;GMS&gt;&lt;/wAu&gt;&#39;
&#39;&lt;j CI=\&#39;\&#39; T98sJ=&quot;&quot; DR4=\&#39;\&#39;/&gt;&#39;
&#39;&lt;FQc90 Wt=&quot;&quot;/&gt;&#39;
</pre></div>
</div>
</div>
</div>
<p>Such inputs, of course, are great for systematic testing. Our sister book, <a class="reference external" href="https://www.fuzzingbook.org/">the fuzzing book</a>, covers these and more.</p>
</section>
<section id="derivation-trees">
<h2>Derivation Trees<a class="headerlink" href="#derivation-trees" title="Link to this heading">#</a></h2>
<p>To produce inputs from a grammar, the fuzzingbook <code class="docutils literal notranslate"><span class="pre">GrammarFuzzer</span></code> makes use of a structure called a <em>derivation tree</em> (also known as <em>syntax tree</em>). A derivation tree encodes the individual expansion steps undertaken while producing the output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DerivationTree</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span>
</pre></div>
</div>
</div>
</div>
<p>Let us illustrate derivation trees by example, using the last HTML output we produced.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fuzz_html</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;FQc90 Wt=&quot;&quot;/&gt;&#39;
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">GrammarFuzzer</span></code> attribute <code class="docutils literal notranslate"><span class="pre">derivation_tree</span></code> holds the last tree used to produce this input. We can visualize the tree as follows:</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/3c052de10a9c5dac0baf4d2c072775500c5de8bae51e1c98c98858762f2c5290.svg" src="_images/3c052de10a9c5dac0baf4d2c072775500c5de8bae51e1c98c98858762f2c5290.svg" />
</div>
</div>
<p>From top to bottom, we see that the input was constructed from a <code class="docutils literal notranslate"><span class="pre">&lt;start&gt;</span></code> symbol, which then expanded into <code class="docutils literal notranslate"><span class="pre">html</span></code>, which then expanded into HTML text, and so on. Multiple children in a tree stand for a concatenation of individual symbols.</p>
<p>Internally, these trees come as pairs <code class="docutils literal notranslate"><span class="pre">(symbol,</span> <span class="pre">children)</span></code>, where <code class="docutils literal notranslate"><span class="pre">symbol</span></code> is the name of a node (say, <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code>), and <code class="docutils literal notranslate"><span class="pre">children</span></code> is a (possibly empty) list of subtrees. Here are the topmost nodes of the above tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pprint</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">simple_html_fuzzer</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;&lt;start&gt;&#39;, [(&#39;&lt;html&gt;&#39;, [(&#39;&lt;tagged-text&gt;&#39;, [(&#39;&lt;self-closing-tag&gt;&#39;, [...])])])])
</pre></div>
</div>
</div>
</div>
<p>To produce abstract failure-inducing patterns, we will work on this very structure. The idea is to</p>
<ol class="arabic simple">
<li><p>systematically replace subtrees by other, generated, compatible subtrees (e.g. replace one <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code> subtree in the concrete input by some other generated <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code> subtree);</p></li>
<li><p>see whether these subtrees also result in failures; and</p></li>
<li><p>if they do, use the nonterminal (<code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code>) as a placeholder in the pattern.</p></li>
</ol>
<p>This will involve some subtree manipulation, construction, and finally testing. First, though, we need to be able to turn an <em>existing input</em> into a derivation tree.</p>
</section>
<section id="parsing">
<h2>Parsing<a class="headerlink" href="#parsing" title="Link to this heading">#</a></h2>
<p>The activity of creating a structure out of an unstructured input is called <em>parsing</em>. Generally speaking, a <em>parser</em> uses a <em>grammar</em> to create a <em>derivation tree</em> (also called <em>parse tree</em> in parsing contexts) from a string input.</p>
<p>Again, there’s a whole body of theory (and practice!) around constructing parsers. We make our life simple by using an existing parser (again, from <a class="reference external" href="https://www.fuzzingbook.org/Parser.html">the fuzzing book</a>), which does just what we want. The <code class="docutils literal notranslate"><span class="pre">EarleyParser</span></code> is instantiated with a grammar such as <code class="docutils literal notranslate"><span class="pre">SIMPLE_HTML_GRAMMAR</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">fuzzingbook.Parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parser</span><span class="p">,</span> <span class="n">EarleyParser</span>  <span class="c1"># minor dependency</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_html_parser</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Its method <code class="docutils literal notranslate"><span class="pre">parse()</span></code> returns an iterator over multiple possible derivation trees.  (There can be multiple trees because the grammar could be ambiguous). We are only interested in the first such tree. Let us parse <code class="docutils literal notranslate"><span class="pre">BAD_INPUT</span></code> and inspect the resulting ~parse tree~ ~syntax tree~ derivation tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bad_input_tree</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">simple_html_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">BAD_INPUT</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/8d46804d954814cd1eb0b0e091433b99b7df7c595ac830f720943f30d741091d.svg" src="_images/8d46804d954814cd1eb0b0e091433b99b7df7c595ac830f720943f30d741091d.svg" />
</div>
</div>
<p>This derivation tree has the same structure as the one created from our <code class="docutils literal notranslate"><span class="pre">GrammarFuzzer</span></code> above. We see how the <code class="docutils literal notranslate"><span class="pre">&lt;tagged-text&gt;</span></code> is composed of three elements:</p>
<ol class="arabic simple">
<li><p>an<code class="docutils literal notranslate"><span class="pre">&lt;opening-tag&gt;</span></code> (<code class="docutils literal notranslate"><span class="pre">&lt;foo&gt;</span></code>);</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code> element which becomes <code class="docutils literal notranslate"><span class="pre">&lt;plain-text&gt;</span></code> (<code class="docutils literal notranslate"><span class="pre">&quot;bar</span></code>); and</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">&lt;closing-tag&gt;</span></code> (<code class="docutils literal notranslate"><span class="pre">&lt;/foo&gt;</span></code>).</p></li>
</ol>
<p>We can easily turn the tree back into a string. The method <code class="docutils literal notranslate"><span class="pre">tree_to_string()</span></code> traverses the tree left-to-right and joins all nonterminal symbols.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">fuzzingbook.GrammarFuzzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">tree_to_string</span><span class="p">,</span> <span class="n">all_terminals</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_to_string</span><span class="p">(</span><span class="n">bad_input_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;foo&gt;&quot;bar&lt;/foo&gt;&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tree_to_string</span><span class="p">(</span><span class="n">bad_input_tree</span><span class="p">)</span> <span class="o">==</span> <span class="n">BAD_INPUT</span>
</pre></div>
</div>
</div>
</div>
<p>With this, we can now</p>
<ul class="simple">
<li><p>parse an input into a tree structure;</p></li>
<li><p>(re-)create parts of the tree structure; and</p></li>
<li><p>turn the tree back into an input string.</p></li>
</ul>
</section>
<section id="mutating-the-tree">
<h2>Mutating the Tree<a class="headerlink" href="#mutating-the-tree" title="Link to this heading">#</a></h2>
<p>We introduce a class <code class="docutils literal notranslate"><span class="pre">TreeMutator</span></code> that is set to mutate a tree. Its constructor takes a grammar and a tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">fuzzingbook.Grammars</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_grammar</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeMutator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Grammar-based mutations of derivation trees.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                 <span class="n">fuzzer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GrammarFuzzer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">log</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor. </span>
<span class="sd">        `grammar` is the underlying grammar; </span>
<span class="sd">        `tree` is the tree to work on.</span>
<span class="sd">        `fuzzer` is the grammar fuzzer to use (default: `GrammarFuzzer`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">grammar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>

        <span class="k">if</span> <span class="n">fuzzer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">fuzzer</span>
</pre></div>
</div>
</div>
</div>
<section id="referencing-subtrees">
<h3>Referencing Subtrees<a class="headerlink" href="#referencing-subtrees" title="Link to this heading">#</a></h3>
<p>To reference individual elements in the tree, we introduce the concept of a <em>path</em>. A path is a list of numbers indicating the children (starting with 0) we should follow. A path <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">...,</span> <span class="pre">0]</span></code> stands for the leftmost child in a tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TreePath</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">get_subtree()</span></code> returns the subtree for a given path.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeMutator</span><span class="p">(</span><span class="n">TreeMutator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_subtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">TreePath</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access a subtree based on `path` (a list of children numbers)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>

        <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="n">tree</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span> <span class="ow">or</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tree</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subtree</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">children</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s <code class="docutils literal notranslate"><span class="pre">get_subtree()</span></code> in action. We instantiate a <code class="docutils literal notranslate"><span class="pre">TreeMutator</span></code> on the <code class="docutils literal notranslate"><span class="pre">BAD_INPUT</span></code> tree as shown above and return the element at the path <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">0]</span></code> – i.e. follow the leftmost edge twice, than the second-to-leftmost edge, then the leftmost edge again. This gives us the <code class="docutils literal notranslate"><span class="pre">&lt;plain-text&gt;</span></code> subtree representing the string <code class="docutils literal notranslate"><span class="pre">&quot;bar</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bad_input_tree_mutator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TreeMutator</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">TreeMutator</span><span class="p">(</span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="p">,</span> <span class="n">bad_input_tree</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plain_text_subtree</span> <span class="o">=</span> <span class="n">bad_input_tree_mutator</span><span class="p">()</span><span class="o">.</span><span class="n">get_subtree</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">plain_text_subtree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;&lt;plain-text&gt;&#39;,
 [(&#39;&lt;plain-char&gt;&#39;, [(&#39;&lt;other&gt;&#39;, [(&#39;&quot;&#39;, [])])]),
  (&#39;&lt;plain-text&gt;&#39;,
   [(&#39;&lt;plain-char&gt;&#39;, [(&#39;&lt;letter&gt;&#39;, [...])]),
    (&#39;&lt;plain-text&gt;&#39;, [(&#39;&lt;plain-char&gt;&#39;, [...]), (&#39;&lt;plain-text&gt;&#39;, [...])])])])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_to_string</span><span class="p">(</span><span class="n">plain_text_subtree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&quot;bar&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">In <code>bad_input_tree</code>, what is  the subtree at the path <code>[0, 0, 2, 1]</code> as string?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="01a7d552-b294-11f0-8772-6298cf1a5790" id="01a7d552-b294-11f0-8772-6298cf1a5790-1" onclick="clear_selection('01a7d552-b294-11f0-8772-6298cf1a5790')">
        <label id="01a7d552-b294-11f0-8772-6298cf1a5790-1-label" for="01a7d552-b294-11f0-8772-6298cf1a5790-1"><code>&lt;</code></label><br>
    
        <input type="radio" name="01a7d552-b294-11f0-8772-6298cf1a5790" id="01a7d552-b294-11f0-8772-6298cf1a5790-2" onclick="clear_selection('01a7d552-b294-11f0-8772-6298cf1a5790')">
        <label id="01a7d552-b294-11f0-8772-6298cf1a5790-2-label" for="01a7d552-b294-11f0-8772-6298cf1a5790-2"><code>/</code></label><br>
    
        <input type="radio" name="01a7d552-b294-11f0-8772-6298cf1a5790" id="01a7d552-b294-11f0-8772-6298cf1a5790-3" onclick="clear_selection('01a7d552-b294-11f0-8772-6298cf1a5790')">
        <label id="01a7d552-b294-11f0-8772-6298cf1a5790-3-label" for="01a7d552-b294-11f0-8772-6298cf1a5790-3"><code>&lt;/foo&gt;</code></label><br>
    
        <input type="radio" name="01a7d552-b294-11f0-8772-6298cf1a5790" id="01a7d552-b294-11f0-8772-6298cf1a5790-4" onclick="clear_selection('01a7d552-b294-11f0-8772-6298cf1a5790')">
        <label id="01a7d552-b294-11f0-8772-6298cf1a5790-4-label" for="01a7d552-b294-11f0-8772-6298cf1a5790-4"><code>&lt;foo&gt;</code></label><br>
    
    </div>
    </p>
    <input id="01a7d552-b294-11f0-8772-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('01a7d552-b294-11f0-8772-6298cf1a5790', 4, 0, 'next(prime_numbers)')">
    <span class="quiz_hint" id="01a7d552-b294-11f0-8772-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
</section>
<section id="creating-new-subtrees">
<h3>Creating new Subtrees<a class="headerlink" href="#creating-new-subtrees" title="Link to this heading">#</a></h3>
<p>The method <code class="docutils literal notranslate"><span class="pre">new_tree()</span></code> creates a new subtree for the given <code class="docutils literal notranslate"><span class="pre">&lt;start_symbol&gt;</span></code> according to the rules of the grammar. It invokes <code class="docutils literal notranslate"><span class="pre">expand_tree()</span></code> on the given <code class="docutils literal notranslate"><span class="pre">GrammarFuzzer</span></code> – a method that takes an initial (empty) tree and expands it until no more expansions are left.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeMutator</span><span class="p">(</span><span class="n">TreeMutator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">new_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new subtree for &lt;start_symbol&gt;.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating new tree for </span><span class="si">{</span><span class="n">start_symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_symbol</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">expand_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here is an example of <code class="docutils literal notranslate"><span class="pre">new_tree()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plain_text_tree</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">TreeMutator</span><span class="p">,</span> <span class="n">bad_input_tree_mutator</span><span class="p">())</span><span class="o">.</span><span class="n">new_tree</span><span class="p">(</span><span class="s1">&#39;&lt;plain-text&gt;&#39;</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">plain_text_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating new tree for &lt;plain-text&gt;
</pre></div>
</div>
<img alt="_images/85b4898fb91e033f1fa040b4d85429f1eded68f08f9ad84e5203177e125263c2.svg" src="_images/85b4898fb91e033f1fa040b4d85429f1eded68f08f9ad84e5203177e125263c2.svg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_to_string</span><span class="p">(</span><span class="n">plain_text_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h3>Mutating the Tree<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>With us now being able to</p>
<ul class="simple">
<li><p>access a particular path in the tree (<code class="docutils literal notranslate"><span class="pre">get_subtree()</span></code>) and</p></li>
<li><p>create a new subtree (<code class="docutils literal notranslate"><span class="pre">new_tree()</span></code>),</p></li>
</ul>
<p>we can mutate the tree at a given path. This is the task of <code class="docutils literal notranslate"><span class="pre">mutate()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeMutator</span><span class="p">(</span><span class="n">TreeMutator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">TreePath</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a new tree mutated at `path`&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>
        <span class="k">assert</span> <span class="n">tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="n">tree</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span> <span class="ow">or</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_tree</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

        <span class="n">head</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_children</span> <span class="o">=</span> <span class="p">(</span><span class="n">children</span><span class="p">[:</span><span class="n">head</span><span class="p">]</span> <span class="o">+</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">children</span><span class="p">[</span><span class="n">head</span><span class="p">])]</span> <span class="o">+</span>
                        <span class="n">children</span><span class="p">[</span><span class="n">head</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span>
</pre></div>
</div>
</div>
</div>
<p>Here is an example of <code class="docutils literal notranslate"><span class="pre">mutate()</span></code> in action. We mutate <code class="docutils literal notranslate"><span class="pre">bad_input_tree</span></code> at the path <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">0]</span></code> – that is, <code class="docutils literal notranslate"><span class="pre">&lt;plain-text&gt;</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mutated_tree</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">TreeMutator</span><span class="p">,</span> <span class="n">bad_input_tree_mutator</span><span class="p">())</span><span class="o">.</span><span class="n">mutate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">mutated_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating new tree for &lt;plain-text&gt;
</pre></div>
</div>
<img alt="_images/327fdce3db6ffea273a44c5b8b37e9356cd0bcfef06519fff559f7d465c5d13d.svg" src="_images/327fdce3db6ffea273a44c5b8b37e9356cd0bcfef06519fff559f7d465c5d13d.svg" />
</div>
</div>
<p>We see that the <code class="docutils literal notranslate"><span class="pre">&lt;plain-text&gt;</span></code> subtree is now different, which also becomes evident in the string representation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_to_string</span><span class="p">(</span><span class="n">mutated_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;foo&gt; &lt;/foo&gt;&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="generalizing-trees">
<h2>Generalizing Trees<a class="headerlink" href="#generalizing-trees" title="Link to this heading">#</a></h2>
<p>Now for the main part – finding out which parts of a tree can be generalized. Our idea is to <em>test</em> a finite number of mutations to a subtree (say, 10). If all of these tests fail as well, then we assume we can generalize the subtree to a placeholder.</p>
<p>We introduce a class <code class="docutils literal notranslate"><span class="pre">TreeGeneralizer</span></code> for this purpose. On top of <code class="docutils literal notranslate"><span class="pre">grammar</span></code> and <code class="docutils literal notranslate"><span class="pre">tree</span></code> already used for the <code class="docutils literal notranslate"><span class="pre">TreeMutator</span></code> constructor, the <code class="docutils literal notranslate"><span class="pre">TreeGeneralizer</span></code> also takes a <code class="docutils literal notranslate"><span class="pre">test</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeGeneralizer</span><span class="p">(</span><span class="n">TreeMutator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine which parts of a derivation tree can be generalized.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
                 <span class="n">max_tries_for_generalization</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor. `grammar` and `tree` are as in `TreeMutator`.</span>
<span class="sd">        `test` is a function taking a string that either</span>
<span class="sd">          * raises an exception, indicating test failure;</span>
<span class="sd">          * or not, indicating test success.</span>
<span class="sd">        `max_tries_for_generalization` is the number of times</span>
<span class="sd">        an instantiation has to fail before it is generalized.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_tries_for_generalization</span> <span class="o">=</span> <span class="n">max_tries_for_generalization</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">test</span></code> function is used in <code class="docutils literal notranslate"><span class="pre">test_tree()</span></code>, returning <code class="docutils literal notranslate"><span class="pre">False</span></code> if the test fails (raising an exception), and <code class="docutils literal notranslate"><span class="pre">True</span></code> if the test passes (no exception).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeGeneralizer</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if testing `tree` passes, else False&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">tree_to_string</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Testing </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FAIL (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PASS&quot;</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
</div>
<section id="testing-for-generalization">
<h3>Testing for Generalization<a class="headerlink" href="#testing-for-generalization" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">can_generalize()</span></code> method brings the above methods together. It creates a number of tree mutations at the given path, and returns True if all of them produce a failure. (Note that this is not as sophisticated as our <a class="reference internal" href="DeltaDebugger.html"><span class="std std-doc">delta debugger</span></a> implementation, which also checks that the <em>same</em> error occurs.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeGeneralizer</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">can_generalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">TreePath</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if the subtree at `path` can be generalized.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_tries_for_generalization</span><span class="p">):</span>
            <span class="n">mutated_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_tree</span><span class="p">(</span><span class="n">mutated_tree</span><span class="p">):</span>
                <span class="c1"># Failure no longer occurs; cannot abstract</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>Let us put <code class="docutils literal notranslate"><span class="pre">TreeGeneralizer</span></code> into action. We can directly use <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> as test function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bad_input_tree_generalizer</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TreeGeneralizer</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">TreeGeneralizer</span><span class="p">(</span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="p">,</span> <span class="n">bad_input_tree</span><span class="p">,</span>
                           <span class="n">remove_html_markup</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>On our <code class="docutils literal notranslate"><span class="pre">BAD_INPUT</span></code> (and its tree), can we generalize the root <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code> node? In other words, does the failure occur for all possible <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code> inputs?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bad_input_tree_generalizer</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">can_generalize</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing &quot;&lt;l35Gmq W2G571=&#39;&#39;&gt;&quot;...PASS
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>The answer is no. The first alternative passes the test; hence no generalization.</p>
<p>How about the middle <code class="docutils literal notranslate"><span class="pre">&lt;plain_text&gt;</span></code> part? Can we generalize this?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bad_input_tree_generalizer</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">can_generalize</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing &#39;&lt;foo&gt;8&lt;/foo&gt;&#39;...PASS
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>The answer is no – just as above.</p>
<p>How about the closing tag? Can we generalize this one?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bad_input_tree_generalizer</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">can_generalize</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing &#39;&lt;foo&gt;&quot;bar&lt;/e7N&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;foo&gt;&quot;bar&lt;/q37A&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;foo&gt;&quot;bar&lt;/W&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;foo&gt;&quot;bar&lt;/z93Q5&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;foo&gt;&quot;bar&lt;/WR&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;foo&gt;&quot;bar&lt;/m&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;foo&gt;&quot;bar&lt;/Uy443wt1h7&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;foo&gt;&quot;bar&lt;/fon2&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;foo&gt;&quot;bar&lt;/M&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;foo&gt;&quot;bar&lt;/g9&gt;&#39;...FAIL (AssertionError)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Yes, we can! All alternate instantiations of <code class="docutils literal notranslate"><span class="pre">&lt;closing-tag&gt;</span></code> result in a failure.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">Is this also true for <code>&lt;opening-tag&gt;</code>?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="021533e0-b294-11f0-8772-6298cf1a5790" id="021533e0-b294-11f0-8772-6298cf1a5790-1" onclick="clear_selection('021533e0-b294-11f0-8772-6298cf1a5790')">
        <label id="021533e0-b294-11f0-8772-6298cf1a5790-1-label" for="021533e0-b294-11f0-8772-6298cf1a5790-1">Yes</label><br>
    
        <input type="radio" name="021533e0-b294-11f0-8772-6298cf1a5790" id="021533e0-b294-11f0-8772-6298cf1a5790-2" onclick="clear_selection('021533e0-b294-11f0-8772-6298cf1a5790')">
        <label id="021533e0-b294-11f0-8772-6298cf1a5790-2-label" for="021533e0-b294-11f0-8772-6298cf1a5790-2">No</label><br>
    
    </div>
    </p>
    <input id="021533e0-b294-11f0-8772-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('021533e0-b294-11f0-8772-6298cf1a5790', 4, 0, '(&quot;Yes&quot; == &quot;Yes&quot;) + (&quot;No&quot; == &quot;No&quot;)')">
    <span class="quiz_hint" id="021533e0-b294-11f0-8772-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Note that the above does not hold for <code class="docutils literal notranslate"><span class="pre">&lt;opening-tag&gt;</span></code>. If the attribute value contains a quote character, it will extend to the end of the input. This is another error, but not caught by our assertion; hence, the input will be flagged as passing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BAD_ATTR_INPUT</span> <span class="o">=</span> <span class="s1">&#39;&lt;foo attr=&quot;</span><span class="se">\&#39;</span><span class="s1">&quot;&gt;bar&lt;/foo&gt;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="n">BAD_ATTR_INPUT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&#39;
</pre></div>
</div>
</div>
</div>
<p>The effect of this is that there are patterns for <code class="docutils literal notranslate"><span class="pre">&lt;opening-tag&gt;</span></code> which do not cause the failure to occur; hence, <code class="docutils literal notranslate"><span class="pre">&lt;opening-tag&gt;</span></code> is not a fully valid generalization.</p>
<p>This, however, becomes apparent only if one of our generated tests includes a quote character in the attribute value. Since quote characters are as likely (or as unlikely) to appear as other characters, this effect may not become apparent in our default 10 tests:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bad_input_tree_generalizer</span><span class="p">()</span><span class="o">.</span><span class="n">can_generalize</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>It will become apparent, however, as we increase the number of tests:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bad_input_tree_generalizer</span><span class="p">(</span><span class="n">max_tries_for_generalization</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">can_generalize</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing &#39;&lt;Ada np=\&#39;7\&#39; y7v=\&#39;\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;B V=\&#39;\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;K v=&quot;$&quot; s5F=&quot;\x0b&quot; q=&quot;&quot; E=\&#39;\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;Fcdt8 v7A4u=\&#39;.\t\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;s n=&quot;&quot;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;W&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;ap&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;B1&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;Q00wY M=\&#39;\r \&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;O6 d7=&quot;&quot; H=\&#39;\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;v1IH w=&quot;&quot; ZI=&quot;&quot; O=&quot;&quot;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;T1 w998=\&#39;a\&#39; j=\&#39;z\n7\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;Dnh1&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;D F9=&quot;&quot; x4=\&#39;\&#39; Hup=\&#39;7\n\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;l62E&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;k11 P8x5=&quot;&quot;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;V6LBVu&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;k9S&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;tU2J913 lQ6N=\&#39;\&#39; f=\&#39;*\&#39; V=\&#39;\&#39; b=&quot;&quot; l=&quot;&quot; G=\&#39;\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;X O=&quot;U~&quot;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;q4 W=\&#39;\&#39; i=\&#39;aA9\&#39; I=\&#39;9\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;HK&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;T&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;NJc j32=&quot;\x0b&quot;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;G&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;w B=&quot;\r&quot;&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;Ac1&gt;&quot;bar&lt;/foo&gt;&#39;...FAIL (AssertionError)
Testing &#39;&lt;vB y2=\&#39;7x\&#39;\&#39;&gt;&quot;bar&lt;/foo&gt;&#39;...PASS
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>We see that our approach may <em>overgeneralize</em> – producing a generalization that may be too lenient. In practice, this is not too much of a problem, as we would be interested in characterizing cases that trigger the failure, rather than characterizing a small subset that does not trigger the failure.</p>
</section>
<section id="generalizable-paths">
<h3>Generalizable Paths<a class="headerlink" href="#generalizable-paths" title="Link to this heading">#</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">can_generalize()</span></code>, we can devise a method <code class="docutils literal notranslate"><span class="pre">generalizable_paths()</span></code> that returns all paths in the tree that can be generalized.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeGeneralizer</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                   <span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">TreePath</span><span class="p">,</span> <span class="n">DerivationTree</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span> 
                   <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TreePath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                   <span class="n">tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TreePath</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all paths for which `predicate` holds.</span>
<span class="sd">        `predicate` is a function `predicate`(`path`, `tree`), where</span>
<span class="sd">        `path` denotes a subtree in `tree`. If `predicate()` returns</span>
<span class="sd">        True, `path` is included in the returned list.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>
        <span class="k">assert</span> <span class="n">tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
                <span class="n">child_symbol</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">child</span>
                <span class="k">if</span> <span class="n">child_symbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
                    <span class="n">paths</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_paths</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">paths</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generalizable_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TreePath</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all paths whose subtrees can be generalized.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">can_generalize</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here is <code class="docutils literal notranslate"><span class="pre">generalizable_paths()</span></code> in action. We obtain all (paths to) subtrees that can be generalized:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bad_input_generalizable_paths</span> <span class="o">=</span> \
    <span class="n">cast</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">,</span> <span class="n">bad_input_tree_generalizer</span><span class="p">())</span><span class="o">.</span><span class="n">generalizable_paths</span><span class="p">()</span>
<span class="n">bad_input_generalizable_paths</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0, 0, 0], [0, 0, 1, 0, 1, 0], [0, 0, 1, 0, 1, 1], [0, 0, 2]]
</pre></div>
</div>
</div>
</div>
<p>To convert these subtrees into abstract failure-inducing patterns, the method <code class="docutils literal notranslate"><span class="pre">generalize_path()</span></code> returns a copy of the tree with the subtree replaced by a nonterminal without children:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeGeneralizer</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generalize_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">TreePath</span><span class="p">,</span> 
                        <span class="n">tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of the tree in which the subtree at `path`</span>
<span class="sd">        is generalized (= replaced by a nonterminal without children)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>
        <span class="k">assert</span> <span class="n">tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="n">tree</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span> <span class="ow">or</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">symbol</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># Nonterminal without children</span>

        <span class="n">head</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_children</span> <span class="o">=</span> <span class="p">(</span><span class="n">children</span><span class="p">[:</span><span class="n">head</span><span class="p">]</span> <span class="o">+</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">generalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">children</span><span class="p">[</span><span class="n">head</span><span class="p">])]</span> <span class="o">+</span>
                        <span class="n">children</span><span class="p">[</span><span class="n">head</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span>
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">all_terminals()</span></code> expands these placeholders:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">,</span> <span class="n">bad_input_tree_generalizer</span><span class="p">())</span><span class="o">.</span><span class="n">generalize_path</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;opening-tag&gt;&quot;bar&lt;plain-text&gt;&lt;/foo&gt;&#39;
</pre></div>
</div>
</div>
</div>
<p>Finally, the method <code class="docutils literal notranslate"><span class="pre">generalize()</span></code> obtains a tree in which all generalizable paths actually are generalized:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeGeneralizer</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a copy of the tree in which all generalizable subtrees</span>
<span class="sd">        are generalized (= replaced by nonterminals without children)&quot;&quot;&quot;</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>
        <span class="k">assert</span> <span class="n">tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalizable_paths</span><span class="p">():</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tree</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abstract_failure_inducing_input</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">,</span> <span class="n">bad_input_tree_generalizer</span><span class="p">())</span><span class="o">.</span><span class="n">generalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This gives us the final generalization of <code class="docutils literal notranslate"><span class="pre">BAD_INPUT</span></code>. In the abstract failure-inducing input, all generalizable elements are generalized.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">abstract_failure_inducing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;opening-tag&gt;&quot;&lt;plain-text&gt;&lt;closing-tag&gt;&#39;
</pre></div>
</div>
</div>
</div>
<p>We see that to obtain the failure, it suffices to have an <code class="docutils literal notranslate"><span class="pre">&lt;opening-tag&gt;</span></code>, followed by a quote and (any) <code class="docutils literal notranslate"><span class="pre">&lt;plain-text&gt;</span></code> and (any) <code class="docutils literal notranslate"><span class="pre">&lt;closing-tag&gt;</span></code>. Clearly, all that it takes to produce the failure is to have a double quote in the plain text.</p>
<p>Also note how this diagnosis was reached through <em>experiments</em> only – just as with <a class="reference internal" href="DeltaDebugger.html"><span class="std std-doc">delta debugging</span></a>, we could treat the program under test as a black box. In contrast to delta debugging, however, we obtain an <em>abstraction</em> that generalizes the circumstances under which a given failure occurs.</p>
</section>
</section>
<section id="fuzzing-with-patterns">
<h2>Fuzzing with Patterns<a class="headerlink" href="#fuzzing-with-patterns" title="Link to this heading">#</a></h2>
<p>One neat side effect of abstract failure-inducing patterns is that they can be easily instantiated into further test cases, all set to reproduce the failure in question. This gives us a test suite we can later test our fix against.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">fuzz_tree()</span></code> takes a tree representing an abstract failure-inducing input and instantiates all missing subtrees.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TreeGeneralizer</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fuzz_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivationTree</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an instantiated copy of `tree`.&quot;&quot;&quot;</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">expand_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bitg</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">,</span> <span class="n">bad_input_tree_generalizer</span><span class="p">())</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">bitg</span><span class="o">.</span><span class="n">fuzz_tree</span><span class="p">(</span><span class="n">abstract_failure_inducing_input</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;UzL3Ct6&gt;&quot;&lt;/p&gt;
&lt;nw10E6&gt;&quot;&lt;/W&gt;
&lt;h lV=&quot;&#39;&quot;&gt;&quot;&lt;/x8&gt;
&lt;k&gt;&quot;&lt;/u&gt;
&lt;a0 l0820650g=&#39;3&#39;&gt;&quot;&lt;/v5t&gt;
&lt;zTg&gt;&quot;&lt;/o1Z&gt;
&lt;yMgT02p s=&quot;&quot; g94e=&#39;R&#39;&gt;&quot;&lt;/P2&gt;
&lt;Y&gt;&quot;&lt;/S9b&gt;
&lt;X2566xS8v2&gt;&quot;&lt;/r13&gt;
&lt;D48&gt;&quot;	&lt;/R&gt;
</pre></div>
</div>
</div>
</div>
<p>We can take these inputs and see whether they reproduce the failure in question:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">successes</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">trials</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="n">test_input</span> <span class="o">=</span> <span class="n">all_terminals</span><span class="p">(</span>
        <span class="n">bitg</span><span class="o">.</span><span class="n">fuzz_tree</span><span class="p">(</span><span class="n">abstract_failure_inducing_input</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">remove_html_markup</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="n">successes</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">successes</span><span class="p">,</span> <span class="n">failures</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(982, 18)
</pre></div>
</div>
</div>
</div>
<p>We get an overall failure rate of ~98%, which is not bad at all.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">failures</span> <span class="o">/</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.018
</pre></div>
</div>
</div>
</div>
<p>In our case, it is <em>overgeneralization</em> (as discussed above) that is responsible for not reaching a 100% rate. (In all generality, we are trying to approximate the behavior of a Turing machine with a context free grammar, which is, well, always an approximation.) However, even a lower rate would still be useful, as any additional test case that reproduces a failure helps in ensuring the final fix is complete.</p>
</section>
<section id="putting-it-all-together">
<h2>Putting it all Together<a class="headerlink" href="#putting-it-all-together" title="Link to this heading">#</a></h2>
<p>Let us now put together all this in a more convenient package that does not require the user to parse and unparse derivation trees.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code> is modeled after the <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> from <a class="reference internal" href="DeltaDebugger.html"><span class="std std-doc">the chapter on delta debugging</span></a>. It is to be used as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DDSetDebugger</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">some_failing_function</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>After that, evaluating <code class="docutils literal notranslate"><span class="pre">dd</span></code> yields a generalized abstract failure-inducing input as a string.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code> accepts only one grammar, the function to be debugged should have exactly one string argument (besides other arguments); this string must fit the grammar.</p>
<section id="constructor">
<h3>Constructor<a class="headerlink" href="#constructor" title="Link to this heading">#</a></h3>
<p>The constructor puts together the various components. It allows for customization by subclassing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">DeltaDebugger</span><span class="w"> </span><span class="kn">import</span> <span class="n">CallCollector</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DDSetDebugger</span><span class="p">(</span><span class="n">CallCollector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Debugger implementing the DDSET algorithm for abstracting failure-inducing inputs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grammar</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span> 
                 <span class="n">generalizer_class</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">TreeGeneralizer</span><span class="p">,</span>
                 <span class="n">parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Parser</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>
<span class="sd">        `grammar` is an input grammar in fuzzingbook format.</span>
<span class="sd">        `generalizer_class` is the tree generalizer class to use</span>
<span class="sd">        (default: `TreeGeneralizer`)</span>
<span class="sd">        `parser` is the parser to use (default: `EarleyParser(grammar)`).</span>
<span class="sd">        All other keyword args are passed to the tree generalizer, notably:</span>
<span class="sd">        `fuzzer` - the fuzzer to use (default: `GrammarFuzzer`), and</span>
<span class="sd">        `log` - enables debugging output if True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">grammar</span>
        <span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generalizer_class</span> <span class="o">=</span> <span class="n">generalizer_class</span>

        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="c1"># These save state for further fuzz() calls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalized_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalized_trees</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DerivationTree</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalizers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TreeGeneralizer</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generalizing-arguments">
<h3>Generalizing Arguments<a class="headerlink" href="#generalizing-arguments" title="Link to this heading">#</a></h3>
<p>The method <code class="docutils literal notranslate"><span class="pre">generalize()</span></code> is the main entry point. For all string arguments collected in the first function call, it generalizes the arguments and returns an abstract failure-inducing string.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DDSetDebugger</span><span class="p">(</span><span class="n">DDSetDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generalize arguments seen. For each function argument,</span>
<span class="sd">        produce an abstract failure-inducing input that characterizes</span>
<span class="sd">        the set of inputs for which the function fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalized_args</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalized_args</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generalized_args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalized_trees</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalizers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">():</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">({</span><span class="n">arg</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>

            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">()[</span><span class="n">arg</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">value</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalizer_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> 
                                             <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">generalized_tree</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">generalize</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">generalizers</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">gen</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generalized_trees</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">generalized_tree</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generalized_args</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">generalized_tree</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalized_args</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DDSetDebugger</span><span class="p">(</span><span class="n">DDSetDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representation of the generalized call.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generalize</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Here is an example of how <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code> would be used on our <code class="docutils literal notranslate"><span class="pre">BAD_INPUT</span></code> example. Simply evaluating the debugger yields a call with a generalized input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DDSetDebugger</span><span class="p">(</span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="n">BAD_INPUT</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>remove_html_markup(s=&#39;&lt;opening-tag&gt;&quot;&lt;plain-text&gt;&lt;closing-tag&gt;&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="fuzzing">
<h3>Fuzzing<a class="headerlink" href="#fuzzing" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">fuzz()</span></code> method produces instantiations of the abstract failure-inducing pattern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DDSetDebugger</span><span class="p">(</span><span class="n">DDSetDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fuzz_args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return arguments randomly instantiated</span>
<span class="sd">        from the abstract failure-inducing pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalized_trees</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generalize</span><span class="p">()</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generalized_args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalized_trees</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalized_trees</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalizers</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>
            <span class="n">instantiated_tree</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">fuzz_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="n">args</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">instantiated_tree</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">args</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fuzz</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a call with arguments randomly instantiated</span>
<span class="sd">        from the abstract failure-inducing pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_args</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Here are some axamples of <code class="docutils literal notranslate"><span class="pre">fuzz()</span></code> in action:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DDSetDebugger</span><span class="p">(</span><span class="n">SIMPLE_HTML_GRAMMAR</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="n">BAD_INPUT</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;remove_html_markup(s=\&#39;&lt;Xq&gt;&quot;&lt;/j&gt;\&#39;)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;remove_html_markup(s=\&#39;&lt;L89B6b9vz&gt;&quot;\\t&lt;/a3&gt;\&#39;)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;remove_html_markup(s=\&#39;&lt;Z VF=\\\&#39;\\\&#39; l=&quot;_-(&quot;&gt;&quot;)&lt;/Y&gt;\&#39;)&#39;
</pre></div>
</div>
</div>
</div>
<p>These can be fed into <code class="docutils literal notranslate"><span class="pre">eval()</span></code>, set to produce more failing calls.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="nb">eval</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_52206/2072246869.py&quot;, line 2, in &lt;module&gt;
    eval(dd.fuzz())
    ~~~~^^^^^^^^^^^
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_52206/2717035104.py&quot;, line 17, in remove_html_markup
    assert &#39;&lt;&#39; not in out and &#39;&gt;&#39; not in out
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="more-examples">
<h2>More Examples<a class="headerlink" href="#more-examples" title="Link to this heading">#</a></h2>
<p>Let us apply <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code> on more examples.</p>
<section id="square-root">
<h3>Square Root<a class="headerlink" href="#square-root" title="Link to this heading">#</a></h3>
<p>Our first example is the <code class="docutils literal notranslate"><span class="pre">square_root()</span></code> function from <a class="reference internal" href="Assertions.html"><span class="std std-doc">the chapter on assertions</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Assertions</span><span class="w"> </span><span class="kn">import</span> <span class="n">square_root</span>  <span class="c1"># minor dependency</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">square_root()</span></code> function fails on a value of <code class="docutils literal notranslate"><span class="pre">-1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">square_root</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_52206/1205325604.py&quot;, line 2, in &lt;module&gt;
    square_root(-1)
    ~~~~~~~~~~~^^^^
  File &quot;Assertions.ipynb&quot;, line 55, in square_root
    assert x &gt;= 0  # precondition
           ^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>We define a grammar for its arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">INT_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;int&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;int&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;positive-int&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&lt;positive-int&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;positive-int&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;nonzero-digit&gt;&lt;positive-int&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;nonzero-digit&gt;&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;123456789&quot;</span><span class="p">),</span>
    
    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The test function takes a string and converts it into an integer:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">square_root_test</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">square_root</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>With this, we can go and see whether we can generalize a failing input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DDSetDebugger</span><span class="p">(</span><span class="n">INT_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd_square_root</span><span class="p">:</span>
    <span class="n">square_root_test</span><span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_square_root</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing &#39;-8&#39;...FAIL (AssertionError)
Testing &#39;-316&#39;...FAIL (AssertionError)
Testing &#39;8&#39;...PASS
Testing &#39;684&#39;...PASS
Testing &#39;-3&#39;...FAIL (AssertionError)
Testing &#39;-870&#39;...FAIL (AssertionError)
Testing &#39;-3&#39;...FAIL (AssertionError)
Testing &#39;-3451&#39;...FAIL (AssertionError)
Testing &#39;-8&#39;...FAIL (AssertionError)
Testing &#39;-63213&#39;...FAIL (AssertionError)
Testing &#39;-26&#39;...FAIL (AssertionError)
Testing &#39;-4&#39;...FAIL (AssertionError)
Testing &#39;-6&#39;...FAIL (AssertionError)
Testing &#39;-8&#39;...FAIL (AssertionError)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>square_root_test(s=&#39;-&lt;positive-int&gt;&#39;)
</pre></div>
</div>
</div>
</div>
<p>Success! Using <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code>, we have nicely generalized the failure-inducing input to a pattern <code class="docutils literal notranslate"><span class="pre">-&lt;positive-int&gt;</span></code> that translates into “any negative number”.</p>
</section>
<section id="middle">
<h3>Middle<a class="headerlink" href="#middle" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">middle()</span></code> function from <a class="reference internal" href="StatisticalDebugger.html"><span class="std std-doc">the chapter on statistical debugging</span></a> returns the middle of three numerical values <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">StatisticalDebugger</span><span class="w"> </span><span class="kn">import</span> <span class="n">middle</span>  <span class="c1"># minor dependency</span>
</pre></div>
</div>
</div>
</div>
<p>We set up a test function that evaluates a string – a tuple of three arguments – and then tests <code class="docutils literal notranslate"><span class="pre">middle()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">middle_test</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">middle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The grammar for the three numbers simply puts three integers together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">XYZ_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;int&gt;, &lt;int&gt;, &lt;int&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;int&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;positive-int&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&lt;positive-int&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;positive-int&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;nonzero-digit&gt;&lt;positive-int&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;nonzero-digit&gt;&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;123456789&quot;</span><span class="p">),</span>
    
    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Here is an example of <code class="docutils literal notranslate"><span class="pre">middle()</span></code> failing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">middle_test</span><span class="p">(</span><span class="s2">&quot;2, 1, 3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_52206/982110330.py&quot;, line 2, in &lt;module&gt;
    middle_test(&quot;2, 1, 3&quot;)
    ~~~~~~~~~~~^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_52206/3079946275.py&quot;, line 3, in middle_test
    assert middle(x, y, z) == sorted([x, y, z])[1]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>What happens if we debug this with <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code>? We see that there is no abstraction at the syntax level that could characterize this failure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DDSetDebugger</span><span class="p">(</span><span class="n">XYZ_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd_middle</span><span class="p">:</span>
    <span class="n">middle_test</span><span class="p">(</span><span class="s2">&quot;2, 1, 3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_middle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing &#39;7, 4591, -0&#39;...PASS
Testing &#39;6, 1, 3&#39;...PASS
Testing &#39;7, 1, 3&#39;...PASS
Testing &#39;7, 1, 3&#39;...PASS
Testing &#39;2, -7, 3&#39;...FAIL (AssertionError)
Testing &#39;2, 0, 3&#39;...FAIL (AssertionError)
Testing &#39;2, -89, 3&#39;...FAIL (AssertionError)
Testing &#39;2, 973, 3&#39;...PASS
Testing &#39;2, 11, 3&#39;...PASS
Testing &#39;2, 8, 3&#39;...PASS
Testing &#39;2, 1, 9&#39;...FAIL (AssertionError)
Testing &#39;2, 1, -16&#39;...PASS
Testing &#39;2, 1, 35&#39;...FAIL (AssertionError)
Testing &#39;2, 1, 6&#39;...FAIL (AssertionError)
Testing &#39;2, 1, 53&#39;...FAIL (AssertionError)
Testing &#39;2, 1, 5&#39;...FAIL (AssertionError)
Testing &#39;2, 1, 737&#39;...FAIL (AssertionError)
Testing &#39;2, 1, 28&#39;...FAIL (AssertionError)
Testing &#39;2, 1, 3&#39;...FAIL (AssertionError)
Testing &#39;2, 1, 5&#39;...FAIL (AssertionError)
Testing &#39;2, 1, 5&#39;...FAIL (AssertionError)
Testing &#39;2, 1, 56&#39;...FAIL (AssertionError)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>middle_test(s=&#39;2, 1, &lt;positive-int&gt;&#39;)
</pre></div>
</div>
</div>
</div>
<p>So, while there are failures that can be nicely characterized using abstractions of input elements, <code class="docutils literal notranslate"><span class="pre">middle()</span></code> is not one of them. Which is good, because this means that all our other techniques such as <a class="reference internal" href="StatisticalDebugger.html"><span class="std std-doc">statistical debugging</span></a> and <a class="reference internal" href="DynamicInvariants.html"><span class="std std-doc">dynamic invariants</span></a> still have a use case :-)</p>
</section>
</section>
<section id="lessons-learned">
<h2>Lessons Learned<a class="headerlink" href="#lessons-learned" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Generalizing failure-inducing inputs can yield important information for which inputs and under which circumstances a failure occurs.</p></li>
<li><p>Generalizing failure-inducing inputs is most useful if the input can be split into multiple elements, of which only a part are relevant for producing the error.</p></li>
<li><p>As they help in <em>parsing</em> and <em>producing</em> input, <em>grammars</em> can play an important role in testing and debugging.</p></li>
</ul>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>The potential for determining how input features relate to bugs is not nearly explored yet.
The ALHAZEN work by Kampmann et al. \cite{Kampmann2020} generalizes over DDSET differently, by investigating <em>semantic</em> features of input elements such as their numeric interpretation or length and their correlation with failures. Like DDSET, ALHAZEN also uses a feedback loop to strengthen or refute its hypotheses.</p>
<p>Our <a class="reference internal" href="Alhazen.html"><span class="std std-doc">next chapter</span></a> introduces ALHAZEN.</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>Our <code class="docutils literal notranslate"><span class="pre">DDSetDebugger</span></code> class implements the DDSET algorithm as introduced by Gopinath et al. in \cite{Gopinath2020}. A <a class="reference external" href="https://rahul.gopinath.org/post/2020/07/15/ddset/">full-fledged implementation of DDSET</a> with plenty of details and experiments is available as a Jupyter Notebook. Our implementation follows the <a class="reference external" href="https://rahul.gopinath.org/post/2020/08/03/simple-ddset/">simplified implementation of DDSET, as described by Gopinath</a>.</p>
<p>In \cite{Gopinath2021}, Gopinath has extended the concept of DDSET further. His work on <em>evocative expressions</em> introduces a <em>pattern language</em> in which arbitrary DDSET-like patterns can be combined into Boolean formula that even more precisely capture and produce failure circumstances. In particular, evocative expressions can <em>specialize</em> grammars towards Boolean pattern combinations, thus allowing for great flexibility in testing and debugging.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<section id="exercise-1-generalization-and-specialization">
<h3>Exercise 1: Generalization and Specialization<a class="headerlink" href="#exercise-1-generalization-and-specialization" title="Link to this heading">#</a></h3>
<p>Consider the abstract failure-inducing input for <code class="docutils literal notranslate"><span class="pre">BAD_INPUT</span></code> we determined:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">abstract_failure_inducing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;opening-tag&gt;&quot;&lt;plain-text&gt;&lt;closing-tag&gt;&#39;
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple">
<li><p>How does it change if you increase the number of test runs, using <code class="docutils literal notranslate"><span class="pre">max_tries_for_generalization</span></code>?</p></li>
<li><p>What is the success rate of the new pattern?</p></li>
</ol>
<p><strong>Solution.</strong> We can compute this by increasing <code class="docutils literal notranslate"><span class="pre">max_tries_for_generalization</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">more_precise_bitg</span> <span class="o">=</span> \
    <span class="n">cast</span><span class="p">(</span><span class="n">TreeGeneralizer</span><span class="p">,</span> <span class="n">bad_input_tree_generalizer</span><span class="p">(</span><span class="n">max_tries_for_generalization</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>

<span class="n">more_precise_abstract_failure_inducing_input</span> <span class="o">=</span> \
    <span class="n">more_precise_bitg</span><span class="o">.</span><span class="n">generalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">more_precise_abstract_failure_inducing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;lt&gt;&lt;id&gt;&lt;gt&gt;&quot;&lt;plain-text&gt;&lt;closing-tag&gt;&#39;
</pre></div>
</div>
</div>
</div>
<p>We see that we still have an opening tag; however, it no longer assumes attributes.</p>
<p>The success rate can be computed as before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">successes</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">trials</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="n">test_input</span> <span class="o">=</span> <span class="n">all_terminals</span><span class="p">(</span>
        <span class="n">more_precise_bitg</span><span class="o">.</span><span class="n">fuzz_tree</span><span class="p">(</span>
            <span class="n">more_precise_abstract_failure_inducing_input</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">remove_html_markup</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="n">successes</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">successes</span><span class="p">,</span> <span class="n">failures</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(993, 7)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">failures</span> <span class="o">/</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.007
</pre></div>
</div>
</div>
</div>
<p>We see that the success rate is now more than 99%, which is better than before. On the other hand, the pattern is now overly <em>special</em>, since there are <code class="docutils literal notranslate"><span class="pre">&lt;opening-tags&gt;</span></code> with attributes such that the failure occurs (but also some that cancel out the error).</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="DynamicInvariants.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Mining Function Specifications</p>
      </div>
    </a>
    <a class="right-next"
       href="Alhazen.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Learning from Failures</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-failing-program">A Failing Program</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grammars">Grammars</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#derivation-trees">Derivation Trees</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parsing">Parsing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutating-the-tree">Mutating the Tree</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#referencing-subtrees">Referencing Subtrees</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-subtrees">Creating new Subtrees</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Mutating the Tree</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generalizing-trees">Generalizing Trees</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-generalization">Testing for Generalization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generalizable-paths">Generalizable Paths</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fuzzing-with-patterns">Fuzzing with Patterns</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-it-all-together">Putting it all Together</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructor">Constructor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generalizing-arguments">Generalizing Arguments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fuzzing">Fuzzing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-examples">More Examples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#square-root">Square Root</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#middle">Middle</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-generalization-and-specialization">Exercise 1: Generalization and Specialization</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andreas Zeller
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
  Copyright &copy; 2021–2025 <a href="https://www.cispa.de/">CISPA Helmholtz Center for Information Security</a>.
  The <strong>content</strong> of this project is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  The <strong>source code</strong> that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/debuggingbook/blob/master/LICENSE.md#mit-license">MIT License</a>.
  <br>
  <a href="https://cispa.de/en/impressum">Imprint</a> &middot; <a href="/html/index.html#how-do-i-cite-your-work">Cite</a>
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>