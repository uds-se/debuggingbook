
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Reducing Failure-Inducing Inputs &#8212; The Debugging Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=d5c2cecb" />
    <link rel="stylesheet" type="text/css" href="_static/mastodon-timeline.css?v=f82c2b23" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'DeltaDebugger';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Isolating Failure-Inducing Changes" href="ChangeDebugger.html" />
    <link rel="prev" title="Tracking Failure Origins" href="Slicer.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p>This is a beta version of debuggingbook.org, currently in development. See the <a href="https://debuggingbook.org/classic/"  style="color:white!important;">classic site</a> for the 2024 version.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/debuggingbook.png" class="logo__image only-light" alt="The Debugging Book - Home"/>
    <script>document.write(`<img src="_static/debuggingbook.png" class="logo__image only-dark" alt="The Debugging Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    The Debugging Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tours.html">Sitemap</a></li>
<li class="toctree-l1"><a class="reference internal" href="Intro_Debugging.html">Introduction to Debugging</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Observing Executions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracer.html">Tracing Executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Debugger.html">How Debuggers Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="Assertions.html">Asserting Expectations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Flows and Dependencies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Slicer.html">Tracking Failure Origins</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reducing Failure Causes</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Reducing Failure-Inducing Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeDebugger.html">Isolating Failure-Inducing Changes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Abstracting Failures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="StatisticalDebugger.html">Statistical Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicInvariants.html">Mining Function Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="DDSetDebugger.html">Generalizing Failure Circumstances</a></li>
<li class="toctree-l1"><a class="reference internal" href="Alhazen.html">Learning from Failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="PerformanceDebugger.html">Debugging Performance Issues</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Automatic Repair</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Repairer.html">Repairing Code Automatically</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Debugging in the Large</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tracking.html">Tracking Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeCounter.html">Where the Bugs are</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ExpectError.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timer.html">Timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timeout.html">Timeout</a></li>
<li class="toctree-l1"><a class="reference internal" href="ClassDiagram.html">Class Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="StackInspector.html">Inspecting Call Stacks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About This Book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ReleaseNotes.html">Release Notes for The Debugging Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importing.html">Downloads and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Guide_for_Authors.html">Guide for Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uds-se/debuggingbook/master?urlpath=tree/docs/notebooks/DeltaDebugger.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uds-se/debuggingbook/issues/new?title=Issue%20on%20page%20%2FDeltaDebugger.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
    <li><a href="../code/DeltaDebugger.py" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="Download Python code"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">.py</span>
    </a>
    </li>
    
      
      
      
      <li><a href="_sources/DeltaDebugger.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download notebook"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  
    <li><a href="Importing.html" target="_blank"
       class="btn btn-sm btn-download-source-button dropdown-item"
       title="All downloads"
       data-bs-placement="left" data-bs-toggle="tooltip"
    >
  

    <span class="btn__icon-container">
      <i class="fas fa-file"></i>
      </span>
    <span class="btn__text-container">All downloads</span>
    </a>
    </li>
    </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Reducing Failure-Inducing Inputs</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-reducing">Why Reducing?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-input-reduction">Manual Input Reduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delta-debugging">Delta Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-deltadebugger-interface">A Simple DeltaDebugger Interface</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#excursion-implementing-deltadebugger">Excursion: Implementing DeltaDebugger</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#collecting-a-call">Collecting a Call</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#repeating-a-call">Repeating a Call</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-logging-and-caching">Testing, Logging, and Caching</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-delta-debugging">General Delta Debugging</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-multiple-arguments">Processing Multiple Arguments</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#public-api">Public API</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-excursion">End of Excursion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-examples">Usage Examples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-remove-html-markup">Reducing remove_html_markup()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-multiple-arguments">Reducing Multiple Arguments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#invoking-an-interactive-debugger">Invoking an Interactive Debugger</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-other-collections">Reducing other Collections</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-inputs">Debugging Inputs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#failure-inducing-differences">Failure-Inducing Differences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-program-code">Reducing Program Code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-code-lines">Reducing Code Lines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-code-characters">Reducing Code Characters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-syntax-trees">Reducing Syntax Trees</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#from-code-to-syntax-trees">From Code to Syntax Trees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#traversing-syntax-trees">Traversing Syntax Trees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#deleting-nodes">Deleting Nodes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-trees">Reducing Trees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transforming-nodes">Transforming Nodes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-advanced-syntactic-code-reduction">Exercise 1: Advanced Syntactic Code Reduction</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="reducing-failure-inducing-inputs">
<h1>Reducing Failure-Inducing Inputs<a class="headerlink" href="#reducing-failure-inducing-inputs" title="Link to this heading">#</a></h1>
<p>A standard problem in debugging is this: Your program fails after processing some large input. Only a <em>part</em> of this input, however, is responsible for the failure. <em>Reducing</em> the input to a failure-inducing minimum not only eases debugging – it also helps in understanding why and when the program fails. In this chapter, we present techniques that <em>automatically reduce and simplify failure-inducing inputs to a minimum</em>, notably the popular <em>Delta Debugging</em> technique.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;6fmJ5l257bM&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="640"
            height="360"
            src="https://www.youtube-nocookie.com/embed/6fmJ5l257bM"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p>Using the “delta debugging” technique for reduction has no specific prerequisites.</p></li>
<li><p>To understand the <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> implementation, reading <a class="reference internal" href="Tracer.html"><span class="std std-doc">the chapter on tracing</span></a> is recommended.</p></li>
</ul>
<p>This chapter is adapted from <a class="reference external" href="https://www.fuzzingbook.org/html/Reducer.html">a similar chapter in “The Fuzzing Book”</a>. The material has been adapted to be independent of the <code class="docutils literal notranslate"><span class="pre">fuzzingbook</span></code> infrastructure, to build on general delta debugging (<code class="docutils literal notranslate"><span class="pre">dd</span></code>), and to provide a simpler invocation interface.</p>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Link to this heading">#</a></h2>
<p>To <a class="reference internal" href="Importing.html"><span class="std std-doc">use the code provided in this chapter</span></a>, write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">debuggingbook.DeltaDebugger</span><span class="w"> </span><span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and then make use of the following features.</p>
<p><strong>Note</strong>: The examples in this section only work after the rest of the cells have been executed.</p>
<p>Here is a simple example: An arithmetic expression causes an error in the Python interpreter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">myeval</span><span class="p">(</span><span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">):</span>
    <span class="n">myeval</span><span class="p">(</span><span class="s1">&#39;1 + 2 * 3 / 0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4002351332.py&quot;, line 2, in &lt;module&gt;
    myeval(&#39;1 + 2 * 3 / 0&#39;)
    ~~~~~~^^^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2200911420.py&quot;, line 2, in myeval
    return eval(inp)
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
ZeroDivisionError: division by zero (expected)
</pre></div>
</div>
</div>
</div>
<p>Can we reduce this input to a minimum? <em>Delta Debugging</em> is a simple and robust reduction algorithm. We provide a <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> class that is used in conjunction with a (failing) function call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">fun</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
<p>The class automatically determines minimal arguments that cause the function to fail with the same exception as the original. Printing out the class object reveals the minimized call.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">myeval</span><span class="p">(</span><span class="s1">&#39;1 + 2 * 3 / 0&#39;</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>myeval(inp=&#39;3/0&#39;)
</pre></div>
</div>
</div>
</div>
<p>The input is reduced to the minimum: We get the essence of the division by zero.</p>
<p>There also is an interface to access the reduced input(s) programmatically. The method <code class="docutils literal notranslate"><span class="pre">min_args()</span></code> returns a dictionary in which all function arguments are minimized:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;inp&#39;: &#39;3/0&#39;}
</pre></div>
</div>
</div>
</div>
<p>In contrast, <code class="docutils literal notranslate"><span class="pre">max_args()</span></code> returns a dictionary in which all function arguments are maximized, but still pass:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">max_args</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;inp&#39;: &#39;1 + 2 * 3  &#39;}
</pre></div>
</div>
</div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">min_arg_diff()</span></code> returns a triple of</p>
<ul class="simple">
<li><p>passing input,</p></li>
<li><p>failing input, and</p></li>
<li><p>their minimal failure-inducing difference:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">min_arg_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>({&#39;inp&#39;: &#39; 3 &#39;}, {&#39;inp&#39;: &#39; 3 /0&#39;}, {&#39;inp&#39;: &#39;/0&#39;})
</pre></div>
</div>
</div>
</div>
<p>And you can also access the function itself, as well as its original arguments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">function</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">dd</span><span class="o">.</span><span class="n">args</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;myeval&#39;, {&#39;inp&#39;: &#39;1 + 2 * 3 / 0&#39;})
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> processes (i.e., minimizes or maximizes) all arguments that support a <code class="docutils literal notranslate"><span class="pre">len()</span></code> operation and that can be indexed – notably <em>strings</em> and <em>lists</em>. If a function has multiple arguments, all arguments that can be processed will be processed.</p>
<p>This chapter also provides a number of superclasses to <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code>, notably <code class="docutils literal notranslate"><span class="pre">CallCollector</span></code>, which obtains the first function call for <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code>. <code class="docutils literal notranslate"><span class="pre">CallReducer</span></code> classes allow for implementing alternate call reduction strategies.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 14.0.2 (20251019.1705)
 -->
<!-- Pages: 1 -->
<svg width="306pt" height="803pt"
 viewBox="0.00 0.00 306.00 803.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 799)">
<g id="a_graph0"><a xlink:title="DeltaDebugger class hierarchy">
<polygon fill="white" stroke="none" points="-4,4 -4,-799 301.62,-799 301.62,4 -4,4"/>
</a>
</g>
<!-- DeltaDebugger -->
<g id="node1" class="node">
<title>DeltaDebugger</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class DeltaDebugger:&#10;Like CallReducer, but cache test outcomes.">
<polygon fill="none" stroke="black" points="6,-0.5 6,-135.75 160,-135.75 160,-0.5 6,-0.5"/>
<text xml:space="preserve" text-anchor="start" x="31.25" y="-119.45" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">DeltaDebugger</text>
<polyline fill="none" stroke="black" points="6,-110.5 160,-110.5"/>
<g id="a_node1_0"><a xlink:href="#" xlink:title="DeltaDebugger">
<g id="a_node1_1"><a xlink:href="#" xlink:title="__repr__(self) &#45;&gt; str:&#10;Return a string representation of the minimized call.">
<text xml:space="preserve" text-anchor="start" x="14" y="-98" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__repr__()</text>
</a>
</g>
<g id="a_node1_2"><a xlink:href="#" xlink:title="dd(self, var_to_be_reduced: str, fail_args: Dict[str, Any], *, mode: str = &#39;&#45;&#39;) &#45;&gt; Tuple[Sequence, Sequence, Sequence]:&#10;General Delta Debugging.&#10;`var_to_be_reduced` &#45; the name of the variable to reduce.&#10;`fail_args` &#45; a dict of (failure&#45;inducing) function arguments,&#10;with `fail_args[var_to_be_reduced]` &#45; the input to apply dd on.&#10;`mode`&#45; how the algorithm should operate:&#10;&#39;&#45;&#39; (default): minimize input (`ddmin`),&#10;&#39;+&#39;: maximizing input (`ddmax`),&#10;&#39;+&#45;&#39;: minimizing pass/fail difference (`dd`)&#10;Returns a triple (`pass`, `fail`, `diff`) with&#10;* maximized passing input (`pass`),&#10;* minimized failing input (`fail`), and&#10;* their difference `diff`&#10;(elems that are in `fail`, but not in `pass`).">
<text xml:space="preserve" text-anchor="start" x="14" y="-85.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">dd()</text>
</a>
</g>
<g id="a_node1_3"><a xlink:href="#" xlink:title="max_args(self) &#45;&gt; Dict[str, Any]:&#10;Return 1&#45;maximal arguments.">
<text xml:space="preserve" text-anchor="start" x="14" y="-72.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">max_args()</text>
</a>
</g>
<g id="a_node1_4"><a xlink:href="#" xlink:title="min_arg_diff(self) &#45;&gt; Tuple[Dict[str, Any], Dict[str, Any], Dict[str, Any]]:&#10;Return 1&#45;minimal difference between arguments.">
<text xml:space="preserve" text-anchor="start" x="14" y="-59.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">min_arg_diff()</text>
</a>
</g>
<g id="a_node1_5"><a xlink:href="#" xlink:title="min_args(self) &#45;&gt; Dict[str, Any]:&#10;Return 1&#45;minimal arguments.">
<text xml:space="preserve" text-anchor="start" x="14" y="-47" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">min_args()</text>
</a>
</g>
<g id="a_node1_6"><a xlink:href="#" xlink:title="after_collection(self) &#45;&gt; None:&#10;Called after collection. To be defined in subclasses.">
<text xml:space="preserve" text-anchor="start" x="14" y="-34.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">after_collection()</text>
</a>
</g>
<g id="a_node1_7"><a xlink:href="#" xlink:title="check_reproducibility(self) &#45;&gt; None">
<text xml:space="preserve" text-anchor="start" x="14" y="-20.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">check_reproducibility()</text>
</a>
</g>
<g id="a_node1_8"><a xlink:href="#" xlink:title="process_args(self, strategy: Callable, **strategy_args: Any) &#45;&gt; Tuple[Dict[str, Any], Dict[str, Any], Dict[str, Any]]:&#10;Reduce all reducible arguments, using `strategy`(var, `strategy_args`).&#10;Can be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="14" y="-8.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">process_args()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CachingCallReducer -->
<g id="node2" class="node">
<title>CachingCallReducer</title>
<g id="a_node2"><a xlink:href="#" xlink:title="class CachingCallReducer:&#10;Like CallReducer, but cache test outcomes.">
<polygon fill="none" stroke="black" points="5.62,-172.75 5.62,-231.5 160.38,-231.5 160.38,-172.75 5.62,-172.75"/>
<text xml:space="preserve" text-anchor="start" x="13.62" y="-215.2" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">CachingCallReducer</text>
<polyline fill="none" stroke="black" points="5.62,-206.25 160.38,-206.25"/>
<g id="a_node2_9"><a xlink:href="#" xlink:title="CachingCallReducer">
<g id="a_node2_10"><a xlink:href="#" xlink:title="init(self) &#45;&gt; None:&#10;Reset for new collection.">
<text xml:space="preserve" text-anchor="start" x="65" y="-193.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">init()</text>
</a>
</g>
<g id="a_node2_11"><a xlink:href="#" xlink:title="test(self, args: Dict[str, Any]) &#45;&gt; str:&#10;Like run(), but also log detail and keep statistics.">
<text xml:space="preserve" text-anchor="start" x="65" y="-181" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">test()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- DeltaDebugger&#45;&gt;CachingCallReducer -->
<g id="edge1" class="edge">
<title>DeltaDebugger&#45;&gt;CachingCallReducer</title>
<path fill="none" stroke="black" d="M83,-135.9C83,-144.58 83,-153.24 83,-161.28"/>
<polygon fill="none" stroke="black" points="79.5,-161.04 83,-171.04 86.5,-161.04 79.5,-161.04"/>
</g>
<!-- CallReducer -->
<g id="node3" class="node">
<title>CallReducer</title>
<g id="a_node3"><a xlink:href="#" xlink:title="class CallReducer:&#10;Collect an exception&#45;raising function call f().&#10;Use as `with CallCollector(): f()`">
<polygon fill="none" stroke="black" points="33.38,-268.5 33.38,-365.5 132.62,-365.5 132.62,-268.5 33.38,-268.5"/>
<text xml:space="preserve" text-anchor="start" x="41.38" y="-349.2" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">CallReducer</text>
<polyline fill="none" stroke="black" points="33.38,-340.25 132.62,-340.25"/>
<g id="a_node3_12"><a xlink:href="#" xlink:title="CallReducer">
<g id="a_node3_13"><a xlink:href="#" xlink:title="__init__(self, *, log: Union[bool, int] = False) &#45;&gt; None:&#10;Initialize. If `log` is True, enable logging.">
<text xml:space="preserve" text-anchor="start" x="47" y="-327.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node3_14"><a xlink:href="#" xlink:title="reduce_arg(self, var_to_be_reduced: str, args: Dict[str, Any]) &#45;&gt; Sequence:&#10;Determine and return a minimal value for var_to_be_reduced.&#10;To be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="47" y="-315" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">reduce_arg()</text>
</a>
</g>
<g id="a_node3_15"><a xlink:href="#" xlink:title="reset(self) &#45;&gt; None:&#10;Reset the number of tests.">
<text xml:space="preserve" text-anchor="start" x="47" y="-301.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">reset()</text>
</a>
</g>
<g id="a_node3_16"><a xlink:href="#" xlink:title="run(self, args: Dict[str, Any]) &#45;&gt; str:&#10;Run collected function with `args`. Return&#10;* PASS if no exception occurred&#10;* FAIL if the collected exception occurred&#10;* UNRESOLVED if some other exception occurred.&#10;Not to be used directly; can be overloaded in subclasses.">
<text xml:space="preserve" text-anchor="start" x="47" y="-289.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">run()</text>
</a>
</g>
<g id="a_node3_17"><a xlink:href="#" xlink:title="test(self, args: Dict[str, Any]) &#45;&gt; str:&#10;Like run(), but also log detail and keep statistics.">
<text xml:space="preserve" text-anchor="start" x="47" y="-276.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">test()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CachingCallReducer&#45;&gt;CallReducer -->
<g id="edge2" class="edge">
<title>CachingCallReducer&#45;&gt;CallReducer</title>
<path fill="none" stroke="black" d="M83,-231.9C83,-239.62 83,-248.26 83,-256.98"/>
<polygon fill="none" stroke="black" points="79.5,-256.91 83,-266.91 86.5,-256.91 79.5,-256.91"/>
</g>
<!-- CallCollector -->
<g id="node4" class="node">
<title>CallCollector</title>
<g id="a_node4"><a xlink:href="#" xlink:title="class CallCollector:&#10;Collect an exception&#45;raising function call f().&#10;Use as `with CallCollector(): f()`">
<polygon fill="none" stroke="black" points="21,-402.5 21,-588.75 145,-588.75 145,-402.5 21,-402.5"/>
<text xml:space="preserve" text-anchor="start" x="38.38" y="-572.45" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">CallCollector</text>
<polyline fill="none" stroke="black" points="21,-563.5 145,-563.5"/>
<g id="a_node4_18"><a xlink:href="#" xlink:title="CallCollector">
<g id="a_node4_19"><a xlink:href="#" xlink:title="__enter__(self) &#45;&gt; Any:&#10;Called at begin of `with` block. Turn tracing on.">
<text xml:space="preserve" text-anchor="start" x="29" y="-551" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__enter__()</text>
</a>
</g>
<g id="a_node4_20"><a xlink:href="#" xlink:title="__exit__(self, exc_tp: Type, exc_value: BaseException, exc_traceback: traceback) &#45;&gt; Optional[bool]:&#10;Called at end of `with` block. Turn tracing off.">
<text xml:space="preserve" text-anchor="start" x="29" y="-538.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__exit__()</text>
</a>
</g>
<g id="a_node4_21"><a xlink:href="#" xlink:title="__init__(self) &#45;&gt; None:&#10;Initialize collector">
<text xml:space="preserve" text-anchor="start" x="29" y="-525.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node4_22"><a xlink:href="#" xlink:title="args(self) &#45;&gt; Dict[str, Any]:&#10;Return the dictionary of collected arguments.">
<text xml:space="preserve" text-anchor="start" x="29" y="-512.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">args()</text>
</a>
</g>
<g id="a_node4_23"><a xlink:href="#" xlink:title="call(self, new_args: Optional[Dict[str, Any]] = None) &#45;&gt; Any:&#10;Call collected function. If `new_args` is given,&#10;override arguments from its {var: value} entries.">
<text xml:space="preserve" text-anchor="start" x="29" y="-500" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">call()</text>
</a>
</g>
<g id="a_node4_24"><a xlink:href="#" xlink:title="exception(self) &#45;&gt; Optional[BaseException]:&#10;Return the exception produced, or `None` if none.">
<text xml:space="preserve" text-anchor="start" x="29" y="-487.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">exception()</text>
</a>
</g>
<g id="a_node4_25"><a xlink:href="#" xlink:title="function(self) &#45;&gt; Callable:&#10;Return the function called.">
<text xml:space="preserve" text-anchor="start" x="29" y="-474.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">function()</text>
</a>
</g>
<g id="a_node4_26"><a xlink:href="#" xlink:title="after_collection(self) &#45;&gt; None:&#10;Called after collection. To be defined in subclasses.">
<text xml:space="preserve" text-anchor="start" x="29" y="-461.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">after_collection()</text>
</a>
</g>
<g id="a_node4_27"><a xlink:href="#" xlink:title="format_call(self, args: Optional[Dict[str, Any]] = None) &#45;&gt; str:&#10;Return a string representing a call of the function with given args.">
<text xml:space="preserve" text-anchor="start" x="29" y="-448" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">format_call()</text>
</a>
</g>
<g id="a_node4_28"><a xlink:href="#" xlink:title="format_exception(self, exc: Optional[BaseException] = None) &#45;&gt; str:&#10;Return a string representing the given exception.">
<text xml:space="preserve" text-anchor="start" x="29" y="-435.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">format_exception()</text>
</a>
</g>
<g id="a_node4_29"><a xlink:href="#" xlink:title="init(self) &#45;&gt; None:&#10;Reset for new collection.">
<text xml:space="preserve" text-anchor="start" x="29" y="-423.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">init()</text>
</a>
</g>
<g id="a_node4_30"><a xlink:href="#" xlink:title="traceit(self, frame: frame, event: str, arg: Any) &#45;&gt; None:&#10;Tracing function. Collect first call, then turn tracing off.">
<text xml:space="preserve" text-anchor="start" x="29" y="-409.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">traceit()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CallReducer&#45;&gt;CallCollector -->
<g id="edge3" class="edge">
<title>CallReducer&#45;&gt;CallCollector</title>
<path fill="none" stroke="black" d="M83,-365.8C83,-373.68 83,-382.12 83,-390.76"/>
<polygon fill="none" stroke="black" points="79.5,-390.69 83,-400.69 86.5,-390.69 79.5,-390.69"/>
</g>
<!-- StackInspector -->
<g id="node5" class="node">
<title>StackInspector</title>
<g id="a_node5"><a xlink:href="StackInspector.ipynb" xlink:title="class StackInspector:&#10;Provide functions to inspect the stack">
<polygon fill="none" stroke="black" points="0,-625.75 0,-794.5 166,-794.5 166,-625.75 0,-625.75"/>
<text xml:space="preserve" text-anchor="start" x="32.75" y="-778.2" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">StackInspector</text>
<polyline fill="none" stroke="black" points="0,-769.25 166,-769.25"/>
<g id="a_node5_31"><a xlink:href="#" xlink:title="StackInspector">
<g id="a_node5_32"><a xlink:href="StackInspector.ipynb" xlink:title="_generated_function_cache = {}">
<text xml:space="preserve" text-anchor="start" x="8" y="-755.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">_generated_function_cache</text>
</a>
</g>
</a>
</g>
<polyline fill="none" stroke="black" points="0,-748.5 166,-748.5"/>
<g id="a_node5_33"><a xlink:href="#" xlink:title="StackInspector">
<g id="a_node5_34"><a xlink:href="StackInspector.ipynb" xlink:title="caller_frame(self) &#45;&gt; frame:&#10;Return the frame of the caller.">
<text xml:space="preserve" text-anchor="start" x="26" y="-736" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">caller_frame()</text>
</a>
</g>
<g id="a_node5_35"><a xlink:href="StackInspector.ipynb" xlink:title="caller_function(self) &#45;&gt; Callable:&#10;Return the calling function">
<text xml:space="preserve" text-anchor="start" x="26" y="-723.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">caller_function()</text>
</a>
</g>
<g id="a_node5_36"><a xlink:href="StackInspector.ipynb" xlink:title="caller_globals(self) &#45;&gt; Dict[str, Any]:&#10;Return the globals() environment of the caller.">
<text xml:space="preserve" text-anchor="start" x="26" y="-710.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">caller_globals()</text>
</a>
</g>
<g id="a_node5_37"><a xlink:href="StackInspector.ipynb" xlink:title="caller_locals(self) &#45;&gt; Dict[str, Any]:&#10;Return the locals() environment of the caller.">
<text xml:space="preserve" text-anchor="start" x="26" y="-697.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">caller_locals()</text>
</a>
</g>
<g id="a_node5_38"><a xlink:href="StackInspector.ipynb" xlink:title="caller_location(self) &#45;&gt; Tuple[Callable, int]:&#10;Return the location (func, lineno) of the caller.">
<text xml:space="preserve" text-anchor="start" x="26" y="-685" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">caller_location()</text>
</a>
</g>
<g id="a_node5_39"><a xlink:href="StackInspector.ipynb" xlink:title="is_internal_error(self, exc_tp: Type, exc_value: BaseException, exc_traceback: traceback) &#45;&gt; bool:&#10;Return True if exception was raised from `StackInspector` or a subclass.">
<text xml:space="preserve" text-anchor="start" x="26" y="-672.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">is_internal_error()</text>
</a>
</g>
<g id="a_node5_40"><a xlink:href="StackInspector.ipynb" xlink:title="our_frame(self, frame: frame) &#45;&gt; bool:&#10;Return true if `frame` is in the current (inspecting) class.">
<text xml:space="preserve" text-anchor="start" x="26" y="-659.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">our_frame()</text>
</a>
</g>
<g id="a_node5_41"><a xlink:href="StackInspector.ipynb" xlink:title="search_frame(self, name: str, frame: Optional[frame] = None) &#45;&gt; Tuple[Optional[frame], Optional[Callable]]:&#10;Return a pair (`frame`, `item`)&#10;in which the function `name` is defined as `item`.">
<text xml:space="preserve" text-anchor="start" x="26" y="-646.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">search_frame()</text>
</a>
</g>
<g id="a_node5_42"><a xlink:href="StackInspector.ipynb" xlink:title="search_func(self, name: str, frame: Optional[frame] = None) &#45;&gt; Optional[Callable]:&#10;Search in callers for a definition of the function `name`">
<text xml:space="preserve" text-anchor="start" x="26" y="-634" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">search_func()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CallCollector&#45;&gt;StackInspector -->
<g id="edge4" class="edge">
<title>CallCollector&#45;&gt;StackInspector</title>
<path fill="none" stroke="black" d="M83,-589.21C83,-597.52 83,-605.93 83,-614.26"/>
<polygon fill="none" stroke="black" points="79.5,-614.02 83,-624.02 86.5,-614.02 79.5,-614.02"/>
</g>
<!-- Legend -->
<g id="node6" class="node">
<title>Legend</title>
<text xml:space="preserve" text-anchor="start" x="178.38" y="-84.12" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="10.00" fill="#6a0dad">Legend</text>
<text xml:space="preserve" text-anchor="start" x="178.38" y="-74.12" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="184.38" y="-74.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00">public_method()</text>
<text xml:space="preserve" text-anchor="start" x="178.38" y="-64.12" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="184.38" y="-64.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00">private_method()</text>
<text xml:space="preserve" text-anchor="start" x="178.38" y="-54.12" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00">• </text>
<text xml:space="preserve" text-anchor="start" x="184.38" y="-54.12" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00">overloaded_method()</text>
<text xml:space="preserve" text-anchor="start" x="178.38" y="-45.08" font-family="Helvetica,sans-Serif" font-size="9.00">Hover over names to see doc</text>
</g>
</g>
</svg>
</div></div>
</div>
</section>
<section id="why-reducing">
<h2>Why Reducing?<a class="headerlink" href="#why-reducing" title="Link to this heading">#</a></h2>
<p>A common problem in debugging is that given an input, only a <em>small part of that input may be responsible for the failure</em>. A central part of debugging is to <em>identify</em> these parts – and to simplify (or <em>reduce</em>) the input to a minimal form that reproduces the failure – but does and contains as little else as possible.</p>
<p>Here’s an example of such a situation.  We have a <code class="docutils literal notranslate"><span class="pre">mystery()</span></code> method that – given its code – can occasionally fail.  But under which circumstances does this actually happen?  We have deliberately obscured the exact condition in order to make this non-obvious.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bookutils.setup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">Tracer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">quiz</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mystery</span><span class="p">(</span><span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mo">0o17</span> <span class="o">+</span> <span class="mo">0o31</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mo">0o27</span> <span class="o">+</span> <span class="mo">0o22</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid input&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>To find an input that causes the function to fail, let us <em>fuzz</em> it – that is, feed it with random inputs – until we find a failing input. There are <a class="reference external" href="https://fuzzingbook.org">entire books about fuzzing</a>; but here, a very simple <code class="docutils literal notranslate"><span class="pre">fuzz()</span></code> function for this purpose will already suffice.</p>
<p>To build a fuzzer, we need random inputs – and thus a source for randomness. The function <code class="docutils literal notranslate"><span class="pre">random.randrange(a,</span> <span class="pre">b)</span></code> returns a random number in the range (a, b).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>107
</pre></div>
</div>
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">random.randrange()</span></code> to compose random (printable) characters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fuzz</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
    <span class="n">fuzz</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="n">fuzz</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">127</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fuzz</span>
</pre></div>
</div>
</div>
</div>
<p>Here are some random strings produced by our <code class="docutils literal notranslate"><span class="pre">fuzz()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">fuzz</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;N&amp;+slk%hyp5&#39;
&quot;&#39;@[3(rW*M5W]tMFPU4\\P@tz%[X?uo\\1?b4T;1bDeYtHx #UJ5&quot;
&#39;w}pMmPodJM,_%%BC~dYN6*g|Y*Ou9I&lt;P94}7,99ivb(9`=%jJj*Y*d~OLXk!;J&#39;
&quot;!iOU8]hqg00?u(c);&gt;:\\=V&lt;ZV1=*g#UJA&#39;No5QZ)~--[})Sdv#m*L&quot;
&#39;0iHh[-MzS.U.X}fG7aA:G&lt;bEI\&#39;Ofn[&quot;,Mx{@jfto}i3D?7%V7XdtO6BjYEa#Il)~]&#39;
&quot;E`h7h)ChX0G*m,|sosJ.mu/\\c&#39;EpaPi0(n{&quot;
</pre></div>
</div>
</div>
</div>
<p>Let us now use <code class="docutils literal notranslate"><span class="pre">fuzz()</span></code> to find an input where <code class="docutils literal notranslate"><span class="pre">mistery()</span></code> fails:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">fuzz_input</span> <span class="o">=</span> <span class="n">fuzz</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mystery</span><span class="p">(</span><span class="n">fuzz_input</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<p>This is an input that causes <code class="docutils literal notranslate"><span class="pre">mystery()</span></code> to fail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">failing_input</span> <span class="o">=</span> <span class="n">fuzz_input</span>
<span class="n">failing_input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>26
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ExpectError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExpectError</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/3137704634.py&quot;, line 2, in &lt;module&gt;
    mystery(failing_input)
    ~~~~~~~^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4141878445.py&quot;, line 5, in mystery
    raise ValueError(&quot;Invalid input&quot;)
ValueError: Invalid input (expected)
</pre></div>
</div>
</div>
</div>
<p>Something in this input causes <code class="docutils literal notranslate"><span class="pre">mystery()</span></code> to fail.  But what is it?</p>
</section>
<section id="manual-input-reduction">
<h2>Manual Input Reduction<a class="headerlink" href="#manual-input-reduction" title="Link to this heading">#</a></h2>
<p>One important step in the debugging process is <em>reduction</em> – that is, to identify those circumstances of a failure that are relevant for the failure to occur, and to <em>omit</em> (if possible) those parts that are not.  As Kernighan and Pike \cite{Kernighan1999} put it:</p>
<blockquote>
<div><p>For every circumstance of the problem, check whether it is relevant for the problem to occur.  If it is not, remove it from the problem report or the test case in question.</p>
</div></blockquote>
<p>Specifically for inputs, they suggest a <em>divide and conquer</em> process:</p>
<blockquote>
<div><p>Proceed by binary search.  Throw away half the input and see if the output is still wrong; if not, go back to the previous state and discard the other half of the input.</p>
</div></blockquote>
<p>This is something we can easily try out, using our last generated input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">failing_input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;
</pre></div>
</div>
</div>
</div>
<p>For instance, we can see whether the error still occurs if we only feed in the first half:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">half_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>   <span class="c1"># // is integer division</span>
<span class="n">first_half</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[:</span><span class="n">half_length</span><span class="p">]</span>
<span class="n">first_half</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;V&quot;/+!aF-(V4EO&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">first_half</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Nope – the first half alone does not suffice.  Maybe the second half?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">second_half</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">half_length</span><span class="p">:]</span>
<span class="k">assert</span> <span class="n">first_half</span> <span class="o">+</span> <span class="n">second_half</span> <span class="o">==</span> <span class="n">failing_input</span>
<span class="n">second_half</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;z*+s/Q,7)2@0_&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">second_half</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This did not go so well either.  We may still proceed by cutting away <em>smaller chunks</em> – say, one character after another.  If our test is deterministic and easily repeated, it is clear that this process eventually will yield a reduced input.  But still, it is a rather inefficient process, especially for long inputs.  What we need is a <em>strategy</em> that effectively minimizes a failure-inducing input – a strategy that can be automated.</p>
</section>
<section id="delta-debugging">
<h2>Delta Debugging<a class="headerlink" href="#delta-debugging" title="Link to this heading">#</a></h2>
<p>One strategy to effectively reduce failure-inducing inputs is <em>delta debugging</em> \cite{Zeller2002}.  Delta Debugging implements the “binary search” strategy, as listed above, but with a twist: If neither half fails (also as above), it keeps on cutting away smaller and smaller chunks from the input, until it eliminates individual characters.  Thus, after cutting away the first half, we cut away
the first quarter, the second quarter, and so on.</p>
<p>Let us illustrate this on our example, and see what happens if we cut away the first quarter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quarter_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span>
<span class="n">input_without_first_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:]</span>
<span class="n">input_without_first_quarter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;F-(V4EOz*+s/Q,7)2@0_&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">input_without_first_quarter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2963114098.py&quot;, line 2, in &lt;module&gt;
    mystery(input_without_first_quarter)
    ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4141878445.py&quot;, line 5, in mystery
    raise ValueError(&quot;Invalid input&quot;)
ValueError: Invalid input (expected)
</pre></div>
</div>
</div>
</div>
<p>Ah! This has failed, and reduced our failing input by 25%.  Let’s remove another quarter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_without_first_and_second_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:]</span>
<span class="n">input_without_first_and_second_quarter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Oz*+s/Q,7)2@0_&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">input_without_first_and_second_quarter</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is not too surprising, as we had that one before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">second_half</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;z*+s/Q,7)2@0_&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_without_first_and_second_quarter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Oz*+s/Q,7)2@0_&#39;
</pre></div>
</div>
</div>
</div>
<p>How about removing the third quarter, then?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_without_first_and_third_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:</span>
                                                      <span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:]</span>
<span class="n">input_without_first_and_third_quarter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;F-(V4EQ,7)2@0_&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">input_without_first_and_third_quarter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4218135276.py&quot;, line 2, in &lt;module&gt;
    mystery(input_without_first_and_third_quarter)
    ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4141878445.py&quot;, line 5, in mystery
    raise ValueError(&quot;Invalid input&quot;)
ValueError: Invalid input (expected)
</pre></div>
</div>
</div>
</div>
<p>Yes!  This has succeeded.  Our input is now 50% smaller.</p>
<p>We have now tried to remove pieces that make up <span class="math notranslate nohighlight">\(\frac{1}{2}\)</span> and <span class="math notranslate nohighlight">\(\frac{1}{4}\)</span> of the original failing string.  In the next iteration, we would go and remove even smaller pieces – <span class="math notranslate nohighlight">\(\frac{1}{8}\)</span>, <span class="math notranslate nohighlight">\(\frac{1}{16}\)</span> and so on.  We continue until we are down to <span class="math notranslate nohighlight">\(\frac{1}{26}\)</span> – that is, individual characters.</p>
<p>However, this is something we happily let a computer do for us – and this is what the <em>Delta Debugging</em> algorithm does.  Delta Debugging implements the strategy sketched above: It first removes larger chunks of size <span class="math notranslate nohighlight">\(\frac{1}{2}\)</span>; if this does not fail, then we proceed to chunks of size <span class="math notranslate nohighlight">\(\frac{1}{4}\)</span>, then <span class="math notranslate nohighlight">\(\frac{1}{8}\)</span> and so on.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">ddmin()</span></code> implementation uses the exact same Python code as Zeller in \cite{Zeller2002}; the only difference is that it has been adapted to work on Python 3.  The variable <code class="docutils literal notranslate"><span class="pre">n</span></code> (initially 2) indicates the granularity – in each step, chunks of size <span class="math notranslate nohighlight">\(\frac{1}{n}\)</span> are cut away.  If none of the test fails (<code class="docutils literal notranslate"><span class="pre">some_complement_is_failing</span></code> is False), then <code class="docutils literal notranslate"><span class="pre">n</span></code> is doubled – until it reaches the length of the input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PASS</span> <span class="o">=</span> <span class="s1">&#39;PASS&#39;</span>
<span class="n">FAIL</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
<span class="n">UNRESOLVED</span> <span class="o">=</span> <span class="s1">&#39;UNRESOLVED&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ddmin</span><span class="p">(</span><span class="n">test</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="o">*</span><span class="n">test_args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduce `inp` to a 1-minimal failing subset, using the outcome</span>
<span class="sd">    of `test(inp, *test_args)`, which should be `PASS`, `FAIL`, or `UNRESOLVED`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">test</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="o">*</span><span class="n">test_args</span><span class="p">)</span> <span class="o">!=</span> <span class="n">PASS</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Initial granularity</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Where to start the next subset</span>
        <span class="n">subset_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">some_complement_is_failing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
            <span class="c1"># Cut out inp[start:(start + subset_length)]</span>
            <span class="n">complement</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">inp</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">inp</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">subset_length</span><span class="p">:]</span>  <span class="c1"># type: ignore</span>

            <span class="k">if</span> <span class="n">test</span><span class="p">(</span><span class="n">complement</span><span class="p">,</span> <span class="o">*</span><span class="n">test_args</span><span class="p">)</span> <span class="o">==</span> <span class="n">FAIL</span><span class="p">:</span>
                <span class="c1"># Continue with reduced input</span>
                <span class="n">inp</span> <span class="o">=</span> <span class="n">complement</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">some_complement_is_failing</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

            <span class="c1"># Continue with next subset</span>
            <span class="n">start</span> <span class="o">+=</span> <span class="n">subset_length</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">some_complement_is_failing</span><span class="p">:</span>
            <span class="c1"># Increase granularity</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">inp</span>
</pre></div>
</div>
</div>
</div>
<p>To see how <code class="docutils literal notranslate"><span class="pre">ddmin()</span></code> works, let us run it on our failing input. We need to define a <code class="docutils literal notranslate"><span class="pre">test</span></code> function that returns PASS or FAIL, depending on the test outcome. This <code class="docutils literal notranslate"><span class="pre">generic_test()</span></code> assumes that the function fails if it raises an exception (such as an <code class="docutils literal notranslate"><span class="pre">AssertException</span></code>), and passes otherwise. The optional argument <code class="docutils literal notranslate"><span class="pre">expected_exc</span></code> specifies the name of exception to be checked for; this ensures we reduce only for the kind of error raised in the original failure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generic_test</span><span class="p">(</span><span class="n">inp</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
                 <span class="n">expected_exc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">detail</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="n">PASS</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">if</span> <span class="n">expected_exc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="n">FAIL</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">expected_exc</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">expected_exc</span><span class="p">):</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="n">FAIL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="n">UNRESOLVED</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">outcome</span><span class="si">}{</span><span class="n">detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outcome</span>
</pre></div>
</div>
</div>
</div>
<p>We can now invoke <code class="docutils literal notranslate"><span class="pre">ddmin()</span></code> in our setting. With each step, we see how the remaining input gets smaller and smaller, until only two characters remain:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ddmin</span><span class="p">(</span><span class="n">generic_test</span><span class="p">,</span> <span class="n">failing_input</span><span class="p">,</span> <span class="n">mystery</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid input&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mystery(&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
mystery(&#39;z*+s/Q,7)2@0_&#39;): PASS
mystery(&#39;V&quot;/+!aF-(V4EO&#39;): PASS
mystery(&#39;F-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
mystery(&#39;Oz*+s/Q,7)2@0_&#39;): PASS
mystery(&#39;F-(V4EQ,7)2@0_&#39;): FAIL (ValueError: Invalid input)
mystery(&#39;,7)2@0_&#39;): PASS
mystery(&#39;F-(V4EQ&#39;): PASS
mystery(&#39;V4EQ,7)2@0_&#39;): PASS
mystery(&#39;F-(Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
mystery(&#39;Q,7)2@0_&#39;): PASS
mystery(&#39;F-()2@0_&#39;): FAIL (ValueError: Invalid input)
mystery(&#39;2@0_&#39;): PASS
mystery(&#39;F-()&#39;): FAIL (ValueError: Invalid input)
mystery(&#39;()&#39;): FAIL (ValueError: Invalid input)
mystery(&#39;)&#39;): PASS
mystery(&#39;(&#39;): PASS
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;()&#39;
</pre></div>
</div>
</div>
</div>
<p>Now we know why <code class="docutils literal notranslate"><span class="pre">mystery()</span></code> fails – it suffices that the input contains two matching parentheses.  Delta Debugging determines this in 25 steps.  Its result is <em>1-minimal</em>, meaning that every character contained is required to produce the error; removing any (as seen in the last two tests, above) no longer causes the test to fail.  This property is guaranteed by the delta debugging algorithm, which in its last stage always tries to delete characters one by one.</p>
<p>A reduced test case such as the one above has many advantages:</p>
<ul class="simple">
<li><p>A reduced test case <strong>reduces the <em>cognitive load</em> of the programmer</strong>.  The test case is shorter and focused, and thus does not burden the programmer with irrelevant details.  A reduced input typically leads to shorter executions and smaller program states, both of which reduce the search space as it comes to understanding the bug.  In our case, we have eliminated lots of irrelevant input – only the two characters the reduced input contains are relevant.</p></li>
<li><p>A reduced test case <strong>is easier to communicate</strong>.  All one needs here is the summary: <code class="docutils literal notranslate"><span class="pre">mystery()</span> <span class="pre">fails</span> <span class="pre">on</span> <span class="pre">&quot;()&quot;</span></code>, which is much better than <code class="docutils literal notranslate"><span class="pre">mystery()</span> <span class="pre">fails</span> <span class="pre">on</span> <span class="pre">a</span> <span class="pre">4100-character</span> <span class="pre">input</span> <span class="pre">(attached)</span></code>.</p></li>
<li><p>A reduced test case helps in <strong>identifying duplicates</strong>.  If similar bugs have been reported already, and all of them have been reduced to the same cause (namely that the input contains matching parentheses), then it becomes obvious that all these bugs are different symptoms of the same underlying cause – and would all be resolved at once with one code fix.</p></li>
</ul>
<p>How effective is delta debugging?  In the best case (when the left half or the right half fails), the number of tests is logarithmic proportional to the length <span class="math notranslate nohighlight">\(n\)</span> of an input (i.e., <span class="math notranslate nohighlight">\(O(\log_2 n)\)</span>); this is the same complexity as binary search.  In the worst case, though, delta debugging can require a number of tests proportional to <span class="math notranslate nohighlight">\(n^2\)</span> (i.e., <span class="math notranslate nohighlight">\(O(n^2)\)</span>) – this happens in the case when we are down to character granularity, and we have to repeatedly tried to delete all characters, only to find that deleting the last character results in a failure \cite{Zeller2002}.  (This is a pretty pathological situation, though.)</p>
<p>In general, delta debugging is a robust algorithm that is easy to implement, easy to deploy, and easy to use – provided that the underlying test case is deterministic and runs quickly enough to warrant a number of experiments. In general, any debugging task should start with simplifying the test case as much as possible – and this is where delta debugging can help.</p>
</section>
<section id="a-simple-deltadebugger-interface">
<h2>A Simple DeltaDebugger Interface<a class="headerlink" href="#a-simple-deltadebugger-interface" title="Link to this heading">#</a></h2>
<p>As defined above, using <code class="docutils literal notranslate"><span class="pre">ddmin()</span></code> still requires the developer to set up a special testing function – and writing or using even a generic tester (like <code class="docutils literal notranslate"><span class="pre">generic_test()</span></code>) takes some effort.  We want to simplify the setup such that only two lines of Python is required.</p>
<p>Our aim is to have a <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> class that we can use in conjunction with a failing (i.e., exception raising) function call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
<p>Here, at the end of the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement, printing out <code class="docutils literal notranslate"><span class="pre">dd</span></code> shows us the minimal input that causes the failure.</p>
<section id="excursion-implementing-deltadebugger">
<h3>Excursion: Implementing DeltaDebugger<a class="headerlink" href="#excursion-implementing-deltadebugger" title="Link to this heading">#</a></h3>
<p>Our interface consist of six building blocks:</p>
<ol class="arabic simple">
<li><p>We collect the name and args of the first call in the <code class="docutils literal notranslate"><span class="pre">with</span></code> body, as well as the exception it raises.</p></li>
<li><p>We set up an infrastructure such that we can repeat calls with different arguments.</p></li>
<li><p>We make sure that multiple tests with the same arguments can return outcomes from a cache.</p></li>
<li><p>We create a <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> class that implements the general Delta Debugging algorithm – an algorithm than can minimize failing inputs as well as maximize passing inputs.</p></li>
<li><p>We provide an infrastructure that applies Delta Debugging on multiple arguments.</p></li>
<li><p>Finally, custom methods like <code class="docutils literal notranslate"><span class="pre">min_args()</span></code> allow invoking delta debugging on arguments.</p></li>
</ol>
<section id="collecting-a-call">
<h4>Collecting a Call<a class="headerlink" href="#collecting-a-call" title="Link to this heading">#</a></h4>
<p>We start by creating an infrastructure that collects a call. The <code class="docutils literal notranslate"><span class="pre">CallCollector</span></code> class saves the first call observed in <code class="docutils literal notranslate"><span class="pre">_function</span></code>, <code class="docutils literal notranslate"><span class="pre">_args</span></code>, and <code class="docutils literal notranslate"><span class="pre">_exception</span></code> attributes, respectively; it then turns tracing off.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">TracebackType</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">StackInspector</span><span class="w"> </span><span class="kn">import</span> <span class="n">StackInspector</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NoCallError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CallCollector</span><span class="p">(</span><span class="n">StackInspector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collect an exception-raising function call f().</span>
<span class="sd">    Use as `with CallCollector(): f()`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize collector&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset for new collection.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">traceit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tracing function. Collect first call, then turn tracing off.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">):</span>
                <span class="c1"># Internal function</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Already set</span>
                <span class="k">return</span>

            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">func</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">func</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Create new function from given code</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Create a local copy of args</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_freevars</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># Local var, not an argument</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

            <span class="c1"># Turn tracing off</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">after_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called after collection. To be defined in subclasses.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dictionary of collected arguments.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the function called.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoCallError</span><span class="p">(</span><span class="s2">&quot;No function call collected&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exception</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the exception produced, or `None` if none.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">format_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">format_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">CallCollector</span></code> is used like a <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> from the <a class="reference internal" href="Tracer.html"><span class="std std-doc">chapter on tracing</span></a>, using a <code class="docutils literal notranslate"><span class="pre">with</span></code> block to collect a single function call.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CallCollector</span><span class="p">(</span><span class="n">CallCollector</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called at begin of `with` block. Turn tracing on.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">gettrace</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceit</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_tp</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
                 <span class="n">exc_traceback</span><span class="p">:</span> <span class="n">TracebackType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called at end of `with` block. Turn tracing off.&quot;&quot;&quot;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exc_tp</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># re-raise exception</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoCallError</span><span class="p">(</span><span class="s2">&quot;No call collected&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_internal_error</span><span class="p">(</span><span class="n">exc_tp</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Re-raise exception</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span> <span class="o">=</span> <span class="n">exc_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">after_collection</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Ignore exception</span>
</pre></div>
</div>
</div>
</div>
<p>Here are the attributes as collected by <code class="docutils literal notranslate"><span class="pre">CallCollector</span></code> for our <code class="docutils literal notranslate"><span class="pre">mystery()</span></code> function. Note that the <code class="docutils literal notranslate"><span class="pre">mystery()</span></code> exception is “swallowed” by the <code class="docutils literal notranslate"><span class="pre">CallCollector</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CallCollector</span><span class="p">()</span> <span class="k">as</span> <span class="n">call_collector</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">call_collector</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.mystery(inp: str) -&gt; None&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">call_collector</span><span class="o">.</span><span class="n">args</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;inp&#39;: &#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">call_collector</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ValueError(&#39;Invalid input&#39;)
</pre></div>
</div>
</div>
</div>
<p>If an error occurs <em>before</em> the first function call takes place, the exception is simply re-raised.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">NameError</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">CallCollector</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">some_error</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/700237621.py&quot;, line 3, in &lt;module&gt;
    some_error()  # type: ignore
    ^^^^^^^^^^
NameError: name &#39;some_error&#39; is not defined. Did you mean: &#39;NameError&#39;? (expected)
</pre></div>
</div>
</div>
</div>
</section>
<section id="repeating-a-call">
<h4>Repeating a Call<a class="headerlink" href="#repeating-a-call" title="Link to this heading">#</a></h4>
<p>Our second step is an infrastructure such that we can call the function collected earlier with alternate arguments. We can call the function directly via the collected <code class="docutils literal notranslate"><span class="pre">_function</span></code> attribute:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">call_collector</span><span class="o">.</span><span class="n">function</span><span class="p">()(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">call_collector</span><span class="o">.</span><span class="n">function</span><span class="p">()(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/3898025015.py&quot;, line 2, in &lt;module&gt;
    call_collector.function()(failing_input)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4141878445.py&quot;, line 5, in mystery
    raise ValueError(&quot;Invalid input&quot;)
ValueError: Invalid input (expected)
</pre></div>
</div>
</div>
</div>
<p>We can also provide the arguments collected during the call:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">call_collector</span><span class="o">.</span><span class="n">function</span><span class="p">()(</span><span class="o">**</span><span class="n">call_collector</span><span class="o">.</span><span class="n">args</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/1915817655.py&quot;, line 2, in &lt;module&gt;
    call_collector.function()(**call_collector.args())
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4141878445.py&quot;, line 5, in mystery
    raise ValueError(&quot;Invalid input&quot;)
ValueError: Invalid input (expected)
</pre></div>
</div>
</div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">call()</span></code> method calls the collected function using this construct. It also allows changing_ individual arguments by providing a <code class="docutils literal notranslate"><span class="pre">new_args</span></code> dictionary of variable names to new values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CallCollector</span><span class="p">(</span><span class="n">CallCollector</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call collected function. If `new_args` is given,</span>
<span class="sd">        override arguments from its {var: value} entries.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">new_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_args</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Create local copy</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">():</span>
            <span class="n">args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">()[</span><span class="n">var</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">new_args</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">()(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Using simply <code class="docutils literal notranslate"><span class="pre">call()</span></code> without arguments reproduces the failure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CallCollector</span><span class="p">()</span> <span class="k">as</span> <span class="n">call_collector</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
<span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">call_collector</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/460230734.py&quot;, line 4, in &lt;module&gt;
    call_collector.call()
    ~~~~~~~~~~~~~~~~~~~^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/3952656613.py&quot;, line 17, in call
    return self.function()(**args)
           ~~~~~~~~~~~~~~~^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4141878445.py&quot;, line 5, in mystery
    raise ValueError(&quot;Invalid input&quot;)
ValueError: Invalid input (expected)
</pre></div>
</div>
</div>
</div>
<p>We can also supply alternate arguments (and get alternate outcomes):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">call_collector</span><span class="o">.</span><span class="n">call</span><span class="p">({</span><span class="s1">&#39;inp&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>We close with two helper functions that come handy for logging and error messages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CallCollector</span><span class="p">(</span><span class="n">CallCollector</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representing a call of the function with given args.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">format_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representing the given exception.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CallCollector</span><span class="p">()</span> <span class="k">as</span> <span class="n">call_collector</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">call_collector</span><span class="o">.</span><span class="n">format_call</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;mystery(inp=\&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_\&#39;)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">call_collector</span><span class="o">.</span><span class="n">format_exception</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;ValueError: Invalid input&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="testing-logging-and-caching">
<h4>Testing, Logging, and Caching<a class="headerlink" href="#testing-logging-and-caching" title="Link to this heading">#</a></h4>
<p>Our next to last step is an infrastructure that implements delta debugging for the collected call.</p>
<p>We first introduce a <code class="docutils literal notranslate"><span class="pre">CallReducer</span></code> class as an abstract superclass for all kinds of reducers.
Its <code class="docutils literal notranslate"><span class="pre">run()</span></code> method tests the function and returns PASS, FAIL, or UNRESOLVED. As with <code class="docutils literal notranslate"><span class="pre">generic_test()</span></code>, above, we check for exception type and exact error message.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CallReducer</span><span class="p">(</span><span class="n">CallCollector</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">log</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize. If `log` is True, enable logging.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the number of tests.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run collected function with `args`. Return</span>
<span class="sd">        * PASS if no exception occurred</span>
<span class="sd">        * FAIL if the collected exception occurred</span>
<span class="sd">        * UNRESOLVED if some other exception occurred.</span>
<span class="sd">        Not to be used directly; can be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_exception</span> <span class="o">=</span> <span class="n">exc</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span> <span class="ow">and</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">())):</span>
                <span class="k">return</span> <span class="n">FAIL</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">UNRESOLVED</span>  <span class="c1"># Some other failure</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">PASS</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">test()</span></code> method runs a single test (with logging, if wanted); the <code class="docutils literal notranslate"><span class="pre">reduce_arg()</span></code> method will eventually reduce an input to the minimum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CallReducer</span><span class="p">(</span><span class="n">CallReducer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Like run(), but also log detail and keep statistics.&quot;&quot;&quot;</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outcome</span> <span class="o">==</span> <span class="n">PASS</span><span class="p">:</span>
            <span class="n">detail</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">detail</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_exception</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">outcome</span><span class="si">}{</span><span class="n">detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outcome</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reduce_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_to_be_reduced</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine and return a minimal value for var_to_be_reduced.</span>
<span class="sd">        To be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="n">var_to_be_reduced</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s some logging output from the <code class="docutils literal notranslate"><span class="pre">test()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CallReducer</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">reducer</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>

<span class="n">reducer</span><span class="o">.</span><span class="n">test</span><span class="p">({</span><span class="s1">&#39;inp&#39;</span><span class="p">:</span> <span class="n">failing_input</span><span class="p">})</span>
<span class="n">reducer</span><span class="o">.</span><span class="n">test</span><span class="p">({</span><span class="s1">&#39;inp&#39;</span><span class="p">:</span> <span class="s1">&#39;123&#39;</span><span class="p">})</span>
<span class="n">reducer</span><span class="o">.</span><span class="n">test</span><span class="p">({</span><span class="s1">&#39;inp&#39;</span><span class="p">:</span> <span class="s1">&#39;123&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test #1 mystery(inp=&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Test #2 mystery(inp=&#39;123&#39;): PASS
Test #3 mystery(inp=&#39;123&#39;): PASS
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;PASS&#39;
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">CachingCallReducer</span></code> variant saves test results, such that we don’t have to run the same tests again and again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CachingCallReducer</span><span class="p">(</span><span class="n">CallReducer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Like CallReducer, but cache test outcomes.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">FrozenSet</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Create a hashable index</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span>
            <span class="c1"># Non-hashable value – do not use cache</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="n">outcome</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcome</span>

        <span class="k">return</span> <span class="n">outcome</span>
</pre></div>
</div>
</div>
</div>
<p>If we now repeat a test with the same argument, its outcome can be found in the cache:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CachingCallReducer</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">reducer</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>

<span class="n">reducer</span><span class="o">.</span><span class="n">test</span><span class="p">({</span><span class="s1">&#39;inp&#39;</span><span class="p">:</span> <span class="n">failing_input</span><span class="p">})</span>
<span class="n">reducer</span><span class="o">.</span><span class="n">test</span><span class="p">({</span><span class="s1">&#39;inp&#39;</span><span class="p">:</span> <span class="s1">&#39;123&#39;</span><span class="p">})</span>
<span class="n">reducer</span><span class="o">.</span><span class="n">test</span><span class="p">({</span><span class="s1">&#39;inp&#39;</span><span class="p">:</span> <span class="s1">&#39;123&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test #1 mystery(inp=&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Test #2 mystery(inp=&#39;123&#39;): PASS
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;PASS&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="general-delta-debugging">
<h4>General Delta Debugging<a class="headerlink" href="#general-delta-debugging" title="Link to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> class finally implements Delta Debugging on arguments. Our implementation uses the <em>general</em> <code class="docutils literal notranslate"><span class="pre">dd</span></code> delta debugging algorithm from \cite{Zeller2002}. In contrast to <code class="docutils literal notranslate"><span class="pre">ddmin</span></code>, it returns a <em>pair</em> of a maximized passing input and a minimized failing input. The algorithm can be customized, however, to leave the passing input fixed and <em>only</em> to minimize the failing input (as with <code class="docutils literal notranslate"><span class="pre">ddmin</span></code>), or vice versa.</p>
<p>Internally, <code class="docutils literal notranslate"><span class="pre">dd</span></code> does not directly work on a list of elements; instead, it works on sets of <em>indices</em> into such a list. The function <code class="docutils literal notranslate"><span class="pre">to_set()</span></code> converts a collection into such a set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">to_set</span><span class="p">(</span><span class="n">inp</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert inp into a set of indices&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">to_set</span><span class="p">(</span><span class="s2">&quot;abcd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0, 1, 2, 3}
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">from_set()</span></code> converts a set of indices back into the original collection. For this, it uses a function <code class="docutils literal notranslate"><span class="pre">empty()</span></code> that returns an empty collection that has the same type as the given input <code class="docutils literal notranslate"><span class="pre">inp</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">empty</span><span class="p">(</span><span class="n">inp</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return an &quot;empty&quot; element of the same type as inp&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">inp</span><span class="p">)()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">empty</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">),</span> <span class="n">empty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">empty</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;&#39;, [], set())
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">add_to()</span></code> tries out various ways to add an element to a given collection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add_to</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">elem</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add element to collection; return new collection.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">collection</span> <span class="o">+</span> <span class="n">elem</span>  <span class="c1"># Strings</span>

    <span class="k">try</span><span class="p">:</span>  <span class="c1"># Lists and other collections</span>
        <span class="k">return</span> <span class="n">collection</span> <span class="o">+</span> <span class="nb">type</span><span class="p">(</span><span class="n">collection</span><span class="p">)([</span><span class="n">elem</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>  <span class="c1"># Sets</span>
        <span class="k">return</span> <span class="n">collection</span> <span class="o">|</span> <span class="nb">type</span><span class="p">(</span><span class="n">collection</span><span class="p">)([</span><span class="n">elem</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot add element to collection&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">add_to</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">),</span> <span class="n">add_to</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">add_to</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;abcd&#39;, [1, 2, 3, 4], {1, 2, 3, 4})
</pre></div>
</div>
</div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">empty()</span></code> and <code class="docutils literal notranslate"><span class="pre">add_to()</span></code>, we can now implement <code class="docutils literal notranslate"><span class="pre">from_set()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">from_set</span><span class="p">(</span><span class="n">the_set</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a set of indices into `inp` back into a collection.&quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">the_set</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">add_to</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">from_set</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="s2">&quot;abcd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;bc&#39;
</pre></div>
</div>
</div>
</div>
<p>To split a set of elements into <code class="docutils literal notranslate"><span class="pre">n</span></code> subsets of equal size, we use this helper function, based on <a class="reference external" href="https://stackoverflow.com/questions/2130016/splitting-a-list-into-n-parts-of-approximately-equal-length/37414115#37414115">this discussion in StackOverflow</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span><span class="n">elems</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elems</span><span class="p">)</span>

    <span class="n">k</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elems</span><span class="p">),</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">subsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">elems</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">):(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">)]</span>
                       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="c1"># Convert to list and back</span>
        <span class="n">subsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">elems</span><span class="p">)(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">elems</span><span class="p">)[</span><span class="n">i</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">):(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">)])</span>
                       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">subsets</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span>
    <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span> <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">subsets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">elems</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">subsets</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">subsets</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">split</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1, 2, 3, 4, 5, 6, 7]]
[[1, 2, 3, 4], [5, 6, 7]]
[[1, 2, 3], [4, 5], [6, 7]]
[[1, 2], [3, 4], [5, 6], [7]]
[[1, 2], [3, 4], [5], [6], [7]]
[[1, 2], [3], [4], [5], [6], [7]]
[[1], [2], [3], [4], [5], [6], [7]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ab&#39;, &#39;c&#39;, &#39;d&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">split</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">},</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{1, 2, 3}, {4, 5}, {6, 7}]
</pre></div>
</div>
</div>
</div>
<p>With these, we can now implement general delta debugging. Our implementation follows \cite{Zeller2002} with the following optimizations:</p>
<ol class="arabic simple">
<li><p>We can control whether only to minimize or to maximize (“mode”)</p></li>
<li><p>The operations “Reduce to subset” and “Increase to subset” are only taken while the number of subsets is still 2.</p></li>
<li><p>If “Reduce to subset” and “Increase to subset” are successful, the offset is set to <code class="docutils literal notranslate"><span class="pre">i</span></code> (not <code class="docutils literal notranslate"><span class="pre">0</span></code>) to distribute reduction operations more evenly across the input. (Thanks to Olaf Chitil and Joanna Sharrad to point out this issue!)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NotFailingError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NotPassingError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DeltaDebugger</span><span class="p">(</span><span class="n">CachingCallReducer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_to_be_reduced</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fail_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
           <span class="o">*</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;General Delta Debugging.</span>
<span class="sd">        `var_to_be_reduced` - the name of the variable to reduce.</span>
<span class="sd">        `fail_args` - a dict of (failure-inducing) function arguments, </span>
<span class="sd">            with `fail_args[var_to_be_reduced]` - the input to apply dd on.</span>
<span class="sd">        `mode`- how the algorithm should operate:</span>
<span class="sd">            &#39;-&#39; (default): minimize input (`ddmin`),</span>
<span class="sd">            &#39;+&#39;: maximizing input (`ddmax`),</span>
<span class="sd">            &#39;+-&#39;: minimizing pass/fail difference (`dd`)</span>
<span class="sd">        Returns a triple (`pass`, `fail`, `diff`) with</span>
<span class="sd">        * maximized passing input (`pass`), </span>
<span class="sd">        * minimized failing input (`fail`), and</span>
<span class="sd">        * their difference `diff`</span>
<span class="sd">          (elems that are in `fail`, but not in `pass`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Set</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="c1"># Set up args</span>
            <span class="n">test_args</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fail_args</span><span class="p">:</span>
                <span class="n">test_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">fail_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
            <span class="n">test_args</span><span class="p">[</span><span class="n">var_to_be_reduced</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_set</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">fail_inp</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test_args</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">ret</span><span class="p">(</span><span class="n">c_pass</span><span class="p">:</span> <span class="n">Set</span><span class="p">,</span> <span class="n">c_fail</span><span class="p">:</span> <span class="n">Set</span><span class="p">)</span> <span class="o">-&gt;</span> \
            <span class="n">Tuple</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">from_set</span><span class="p">(</span><span class="n">c_pass</span><span class="p">,</span> <span class="n">fail_inp</span><span class="p">),</span>
                    <span class="n">from_set</span><span class="p">(</span><span class="n">c_fail</span><span class="p">,</span> <span class="n">fail_inp</span><span class="p">),</span>
                    <span class="n">from_set</span><span class="p">(</span><span class="n">c_fail</span> <span class="o">-</span> <span class="n">c_pass</span><span class="p">,</span> <span class="n">fail_inp</span><span class="p">))</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Initial granularity</span>

        <span class="n">fail_inp</span> <span class="o">=</span> <span class="n">fail_args</span><span class="p">[</span><span class="n">var_to_be_reduced</span><span class="p">]</span>

        <span class="n">c_pass</span> <span class="o">=</span> <span class="n">to_set</span><span class="p">([])</span>
        <span class="n">c_fail</span> <span class="o">=</span> <span class="n">to_set</span><span class="p">(</span><span class="n">fail_inp</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">minimize_fail</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">mode</span>
        <span class="n">maximize_pass</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span> <span class="ow">in</span> <span class="n">mode</span>

        <span class="c1"># Validate inputs</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">(</span><span class="n">c_pass</span><span class="p">)</span> <span class="o">==</span> <span class="n">FAIL</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">maximize_pass</span><span class="p">:</span>
                <span class="n">s_pass</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">from_set</span><span class="p">(</span><span class="n">c_pass</span><span class="p">,</span> <span class="n">fail_inp</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">NotPassingError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">s_pass</span><span class="si">}</span><span class="s2"> expected to pass, but fails&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="n">c_pass</span><span class="p">,</span> <span class="n">c_pass</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">test</span><span class="p">(</span><span class="n">c_fail</span><span class="p">)</span> <span class="o">==</span> <span class="n">PASS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">minimize_fail</span><span class="p">:</span>
                <span class="n">s_fail</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">from_set</span><span class="p">(</span><span class="n">c_fail</span><span class="p">,</span> <span class="n">fail_inp</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">NotFailingError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">s_fail</span><span class="si">}</span><span class="s2"> expected to fail, but passes&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="n">c_fail</span><span class="p">,</span> <span class="n">c_fail</span><span class="p">)</span>

        <span class="c1"># Main loop</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Passing input:&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">from_set</span><span class="p">(</span><span class="n">c_pass</span><span class="p">,</span> <span class="n">fail_inp</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failing input:&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">from_set</span><span class="p">(</span><span class="n">c_fail</span><span class="p">,</span> <span class="n">fail_inp</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Granularity:  &quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

            <span class="n">delta</span> <span class="o">=</span> <span class="n">c_fail</span> <span class="o">-</span> <span class="n">c_pass</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="n">c_pass</span><span class="p">,</span> <span class="n">c_fail</span><span class="p">)</span>

            <span class="n">deltas</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

            <span class="n">reduction_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
                <span class="n">next_c_pass</span> <span class="o">=</span> <span class="n">c_pass</span> <span class="o">|</span> <span class="n">deltas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">next_c_fail</span> <span class="o">=</span> <span class="n">c_fail</span> <span class="o">-</span> <span class="n">deltas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">minimize_fail</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">test</span><span class="p">(</span><span class="n">next_c_pass</span><span class="p">)</span> <span class="o">==</span> <span class="n">FAIL</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reduce to subset&quot;</span><span class="p">)</span>
                    <span class="n">c_fail</span> <span class="o">=</span> <span class="n">next_c_pass</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>  <span class="c1"># was offset = 0 in original dd()</span>
                    <span class="n">reduction_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="k">elif</span> <span class="n">maximize_pass</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">test</span><span class="p">(</span><span class="n">next_c_fail</span><span class="p">)</span> <span class="o">==</span> <span class="n">PASS</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Increase to subset&quot;</span><span class="p">)</span>
                    <span class="n">c_pass</span> <span class="o">=</span> <span class="n">next_c_fail</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>  <span class="c1"># was offset = 0 in original dd()</span>
                    <span class="n">reduction_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="k">elif</span> <span class="n">minimize_fail</span> <span class="ow">and</span> <span class="n">test</span><span class="p">(</span><span class="n">next_c_fail</span><span class="p">)</span> <span class="o">==</span> <span class="n">FAIL</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reduce to complement&quot;</span><span class="p">)</span>
                    <span class="n">c_fail</span> <span class="o">=</span> <span class="n">next_c_fail</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="n">reduction_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="k">elif</span> <span class="n">maximize_pass</span> <span class="ow">and</span> <span class="n">test</span><span class="p">(</span><span class="n">next_c_pass</span><span class="p">)</span> <span class="o">==</span> <span class="n">PASS</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Increase to complement&quot;</span><span class="p">)</span>
                    <span class="n">c_pass</span> <span class="o">=</span> <span class="n">next_c_pass</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="n">reduction_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># choose next subset</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">reduction_found</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No reduction found&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="n">c_pass</span><span class="p">,</span> <span class="n">c_fail</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Increase granularity&quot;</span><span class="p">)</span>

                <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">dd()</span></code> minimizes inputs – just like <code class="docutils literal notranslate"><span class="pre">ddmin()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Its output is a triple of maximized passing input (if wanted), minimized failing input, and difference. Here is this triple for <code class="docutils literal notranslate"><span class="pre">mystery()</span></code>, just as with <code class="docutils literal notranslate"><span class="pre">ddmin()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mystery_pass</span><span class="p">,</span> <span class="n">mystery_fail</span><span class="p">,</span> <span class="n">mystery_diff</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">dd</span><span class="p">(</span><span class="s1">&#39;inp&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;inp&#39;</span><span class="p">:</span> <span class="n">failing_input</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>The first element (<code class="docutils literal notranslate"><span class="pre">mystery_pass</span></code>) is the maximal passing input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mystery_pass</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&#39;
</pre></div>
</div>
</div>
</div>
<p>The second element (<code class="docutils literal notranslate"><span class="pre">mystery_fail</span></code>) is the minimal failing input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mystery_fail</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;()&#39;
</pre></div>
</div>
</div>
</div>
<p>And the third element (<code class="docutils literal notranslate"><span class="pre">mystery_diff</span></code>) is the difference between the two:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mystery_diff</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;()&#39;
</pre></div>
</div>
</div>
</div>
<p>(Note that we will introduce more comfortable APIs later.)</p>
<p>We can follow the operation of <code class="docutils literal notranslate"><span class="pre">dd()</span></code> by increasing the logging level. We see how with every test, the difference between the passing and the failing input gets smaller and smaller.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">dd</span><span class="p">(</span><span class="s1">&#39;inp&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;inp&#39;</span><span class="p">:</span> <span class="n">failing_input</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test #1 mystery(inp=&#39;&#39;): PASS
Test #2 mystery(inp=&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Passing input: &#39;&#39;
Failing input: &#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;
Granularity:   2
Test #3 mystery(inp=&#39;V&quot;/+!aF-(V4EO&#39;): PASS
Test #4 mystery(inp=&#39;z*+s/Q,7)2@0_&#39;): PASS
No reduction found
Increase granularity
Passing input: &#39;&#39;
Failing input: &#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;
Granularity:   4
Test #5 mystery(inp=&#39;-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Reduce to complement
Passing input: &#39;&#39;
Failing input: &#39;-(V4EOz*+s/Q,7)2@0_&#39;
Granularity:   3
Test #6 mystery(inp=&#39;*+s/Q,7)2@0_&#39;): PASS
Test #7 mystery(inp=&#39;-(V4EOz7)2@0_&#39;): FAIL (ValueError: Invalid input)
Reduce to complement
Passing input: &#39;&#39;
Failing input: &#39;-(V4EOz7)2@0_&#39;
Granularity:   2
Test #8 mystery(inp=&#39;7)2@0_&#39;): PASS
Test #9 mystery(inp=&#39;-(V4EOz&#39;): PASS
No reduction found
Increase granularity
Passing input: &#39;&#39;
Failing input: &#39;-(V4EOz7)2@0_&#39;
Granularity:   4
Test #10 mystery(inp=&#39;-(V47)2@0_&#39;): FAIL (ValueError: Invalid input)
Reduce to complement
Passing input: &#39;&#39;
Failing input: &#39;-(V47)2@0_&#39;
Granularity:   3
Test #11 mystery(inp=&#39;-(V4@0_&#39;): PASS
Test #12 mystery(inp=&#39;-(V47)2&#39;): FAIL (ValueError: Invalid input)
Reduce to complement
Passing input: &#39;&#39;
Failing input: &#39;-(V47)2&#39;
Granularity:   2
Test #13 mystery(inp=&#39;-7)2&#39;): PASS
Test #14 mystery(inp=&#39;(V4&#39;): PASS
No reduction found
Increase granularity
Passing input: &#39;&#39;
Failing input: &#39;-(V47)2&#39;
Granularity:   4
Test #15 mystery(inp=&#39;-47)2&#39;): PASS
Test #16 mystery(inp=&#39;-(V7)2&#39;): FAIL (ValueError: Invalid input)
Reduce to complement
Passing input: &#39;&#39;
Failing input: &#39;-(V7)2&#39;
Granularity:   3
Test #17 mystery(inp=&#39;-(V2&#39;): PASS
Test #18 mystery(inp=&#39;(V7)&#39;): FAIL (ValueError: Invalid input)
Reduce to complement
Passing input: &#39;&#39;
Failing input: &#39;(V7)&#39;
Granularity:   2
Test #19 mystery(inp=&#39;7)&#39;): PASS
Test #20 mystery(inp=&#39;(V&#39;): PASS
No reduction found
Increase granularity
Passing input: &#39;&#39;
Failing input: &#39;(V7)&#39;
Granularity:   4
Test #21 mystery(inp=&#39;(7)&#39;): FAIL (ValueError: Invalid input)
Reduce to complement
Passing input: &#39;&#39;
Failing input: &#39;(7)&#39;
Granularity:   3
Test #22 mystery(inp=&#39;()&#39;): FAIL (ValueError: Invalid input)
Reduce to complement
Passing input: &#39;&#39;
Failing input: &#39;()&#39;
Granularity:   2
Test #23 mystery(inp=&#39;)&#39;): PASS
Test #24 mystery(inp=&#39;(&#39;): PASS
No reduction found
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;&#39;, &#39;()&#39;, &#39;()&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="processing-multiple-arguments">
<h4>Processing Multiple Arguments<a class="headerlink" href="#processing-multiple-arguments" title="Link to this heading">#</a></h4>
<p>What happens if a function has multiple arguments? First, we check if they are <em>reducible</em> – that is, they provide a <code class="docutils literal notranslate"><span class="pre">len()</span></code> length function and a way to access indexed elements. This holds for all strings and all lists, as well as other ordered collections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_reducible</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># Return True if `value` supports len() and indexing.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>Our method <code class="docutils literal notranslate"><span class="pre">process_args()</span></code> processes recorded call arguments, one after the one, until all are minimized or maximized. Processing them individually (rather than, say, all at once) allows maintaining a stable <em>context</em> during reduction.</p>
<p>This method also does all the housekeeping, checking arguments and results, and raising errors if need be.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FailureNotReproducedError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DeltaDebugger</span><span class="p">(</span><span class="n">DeltaDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_reproducibility</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Check whether running the function again fails</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span><span class="p">,</span> \
            <span class="s2">&quot;No call collected. Use `with dd: func()` first.&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">,</span> \
            <span class="s2">&quot;No arguments collected. Use `with dd: func(args)` first.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">outcome</span> <span class="o">==</span> <span class="n">UNRESOLVED</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FailureNotReproducedError</span><span class="p">(</span>
                <span class="s2">&quot;When called again, &quot;</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">())</span> <span class="o">+</span> 
                <span class="s2">&quot; raised &quot;</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_exception</span><span class="p">)</span> <span class="o">+</span>
                <span class="s2">&quot; instead of &quot;</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">()))</span>

        <span class="k">if</span> <span class="n">outcome</span> <span class="o">==</span> <span class="n">PASS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFailingError</span><span class="p">(</span><span class="s2">&quot;When called again, &quot;</span> <span class="o">+</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">())</span> <span class="o">+</span> 
                                  <span class="s2">&quot; did not fail&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">outcome</span> <span class="o">==</span> <span class="n">FAIL</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DeltaDebugger</span><span class="p">(</span><span class="n">DeltaDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">**</span><span class="n">strategy_args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> \
        <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduce all reducible arguments, using `strategy`(var, `strategy_args`).</span>
<span class="sd">        Can be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pass_args</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Local copy</span>
        <span class="n">fail_args</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Local copy</span>
        <span class="n">diff_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">():</span>
            <span class="n">fail_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">()[</span><span class="n">var</span><span class="p">]</span>
            <span class="n">diff_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">()[</span><span class="n">var</span><span class="p">]</span>
            <span class="n">pass_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">()[</span><span class="n">var</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">is_reducible</span><span class="p">(</span><span class="n">pass_args</span><span class="p">[</span><span class="n">var</span><span class="p">]):</span>
                <span class="n">pass_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">empty</span><span class="p">(</span><span class="n">pass_args</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>

        <span class="n">vars_to_be_processed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fail_args</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">pass_processed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fail_processed</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_reproducibility</span><span class="p">()</span>

        <span class="c1"># We take turns in processing variables until all are processed</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_to_be_processed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_to_be_processed</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_reducible</span><span class="p">(</span><span class="n">fail_args</span><span class="p">[</span><span class="n">var</span><span class="p">]):</span>
                    <span class="n">vars_to_be_processed</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                    <span class="k">break</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

                <span class="n">maximized_pass_value</span><span class="p">,</span> <span class="n">minimized_fail_value</span><span class="p">,</span> <span class="n">diff</span> <span class="o">=</span> \
                    <span class="n">strategy</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">fail_args</span><span class="p">,</span> <span class="o">**</span><span class="n">strategy_args</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">maximized_pass_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> 
                    <span class="nb">len</span><span class="p">(</span><span class="n">maximized_pass_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pass_args</span><span class="p">[</span><span class="n">var</span><span class="p">])):</span>
                    <span class="n">pass_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">maximized_pass_value</span>
                    <span class="c1"># FIXME: diff_args may not be correct for multiple args</span>
                    <span class="n">diff_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximized </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> to&quot;</span><span class="p">,</span>
                              <span class="nb">repr</span><span class="p">(</span><span class="n">maximized_pass_value</span><span class="p">))</span>
                    <span class="n">vars_to_be_processed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fail_args</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">pass_processed</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">minimized_fail_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> 
                    <span class="nb">len</span><span class="p">(</span><span class="n">minimized_fail_value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">fail_args</span><span class="p">[</span><span class="n">var</span><span class="p">])):</span>
                    <span class="n">fail_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">minimized_fail_value</span>
                    <span class="n">diff_args</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimized </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> to&quot;</span><span class="p">,</span>
                              <span class="nb">repr</span><span class="p">(</span><span class="n">minimized_fail_value</span><span class="p">))</span>
                    <span class="n">vars_to_be_processed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fail_args</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">fail_processed</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">vars_to_be_processed</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">assert</span> <span class="n">pass_processed</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">pass_args</span><span class="p">)</span> <span class="o">==</span> <span class="n">PASS</span><span class="p">,</span> \
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="n">pass_args</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not pass&quot;</span>
        <span class="k">assert</span> <span class="n">fail_processed</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">fail_args</span><span class="p">)</span> <span class="o">==</span> <span class="n">FAIL</span><span class="p">,</span> \
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="n">fail_args</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not fail&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="ow">and</span> <span class="n">pass_processed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximized passing call to&quot;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="n">pass_args</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="ow">and</span> <span class="n">fail_processed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimized failing call to&quot;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="n">fail_args</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">pass_args</span><span class="p">,</span> <span class="n">fail_args</span><span class="p">,</span> <span class="n">diff_args</span>
</pre></div>
</div>
</div>
</div>
<p>For more housekeeping, we define the <code class="docutils literal notranslate"><span class="pre">after_collection()</span></code> method that will be invoked at the end of the <code class="docutils literal notranslate"><span class="pre">with</span></code> block. It checks for a number of additional preconditions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DeltaDebugger</span><span class="p">(</span><span class="n">DeltaDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">after_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Some post-collection checks</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoCallError</span><span class="p">(</span><span class="s2">&quot;No function call observed&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFailingError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">()</span><span class="si">}</span><span class="s2"> did not raise an exception&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Observed </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s2">&quot; raising </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="public-api">
<h4>Public API<a class="headerlink" href="#public-api" title="Link to this heading">#</a></h4>
<p>We finish the implementation with public methods that allow users to run delta debugging and obtain the diagnostics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DeltaDebugger</span><span class="p">(</span><span class="n">DeltaDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">min_args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1-minimal arguments.&quot;&quot;&quot;</span>
        <span class="n">pass_args</span><span class="p">,</span> <span class="n">fail_args</span><span class="p">,</span> <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dd</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fail_args</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DeltaDebugger</span><span class="p">(</span><span class="n">DeltaDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1-maximal arguments.&quot;&quot;&quot;</span>
        <span class="n">pass_args</span><span class="p">,</span> <span class="n">fail_args</span><span class="p">,</span> <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dd</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pass_args</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DeltaDebugger</span><span class="p">(</span><span class="n">DeltaDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">min_arg_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return 1-minimal difference between arguments.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dd</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;+-&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">__repr__()</span></code> method returns a string representation of the minimized call.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DeltaDebugger</span><span class="p">(</span><span class="n">DeltaDebugger</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representation of the minimized call.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_args</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="end-of-excursion">
<h3>End of Excursion<a class="headerlink" href="#end-of-excursion" title="Link to this heading">#</a></h3>
<p>To see how the <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> works, let us run it on our failing input. The expected usage is as introduced earlier – we wrap the failing function in a <code class="docutils literal notranslate"><span class="pre">with</span></code> block, and then print out the debugger to see the reduced arguments. We see that <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> easily reduces the arguments to the minimal failure-inducing input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mystery(inp=&#39;()&#39;)
</pre></div>
</div>
</div>
</div>
<p>We can turn on logging for <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> to see how it proceeds. With each step, we see how the remaining input gets smaller and smaller, until only two characters remain:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Observed mystery(inp=&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;) raising ValueError: Invalid input
Test #1 mystery(inp=&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Processing inp...
Test #2 mystery(inp=&#39;&#39;): PASS
Test #3 mystery(inp=&#39;V&quot;/+!aF-(V4EO&#39;): PASS
Test #4 mystery(inp=&#39;z*+s/Q,7)2@0_&#39;): PASS
Test #5 mystery(inp=&#39;-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Test #6 mystery(inp=&#39;*+s/Q,7)2@0_&#39;): PASS
Test #7 mystery(inp=&#39;-(V4EOz7)2@0_&#39;): FAIL (ValueError: Invalid input)
Test #8 mystery(inp=&#39;7)2@0_&#39;): PASS
Test #9 mystery(inp=&#39;-(V4EOz&#39;): PASS
Test #10 mystery(inp=&#39;-(V47)2@0_&#39;): FAIL (ValueError: Invalid input)
Test #11 mystery(inp=&#39;-(V4@0_&#39;): PASS
Test #12 mystery(inp=&#39;-(V47)2&#39;): FAIL (ValueError: Invalid input)
Test #13 mystery(inp=&#39;-7)2&#39;): PASS
Test #14 mystery(inp=&#39;(V4&#39;): PASS
Test #15 mystery(inp=&#39;-47)2&#39;): PASS
Test #16 mystery(inp=&#39;-(V7)2&#39;): FAIL (ValueError: Invalid input)
Test #17 mystery(inp=&#39;-(V2&#39;): PASS
Test #18 mystery(inp=&#39;(V7)&#39;): FAIL (ValueError: Invalid input)
Test #19 mystery(inp=&#39;7)&#39;): PASS
Test #20 mystery(inp=&#39;(V&#39;): PASS
Test #21 mystery(inp=&#39;(7)&#39;): FAIL (ValueError: Invalid input)
Test #22 mystery(inp=&#39;()&#39;): FAIL (ValueError: Invalid input)
Test #23 mystery(inp=&#39;)&#39;): PASS
Test #24 mystery(inp=&#39;(&#39;): PASS
Minimized inp to &#39;()&#39;
Minimized failing call to mystery(inp=&#39;()&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mystery(inp=&#39;()&#39;)
</pre></div>
</div>
</div>
</div>
<p>It is also possible to access the debugger programmatically:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">args</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;inp&#39;: &#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;inp&#39;: &#39;()&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">What happens if the function under test does not raise an exception?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="de2760de-b293-11f0-b3c5-6298cf1a5790" id="de2760de-b293-11f0-b3c5-6298cf1a5790-1" onclick="clear_selection('de2760de-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de2760de-b293-11f0-b3c5-6298cf1a5790-1-label" for="de2760de-b293-11f0-b3c5-6298cf1a5790-1">Delta debugging searches for the minimal input that produces the same result</label><br>
    
        <input type="radio" name="de2760de-b293-11f0-b3c5-6298cf1a5790" id="de2760de-b293-11f0-b3c5-6298cf1a5790-2" onclick="clear_selection('de2760de-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de2760de-b293-11f0-b3c5-6298cf1a5790-2-label" for="de2760de-b293-11f0-b3c5-6298cf1a5790-2">Delta debugging starts a fuzzer to find an exception</label><br>
    
        <input type="radio" name="de2760de-b293-11f0-b3c5-6298cf1a5790" id="de2760de-b293-11f0-b3c5-6298cf1a5790-3" onclick="clear_selection('de2760de-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de2760de-b293-11f0-b3c5-6298cf1a5790-3-label" for="de2760de-b293-11f0-b3c5-6298cf1a5790-3">Delta debugging raises an exception</label><br>
    
        <input type="radio" name="de2760de-b293-11f0-b3c5-6298cf1a5790" id="de2760de-b293-11f0-b3c5-6298cf1a5790-4" onclick="clear_selection('de2760de-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de2760de-b293-11f0-b3c5-6298cf1a5790-4-label" for="de2760de-b293-11f0-b3c5-6298cf1a5790-4">Delta debugging runs forever in a loop</label><br>
    
    </div>
    </p>
    <input id="de2760de-b293-11f0-b3c5-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('de2760de-b293-11f0-b3c5-6298cf1a5790', 8, 0, '0 ** 0 + 1 ** 0 + 0 ** 1 + 1 ** 1')">
    <span class="quiz_hint" id="de2760de-b293-11f0-b3c5-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Indeed, <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> checks if an exception occurs. If not, you obtain a <code class="docutils literal notranslate"><span class="pre">NotFailingError</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="n">NotFailingError</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
        <span class="n">mystery</span><span class="p">(</span><span class="s2">&quot;An input that does not fail&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/3784387889.py&quot;, line 2, in &lt;module&gt;
    with DeltaDebugger() as dd:
         ~~~~~~~~~~~~~^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4114738534.py&quot;, line 24, in __exit__
    self.after_collection()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/1934034330.py&quot;, line 7, in after_collection
    raise NotFailingError(
        f&quot;{self.format_call()} did not raise an exception&quot;)
NotFailingError: mystery(inp=&#39;An input that does not fail&#39;) did not raise an exception (expected)
</pre></div>
</div>
</div>
</div>
<p>Delta Debugging also assumes that the function under test is <em>deterministic</em>. If it occasionally fails and occasionally passes, you will get random results.</p>
</section>
</section>
<section id="usage-examples">
<h2>Usage Examples<a class="headerlink" href="#usage-examples" title="Link to this heading">#</a></h2>
<p>Let us apply <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> on a number of examples.</p>
<section id="reducing-remove-html-markup">
<h3>Reducing remove_html_markup()<a class="headerlink" href="#reducing-remove-html-markup" title="Link to this heading">#</a></h3>
<p>For our ongoing <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> example, we can reduce the failure-inducing input to a minimum, too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Assertions</span><span class="w"> </span><span class="kn">import</span> <span class="n">remove_html_markup</span>  <span class="c1"># minor dependency</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;x &gt; y&quot;&#39;</span><span class="p">)</span>
<span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Observed remove_html_markup(s=&#39;&quot;x &gt; y&quot;&#39;) raising AssertionError
Test #1 remove_html_markup(s=&#39;&quot;x &gt; y&quot;&#39;): FAIL (AssertionError)
Processing s...
Test #2 remove_html_markup(s=&#39;&#39;): PASS
Test #3 remove_html_markup(s=&#39;&quot;x &gt;&#39;): FAIL (AssertionError)
Test #4 remove_html_markup(s=&#39;&quot;x&#39;): PASS
Test #5 remove_html_markup(s=&#39; &gt;&#39;): PASS
Test #6 remove_html_markup(s=&#39;x &gt;&#39;): PASS
Test #7 remove_html_markup(s=&#39;&quot; &gt;&#39;): FAIL (AssertionError)
Test #8 remove_html_markup(s=&#39;&quot;&gt;&#39;): FAIL (AssertionError)
Test #9 remove_html_markup(s=&#39;&gt;&#39;): PASS
Test #10 remove_html_markup(s=&#39;&quot;&#39;): PASS
Minimized s to &#39;&quot;&gt;&#39;
Minimized failing call to remove_html_markup(s=&#39;&quot;&gt;&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;s&#39;: &#39;&quot;&gt;&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="reducing-multiple-arguments">
<h3>Reducing Multiple Arguments<a class="headerlink" href="#reducing-multiple-arguments" title="Link to this heading">#</a></h3>
<p>If a function has multiple reducible variables, they get reduced in turns. This <code class="docutils literal notranslate"><span class="pre">string_error()</span></code> function fails whenever <code class="docutils literal notranslate"><span class="pre">s1</span></code> is a substring of <code class="docutils literal notranslate"><span class="pre">s2</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">string_error</span><span class="p">(</span><span class="n">s1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">s1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s2</span><span class="p">,</span> <span class="s2">&quot;no substrings&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> on <code class="docutils literal notranslate"><span class="pre">string_error</span></code> shows how first <code class="docutils literal notranslate"><span class="pre">s1</span></code> is reduced, then <code class="docutils literal notranslate"><span class="pre">s2</span></code>, then <code class="docutils literal notranslate"><span class="pre">s1</span></code> again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">string_error</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;foobar&quot;</span><span class="p">)</span>

<span class="n">string_error_args</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()</span>
<span class="n">string_error_args</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Observed string_error(s1=&#39;foo&#39;, s2=&#39;foobar&#39;) raising AssertionError: no substrings
Test #1 string_error(s1=&#39;foo&#39;, s2=&#39;foobar&#39;): FAIL (AssertionError: no substrings)
Processing s2...
Test #2 string_error(s1=&#39;foo&#39;, s2=&#39;&#39;): PASS
Test #3 string_error(s1=&#39;foo&#39;, s2=&#39;foo&#39;): FAIL (AssertionError: no substrings)
Test #4 string_error(s1=&#39;foo&#39;, s2=&#39;fo&#39;): PASS
Test #5 string_error(s1=&#39;foo&#39;, s2=&#39;o&#39;): PASS
Test #6 string_error(s1=&#39;foo&#39;, s2=&#39;oo&#39;): PASS
Minimized s2 to &#39;foo&#39;
Processing s1...
Test #7 string_error(s1=&#39;&#39;, s2=&#39;foo&#39;): FAIL (AssertionError: no substrings)
Minimized s1 to &#39;&#39;
Processing s2...
Test #8 string_error(s1=&#39;&#39;, s2=&#39;&#39;): FAIL (AssertionError: no substrings)
Minimized s2 to &#39;&#39;
Minimized failing call to string_error(s1=&#39;&#39;, s2=&#39;&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;s1&#39;: &#39;&#39;, &#39;s2&#39;: &#39;&#39;}
</pre></div>
</div>
</div>
</div>
<p>We see that the failure also occurs if both strings are empty:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">string_error</span><span class="p">(</span><span class="n">string_error_args</span><span class="p">[</span><span class="s1">&#39;s1&#39;</span><span class="p">],</span> <span class="n">string_error_args</span><span class="p">[</span><span class="s1">&#39;s2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/3257360882.py&quot;, line 2, in &lt;module&gt;
    string_error(string_error_args[&#39;s1&#39;], string_error_args[&#39;s2&#39;])
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/773514021.py&quot;, line 2, in string_error
    assert s1 not in s2, &quot;no substrings&quot;
           ^^^^^^^^^^^^
AssertionError: no substrings (expected)
</pre></div>
</div>
</div>
</div>
</section>
<section id="invoking-an-interactive-debugger">
<h3>Invoking an Interactive Debugger<a class="headerlink" href="#invoking-an-interactive-debugger" title="Link to this heading">#</a></h3>
<p>The results from delta debugging can be immediately used to invoke an <a class="reference internal" href="Debugger.html"><span class="std std-doc">interactive debugger</span></a> on the minimized input. To this end, we need to turn the dictionary returned by <code class="docutils literal notranslate"><span class="pre">min_args()</span></code> into arguments of the (failing) function call.</p>
<p>Python provides a simple way to turn dictionaries into function calls. The construct</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fun</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>invokes the function <code class="docutils literal notranslate"><span class="pre">fun</span></code>, with all parameters assigned from the respective values in the dictionary.</p>
<p>With this, we can immediately invoke a <code class="docutils literal notranslate"><span class="pre">Debugger</span></code> on the failing run with minimized arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Debugger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Debugger</span>  <span class="c1"># minor dependency</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;print&#39;, &#39;quit&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">Debugger</span><span class="p">():</span>
        <span class="n">string_error</span><span class="p">(</span><span class="o">**</span><span class="n">string_error_args</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calling string_error(s1 = &#39;&#39;, s2 = &#39;&#39;)
</pre></div>
</div>
<div class="output text_html"><samp>(debugger) <b>print</b></samp></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>s1 = &#39;&#39;
s2 = &#39;&#39;
</pre></div>
</div>
<div class="output text_html"><samp>(debugger) <b>quit</b></samp></div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2680174709.py&quot;, line 3, in &lt;module&gt;
    string_error(**string_error_args)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/773514021.py&quot;, line 2, in string_error
    assert s1 not in s2, &quot;no substrings&quot;
           ^^^^^^^^^^^^
AssertionError: no substrings (expected)
</pre></div>
</div>
</div>
</div>
</section>
<section id="reducing-other-collections">
<h3>Reducing other Collections<a class="headerlink" href="#reducing-other-collections" title="Link to this heading">#</a></h3>
<p>Our <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> is not limited to strings. It can reduce any argument <code class="docutils literal notranslate"><span class="pre">x</span></code> for which a <code class="docutils literal notranslate"><span class="pre">len(x)</span></code> operation and an indexing operation <code class="docutils literal notranslate"><span class="pre">x[i]</span></code> is defined – notably lists. Here is how to apply <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> on a list:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">list_error</span><span class="p">(</span><span class="n">l1</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">l2</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxlen</span><span class="p">,</span> <span class="s2">&quot;invalid string length&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">list_error</span><span class="p">(</span><span class="n">l1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">l2</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>list_error(l1=[], l2=[], maxlen=5)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="debugging-inputs">
<h2>Debugging Inputs<a class="headerlink" href="#debugging-inputs" title="Link to this heading">#</a></h2>
<p>Sometimes, it may be useful to not <em>minimize</em> the input, but rather <em>maximize</em> it – that is, to find the <em>maximum</em> input that does <em>not</em> fail. For instance, you may have an input of which you want to <em>preserve</em> as much as possible – to repair it, or to establish a <em>context</em> that is as close as possible to the real input.</p>
<p>This is possible by using the <code class="docutils literal notranslate"><span class="pre">max_arg()</span></code> method. It implements the <code class="docutils literal notranslate"><span class="pre">ddmax</span></code> variant of the general Delta Debugging algorithm \cite{Kirschner2020}. With each step, it tries to add more and more characters to the passing input until it is <em>1-maximal</em> – that is, any additional character that would be added from the failing input also would cause the function to fail.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
<span class="n">max_passing_input</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">max_args</span><span class="p">()[</span><span class="s1">&#39;inp&#39;</span><span class="p">]</span>
<span class="n">max_passing_input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Observed mystery(inp=&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;) raising ValueError: Invalid input
Test #1 mystery(inp=&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Processing inp...
Test #2 mystery(inp=&#39;&#39;): PASS
Test #3 mystery(inp=&#39;z*+s/Q,7)2@0_&#39;): PASS
Test #4 mystery(inp=&#39;-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Test #5 mystery(inp=&#39;V&quot;/+!aFz*+s/Q,7)2@0_&#39;): PASS
Test #6 mystery(inp=&#39;V&quot;/+!aF4EOz*+s/Q,7)2@0_&#39;): PASS
Test #7 mystery(inp=&#39;V&quot;/+!aF-4EOz*+s/Q,7)2@0_&#39;): PASS
Test #8 mystery(inp=&#39;V&quot;/+!aF-V4EOz*+s/Q,7)2@0_&#39;): PASS
Maximized inp to &#39;V&quot;/+!aF-V4EOz*+s/Q,7)2@0_&#39;
Maximized passing call to mystery(inp=&#39;V&quot;/+!aF-V4EOz*+s/Q,7)2@0_&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;V&quot;/+!aF-V4EOz*+s/Q,7)2@0_&#39;
</pre></div>
</div>
</div>
</div>
<p>Note that this is precisely the failure-inducing input <em>except</em> for the first parenthesis. Adding this single character would cause the input to cause a failure.</p>
</section>
<section id="failure-inducing-differences">
<h2>Failure-Inducing Differences<a class="headerlink" href="#failure-inducing-differences" title="Link to this heading">#</a></h2>
<p>If one wants to look for <em>differences</em> that distinguish passing from failing runs, Delta Debugging also has a direct method for this – by both maximizing the passing input and minimizing the failing input until they meet somewhere in the middle. The remaining difference is what makes the difference between passing and failing.</p>
<p>To compute the failure-inducing differences for <code class="docutils literal notranslate"><span class="pre">mystery()</span></code>, use the <code class="docutils literal notranslate"><span class="pre">min_arg_diff()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">mystery</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
<span class="n">max_passing_args</span><span class="p">,</span> <span class="n">min_failing_args</span><span class="p">,</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_arg_diff</span><span class="p">()</span>
<span class="n">max_passing_args</span><span class="p">[</span><span class="s1">&#39;inp&#39;</span><span class="p">],</span> <span class="n">min_failing_args</span><span class="p">[</span><span class="s1">&#39;inp&#39;</span><span class="p">],</span> <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;inp&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Observed mystery(inp=&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;) raising ValueError: Invalid input
Test #1 mystery(inp=&#39;V&quot;/+!aF-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Processing inp...
Test #2 mystery(inp=&#39;&#39;): PASS
Test #3 mystery(inp=&#39;V&quot;/+!aF-(V4EO&#39;): PASS
Test #4 mystery(inp=&#39;z*+s/Q,7)2@0_&#39;): PASS
Test #5 mystery(inp=&#39;V&quot;/+!aFz*+s/Q,7)2@0_&#39;): PASS
Test #6 mystery(inp=&#39;-(V4EOz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Test #7 mystery(inp=&#39;-(Vz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Test #8 mystery(inp=&#39;(Vz*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Test #9 mystery(inp=&#39;(z*+s/Q,7)2@0_&#39;): FAIL (ValueError: Invalid input)
Maximized inp to &#39;z*+s/Q,7)2@0_&#39;
Minimized inp to &#39;(z*+s/Q,7)2@0_&#39;
Maximized passing call to mystery(inp=&#39;z*+s/Q,7)2@0_&#39;)
Minimized failing call to mystery(inp=&#39;(z*+s/Q,7)2@0_&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;z*+s/Q,7)2@0_&#39;, &#39;(z*+s/Q,7)2@0_&#39;, &#39;(&#39;)
</pre></div>
</div>
</div>
</div>
<p>Minimizing failure-inducing differences is especially efficient on large inputs, since the number of differences between a passing and a failing input is much smaller than the inputs themselves. Here is the failure-inducing difference as determined by Delta Debugging:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;inp&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;(&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="reducing-program-code">
<h2>Reducing Program Code<a class="headerlink" href="#reducing-program-code" title="Link to this heading">#</a></h2>
<p>One particularly fun application of reducers is on <em>program code</em>. Technically speaking, program code is just another input to a computation; and we can actually automatically determine which minimum of program code is required to produce a failure, using Delta Debugging. Such minimization of code is typically used as it comes to debugging programs that accept code as their input, such as <em>compilers</em> and <em>interpreters</em>. However, it can also pinpoint failure causes in the (input) code itself.</p>
<p>As an example, let us apply Delta Debugging on the code from <a class="reference internal" href="#Assertions.html"><span class="xref myst">the chapter on assertions</span></a>. You do not need to have read the chapter; the important part is that this chapter provides an implementation of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> that we want to use.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">Assertions</span>  <span class="c1"># minor dependency</span>
</pre></div>
</div>
</div>
</div>
<p>Here is the source code of all the chapter; this is several hundred lines long.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">assertions_source_lines</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">Assertions</span><span class="p">)</span>
<span class="c1"># print_content(&quot;&quot;.join(assertions_source_lines), &quot;.py&quot;)</span>
<span class="n">assertions_source_lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;from bookutils import YouTubeVideo\n&#39;,
 &#39;YouTubeVideo(&quot;9mI9sbKFkwU&quot;)\n&#39;,
 &#39;\n&#39;,
 &#39;import bookutils.setup\n&#39;,
 &#39;\n&#39;,
 &#39;from bookutils import quiz\n&#39;,
 &#39;\n&#39;,
 &#39;import Tracer\n&#39;,
 &#39;\n&#39;,
 &#39;from ExpectError import ExpectError\n&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">assertions_source_lines</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>552
</pre></div>
</div>
</div>
</div>
<p>We can take this code and execute it. Nothing particular should happen here, as our imports only import definitions of functions, classes, and global variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compile_and_run</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># To execute &#39;Assertions&#39; in place, we need to define __name__ and __package__</span>
    <span class="n">exec</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;__name__&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;string&gt;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;__package__&#39;</span><span class="p">:</span> <span class="s1">&#39;debuggingbook&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;Any&#39;</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                         <span class="s1">&#39;Type&#39;</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span>
                         <span class="s1">&#39;TracebackType&#39;</span><span class="p">:</span> <span class="n">TracebackType</span><span class="p">,</span>
                         <span class="s1">&#39;Optional&#39;</span><span class="p">:</span> <span class="n">Optional</span><span class="p">},</span>
         <span class="p">{})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compile_and_run</span><span class="p">(</span><span class="n">assertions_source_lines</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Assertions</span><span class="w"> </span><span class="kn">import</span> <span class="n">remove_html_markup</span>  <span class="c1"># minor dependency</span>
</pre></div>
</div>
</div>
</div>
<p>Let us add some code to it – a “My Test” assertion that tests that <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, applied on a string with double quotes, should keep these in place:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compile_and_test_html_markup_simple</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">compile_and_run</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span> 
        <span class="p">[</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;&#39;&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;, &quot;My Test&quot;\n&#39;&#39;&#39;</span>
        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>This assertion fails. (As always, <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> is buggy.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">compile_and_test_html_markup_simple</span><span class="p">(</span><span class="n">assertions_source_lines</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2334363057.py&quot;, line 2, in &lt;module&gt;
    compile_and_test_html_markup_simple(assertions_source_lines)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/1838190689.py&quot;, line 2, in compile_and_test_html_markup_simple
    compile_and_run(lines +
    ~~~~~~~~~~~~~~~^^^^^^^^
        [
        ^
            &#39;&#39;&#39;&#39;&#39;&#39;,
            ^^^^^^^
            &#39;&#39;&#39;assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;, &quot;My Test&quot;\n&#39;&#39;&#39;
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ])
        ^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2075409738.py&quot;, line 3, in compile_and_run
    exec(&quot;&quot;.join(lines), {&#39;__name__&#39;: &#39;&lt;string&gt;&#39;,
    ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                          &#39;__package__&#39;: &#39;debuggingbook&#39;,
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...&lt;3 lines&gt;...
                         &#39;Optional&#39;: Optional},
                         ^^^^^^^^^^^^^^^^^^^^^^
         {})
         ^^^
  File &quot;&lt;string&gt;&quot;, line 553, in &lt;module&gt;
AssertionError: My Test (expected)
</pre></div>
</div>
</div>
</div>
<p>The question we want to address in this section is: Given this assertion, can we automatically determine which part of the <code class="docutils literal notranslate"><span class="pre">Assertions</span></code> code lines in <code class="docutils literal notranslate"><span class="pre">assertions_source_lines</span></code> is relevant for producing the failure?</p>
<section id="reducing-code-lines">
<h3>Reducing Code Lines<a class="headerlink" href="#reducing-code-lines" title="Link to this heading">#</a></h3>
<p>Since our <code class="docutils literal notranslate"><span class="pre">Assertions</span></code> source code comes as a list of lines, we can apply our <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> on it. The result will be the list of source lines that is necessary to make the assertion fail.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">What will the reduced set of lines contain?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="de3b756a-b293-11f0-b3c5-6298cf1a5790" id="de3b756a-b293-11f0-b3c5-6298cf1a5790-1" onclick="clear_selection('de3b756a-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de3b756a-b293-11f0-b3c5-6298cf1a5790-1-label" for="de3b756a-b293-11f0-b3c5-6298cf1a5790-1">All of the source code in the assertions chapter.</label><br>
    
        <input type="radio" name="de3b756a-b293-11f0-b3c5-6298cf1a5790" id="de3b756a-b293-11f0-b3c5-6298cf1a5790-2" onclick="clear_selection('de3b756a-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de3b756a-b293-11f0-b3c5-6298cf1a5790-2-label" for="de3b756a-b293-11f0-b3c5-6298cf1a5790-2">Only the source code of <code>remove_html_markup()</code></label><br>
    
        <input type="radio" name="de3b756a-b293-11f0-b3c5-6298cf1a5790" id="de3b756a-b293-11f0-b3c5-6298cf1a5790-3" onclick="clear_selection('de3b756a-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de3b756a-b293-11f0-b3c5-6298cf1a5790-3-label" for="de3b756a-b293-11f0-b3c5-6298cf1a5790-3">Only a subset of <code>remove_html_markup()</code></label><br>
    
        <input type="radio" name="de3b756a-b293-11f0-b3c5-6298cf1a5790" id="de3b756a-b293-11f0-b3c5-6298cf1a5790-4" onclick="clear_selection('de3b756a-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de3b756a-b293-11f0-b3c5-6298cf1a5790-4-label" for="de3b756a-b293-11f0-b3c5-6298cf1a5790-4">No lines at all.</label><br>
    
    </div>
    </p>
    <input id="de3b756a-b293-11f0-b3c5-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('de3b756a-b293-11f0-b3c5-6298cf1a5790', 8, 0, '[x for x in range((1 + 1) ** (1 + 1)) if x % (1 + 1) == 1][1]')">
    <span class="quiz_hint" id="de3b756a-b293-11f0-b3c5-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Let us see what the <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> produces.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">compile_and_test_html_markup_simple</span><span class="p">(</span><span class="n">assertions_source_lines</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We get exactly <em>two</em> lines of code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_lines</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">reduced_lines</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<p>And these are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_content</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">reduced_lines</span><span class="p">),</span> <span class="s2">&quot;.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
</pre></div>
</div>
</div>
</div>
<p>On these lines, our test actually still fails:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">compile_and_test_html_markup_simple</span><span class="p">(</span><span class="n">reduced_lines</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2457905094.py&quot;, line 2, in &lt;module&gt;
    compile_and_test_html_markup_simple(reduced_lines)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/1838190689.py&quot;, line 2, in compile_and_test_html_markup_simple
    compile_and_run(lines +
    ~~~~~~~~~~~~~~~^^^^^^^^
        [
        ^
            &#39;&#39;&#39;&#39;&#39;&#39;,
            ^^^^^^^
            &#39;&#39;&#39;assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;, &quot;My Test&quot;\n&#39;&#39;&#39;
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ])
        ^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2075409738.py&quot;, line 3, in compile_and_run
    exec(&quot;&quot;.join(lines), {&#39;__name__&#39;: &#39;&lt;string&gt;&#39;,
    ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                          &#39;__package__&#39;: &#39;debuggingbook&#39;,
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...&lt;3 lines&gt;...
                         &#39;Optional&#39;: Optional},
                         ^^^^^^^^^^^^^^^^^^^^^^
         {})
         ^^^
  File &quot;&lt;string&gt;&quot;, line 3, in &lt;module&gt;
AssertionError: My Test (expected)
</pre></div>
</div>
</div>
</div>
<p>This failure may come as a surprise – <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> is reduced to a function which does not even return a value. However, this is how it causes our “My Test” assertion to fail: In Python, a function without an explicit <code class="docutils literal notranslate"><span class="pre">return</span></code> statement returns <code class="docutils literal notranslate"><span class="pre">None</span></code>. This value is definitely not the string the “My Test” assertion expects, so it fails.</p>
<p>At the same time, we also have a function <code class="docutils literal notranslate"><span class="pre">test_square_root()</span></code> which is equally devoid of any meaning – its code line does not even stem from its original implementation. Note, however, how the set of four lines is actually 1-minimal – removing any further line would result in a syntax error.</p>
<p>To ensure we do not remove code that actually would be necessary for normal behavior, let us add another check – one that checks for the <em>normal</em> functionality of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>. If this one fails (say, after the code has been tampered with too much), it raises an exception – but a <em>different</em> one from the original failure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compile_and_test_html_markup</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">compile_and_run</span><span class="p">(</span><span class="n">lines</span> <span class="o">+</span>
        <span class="p">[</span>
            <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;if remove_html_markup(&#39;&lt;foo&gt;bar&lt;/foo&gt;&#39;) != &#39;bar&#39;:\n&#39;&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;    raise RuntimeError(&quot;Missing functionality&quot;)\n&#39;&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;, &quot;My Test&quot;\n&#39;&#39;&#39;</span>
        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>On our “reduced” code, we now obtain a different exception.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">compile_and_test_html_markup</span><span class="p">(</span><span class="n">reduced_lines</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/810405118.py&quot;, line 2, in &lt;module&gt;
    compile_and_test_html_markup(reduced_lines)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4067432722.py&quot;, line 2, in compile_and_test_html_markup
    compile_and_run(lines +
    ~~~~~~~~~~~~~~~^^^^^^^^
        [
        ^
    ...&lt;3 lines&gt;...
            &#39;&#39;&#39;assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;, &quot;My Test&quot;\n&#39;&#39;&#39;
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ])
        ^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2075409738.py&quot;, line 3, in compile_and_run
    exec(&quot;&quot;.join(lines), {&#39;__name__&#39;: &#39;&lt;string&gt;&#39;,
    ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                          &#39;__package__&#39;: &#39;debuggingbook&#39;,
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...&lt;3 lines&gt;...
                         &#39;Optional&#39;: Optional},
                         ^^^^^^^^^^^^^^^^^^^^^^
         {})
         ^^^
  File &quot;&lt;string&gt;&quot;, line 4, in &lt;module&gt;
RuntimeError: Missing functionality (expected)
</pre></div>
</div>
</div>
</div>
<p>Such an outcome that is different from the original failure causes our <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> not treating this as a failure, but rather as a <code class="docutils literal notranslate"><span class="pre">UNRESOLVED</span></code> outcome, indicating that the test cannot determine whether it passed or failed. The <code class="docutils literal notranslate"><span class="pre">ddmin</span></code> algorithm treats such unresolved outcomes as if they were passing; hence, the algorithm treats its minimization attempt as unsuccessful.</p>
<p>How does this change things? When we reduce the <code class="docutils literal notranslate"><span class="pre">Assertions</span></code> source code with the extended assertions, we now get a different result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">compile_and_test_html_markup</span><span class="p">(</span><span class="n">assertions_source_lines</span><span class="p">)</span>
<span class="n">reduced_assertions_source_lines</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Our result actually is the source code of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> – and <em>only</em> the source code. This is a success, as Delta Debugging has eliminated all the other parts of the <code class="docutils literal notranslate"><span class="pre">Assertions</span></code> source code; these neither contribute to the correct functioning of <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, nor to the failure at hand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">reduced_assertions_source_lines</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>
    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c
    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>All in all, we have reduced the number of relevant lines in <code class="docutils literal notranslate"><span class="pre">Assertions</span></code> to about 3% of the original source code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">reduced_assertions_source_lines</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">assertions_source_lines</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.025362318840579712
</pre></div>
</div>
</div>
</div>
<p>The astute reader may notice that <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code>, as shown above, is slightly different from the original version in the <a class="reference internal" href="Assertions.html"><span class="std std-doc">chapter on assertions</span></a>. Here’s the original version for comparison:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">remove_html_markup_source_lines</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">Assertions</span><span class="o">.</span><span class="n">remove_html_markup</span><span class="p">)</span>
<span class="n">print_content</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">remove_html_markup_source_lines</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-White"># postcondition</span>
    <span class=" -Color -Color-Blue">assert</span> <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">not</span> <span class=" -Color -Color-Magenta">in</span> out <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">not</span> <span class=" -Color -Color-Magenta">in</span> out

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">In the reduced version, what has changed?</div>
    </p>
    <p>
    <div class="quiz_options" title="Check all that apply.">
    
        <input type="checkbox" name="de546b42-b293-11f0-b3c5-6298cf1a5790" id="de546b42-b293-11f0-b3c5-6298cf1a5790-1" onclick="clear_selection('de546b42-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de546b42-b293-11f0-b3c5-6298cf1a5790-1-label" for="de546b42-b293-11f0-b3c5-6298cf1a5790-1">Comments are deleted</label><br>
    
        <input type="checkbox" name="de546b42-b293-11f0-b3c5-6298cf1a5790" id="de546b42-b293-11f0-b3c5-6298cf1a5790-2" onclick="clear_selection('de546b42-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de546b42-b293-11f0-b3c5-6298cf1a5790-2-label" for="de546b42-b293-11f0-b3c5-6298cf1a5790-2">Blank lines are deleted</label><br>
    
        <input type="checkbox" name="de546b42-b293-11f0-b3c5-6298cf1a5790" id="de546b42-b293-11f0-b3c5-6298cf1a5790-3" onclick="clear_selection('de546b42-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de546b42-b293-11f0-b3c5-6298cf1a5790-3-label" for="de546b42-b293-11f0-b3c5-6298cf1a5790-3">Initializations are deleted</label><br>
    
        <input type="checkbox" name="de546b42-b293-11f0-b3c5-6298cf1a5790" id="de546b42-b293-11f0-b3c5-6298cf1a5790-4" onclick="clear_selection('de546b42-b293-11f0-b3c5-6298cf1a5790')">
        <label id="de546b42-b293-11f0-b3c5-6298cf1a5790-4-label" for="de546b42-b293-11f0-b3c5-6298cf1a5790-4">The assertion is deleted</label><br>
    
    </div>
    </p>
    <input id="de546b42-b293-11f0-b3c5-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('de546b42-b293-11f0-b3c5-6298cf1a5790', 22, 1, '[(1 ** 0 - -1 ** 0) ** n for n in range(0, 3)]')">
    <span class="quiz_hint" id="de546b42-b293-11f0-b3c5-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Indeed, Delta Debugging has determined all these as being irrelevant for reproducing the failure – and consequently, has deleted them.</p>
</section>
<section id="reducing-code-characters">
<h3>Reducing Code Characters<a class="headerlink" href="#reducing-code-characters" title="Link to this heading">#</a></h3>
<p>We can reduce the code further by removing individual <em>characters</em> rather than lines. To this end, we convert our (already reduced) <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> code into a list of characters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_assertions_source_characters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">reduced_assertions_source_lines</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reduced_assertions_source_characters</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39; &#39;, &#39;r&#39;, &#39;e&#39;, &#39;m&#39;, &#39;o&#39;, &#39;v&#39;, &#39;e&#39;, &#39;_&#39;, &#39;h&#39;, &#39;t&#39;, &#39;m&#39;, &#39;l&#39;, &#39;_&#39;, &#39;m&#39;, &#39;a&#39;, &#39;r&#39;, &#39;k&#39;, &#39;u&#39;, &#39;p&#39;, &#39;(&#39;, &#39;s&#39;, &#39;)&#39;, &#39;:&#39;, &#39; &#39;, &#39; &#39;, &#39;#&#39;, &#39; &#39;]
</pre></div>
</div>
</div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">compile_and_test_html_markup()</span></code> works (and fails) as before: It still joins the given strings into one and executes them. (Remember that in Python, “characters” are simply strings of length one.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">compile_and_test_html_markup</span><span class="p">(</span><span class="n">reduced_assertions_source_characters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/909985861.py&quot;, line 2, in &lt;module&gt;
    compile_and_test_html_markup(reduced_assertions_source_characters)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/4067432722.py&quot;, line 2, in compile_and_test_html_markup
    compile_and_run(lines +
    ~~~~~~~~~~~~~~~^^^^^^^^
        [
        ^
    ...&lt;3 lines&gt;...
            &#39;&#39;&#39;assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;, &quot;My Test&quot;\n&#39;&#39;&#39;
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ])
        ^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2075409738.py&quot;, line 3, in compile_and_run
    exec(&quot;&quot;.join(lines), {&#39;__name__&#39;: &#39;&lt;string&gt;&#39;,
    ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                          &#39;__package__&#39;: &#39;debuggingbook&#39;,
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...&lt;3 lines&gt;...
                         &#39;Optional&#39;: Optional},
                         ^^^^^^^^^^^^^^^^^^^^^^
         {})
         ^^^
  File &quot;&lt;string&gt;&quot;, line 17, in &lt;module&gt;
AssertionError: My Test (expected)
</pre></div>
</div>
</div>
</div>
<p>Let’s see what Delta Debugging makes of that – and also, how long it takes. The <code class="docutils literal notranslate"><span class="pre">Timer</span></code> class gives us a simple means to measure time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Timer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">compile_and_test_html_markup</span><span class="p">(</span><span class="n">reduced_assertions_source_characters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s the reduced result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">further_reduced_assertions_source_characters</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span>
<span class="n">print_content</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">further_reduced_assertions_source_characters</span><span class="p">),</span> <span class="s2">&quot;.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):
    tag=<span class=" -Color -Color-Blue">False</span>
    quote=<span class=" -Color -Color-Blue">False</span>
    out=<span class=" -Color -Color-Yellow">&quot;&quot;</span>
    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c==<span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span><span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:tag=<span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">if</span> c==<span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span><span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:tag=<span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c==<span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span><span class=" -Color -Color-Magenta">or</span> c==<span class=" -Color -Color-Yellow">&quot;&quot;</span><span class=" -Color -Color-Magenta">and</span> g:<span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:out=out+c
    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>There’s a number of observations we can make about this code.</p>
<ul class="simple">
<li><p>All superfluous blanks and even newlines have been removed.</p></li>
<li><p>As a curiosity, the initialization of <code class="docutils literal notranslate"><span class="pre">quote</span></code> and <code class="docutils literal notranslate"><span class="pre">out</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> is now merged into a single (semantics-preserving) statement.</p></li>
<li><p>The semantics and effect of <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> characters is preserved, as mandated by our <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code> check.</p></li>
<li><p>Double quotes still have the effect of not being included in the returned value: the remaining <code class="docutils literal notranslate"><span class="pre">quote</span></code> has no effect.</p></li>
</ul>
<p>Semantics-wise, this reduced variant still yields the “original” failure; the biggest semantic differences, though, are in the condition and code associated with double quotes – which actually also is the location of the defect to be fixed. This is how reducing code can also point to not only <em>necessary</em> locations, but also <em>defective</em> locations.</p>
<p>Mind you that reducing code is not cheap, and especially not if you remove by characters. It has taken <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> several thousand tests to obtain the result above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">tests</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1278
</pre></div>
</div>
</div>
</div>
<p>And to do so, it even required <em>several seconds</em>. This may be little for a human, but from a CPU standpoint, this is an enormous effort.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2381666250003036
</pre></div>
</div>
</div>
</div>
</section>
<section id="reducing-syntax-trees">
<h3>Reducing Syntax Trees<a class="headerlink" href="#reducing-syntax-trees" title="Link to this heading">#</a></h3>
<p>When reducing code (or generally speaking, recursive structures), using a <em>syntactic</em> approach can be a much better alternative to the <em>line-by-line</em> or <em>character-by-character</em> approaches discussed above. The idea is that one represents the input as a <em>tree</em> (rather than a sequence of strings), in which a reducer would work on entire subtrees, deleting or reducing parts of the tree.</p>
<p>We illustrate this concept on <em>syntax trees</em> representing Python code. Python provides us with simple means to interactively convert code into syntax trees (and back again). So, in order to reduce code, we can</p>
<ol class="arabic simple">
<li><p><em>parse</em> the program code into a syntax tree (called <em>abstract syntax tree</em> or <em>AST</em>);</p></li>
<li><p>reduce the syntax tree to a minimum, executing it to test reductions; and</p></li>
<li><p><em>unparse</em> the tree to obtain textual code again.</p></li>
</ol>
<p>Since transformations on the AST are much less likely to produce syntax errors, reducing ASTs is much more efficient than reducing program code as text.</p>
<p>In the <a class="reference internal" href="Slicer.html"><span class="std std-doc">chapter on slicing</span></a>, we already have seen several examples on how to work with ASTs. In our context, an AST also offers additional possibilities for reducing. Notably, instead of just <em>deleting</em> code fragments, we can also <em>replace</em> them with simpler fragments. For instance, we can replace arithmetic expressions with constants, or conditional statements <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">cond:</span> <span class="pre">body</span></code> with the associated body <code class="docutils literal notranslate"><span class="pre">body</span></code>.</p>
<p>Let us illustrate how this works, again choosing <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> as our ongoing example. One more time, we create a function with associated test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fun_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">fun_source</span><span class="p">,</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):  <span class=" -Color -Color-White"># type: ignore</span>
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&quot;&quot;</span>

    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Magenta">not</span> quote:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag:
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c

    <span class=" -Color -Color-White"># postcondition</span>
    <span class=" -Color -Color-Blue">assert</span> <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">not</span> <span class=" -Color -Color-Magenta">in</span> out <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">not</span> <span class=" -Color -Color-Magenta">in</span> out

    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<section id="from-code-to-syntax-trees">
<h4>From Code to Syntax Trees<a class="headerlink" href="#from-code-to-syntax-trees" title="Link to this heading">#</a></h4>
<p>Let us parse this piece of code into an AST. This is done by the <code class="docutils literal notranslate"><span class="pre">ast.parse()</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fun_tree</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fun_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The parsed tree contains the function definition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bookutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_ast</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_ast</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a36761cbe1cfb4ebe39968d8673208cdc386e6ac759d68b33273d394d8ed7493.svg" src="_images/a36761cbe1cfb4ebe39968d8673208cdc386e6ac759d68b33273d394d8ed7493.svg" />
</div>
</div>
<p>Let us add some tests to this, using the same scheme:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_source</span> <span class="o">=</span> <span class="p">(</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;if remove_html_markup(&#39;&lt;foo&gt;bar&lt;/foo&gt;&#39;) != &#39;bar&#39;:\n&#39;&#39;&#39;</span> <span class="o">+</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;    raise RuntimeError(&quot;Missing functionality&quot;)\n&#39;&#39;&#39;</span> <span class="o">+</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;assert remove_html_markup(&#39;&quot;foo&quot;&#39;) == &#39;&quot;foo&quot;&#39;, &quot;My Test&quot;&#39;&#39;&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_tree</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">test_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">test_tree</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">if</span> remove_html_markup(<span class=" -Color -Color-Yellow">&#39;&lt;foo&gt;bar&lt;/foo&gt;&#39;</span>) != <span class=" -Color -Color-Yellow">&#39;bar&#39;</span>:
    <span class=" -Color -Color-Blue">raise</span> <span class=" -Color -Color-Cyan">RuntimeError</span>(<span class=" -Color -Color-Yellow">&#39;Missing functionality&#39;</span>)
<span class=" -Color -Color-Blue">assert</span> remove_html_markup(<span class=" -Color -Color-Yellow">&#39;&quot;foo&quot;&#39;</span>) == <span class=" -Color -Color-Yellow">&#39;&quot;foo&quot;&#39;</span>, <span class=" -Color -Color-Yellow">&#39;My Test&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>We can merge the function definition tree and the test tree into a single one:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fun_test_tree</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">)</span>
<span class="n">fun_test_tree</span><span class="o">.</span><span class="n">body</span> <span class="o">+=</span> <span class="n">test_tree</span><span class="o">.</span><span class="n">body</span>
</pre></div>
</div>
</div>
</div>
<p>Such a tree can be compiled into a code object, using Python’s <code class="docutils literal notranslate"><span class="pre">compile()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fun_test_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">fun_test_tree</span><span class="p">,</span> <span class="s1">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>and the resulting code object can be executed directly, using the Python <code class="docutils literal notranslate"><span class="pre">exec()</span></code> function. We see that our test fails as expected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">fun_test_code</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/1290587190.py&quot;, line 2, in &lt;module&gt;
    exec(fun_test_code, {}, {})
    ~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;&lt;string&gt;&quot;, line 3, in &lt;module&gt;
AssertionError: My Test (expected)
</pre></div>
</div>
</div>
</div>
</section>
<section id="traversing-syntax-trees">
<h4>Traversing Syntax Trees<a class="headerlink" href="#traversing-syntax-trees" title="Link to this heading">#</a></h4>
<p>Our goal is now to reduce this tree (or at least the subtree with the function definition) to a minimum.
To this end, we manipulate the AST through the <code class="docutils literal notranslate"><span class="pre">ast</span></code> Python module. The <a class="reference external" href="http://docs.python.org/3/library/ast">official Python <code class="docutils literal notranslate"><span class="pre">ast</span></code> reference</a> is complete, but a bit brief; the documentation <a class="reference external" href="https://greentreesnakes.readthedocs.io/en/latest/">“Green Tree Snakes - the missing Python AST docs”</a> provides an excellent introduction.</p>
<p>The two means for exploring and changing ASTs are the classes <code class="docutils literal notranslate"><span class="pre">NodeVisitor</span></code> and <code class="docutils literal notranslate"><span class="pre">NodeTransformer</span></code>, respectively. We start with creating a list of all nodes in the tree, using a <code class="docutils literal notranslate"><span class="pre">NodeVisitor</span></code> subclass.</p>
<p>Its <code class="docutils literal notranslate"><span class="pre">visit()</span></code> method is called for every node in the tree, which we achieve by having it return <code class="docutils literal notranslate"><span class="pre">self.generic_visit()</span></code> for the current node. It saves all visited nodes in the <code class="docutils literal notranslate"><span class="pre">_all_nodes</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ast</span><span class="w"> </span><span class="kn">import</span> <span class="n">NodeTransformer</span><span class="p">,</span> <span class="n">NodeVisitor</span><span class="p">,</span> <span class="n">AST</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NodeCollector</span><span class="p">(</span><span class="n">NodeVisitor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect all nodes in an AST.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AST</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generic_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AST</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all nodes in tree.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_nodes</span>
</pre></div>
</div>
</div>
</div>
<p>This is how our <code class="docutils literal notranslate"><span class="pre">NodeCollector()</span></code> class produces a list of all nodes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fun_nodes</span> <span class="o">=</span> <span class="n">NodeCollector</span><span class="p">()</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">fun_nodes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>107
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fun_nodes</span><span class="p">[:</span><span class="mi">30</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;ast.Module at 0x10bb58750&gt;,
 &lt;ast.FunctionDef at 0x10bb5b9d0&gt;,
 &lt;ast.arguments at 0x10bb58d90&gt;,
 &lt;ast.arg at 0x10bb5ad90&gt;,
 &lt;ast.Assign at 0x10b76da10&gt;,
 &lt;ast.Name at 0x10bb5afd0&gt;,
 &lt;ast.Store at 0x1078e1bd0&gt;,
 &lt;ast.Constant at 0x10bb8ef10&gt;,
 &lt;ast.Assign at 0x10bb8e050&gt;,
 &lt;ast.Name at 0x10bb8f250&gt;,
 &lt;ast.Store at 0x1078e1bd0&gt;,
 &lt;ast.Constant at 0x10bb8e810&gt;,
 &lt;ast.Assign at 0x10bb8e210&gt;,
 &lt;ast.Name at 0x10bb8eb90&gt;,
 &lt;ast.Store at 0x1078e1bd0&gt;,
 &lt;ast.Constant at 0x10bb8e5d0&gt;,
 &lt;ast.For at 0x10bb8f810&gt;,
 &lt;ast.Name at 0x10bb8eb10&gt;,
 &lt;ast.Store at 0x1078e1bd0&gt;,
 &lt;ast.Name at 0x10bb8fc90&gt;,
 &lt;ast.Load at 0x1078e1b50&gt;,
 &lt;ast.If at 0x10bb8f010&gt;,
 &lt;ast.BoolOp at 0x10bb8f9d0&gt;,
 &lt;ast.And at 0x1078e1e10&gt;,
 &lt;ast.Compare at 0x10bb8f150&gt;,
 &lt;ast.Name at 0x10bb8f350&gt;,
 &lt;ast.Load at 0x1078e1b50&gt;,
 &lt;ast.Eq at 0x1078e2b50&gt;,
 &lt;ast.Constant at 0x10bb8e290&gt;,
 &lt;ast.UnaryOp at 0x10a2a0cd0&gt;]
</pre></div>
</div>
</div>
</div>
<p>Such a list of nodes is what we can feed into Delta Debugging in order to reduce it. The idea is that with every test, we take the tree and for each node in the tree, we check whether it is still in the list – if not, we remove it. Thus, by reducing the list of nodes, we simultaneously reduce the tree as well.</p>
</section>
<section id="deleting-nodes">
<h4>Deleting Nodes<a class="headerlink" href="#deleting-nodes" title="Link to this heading">#</a></h4>
<p>In our next step, we write some code that, given such a list of nodes, <em>prunes</em> the tree such that <em>only</em> elements in the list are still contained. To this end, we proceed in four steps:</p>
<ol class="arabic simple">
<li><p>We traverse the original AST, <em>marking</em> all nodes as “to be deleted”.</p></li>
<li><p>We traverse the given list of nodes, clearing their markers.</p></li>
<li><p>We copy the original tree (including the markers) into a new tree – the one to be reduced.</p></li>
<li><p>We traverse the new tree, now deleting all marked nodes.</p></li>
</ol>
<p>Why do we go through such an extra effort? The reason is that our list of nodes contains references into the <em>original</em> tree – a tree that needs to stay unchanged such that we can reuse it for later. The new tree (the copy) has the same nodes, but at different addresses, so our original references cannot be used anymore. Markers, however, just like any other attributes, are safely copied from the original into the new tree.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NodeMarker()</span></code> visitor marks all nodes in a tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NodeMarker</span><span class="p">(</span><span class="n">NodeVisitor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AST</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">marked</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">NodeReducer()</span></code> transformer reduces all marked nodes. If a method <code class="docutils literal notranslate"><span class="pre">visit_&lt;node</span> <span class="pre">class&gt;()</span></code> is defined, it will be invoked; otherwise, <code class="docutils literal notranslate"><span class="pre">visit_Node()</span></code> is invoked, which <em>deletes</em> the node (and its subtree) by returning <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NodeReducer</span><span class="p">(</span><span class="n">NodeTransformer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;visit_&#39;</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">visitor</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit_Node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="c1"># Can&#39;t remove modules</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default visitor for all nodes&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">marked</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># delete it</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Our function <code class="docutils literal notranslate"><span class="pre">copy_and_reduce()</span></code> puts these pieces together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">copy_and_reduce</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">AST</span><span class="p">,</span> <span class="n">keep_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AST</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AST</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy tree, reducing all nodes that are not in keep_list.&quot;&quot;&quot;</span>

    <span class="c1"># Mark all nodes except those in keep_list</span>
    <span class="n">NodeMarker</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">keep_list</span><span class="p">:</span>
        <span class="c1"># print(&quot;Clearing&quot;, node)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">marked</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># type: ignore</span>

    <span class="c1"># Copy tree and delete marked nodes</span>
    <span class="n">new_tree</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">NodeReducer</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">new_tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_tree</span>
</pre></div>
</div>
</div>
</div>
<p>Let us apply this in practice. We take the first assignment in our tree…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fun_nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ast.Assign at 0x10b76da10&gt;
</pre></div>
</div>
</div>
</div>
<p>… whose subtree happens to be the assignment to <code class="docutils literal notranslate"><span class="pre">tag</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">fun_nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;tag = False&#39;
</pre></div>
</div>
</div>
</div>
<p>We keep all nodes <em>except</em> for this one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keep_list</span> <span class="o">=</span> <span class="n">fun_nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">del</span> <span class="n">keep_list</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let us now create a copy of the tree in which the assignment is missing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_fun_tree</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">copy_and_reduce</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">,</span> <span class="n">keep_list</span><span class="p">))</span>
<span class="n">show_ast</span><span class="p">(</span><span class="n">new_fun_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9c99f416ff3589c4c701a0069634fbcf0c30572f46f776f013b858e871c0c358.svg" src="_images/9c99f416ff3589c4c701a0069634fbcf0c30572f46f776f013b858e871c0c358.svg" />
</div>
</div>
<p>The new tree no longer contains the initial assignment to <code class="docutils literal notranslate"><span class="pre">tag</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">new_fun_tree</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&#39;&#39;</span>
    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> (<span class=" -Color -Color-Magenta">not</span> quote):
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> (<span class=" -Color -Color-Magenta">not</span> quote):
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> (c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag):
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c
    <span class=" -Color -Color-Blue">assert</span> <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">not</span> <span class=" -Color -Color-Magenta">in</span> out <span class=" -Color -Color-Magenta">and</span> <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">not</span> <span class=" -Color -Color-Magenta">in</span> out
    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>If we add our tests and then execute this code, we get an error, as <code class="docutils literal notranslate"><span class="pre">tag</span></code> is now no longer initialized:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_fun_tree</span><span class="o">.</span><span class="n">body</span> <span class="o">+=</span> <span class="n">test_tree</span><span class="o">.</span><span class="n">body</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fun_code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">new_fun_tree</span><span class="p">,</span> <span class="s2">&quot;&lt;string&gt;&quot;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">UnboundLocalError</span><span class="p">):</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">fun_code</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2411822553.py&quot;, line 2, in &lt;module&gt;
    exec(fun_code, {}, {})
    ~~~~^^^^^^^^^^^^^^^^^^
  File &quot;&lt;string&gt;&quot;, line 3, in &lt;module&gt;
  File &quot;&lt;string&gt;&quot;, line 13, in remove_html_markup
UnboundLocalError: cannot access local variable &#39;tag&#39; where it is not associated with a value (expected)
</pre></div>
</div>
</div>
</div>
<p>If we have <em>no</em> node in the keep list, the whole tree gets deleted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">empty_tree</span> <span class="o">=</span> <span class="n">copy_and_reduce</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">,</span> <span class="p">[])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">empty_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="reducing-trees">
<h4>Reducing Trees<a class="headerlink" href="#reducing-trees" title="Link to this heading">#</a></h4>
<p>We can put all these steps together in a single function. <code class="docutils literal notranslate"><span class="pre">compile_and_test_ast()</span></code> takes a tree and a list of nodes, reduces the tree to those nodes in the list, and then compiles and runs the reduced AST.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compile_and_test_ast</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">keep_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AST</span><span class="p">],</span> 
                         <span class="n">test_tree</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">new_tree</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">copy_and_reduce</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">keep_list</span><span class="p">))</span>
    <span class="c1"># print(ast.unparse(new_tree))</span>

    <span class="k">if</span> <span class="n">test_tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_tree</span><span class="o">.</span><span class="n">body</span> <span class="o">+=</span> <span class="n">test_tree</span><span class="o">.</span><span class="n">body</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">code_object</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">new_tree</span><span class="p">,</span> <span class="s1">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;Cannot compile&quot;</span><span class="p">)</span>

    <span class="n">exec</span><span class="p">(</span><span class="n">code_object</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="n">compile_and_test_ast</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">,</span> <span class="n">fun_nodes</span><span class="p">,</span> <span class="n">test_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/2588008834.py&quot;, line 2, in &lt;module&gt;
    compile_and_test_ast(fun_tree, fun_nodes, test_tree)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_51600/1107678207.py&quot;, line 14, in compile_and_test_ast
    exec(code_object, {}, {})
    ~~~~^^^^^^^^^^^^^^^^^^^^^
  File &quot;&lt;string&gt;&quot;, line 3, in &lt;module&gt;
AssertionError: My Test (expected)
</pre></div>
</div>
</div>
</div>
<p>When we run our delta debugger on the AST, this is the list of remaining nodes we obtain:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">compile_and_test_ast</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">,</span> <span class="n">fun_nodes</span><span class="p">,</span> <span class="n">test_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_nodes</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()[</span><span class="s1">&#39;keep_list&#39;</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">reduced_nodes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>57
</pre></div>
</div>
</div>
</div>
<p>This is the associated tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_fun_tree</span> <span class="o">=</span> <span class="n">copy_and_reduce</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">,</span> <span class="n">reduced_nodes</span><span class="p">)</span>
<span class="n">show_ast</span><span class="p">(</span><span class="n">reduced_fun_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/143a6f64a731f8b077f240ce307720fd4318ca8231bb9586515d84701fe5fafd.svg" src="_images/143a6f64a731f8b077f240ce307720fd4318ca8231bb9586515d84701fe5fafd.svg" />
</div>
</div>
<p>And this is its textual representation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">reduced_fun_tree</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):
    tag = <span class=" -Color -Color-Blue">False</span>
    quote = <span class=" -Color -Color-Blue">False</span>
    out = <span class=" -Color -Color-Yellow">&#39;&#39;</span>
    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> (<span class=" -Color -Color-Magenta">not</span> quote):
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span> <span class=" -Color -Color-Magenta">and</span> (<span class=" -Color -Color-Magenta">not</span> quote):
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span> <span class=" -Color -Color-Magenta">or</span> (c == <span class=" -Color -Color-Yellow">&quot;&#39;&quot;</span> <span class=" -Color -Color-Magenta">and</span> tag):
            quote = <span class=" -Color -Color-Magenta">not</span> quote
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c
    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span><span class="o">.</span><span class="n">tests</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>310
</pre></div>
</div>
</div>
</div>
<p>We see that some code was deleted – notably the assertion at the end – but otherwise, our deletion strategy was not particularly effective. This is because in Python, one cannot simply delete the single statement in a controlled body – this raises a syntax error. One would have to replace it with <code class="docutils literal notranslate"><span class="pre">pass</span></code> (or some other statement with no effect) to stay syntactically valid. Still, the syntax-based reduction would still single out <code class="docutils literal notranslate"><span class="pre">remove_html_markup()</span></code> from the <code class="docutils literal notranslate"><span class="pre">Assertions</span></code> source code – and do so even faster, as it would apply on one definition (rather than one line) after another.</p>
</section>
<section id="transforming-nodes">
<h4>Transforming Nodes<a class="headerlink" href="#transforming-nodes" title="Link to this heading">#</a></h4>
<p>To further boost our syntactic reduction strategy, we implement a set of additional reduction operators. First, as already discussed, we do not simply delete an assignment, but we replace it with a <code class="docutils literal notranslate"><span class="pre">pass</span></code> statement. To obtain the tree for <code class="docutils literal notranslate"><span class="pre">pass</span></code>, we simply parse it and access the subtree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NodeReducer</span><span class="p">(</span><span class="n">NodeReducer</span><span class="p">):</span>
    <span class="n">PASS_TREE</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;pass&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AST</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">marked</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="c1"># Replace by pass</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PASS_TREE</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In a similar vein, we can replace comparison operators with <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NodeReducer</span><span class="p">(</span><span class="n">NodeReducer</span><span class="p">):</span>
    <span class="n">FALSE_TREE</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;False&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visit_Compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AST</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">marked</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="c1"># Replace by False</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FALSE_TREE</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we have a Boolean operator, we attempt to replace it with its left operand:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NodeReducer</span><span class="p">(</span><span class="n">NodeReducer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">visit_BoolOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AST</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">marked</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="c1"># Replace by left operator</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And if we find an <code class="docutils literal notranslate"><span class="pre">If</span></code> clause, we attempt to replace it by its body:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NodeReducer</span><span class="p">(</span><span class="n">NodeReducer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">visit_If</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">AST</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">marked</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="c1"># Replace by body</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us try to reduce our code with these additional reducers enabled:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">compile_and_test_ast</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">,</span> <span class="n">fun_nodes</span><span class="p">,</span> <span class="n">test_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is the reduced code we get. We see that all references to <code class="docutils literal notranslate"><span class="pre">quote</span></code> have gone, as has the handling of single quotes – none of this is relevant for the failure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_nodes</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">min_args</span><span class="p">()[</span><span class="s1">&#39;keep_list&#39;</span><span class="p">]</span>
<span class="n">reduced_fun_tree</span> <span class="o">=</span> <span class="n">copy_and_reduce</span><span class="p">(</span><span class="n">fun_tree</span><span class="p">,</span> <span class="n">reduced_nodes</span><span class="p">)</span>
<span class="n">print_content</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">reduced_fun_tree</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span><span class=" -Color -Color-White"> </span><span class=" -Color -Color-Green">remove_html_markup</span>(s):
    tag = <span class=" -Color -Color-Blue">False</span>
    <span class=" -Color -Color-Blue">pass</span>
    out = <span class=" -Color -Color-Yellow">&#39;&#39;</span>
    <span class=" -Color -Color-Blue">for</span> c <span class=" -Color -Color-Magenta">in</span> s:
        <span class=" -Color -Color-Blue">if</span> c == <span class=" -Color -Color-Yellow">&#39;&lt;&#39;</span>:
            tag = <span class=" -Color -Color-Blue">True</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&gt;&#39;</span>:
            tag = <span class=" -Color -Color-Blue">False</span>
        <span class=" -Color -Color-Blue">elif</span> c == <span class=" -Color -Color-Yellow">&#39;&quot;&#39;</span>:
            <span class=" -Color -Color-Blue">pass</span>
        <span class=" -Color -Color-Blue">elif</span> <span class=" -Color -Color-Magenta">not</span> tag:
            out = out + c
    <span class=" -Color -Color-Blue">return</span> out
</pre></div>
</div>
</div>
</div>
<p>Again, the best insights come from comparing this reduced version to the original implementation – and we learn that the problem is not related to the <code class="docutils literal notranslate"><span class="pre">quote</span></code> variable, or to the handling of single quotes; the problem is simply that when the input contains double quotes, these are not added to the final string.</p>
<p>With our reduction code, however, we only touch the surface of what could actually be possible. So far, we implement exactly one reduction per node – but of course, there are many alternatives an expression or statement could be reduced to. We will explore some of these in the <a class="reference internal" href="#Exercises"><span class="xref myst">exercises</span></a>, below; also be sure to check out the <a class="reference internal" href="#Background"><span class="xref myst">background</span></a> on code reduction.</p>
</section>
</section>
</section>
<section id="lessons-learned">
<h2>Lessons Learned<a class="headerlink" href="#lessons-learned" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Reducing failure-inducing inputs to a minimum is helpful for testing and debugging.</p></li>
<li><p><em>Delta debugging</em> is a simple and robust algorithm to easily reduce inputs of test cases, as well as their code.</p></li>
<li><p>Precisely specifying failure conditions helps to avoid false diagnoses.</p></li>
</ul>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>Our next chapter focuses on <a class="reference internal" href="ChangeDebugger.html"><span class="std std-doc">finding <em>failure-inducing code changes</em></span></a>, using delta debugging and version control systems.</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>The “lexical” delta debugging algorithm discussed here – both in its simplifying <code class="docutils literal notranslate"><span class="pre">ddmin</span></code> and in its general <code class="docutils literal notranslate"><span class="pre">dd</span></code> form – stem from \cite{Zeller2002}; actually, <code class="docutils literal notranslate"><span class="pre">ddmin</span></code> is the exact Python implementation as used by Zeller in 2002. The <code class="docutils literal notranslate"><span class="pre">ddmax</span></code> variant was first evaluated in \cite{Kirschner2020}. This chapter is the first to show how both <code class="docutils literal notranslate"><span class="pre">ddmin</span></code> and <code class="docutils literal notranslate"><span class="pre">ddmax</span></code> can be implemented as small variations of <code class="docutils literal notranslate"><span class="pre">dd</span></code>.</p>
<p>The idea of systematically reducing inputs has been discovered a number of times, although not as automatic and generic as delta debugging. \cite{Slutz1998}, for instance, discusses systematic reduction of SQL statements for SQL databases; the general process as manual work is well described by \cite{Kernighan1999}.</p>
<p>The deficits of delta debugging as it comes to syntactically complex inputs were first discussed in <em>compiler testing</em>, and <em>reducing tree inputs</em> rather than string inputs was quickly discovered as an alternative.  <em>Hierarchical Delta Debugging</em> (<em>HDD</em>) \cite{Misherghi2006} applies delta debugging on subtrees of a parse tree, systematically reducing a parse tree to a minimum.  <em>Generalized Tree Reduction</em> \cite{Herfert2017} generalizes this idea to apply arbitrary <em>patterns</em> such as replacing a term by a compatible term in a subtree.  Using <em>grammars</em> to reduce inputs was first implemented in the <em>Perses</em> tool \cite{Sun2018}. <a class="reference external" href="https://www.fuzzingbook.org/html/Reducer.html#Grammar-Based-Input-Reduction">A Python implementation of grammar-based input reduction</a> is part of “The Fuzzing Book”.</p>
<p>While applying delta debugging to code lines does a decent job, <em>syntactic</em> and especially <em>language-specific</em> approaches can do a much better job for the programming language at hand:</p>
<ul class="simple">
<li><p><em>C-Reduce</em> \cite{Regehr2012} is a reducer specifically targeting the reduction of programming languages.  Besides reductions in the style of delta debugging or tree transformations, C-Reduce comes with more than 30 source-to-source transformations that replace aggregates by scalars, remove function parameters at a definition and all call sites, change functions to return <code class="docutils literal notranslate"><span class="pre">void</span></code> and deleting all <code class="docutils literal notranslate"><span class="pre">return</span></code> statements, and many more.  While specifically instantiated for the C language (and used for testing C compilers), these principles extend to arbitrary programming languages following an ALGOL-like syntax.</p></li>
<li><p>Kalhauge and Palsberg \cite{Kalhauge2019} introduce <em>binary reduction of dependency graphs</em>, a general solution for reducing arbitrary inputs with dependencies. Their <em>J-Reduce</em> tool specifically targets Java programs, and again is much faster than delta debugging and achieves a higher reduction rate.</p></li>
</ul>
<p>Reducing inputs also works well in the context of <em>property-based testing</em>; that is, generating data structures for individual functions, which can then be reduced (“shrunk”) upon failure. The <a class="reference external" href="https://hypothesis.works">Hypothesis</a> fuzzer has a number of type-specific shrinking strategies; this <a class="reference external" href="https://hypothesis.works/articles/integrated-shrinking/">blog article</a> discusses some of its features.</p>
<p>This <a class="reference external" href="https://www.drmaciver.com/2019/01/notes-on-test-case-reduction/">blog post</a> by David McIver contains lots of insights on how to apply reduction in practice, in particular multiple runs with different abstraction levels.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<p>How to best reduce inputs is still an underdeveloped field of research, with lots of opportunities.</p>
<section id="exercise-1-advanced-syntactic-code-reduction">
<h3>Exercise 1: Advanced Syntactic Code Reduction<a class="headerlink" href="#exercise-1-advanced-syntactic-code-reduction" title="Link to this heading">#</a></h3>
<p>Extend the code in <a class="reference internal" href="#Transforming-Nodes"><span class="xref myst">“Transforming Nodes”</span></a> such that <em>multiple</em> reduction possibilities for a node are being considered. For instance:</p>
<ul class="simple">
<li><p>Replace a <code class="docutils literal notranslate"><span class="pre">BoolOp</span></code> node by <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p>Replace a <code class="docutils literal notranslate"><span class="pre">BoolOp</span></code> node by <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p>Replace a <code class="docutils literal notranslate"><span class="pre">BoolOp</span></code> node by its left operand.</p></li>
<li><p>Replace a <code class="docutils literal notranslate"><span class="pre">BoolOp</span></code> node by its right operand.</p></li>
</ul>
<p>or:</p>
<ul class="simple">
<li><p>Replace an <code class="docutils literal notranslate"><span class="pre">If</span></code> node by its “then” body.</p></li>
<li><p>Replace an <code class="docutils literal notranslate"><span class="pre">If</span></code> node by its “else” body.</p></li>
</ul>
<p>or:</p>
<ul class="simple">
<li><p>Replace all instances of a variable by a constant.</p></li>
</ul>
<p>or:</p>
<ul class="simple">
<li><p>Replace expressions by a constant.</p></li>
</ul>
<p>Have a look at the <a class="reference external" href="http://docs.python.org/3/library/ast">official Python <code class="docutils literal notranslate"><span class="pre">ast</span></code> reference</a> for a list of nodes (and some ideas on what to replace them by). The documentation <a class="reference external" href="https://greentreesnakes.readthedocs.io/en/latest/">“Green Tree Snakes - the missing Python AST docs”</a> provides an excellent introduction on visitors and transformers. Make copious use of AST visualization and tests to ensure your syntax trees are still correct.</p>
<p>Strategy-wise, you should first create a list of <em>possible</em> reductions; and then pass to Delta Debugging a “keep list” of reductions that should <em>not</em> be applied. When Delta Debugging minimizes this list, it will apply as many reductions as possible.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Slicer.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tracking Failure Origins</p>
      </div>
    </a>
    <a class="right-next"
       href="ChangeDebugger.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Isolating Failure-Inducing Changes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-reducing">Why Reducing?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-input-reduction">Manual Input Reduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delta-debugging">Delta Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-deltadebugger-interface">A Simple DeltaDebugger Interface</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#excursion-implementing-deltadebugger">Excursion: Implementing DeltaDebugger</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#collecting-a-call">Collecting a Call</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#repeating-a-call">Repeating a Call</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-logging-and-caching">Testing, Logging, and Caching</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-delta-debugging">General Delta Debugging</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-multiple-arguments">Processing Multiple Arguments</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#public-api">Public API</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-excursion">End of Excursion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-examples">Usage Examples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-remove-html-markup">Reducing remove_html_markup()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-multiple-arguments">Reducing Multiple Arguments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#invoking-an-interactive-debugger">Invoking an Interactive Debugger</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-other-collections">Reducing other Collections</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-inputs">Debugging Inputs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#failure-inducing-differences">Failure-Inducing Differences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-program-code">Reducing Program Code</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-code-lines">Reducing Code Lines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-code-characters">Reducing Code Characters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-syntax-trees">Reducing Syntax Trees</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#from-code-to-syntax-trees">From Code to Syntax Trees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#traversing-syntax-trees">Traversing Syntax Trees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#deleting-nodes">Deleting Nodes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-trees">Reducing Trees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transforming-nodes">Transforming Nodes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-advanced-syntactic-code-reduction">Exercise 1: Advanced Syntactic Code Reduction</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andreas Zeller
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
  Copyright &copy; 2021–2025 <a href="https://www.cispa.de/">CISPA Helmholtz Center for Information Security</a>.
  The <strong>content</strong> of this project is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  The <strong>source code</strong> that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/debuggingbook/blob/master/LICENSE.md#mit-license">MIT License</a>.
  <br>
  <a href="https://cispa.de/en/impressum">Imprint</a> &middot; <a href="/html/index.html#how-do-i-cite-your-work">Cite</a>
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>